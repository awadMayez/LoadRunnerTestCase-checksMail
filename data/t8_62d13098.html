var __extends,AutoSuggest;(function(n){var t;(function(n){var t,i,r,u,f,e;(function(n){n.User="SRCHHPGUSR"})(t=n.CookieNames||(n.CookieNames={})),function(n){n.AutoSuggest="AS"}(i=n.CrumbNames||(n.CrumbNames={})),function(n){n.CursorPosition="cp";n.ConversationId="cvid";n.SuggestionCount="sc";n.PartialQuery="pq";n.SuggestionPosition="sp";n.SuggestionType="qs";n.PreviewPaneSuggestionType="qsc";n.SkipValue="sk";n.PreviewPaneSkipValue="skc";n.Ghosting="ghc";n.Css="css";n.Count="count";n.DataSet="ds";n.SessionId="sid";n.TimeStamp="qt";n.Query="q";n.ImpressionGuid="ig";n.QFQuery="qry";n.FormCode="form";n.HashedMuid="nclid";n.RequestElToken="elvr";n.AppId="appid";n.History="history";n.ApiTextDecoration="textdecorations";n.ClientId="clientid";n.Market="mkt";n.Scope="scope";n.CountryCode="cc";n.HomeGeographicRegion="hgr";n.SetLang="setlang"}(r=n.QueryParams||(n.QueryParams={})),function(n){n.ImpressionGuid="X-MSEdge-IG"}(u=n.Headers||(n.Headers={})),function(n){n.HitHighlighting="h";n.PopularNow="p";n.Local="l";n.Answers="a"}(f=n.Options||(n.Options={})),function(n){n.Id="id";n.Query="query";n.Url="url";n.Navigation="nav";n.Type="stype";n.Autocomplete="hc";n.SubstrateInst="substrateInst"}(e=n.SuggestionAttributes||(n.SuggestionAttributes={}))})(t=n.Service||(n.Service={}))})(AutoSuggest||(AutoSuggest={})),function(n){function p(t,i){if(i){var r=y.exec(t);return r&&n.TopLevelDomains[r[1].toLowerCase()]==1}return y.test(t)}function at(n){return lt.test(n)}function u(n,t){var r,i;return n?(n=n.trim(),r=st.exec(n),!r)?null:t&&r[0].length<n.length?null:(i={length:r[0].length,type:0,protocol:r[1],auth:r[2],hostname:r[3],port:r[4],path:r[5],parameters:r[6]},i.auth&&!i.auth.includes(":")&&!i.protocol&&!i.port&&!i.path&&!i.parameters)?null:i.protocol||i.path&&i.path.endsWith("/")?i:i.hostname=="localhost"||p(i.hostname,t)||c.test(i.hostname)||a.test(i.hostname)?i:p(i.hostname,!1)?null:(i.type=i.path&&!at(i.path)?1:2,i):null}function vt(n){return b.some(function(t){return n.startsWith(t)})||w.test(n)}function yt(t,i){var e,r,f,o,s;return i.isMultiWord?!0:(e=u(t,!0),!e||e.type!=0)?!0:(r=i.queryToFetch,c.test(e.hostname)||a.test(e.hostname))?t.startsWith(r)||e.hostname.startsWith(r):(f=e.hostname.split("."),f.length<=2?o=HitHighlightingParser.addMarkers(f[0],r):(f=n.SecondLevelDomains[f[f.length-2]]?f.splice(0,f.length-2):f.splice(0,f.length-1),s=f.join("."),o=HitHighlightingParser.addMarkers(s,r)),!o.includes(HitHighlightingParser.startMarker))?!1:r.includes(".")?(r.endsWith("/")&&(r=r.substr(0,r.length-1)),e.hostname.includes(r)):!0}function pt(n){return ht.test(n)}function k(n){return et.test(n)}function wt(n){return ct.test(n)&&!k(n)}function bt(n){var t;return t=typeof n=="string"?n:d(n),t=kt(t),t.trim().replace(/^ht+p(s)?[:;]+[\\\/]*|^\/*/i,function(n,t){return t?"https://":"http://"})}function kt(n){if(!n||!n.includes("\\"))return n;var i=n.includes("?")?n.indexOf("?"):n.length,r=n.includes("#")?n.indexOf("#"):n.length,t=Math.min(i,r),u=n.substring(0,t),f=n.substr(t);return u.replace(/\\/g,"/")+f}function d(n){var t=n.protocol?n.protocol:"";return t+=n.hostname,t+=n.port?n.port:"",t+=n.path?n.path:"",t+(n.parameters?n.parameters:"")}function i(n,t){var r=n.toLowerCase(),i;return t&1&&(i=g.exec(r),i&&(r=i[1])),t&2&&(i=nt.exec(r),i&&(r=i[1])),t&4&&(i=tt.exec(r),i&&(r=i[1])),t&8&&(i=it.exec(r),i&&(r=i[1])),t&16&&(i=dt.exec(r),i&&(r=i[1])),r}function gt(n){return it.test(n)}function f(n){return nt.test(n)?1:g.test(n)?2:tt.test(n)?3:0}function ni(n,t,r){if(r===void 0&&(r=!1),t){var u=t.toLowerCase();if("https".startsWith(u)||t=="/"||i(u,7)!=u)return i(n,16);if(!r&&("www".startsWith(u)||i(u,15)!=u))return i(n,o)}return i(n,r?o:31)||n}function ti(n,t){var i=f(t);switch(f(n)){case 1:return i!=2;case 2:return i!=1;case 3:case 0:return!0}}function ii(t,r,u){if(i(r.replace(/%20/g," "),31)!=i(u.replace(/%20/g," "),31))return!1;var e=f(t.originalQuery);return n.contains([1,2],e)&&!ti(r,u)?!1:!0}function ri(t){var r=u(t,!0),f,i;return r?(i=r.hostname.split("."),f=r.hostname&&i.length>1?i[i.length-1]=="com"&&rt.some(function(n){return i[i.length-2]==n}):!0,f&&r.path&&n.contains(["/search","/entityexplore"],r.path.toLowerCase()))?!0:!1:!1}function ui(n){var t=u(n.replace(/^ftp:/,"http:"),!0);return(t?t.hostname:null)||""}var r="\\-\\s\\[\\]\\/\\\\!@#$%^&*()+={}:;~`\"'|<,>.。?",ut="(?:[^"+r+"]-*)*[^"+r+"](?:-*[^"+r+"])*",s="(?:[^"+r+"]-*)*[^"+r+"0-9](?:-*[^"+r+"])*",ft="(?:(?:"+ut+"[.。])*"+s+")",h="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])",e="(?:(?:"+h+"\\.){3}"+h+")",c=new RegExp("^"+e+"$"),t="(?:[0-9a-fA-F]{1,4})",l="(?::(?:(?::"+t+"){1,7}|:)|(?:"+t+":){1,7}:|(?:"+t+":){7}"+t+"|(?:"+t+":){1,6}(?::"+t+"){1}|(?:"+t+":){1,5}(?::"+t+"){2}|(?:"+t+":){1,4}(?::"+t+"){3}|(?:"+t+":){1,3}(?::"+t+"){4}|(?:"+t+":){1,2}(?::"+t+"){5}|(?:"+t+":){1,1}(?::"+t+"){6}|fe80:(?::"+t+"){0,4}%[0-9]+|::ffff:"+e+"|)",a=new RegExp("^\\["+l+"\\]$","i"),v="ht+ps?[:;]+[\\\\/]*|/+",et=new RegExp("^("+v+")","i"),ot=ft+"|"+e+"|\\["+l+"\\]",st=new RegExp("^("+v+")?([^/]+@)?("+ot+")(:(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{1,4}|[1-9][0-9]{0,3}))?([\\/\\\\][^?#]*)?([?#].*)?","i"),y=new RegExp("[.。]("+s+")$","i"),ht=/((^[\\]{2}).+)|(^[a-z]:\\.*)/i,ct=/^[a-z0-9\-]+:/i,lt=/\s/,w,b,o,rt;n.tryParseUrl=u;w=/file:\/\/\/[^:\/]+:\/[^\/]+\/[^\/]+\/AppData\//i;b=["ms-appx-web:","ms-browser-extension:",];n.isJunkUrl=vt;n.matchesOnDomain=yt;n.isUncOrLocalPath=pt;n.isHttpProtocol=k;n.isNonHttpProtocol=wt;n.cleanAndFixUrlProtocol=bt;n.stripAuthenticationFromUrl=d;var g=/^https:\/*(.*)/i,nt=/^http:\/*(.*)/i,tt=/^\/{2,}(.*)/,it=/^www\.(.*)/i,dt=/^(.*[^:\/])\/+$/;n.normalizeUrl=i;n.hasWww=gt;n.getProtocol=f;o=23;n.removeUrlPrefixes=ni;n.isDuplicateUrl=ii;rt=["bing","staging-bing-int","working-bing-int","bing-int","bing-exp"];n.isBingSearchUrl=ri;n.getDomain=ui}(AutoSuggest||(AutoSuggest={})),function(n){var r,u,i,t;(function(n){n[n.Apps=0]="Apps";n[n.Settings=1]="Settings";n[n.Cortana=2]="Cortana";n[n.Command=3]="Command";n[n.Photos=4]="Photos";n[n.Videos=5]="Videos";n[n.Music=6]="Music";n[n.Documents=7]="Documents";n[n.Folders=8]="Folders";n[n.Emails=9]="Emails";n[n.Store=10]="Store";n[n.SearchSuggestions=11]="SearchSuggestions";n[n.PathCompletion=12]="PathCompletion";n[n.PowerBi=13]="PowerBi";n[n.JumpListTasks=14]="JumpListTasks";n[n.JumpListPinned=15]="JumpListPinned";n[n.JumpListRecent=16]="JumpListRecent";n[n.JumpListFrequent=17]="JumpListFrequent";n[n.JumpListCustom=18]="JumpListCustom";n[n.Calendar=19]="Calendar";n[n.People=20]="People";n[n.EdgeHistory=21]="EdgeHistory";n[n.LocalPlaces=22]="LocalPlaces";n[n.VCDExamples=23]="VCDExamples";n[n.Experimental=24]="Experimental";n[n.Bookmarks=25]="Bookmarks";n[n.Related=26]="Related";n[n.Websites=27]="Websites";n[n.Frequent=52]="Frequent";n[n.SearchHistory=53]="SearchHistory"})(r=n.GroupType||(n.GroupType={})),function(n){n.WebSuggestions="WebSuggestions";n.AppsOnline="AppsOnline";n.SettingsOnline="SettingsOnline";n.BCSApps="BCSApps";n.BCSSettings="BCSSettings";n.LocalApps="LocalApps";n.LocalRecentApps="LocalRecentApps";n.LocalSettings="LocalSettings";n.LocalMedia="LocalMedia";n.LocalFiles="LocalFiles";n.LocalPowerBI="LocalPowerBI";n.LocalBrowsingHistory="LocalBrowsingHistory";n.PathCompletion="PathCompletion";n.CommandLine="CommandLine";n.MRU="MRU";n.MRUApps="MRUApps";n.MRUSettings="MRUSettings";n.MRUFilesAndFolders="MRUFilesAndFolders";n.OneDrive="OneDrive";n.ZeroInput="ZeroInput";n.Office365Calendar="O365Cal";n.Experimental="Experimental";n.Substrate="Substrate";n.Local="Local";n.TypedUrls="TypedUrls"}(u=n.DataSourceNames||(n.DataSourceNames={})),function(n){function t(t,i,r,u,f,e){var o={T:n.QFPERFPING_EVENT_NAME,ST:r,CVID:u,OFFSETS:i,STATE:f,V:n.QFPERFPING_VERSION,RFC:e};return{ImpressionGuid:t,EventType:n.CLIENTINST_EVENT_TYPE,Data:o}}n.CLIENTINST_EVENT_TYPE="ClientInst";n.QFPERFPING_EVENT_NAME="QFPerfPing";n.CLICK_EVENT_TYPE="Click";n.QFPERFPING_VERSION="2";n.QFPERFPING_INVALID_MEASURE=-2;n.INVALID_SEQUENCE_NUMBER=-2;n.KVALUE_SUGGESTIONS_START=1e3;n.KVALUE_SUFFIX_START=1;n.KVALUE_NON_SUGGESTIONS_START=100;n.DEFAULT_APP_NAMESPACE="SmartSearch";n.DEFAULT_SERVICE_NAME="AutoSuggest";n.createPerfPingEvent=t}(i=n.InstrumentationCommon||(n.InstrumentationCommon={}));t=function(){function n(n,t){this._kValue=n;this._handOffType=t}return n.createInstrumentedItem=function(t){return new n(n.generateKValue(t))},n.getNonSuggestionInstrumentedItem=function(t,i,r){return new n(i[t],r)},n.prototype.getKValue=function(){return this._kValue},n.prototype.getAppNS=function(){return n.AppNS},n.prototype.getLayoutKValue=function(){return this._kValue+"."+n.Suffix},n.prototype.getHValue=function(){return"ID="+n.AppNS+","+this.getLayoutKValue()},n.prototype.getHandoffType=function(){return this._handOffType},n.resetKValues=function(n){delete this._keystrokesKValues[n]},n.generateKValue=function(n){var r=n,t=this._keystrokesKValues[r];return t>0||(t=i.KVALUE_SUGGESTIONS_START),this._keystrokesKValues[r]=++t,t},n}();t.AppNS=i.DEFAULT_APP_NAMESPACE;t.Suffix=i.KVALUE_SUFFIX_START;t._keystrokesKValues={};n.InstrumentedItem=t}(AutoSuggest||(AutoSuggest={})),function(n){function ft(){return matchMedia("screen and (-ms-high-contrast)").matches}function et(){return navigator.onLine}function ot(n){return!n.isAnswer&&(n.handoffType==0||n.handoffType==11)}function h(n){return n?n.replace(g,"$1").replace(nt,"$1 "):n}function st(n){return n?n.replace(/[-{}]/g,"").toLowerCase():null}function ht(n){return!n||Object.keys(n).length===0}function c(n,t,i,u){var f,e;n&&(n=n.slice(0,t)+r+n.slice(t,n.length));f=i(n);f&&(e=f.indexOf(r),t=e!=-1?e:t,f=f.replace(r,""));u(f,t)}function u(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];i.forEach(function(t){return delete n.enabledDataSources[t]})}function ct(t,r,f){return t.queryToFetch&&(t.queryToFetch.length<f.minQueryLengthForWebProvider||f.bingDisabledCountriesList&&i(f.bingDisabledCountriesList,r.toLowerCase()))?(u(t,n.WebDataSource),!0):!1}function l(t){if(t){t=n.normalizeUrl(t,15);for(var i=1;i<t.length-1;++i)if(it.includes(t[i]))return!0}return!1}function lt(n,t){var i,r;return c(n,t,function(n){return h(n)},function(n,t){i=n;r=t}),i&&(i=i.trim(),r=Math.min(r,i.length)),{originalQuery:n,originalCursorPosition:t,queryToFetch:i,cursorPosition:r,enabledDataSources:{},equals:function(n){return(i?i.toLowerCase():i)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)},isMultiWord:l(i),getCacheKey:function(){return i}}}function a(n,t,r){return t&&!t.enabledDataSources[n]?!1:i(r.enabledDataSources,n)}function v(n,t,r,u,f){var e=u.enabledDataSources[n];return e?e.suggestionIsEnabled&&!e.suggestionIsEnabled(t,r)?!1:i(f.enabledDataSources,n):!1}function i(n,t){return n.indexOf(t)!=-1}function at(n,t){return n.filter(function(n){return!i(t,n)})}function vt(n,t){if(n.length!=t.length)return!1;for(var i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0}function yt(n,t){if(n===t)return!0;if(!n||!t||Object.keys(n).length!=Object.keys(t).length)return!1;for(var i in n)if(n[i]!=t[i])return!1;return!0}function pt(n,t){return n?n.replace(tt,function(n,i){return t[i]}):n}function wt(n){var t=n?n.number:null,i=n?n.name:null;return t==-2147023673||i=="Canceled"}function f(n,t,i,r,u,f){try{return n()}catch(e){return f||SharedLogHelper.LogError(t,r,e),u&&u(),i}}function bt(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];f(function(){return sj_evt.fire.apply(sj_evt,[n].concat(i))},n)}function e(n,t){var i=[],r=!0,u=function(){for(var u=[],n=0;n<arguments.length;n++)u[n]=arguments[n];r?i.push(u):t.apply(null,u)};n(u);r=!1;i.forEach(function(n){return t.apply(null,n)})}function kt(n){return i(o,n)}function dt(n){return i(y,n)}function gt(n,t,i){return i?n==93:n==121&&t}function ni(n,t){return n==8||n==46||n==88&&t.ctrlKey}function ti(){return _w.location.protocol}function ii(){return _w.location.host}function ri(){return _w.innerWidth}function ui(){return _d.activeElement}function p(t){return t&&+t!=n.WindowsApiDefaultDate&&!isNaN(t.getTime())&&t.getFullYear()!=1600}function b(t){return p(t)?Math.abs(n.getDate().getTime()-t.getTime())/w:null}function fi(n){return b(n)>14}function ei(n){var t;return function(){t?(sb_ct(t),t=0,n()):t=sb_st(function(){n();t=0},250)}}function oi(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")}var r=String.fromCharCode(57346),g=new RegExp("^\\s*("+r+")?\\s*"),nt=new RegExp("\\s*("+r+")?\\s+","g"),tt=/{([0-9]+)}/g,it=" -_/\\",rt=-2147215328,ut=-2147023673,t,o,y,w,s,k,d;SharedLogHelper.RegisterErrorFilter(function(n){var t=n?n.number:null,i=n?n.name:null;return t===ut||t===rt||i==="Canceled"});n.isHighContrastEnabled=ft;n.isBrowserOnline=et;n.isWebSuggestion=ot;n.cleanQuery=h;n.cleanGuid=st;n.isEmpty=ht;n.mantainCursorPositionIn=c;n.disableDataSources=u;n.disableWebDataSourceIfNeeded=ct;n.isMultiWord=l;n.parseQuery=lt;n.isDataSourceEnabled=a;n.isSuggestionTypeEnabled=v;n.contains=i;n.except=at;n.sequenceEqual=vt;n.objEquals=yt;n.log=function(){};n.getDate=function(){return new Date};sa_config.th&&(n.log=function(n,t){return ClientTestHooks.ClientLog("- "+n,t)},t=ClientTestHooks.getUrlValue("currentdate",null),t&&(t.includes("-")||t.length!=8||(t=t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)),n.getDate=function(){return new Date(t)}));n.fetchWrapper=function(n,t,i){return i()};n.formatString=pt;n.isCancellation=wt;n.safeExecute=f;n.safeFireEvent=bt;n.ensureCallbackIsAsync=e;n.WebDataSource="Web";n.MRUDataSource="MRU";n.DataSourceStateFor200Response=null;n.isBingEnabledCache=!0;o=[38,40,];y=o.concat(37,39,36,35);n.isUpOrDownKey=kt;n.isMovingCursorKey=dt;n.isContextMenuKey=gt;n.isDeletionKey=ni;n.getWindowProtocol=ti;n.getWindowHost=ii;n.getWindowWidth=ri;n.getCurrentActiveElement=ui;n.WindowsApiDefaultDate=-116444736e5;n.isValidDate=p;w=864e5;n.getTimeDiffInDays=b;n.olderThan2Weeks=fi;n.doubleClickGuardedHandler=ei;s=function(){function n(){this._cancellations={};this._lastId=0}return n.prototype.register=function(n,t){var i=++this._lastId;return this._cancellations[i]={action:n,skipOnDismissAndLaunch:t},i},n.prototype.unregister=function(n){delete this._cancellations[n]},n.prototype.cancelAll=function(n){var i,t;for(i in this._cancellations)t=this._cancellations[i],t.skipOnDismissAndLaunch&&n||t.action();this._cancellations={}},n}();n.CancellationManager=s;k=function(){function n(){}return n.prototype.getItem=function(n){try{return _w.localStorage.getItem(n)}catch(t){return SharedLogHelper.LogError("localStorage",t,new Error("getItem")),undefined}},n.prototype.setItem=function(n,t){try{_w.localStorage.setItem(n,t)}catch(i){SharedLogHelper.LogError("localStorage",i,new Error("setItem"))}},n.prototype.removeItem=function(n){try{return _w.localStorage.removeItem(n)}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("removeItem"))}},n}();n.LightweightStorage=k;d=function(){function t(n,t,i,r,u,f,e,o,h){var c=this;this._config=n;this._host=t;this._suggestionsParsers=i;this._rootViewModel=r;this._suggestionsRenderingManager=u;this._webProviders=f;this._otherProviders=e;this._instrumentationHelper=o;this._sequenceNumberManager=h;n.cancellationEnabled&&(this._cancellationManager=new s);t.bindShown(function(){c._lastQuery=null;c._currentQuery=null;c._isPaneDismissed=!1});t.bindDismissed(function(){c.stopFurtherProcessing(!0);c.finalizeKeystroke(!0);c._isPaneDismissed=!0});t.bindQueryChangedOrInitialized(function(n,t){return c.onQueryChanged(n,c._config.d,t)});t.bindOnSubmit(function(n,t){return c.onSubmit(n,t)});t.initializeEvents();sj_be(_d.body,"dragstart",function(n){return n.preventDefault(),n.stopPropagation(),!1});sj_b.addEventListener("click",function(n){n.shiftKey&&sj_pd(n)})}return t.prototype.clearFetchTimer=function(){this._fetchTimer&&(sb_ct(this._fetchTimer),this._fetchTimer=null)},t.prototype.finishPreviousQuery=function(n){this.cancelPreviousQuery(n);this._suggestionsRenderingManager.resetTimers()},t.prototype.finalizeKeystroke=function(n){var t=this._sequenceNumberManager.getSequenceNumber();t>0&&this._instrumentationHelper.finalizeKeystrokeLog(t);n||this._sequenceNumberManager.incrementSequenceNumber()},t.prototype.onQueryChanged=function(n,t,i){var u=this,r;this.clearFetchTimer();this._stopFurtherProcessing=!1;this._currentQuery=n;this._lastQuery&&(!this._lastQuery.equals(this._currentQuery)||i)&&this.cancelPreviousQuery(!1);t<=0?this.fetchForQueryChange(0,!1,i):(r=Date.now(),this._fetchTimer=sb_st(function(){return f(function(){return u.fetchForQueryChange(Date.now()-r,!1,i)},"fetchTimer")},t))},t.prototype.onSubmit=function(n,t){var i=this;this._fetchTimer&&(this._currentQuery||(this._currentQuery=this._host.getQuery()),this.fetchForQueryChange(0,!0,!1));this._instrumentationHelper.instrumentSubmissionBegin();this._rootViewModel.submit(n,this._sequenceNumberManager.getSequenceNumber(),function(){return i.stopFurtherProcessing(!0)},t,this._isPaneDismissed)},t.prototype.cancelPreviousQuery=function(n){this._cancellationManager&&this._cancellationManager.cancelAll(n)},t.prototype.stopFurtherProcessing=function(n){this.clearFetchTimer();this.finishPreviousQuery(n);this._stopFurtherProcessing=!0},t.prototype.fetchForQueryChange=function(t,i,r){var u=this,o,f,h;if(this.clearFetchTimer(),(!this._lastQuery||!this._lastQuery.equals(this._currentQuery)||r)&&(o=this._host.getQuery(),o.equals(this._currentQuery))){if(this.finishPreviousQuery(i),this.finalizeKeystroke(!1),this._lastQuery=this._currentQuery,f=this._sequenceNumberManager.getSequenceNumber(),this._instrumentationHelper.instrumentBeginRequest(f,this._currentQuery,t),h=!this._config.enabledDataSources.some(function(n){return a(n,u._currentQuery,u._config)}),h)this._rootViewModel.onQueryChanged(this._currentQuery,f);if(this._suggestionsRenderingManager.initiateSequenceNumber(f,this._currentQuery),!h){var s=function(){return!u._stopFurtherProcessing&&(u._config.d>0?o.equals(u._currentQuery):f==u._sequenceNumberManager.getSequenceNumber())},c=function(n,t,i,r){return u.onResponseReceived(o,f,n,t,i,s,r)},l=function(t){n.fetchWrapper(o,s,function(){u._webProviders.forEach(function(n){return u.fetchWeb(o,n,f,t,s)});u._otherProviders.forEach(function(n){return u.fetch(o,n,f,t,s)})});u._rootViewModel.onQueryChanged(u._currentQuery,f)};e(l,c)}}},t.prototype.fetchWeb=function(t,i,r,u,f){var o=n.Service.QueryParams,e=this._host.getCustomUrlParameters(t),s;this._host.shouldRequestEltoken()&&(e[o.RequestElToken]="1");e[o.CursorPosition]=t.cursorPosition.toString();e[o.ConversationId]=this._host.getConversationId();e[o.ImpressionGuid]=this._instrumentationHelper.getImpressionGuid(r);s=this._host.getCustomHeaders();i.fetch(t,u,r,this._cancellationManager,f,e,s)},t.prototype.fetch=function(n,t,i,r,u){t.fetch(n,r,i,this._cancellationManager,u)},t.prototype.onResponseReceived=function(n,t,i,r,u,f,o){var s=this,h,c;f()&&(this._instrumentationHelper.instrumentResponseReceived(t,i,u,o),h=function(i,r,f){return s.onSuggestionsParsed(n,t,i,u,r,f)},c=function(u){var e=s._suggestionsParsers[i];e?e.parse(n,t,i,r,f,u,s._cancellationManager):(SharedLogHelper.LogError("onResponseReceived",null,new Error("No parser for data source "+i)),u(i,[],null))},e(c,h))},t.prototype.onSuggestionsParsed=function(n,t,i,r,u,f){var e=this;u=u.filter(function(t){return v(i,t.type,t.handoffType,n,e._config)});this._instrumentationHelper.instrumentDataSource(t,i,u,f);this._rootViewModel.onSuggestionsParsed(n,t,i,r,u);this._suggestionsRenderingManager.queueSuggestions(t,i,u,f)},t}();n.Core=d;n.encodeQueryParameter=oi}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function f(t,f,e,o,s,h){var l=t.content,k=!t.cursorPos&&t.cursorPos!==0?l.length:t.cursorPos,d=l?l.replace(/^\?/,""):l,c=n.parseQuery(d,k),b;c.topHitRestriction=s;c.isZeroInput=!l;var v=1,y=l,p=t.isRegisteredProtocol,w=l&&p&&n.isNonHttpProtocol(l)&&!u.test(l),a=n.tryParseUrl(l,!0);return l&&!l.startsWith("?")&&(n.isUncOrLocalPath(l)||w?v=0:a&&(a.type==0||f.domainJoined&&a.type==1)?(v=0,y=n.cleanAndFixUrlProtocol(a)):f.domainJoined&&a&&a.type==2&&(v=2,y=n.cleanAndFixUrlProtocol(a))),c.isZeroInput?h==i.RegularTab&&(!e&&o.historySettingsPresent&&(c.enabledDataSources[n.WebDataSource]={}),f.inPrivate||(c.enabledDataSources[r.Local]={})):c.queryToFetch&&(c.queryToFetch=c.queryToFetch.toLowerCase(),o.enabledDataSources.forEach(function(n){return c.enabledDataSources[n]={}})),n.disableWebDataSourceIfNeeded(c,f.market,o)||(b=v==0&&w,(f.inPrivate||!f.searchSuggestionsOn||b)&&n.disableDataSources(c,n.WebDataSource)),c.originalQuery=l,c.fixedUrl=y,c.intent=v,c.hasRegisteredProtocol=p,c.parsedUrl=a,c.equals=function(n){return n.isZeroInput==c.isZeroInput&&n.queryToFetch==c.queryToFetch&&n.intent==c.intent&&n.topHitRestriction==c.topHitRestriction},c.getCacheKey=function(){return(c.isZeroInput?"1":"0")+c.queryToFetch},c}var u=/^(ftp):+\/*$/,i,r;(function(n){n.NewTabPage="NTP";n.DefaultHomePage="DHP";n.RegularTab="AB"})(i=t.OneBoxTypes||(t.OneBoxTypes={})),function(n){n.Local="Local";n.TypedUrls="TypedUrls"}(r=t.DataSources||(t.DataSources={}));t.parseQuery=f})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function r(t,i){n.log(i);t&&t.adjustHeight()}function u(n,t){return n&&n.length>t?n.substr(0,t)+"…":n}function f(n){if(!n)return n;var t=(n-116444736000000000)/1e7,i=(new Date).getTime()/1e3;return(i-t)/86400}function h(n){return n.type+"\t"+n.query}function c(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return{id:n,type:t,query:i,text:r,secondaryText:u,url:f,hc:o,icon:s,secondaryTextClass:e,handoffType:h,intent:c,instItem:l,sequenceNumber:a,isAnswer:y,answerHtml:p,selected:!1,getMruData:null,mayContainPII:v}}function e(n){return n.secondaryTextClass==t.CssClass_Annotation}function l(n){if(n.answerHtml)return null;var t=HitHighlightingParser.removeMarkers(n.text);return n.additionalInfoText&&(t+=", "+n.additionalInfoText),t+(e(n)?", "+n.secondaryText:", "+HitHighlightingParser.removeMarkers(n.secondaryText))}function y(t){if(t.type==o.SearchHistory)return n.GroupType.SearchHistory;if(t.type==i.Frequent)return n.GroupType.Frequent;throw new Error("No group for suggestions of type "+t.type);}function p(t,i){return sa_config.titlePositionedNextToUrl&&n.isWebSuggestion(t)?sa_config.showSearchAnnotationOnFirstSuggestion&&!i:!0}function w(t){return t.handoffType==1&&t.type!=n.IEOneBox.LocalSuggestionTypes.Frequent}function b(n){return n.handoffType==0||n.handoffType==11}function k(n){return n.type==i.TypedUrl||n.duplicates&&n.duplicates.some(function(n){return n.type==i.TypedUrl})}var a,o,i,s,v;t.autoCompleteTrace=sa_config.th&&ClientTestHooks.getUrlValue("autoCompleteTrace")?r:null;t.localSuggestionsTrace=sa_config.th&&ClientTestHooks.getUrlValue("localSuggestionsTrace")?function(n,t,i){return i===void 0&&(i=""),r(n,(i?"["+i+"] ":i)+[t.type,t.visitCount,f(t.lastAccessed),u(t.title,50),u(t.url,75)].join(" | "))}:null;t.lastAccessedInDays=f;t.AnswerHeight=104;t.GroupHeight=33;t.SmallerSuggestionHeight=28;t.DefaultSuggestionHeight=33;t.SuggestionHeight=t.DefaultSuggestionHeight;t.Suggestion2LinesHeight=58;t.MRUDatabaseName="EDGE_MRU";t.CssClass_SecondaryText="secondaryText";t.CssClass_Annotation="annotation";t.BingSearchProvider="Bing";t.getSuggestionKey=h;t.createSuggestion=c;t.secondaryTextIsAnnotation=e;t.getSuggestionNarratorText=l,function(n){n.DirectNav="directNav";n.History="history";n.HistorySearch="historySearch";n.Search="search";n.Answer="answer";n.Favorite="favorite"}(a=t.Intents||(t.Intents={})),function(n){n.DirectNav="MD";n.Deeplink="ML";n.SearchHistory="HS";n.Entity="MB"}(o=t.OnlineSuggestionTypes||(t.OnlineSuggestionTypes={})),function(n){n.TypedUrl="TU";n.History="HU";n.Favorite="FV";n.Frequent="FQ"}(i=t.LocalSuggestionTypes||(t.LocalSuggestionTypes={})),function(n){n.PartialQuery="PF";n.PartialWebsite="PWE";n.TokenizedWebsite="TK";n.NoSuggestion="N";n.ManageSearchHistory="MSH";n.KValues=function(){var t={};return t[n.PartialQuery]=101,t[n.PartialWebsite]=102,t[n.TokenizedWebsite]=103,t[n.NoSuggestion]=104,t[n.ManageSearchHistory]=105,t}()}(s=t.SyntheticQSCodes||(t.SyntheticQSCodes={}));t.GroupHeaderQSCodes=function(){var t={};return t[n.GroupType.SearchHistory]=s.ManageSearchHistory,t}(),function(n){n.Search="&#xe721";n.Globe="&#xe774";n.History="&#xe81c";n.Favorite="&#xe734"}(v=t.Icons||(t.Icons={}));t.getGroupType=y;t.showSecondaryText=p;t.enableUrlClass=w;t.hasReverseHighlighting=b;t.considerAsTypedURL=k})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function n(){this._sequenceNumber=0}return n.prototype.getSequenceNumber=function(){return this._sequenceNumber},n.prototype.incrementSequenceNumber=function(){this._sequenceNumber++},n}();n.SequenceNumberManager=t}(AutoSuggest||(AutoSuggest={})),function(n){var t,i,r;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];r=function(){function r(n,t,i){i===void 0&&(i=Date.now);this._autoSuggestHost=n;this._instrumentationHelper=t;this.getNowTimestamp=i;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}return r.prototype.instrumentSuperFreshUpdate=function(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()},r.prototype.registerSuperFresh=function(){this._superFreshEnabled=!0},r.prototype.subscribeForEvents=function(){var n=this;i.forEach(function(t,i){return sj_be(n._appCache,t,function(){return n.handleAppCacheEvent(t,i)})})},r.prototype.handleAppCacheEvent=function(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogError("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}},r.prototype.sendAppCacheEvents=function(){var t=this._appCacheTimeline,r,u,i;t&&(r=t.AppCacheEvents,u=[{I:t.EventIndex,E:r,S:t.SuperFreshUpdateData,ABT:this._instrumentationHelper.getConversationStartTimestamp()}],r[2]&&(u[0].OL=navigator.onLine),i=n.InstrumentationCommon.createPerfPingEvent(this._autoSuggestHost.getConversationId(),u,"AppCache",this._autoSuggestHost.getConversationId()),Log2.LogEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null),this._appCacheTimeline=this.createAppCacheTimelineObject())},r.prototype.createAppCacheTimelineObject=function(){var n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n},r}();n.AppCacheInstrumentationHelper=r}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i="MUID",r=function(){function r(n,t){this._config=n;this._host=t}return r.prototype.logProfilerMarker=function(){},r.prototype.getInitPageName=function(){return"Page.SpartanOneBox.AS.Init"},r.prototype.getSuggestionsPageName=function(){return"Page.SpartanOneBox.AS.Suggestions"},r.prototype.getApplicationName=function(){return"SpartanOneBox"},r.prototype.getRankerModelId=function(){return this._config.mainRankerId},r.prototype.getDataSourceNameMap=function(){var i={};return i[n.WebDataSource]=n.DataSourceNames.WebSuggestions,i[t.DataSources.Local]=n.DataSourceNames.Local,i[t.DataSources.TypedUrls]=n.DataSourceNames.TypedUrls,i},r.prototype.createNonSuggestionDataSourceObject=function(n,t){return{T:"D.Url",K:t.getKValue(),Val:n,Ho:t.getHandoffType()}},r.prototype.createDataSourceObject=function(n){var t=n.mayContainPII||this._host.getMachineState().inPrivate,i={T:"D.Url",K:n.instItem.getKValue(),Q:t?undefined:n.query,Val:n.type,Url:t?undefined:n.url,Ho:n.handoffType,Ans:n.isAnswer?1:undefined,AC:n.autoCompleteType?n.autoCompleteType:undefined,HCMS:n.highConfidenceMetaSuggestionScore,HCS:n.highConfidenceSuggestionScore,LM:n.suggestionLogMeta,PCS:n.prefetchConfidenceScore,PC:n.isPrefetch,F:n.features?n.features.join(","):undefined};return i.RankerSignals=this.buildRankerOutputDataSource(n),i},r.prototype.buildRankerOutputDataSource=function(n){if(!n.featureStore)return undefined;return{featureStore:n.featureStore,rankingScore:n.rankingScore}},r.prototype.logMasterPageImpression=function(t,i){var r=this;Log2.LogMasterPageImpression(t);t.pageName===this.getSuggestionsPageName()&&n.safeExecute(function(){return r.sendSuggestionsRenderedReply(t.impressionGuid,i)},"sendSuggestionsRenderedReply")},r.prototype.getEnrichedClientInfo=function(){var n={},i=this._host.getMachineState();return n.searchProvider=i.searchProvider,n.domainJoined=i.domainJoined?1:0,n.EnableRegulatoryPsm=i.enableRegulatoryPsm?1:0,n.EnableCPsm=i.enableCPsm?1:0,n.IsTouch=t.isTouchDevice()?"true":"false",n.CortanaOptIn=i.cortana?"true":"false",i.cortanaCapabilities&&(n.CortanaCapabilities=i.cortanaCapabilities),n},r.prototype.logDataSourceTimeout=function(){},r.prototype.sendSuggestionsRenderedReply=function(n,i){n||SharedLogHelper.LogError("sendSuggestionsRenderedReply",null,new Error("Missing impressionGuid"));i||SharedLogHelper.LogError("sendSuggestionsRenderedReply",null,new Error("Missing cvid"));var r={impressionGuid:n?this.formatAsGuid(n):null,conversationGuid:i?this.formatAsGuid(i):null,clientGuid:this.getMuidCookie()};t.postFrameMessage("resultsRendered",JSON.stringify(r))},r.prototype.getMuidCookie=function(){if(!this._muidCache){var n=sj_cook.get(i);n&&(n=n.substr(i.length+1),this._muidCache=this.formatAsGuid(n))}return this._muidCache},r.prototype.formatAsGuid=function(n){return"{"+[n.substring(0,8),n.substring(8,12),n.substring(12,16),n.substring(16,20),n.substring(20,32)].join("-")+"}"},r.prototype.onItemClick=function(){},r}();t.IEOneBoxInstrumentationProvider=r})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var i="DSNameNotFound",r="/QF_KEYSTROKE_VIRTUAL_URL?",u="/QF_INIT_VIRTUAL_URL?",f="autosuggest",t,e=function(){function e(i,r,u,f,e){var o,s;f===void 0&&(f=Date.now);e===void 0&&(e=function(){return n.getWindowProtocol()+"//"+n.getWindowHost()});o=this;this._config=i;this._host=r;this._clientInstrumentationProvider=u;this.getNowTimestamp=f;this.getOrigin=e;this._perfPingConversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._perfPingSubmissionBeginTime=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._perfPingSubmissionEndTime=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._keystrokesPerfPingData={};this._keystrokesInstrumentationData={};this._dsNameMap=this._clientInstrumentationProvider.getDataSourceNameMap();this.reset(!0);r.bindConversationStart(function(){return o.reset(!1)});i.th&&(ClientTestHooks.isTesthookParamSet("perfTrace")&&(t=!0),s=n.log,n.log=function(n,t){t||o.instrumentDebugEvent(n);s(n,t)})}return e.prototype.getImpressionGuid=function(n){var t=this._keystrokesInstrumentationData[n];if(t&&t.ImpressionGuid)return t.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;},e.prototype.enrichTargetUrl=function(t,i,r,u){this._perfPingSubmissionEndTime=this.getOffsetedNow();var f=r+"&form="+n.encodeQueryParameter(u);return f+="&qs="+n.encodeQueryParameter(i),f+="&cvid="+n.encodeQueryParameter(this._host.getConversationId()),f+("&pq="+n.encodeQueryParameter(t))},e.prototype.onItemClick=function(t,i,r){this._perfPingSubmissionEndTime=this.getOffsetedNow();i&&this.updatePageIG(t);var u=this._keystrokesInstrumentationData[t];u?_G.IG!=u.ImpressionGuid&&SharedLogHelper.LogError("onItemClick","IG ("+u.ImpressionGuid+") for sequenceNumber "+t+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)")):SharedLogHelper.LogError("onItemClick","sequenceNumber: "+t+" ConversationID: "+this._host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));this.finalizeKeystrokeLog(t,1);u&&this.logPerfPingEvent(this.createSubmissionPerfPingEvent(u));r&&r();this._clientInstrumentationProvider.onItemClick();this._config.alwaysUseCustomInstrumentation&&n.safeExecute(function(){return _w.si_Flush()},"onItemClick")},e.prototype.instrumentCustomGping=function(n,t,i,r,u){var f={},e;i&&(f.cm=i);switch(n){case 0:f.i="k";r&&(e=r.altKey?"A":"",e+=r.ctrlKey?"C":"",e+=r.shiftKey?"S":"",e&&(f.mk=e));break;case 2:f.i="n";break;case 3:f.i="b"}u&&(f.pp=u);this.logCustomGPing(t,f)},e.prototype.logCustomGPing=function(t,i){n.isEmpty(i)||(t+="&PR="+JSON.stringify(i));n.safeExecute(function(){return _w.si_T(t)},"logCustomGPing")},e.prototype.logClientInstEvent=function(n,t,i,r,u){var f,e,o;r?(f=null,e=this._keystrokesInstrumentationData[r],e&&(f=e.ImpressionGuid),Log2.LogEvent(n,u,i,null,null,f,null,null)):(o=[n,t,i,!1],u&&Object.keys(u).forEach(function(n){return o.push(n,u[n])}),Log.Log.apply(null,o))},e.prototype.safeInstrument=function(n,t,i,r){var u=this._keystrokesInstrumentationData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},e.prototype.safeInstrumentPerf=function(n,t,i,r){var u=this._keystrokesPerfPingData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},e.prototype.instrumentRenderingStarted=function(n){var t=this;this.safeInstrument(n,function(i){i.RenderingStarted=!0;t.updatePageIG(n)},"instrumentRenderingStarted")},e.prototype.instrumentBeginRequest=function(t,i,r){var u;delete this._keystrokesInstrumentationData[t-1];n.InstrumentedItem.resetKValues(t);u=this._keystrokesPerfPingData[t];u&&SharedLogHelper.LogError("instrumentBeginRequest","sequenceNumber: "+t,new Error("Duplicate BeginRequest for sequenceNumber"));var f=this._host.getConversationId(),e=this._host.getRawImpressionGuid(),o=n.cleanGuid(e),s={ImpressionGuid:o,ConversationId:f,Query:i,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{}},h=this.getOffsetedNow(),c={RawImpressionGuid:e,ImpressionGuid:o,ConversationId:f,PrefixLength:i.queryToFetch?i.queryToFetch.length:0,RequestBegin:h-r,ResponseReceived:{},DataSourcesState:this._searchServiceStatus?{Indexer:this._searchServiceStatus}:undefined,RenderFinished:{},AllDataSourcesProcessed:!1,PendingIcons:0,TopResultRendered:[],IconsRetrieved:{},ResponseFromCache:{}};this._keystrokesInstrumentationData[t]=s;this._keystrokesPerfPingData[t]=c},e.prototype.setSearchServiceStatus=function(n){this._searchServiceStatus=n},e.prototype.instrumentResponseReceived=function(n,i,r,u){var f=this;this.safeInstrumentPerf(n,function(n){var e=f.getOffsetedNow();n.ResponseReceived[i]=e;t&&f.logProfilerMarker(0,0,i,n);r&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[i]=r);u&&(n.ResponseFromCache[i]=u)},"instrumentResponseReceived",i)},e.prototype.instrumentTopResultRendered=function(n,t){var i=this;this.safeInstrumentPerf(n,function(r){var u=i.getOffsetedNow();i.logProfilerMarker(1,0,"topResultRendered",r);r.TopResultRendered.push({V:u,T:t.join(",")});i.tryInstrumentRenderStopped(n,r)},"instrumentTopResultRendered")},e.prototype.instrumentAggregatorCall=function(t,i){var r=this;this.safeInstrument(t,function(t){var e={fastRankModelId:r._clientInstrumentationProvider.getRankerModelId()},f,u;for(f in t.RankerExtraInfo)e[f]=t.RankerExtraInfo[f];t.RankerExtraInfo={};u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:e};r._config.counterFactualLoggingOn&&(u.counterFactualDiff=u.counterFactualDiff||i.isCounterFactualDiff);t.DataSources.aggregator=u},"instrumentAggregatorCall")},e.prototype.addDuplicatesDataSource=function(t){var i=Object.keys(t.DuplicateDS).map(function(n){return t.DuplicateDS[n]});i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})},e.prototype.instrumentDuplicate=function(t,i,r){this.safeInstrument(t,function(t){var u=t.DuplicateDS[i.instItem.getHValue()],f;u||(u={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:i.instItem.getKValue()}]},i.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(u.DS[0].AppNS=i.instItem.getAppNS()),t.DuplicateDS[i.instItem.getHValue()]=u);f={T:"D.DSRef",KRef:r.instItem.getKValue()};r.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=r.instItem.getAppNS());u.DS.push(f);i.duplicates=i.duplicates||[];i.duplicates.push(r)},"instrumentDuplicate")},e.prototype.renderingStopped=function(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed},e.prototype.notifyAllDataSourcesProcessed=function(n){var t=this;this.safeInstrumentPerf(n,function(i){i.AllDataSourcesProcessed=!0;t.tryInstrumentRenderStopped(n,i)},"notifyAllDataSourcesProcessed")},e.prototype.notifyIconPending=function(t,i,r,u){var f=this;this.safeInstrumentPerf(t,function(t){var e=r+(i?"T":"S");t.IconsRetrieved[e]||(t.IconsRetrieved[e]={B:f.getOffsetedNow(),E:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,T:u},t.PendingIcons++)},"notifyIconPending",i?"TR":"SUG")},e.prototype.notifyIconReady=function(n,t,i){var r=this;this.safeInstrumentPerf(n,function(n){var u=i+(t?"T":"S");n.IconsRetrieved[u]?n.IconsRetrieved[u].E=r.getOffsetedNow():SharedLogHelper.LogError("notifyIconReady",null,new Error("Instrumenting unseen icon"));n.PendingIcons--},"notifyIconReady",t?"TR":"SUG")},e.prototype.tryInstrumentRenderStopped=function(t,i){this.renderingStopped(i)&&(this.finalizeKeystrokeLog(t,2),this._config.th&&n.safeFireEvent("RenderStopped"))},e.prototype.isLayoutLogged=function(n){return this._keystrokesInstrumentationData[n].MasterPageImpressionCreated},e.prototype.finalizeKeystrokeLog=function(n,t){var i,r;t===void 0&&(t=0);i=this._keystrokesInstrumentationData[n];i&&this.logKeystrokeData(i,n);t!=1&&(r=this._keystrokesPerfPingData[n],r&&(this.logPerfPingEvent(this.createKeystrokePerfPingEvent(n,r)),delete this._keystrokesPerfPingData[n]))},e.prototype.instrumentSubmissionBegin=function(){this._perfPingSubmissionBeginTime==n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(this._perfPingSubmissionBeginTime=this.getOffsetedNow())},e.prototype.instrumentRenderFinished=function(n,i){var r=this;this.safeInstrumentPerf(n,function(u){var f=r.getOffsetedNow();i.forEach(function(n){return u.RenderFinished[n]=f});t&&r.logProfilerMarker(0,0,"groupsRendered",u);r.tryInstrumentRenderStopped(n,u)},"instrumentRenderFinished",i.join(","))},e.prototype.instrumentSyntheticInstrumentedItem=function(n,t,i){var r=this._keystrokesInstrumentationData[n];r?r.PendingInstrumentedItems[t]=i:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",t,new Error("keystrokesInstrumentationData not found"))},e.prototype.instrumentSyntheticSuggestion=function(n,t){var i=this._keystrokesInstrumentationData[n];i?i.PendingSyntheticSuggestions[t.type]=t:SharedLogHelper.LogError("instrumentSyntheticSuggestion",t.type,new Error("Instrumentation synthetic suggestion after flush"))},e.prototype.getInstrumentedSyntheticSuggestion=function(n,t){return this._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[t]},e.prototype.instrumentDataSource=function(n,t,i,r){this.safeInstrument(n,function(n){var u,f,e;if(r&&r.rankerExtraInfo)for(u in r.rankerExtraInfo)n.RankerExtraInfo[u]=r.rankerExtraInfo[u];f=i||[];e=n.PendingDataSources[t];n.PendingDataSources[t]=e?e.concat(f):f},"instrumentDataSource",t)},e.prototype.processPendingDataSources=function(t){var r,o,u,f,e,s,h;for(r in t.PendingDataSources)if(o=t.PendingDataSources[r],o.length>0){for(u=[],f=this._dsNameMap[r],f||(f=i,SharedLogHelper.LogError("instrumentDataSource",r,new Error("Missing DS name mapping for dataSource"))),e=0,s=o;e<s.length;e++)h=s[e],u.push(this._clientInstrumentationProvider.createDataSourceObject(h));u.length>0&&(t.DataSources[r]={T:"D."+f,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:f,SC:u.length,DS:u})}t.PendingDataSources={}},e.prototype.instrumentSnRProviderFetchUrl=function(n,t){this.safeInstrument(n,function(n){n.SnRProviderFetchUrl=t},"instrumentSnRProviderFetchUrl")},e.prototype.reset=function(n){this._perfPingConversationStartTimestamp=this.getNowTimestamp();this._searchServiceStatus=null;this.logInitializationPhase(n)},e.prototype.getConversationStartTimestamp=function(){return this._perfPingConversationStartTimestamp},e.prototype.logDataSourceTimeout=function(i,r){t&&n.log("timeout");this._clientInstrumentationProvider.logDataSourceTimeout(i,r)},e.prototype.logProfilerMarker=function(i,r,u,f,e){if(t&&r!=2){var o=this.getOffsetedNow();n.log(u+" "+(o-f.RequestBegin))}this._clientInstrumentationProvider.logProfilerMarker(i,r,u,f.RawImpressionGuid,e)},e.prototype.createKeystrokePerfPingEvent=function(t,i){var u={I:t,PL:i.PrefixLength,K:i.RequestBegin,RRT:i.ResponseReceived,RFT:i.RenderFinished,TRR:i.TopResultRendered,RS:undefined,IRT:i.IconsRetrieved},r,f,e,o,s;if(this.renderingStopped(i)){for(r=0,f=0,e=u.TRR;f<e.length;f++)o=e[f],r=Math.max(r,o.V);for(s in u.RFT)r=Math.max(r,u.RFT[s]);r&&(u.RS=r)}return n.InstrumentationCommon.createPerfPingEvent(i.ImpressionGuid,[u],"Keystroke",i.ConversationId,i.DataSourcesState,i.ResponseFromCache)},e.prototype.updatePageIG=function(n){_G.IG=this.getImpressionGuid(n)},e.prototype.createMasterPageImpression=function(t,i,r,u,e,o){var c={dataSources:o||[],layoutNodes:[],pageName:t,rawQuery:u?u.queryToFetch:"",isQuery:!1,impressionUrl:this.createVirtualImpressionURL(i,r),appName:this._clientInstrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:f,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:r?1:0}},s=this._clientInstrumentationProvider.getEnrichedClientInfo(u),h;if(s)for(h in s)c.enrichedClientInfo[h]=s[h];return c},e.prototype.logKeystrokeData=function(t,i){var u,f,e;(this.processPendingDataSources(t),this._config.th&&this.addDuplicatesDataSource(t),u=Object.keys(t.DataSources).map(function(n){return t.DataSources[n]}).concat(this.createNonSuggestionsDataSource(t.PendingInstrumentedItems,t.PendingSyntheticSuggestions)),t.DataSources={},t.PendingSyntheticSuggestions={},t.PendingInstrumentedItems={},u.length==0&&t.MasterPageImpressionCreated)||(t.RenderingStarted&&(f=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,t.MasterPageImpressionCreated)),t.MasterPageImpressionCreated?Log2.LogEvent("ClientInst",null,null,u,f,t.ImpressionGuid,null,null):(e=this.createMasterPageImpression(this._clientInstrumentationProvider.getSuggestionsPageName(),r,t.SnRProviderFetchUrl?t.SnRProviderFetchUrl.substring(t.SnRProviderFetchUrl.indexOf("?")+1):"",t.Query,i,u),f&&(e.layoutNodes=f),this.logMasterPageImpression(t.ImpressionGuid,e),t.MasterPageImpressionCreated=!0))},e.prototype.getSubmissionBeginTime=function(){return this._perfPingSubmissionBeginTime==n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE?this._perfPingSubmissionEndTime:this._perfPingSubmissionBeginTime},e.prototype.createSubmissionPerfPingEvent=function(t){var i=[{ISS:this.getSubmissionBeginTime(),ISE:this._perfPingSubmissionEndTime,ABT:this._perfPingConversationStartTimestamp}];return n.InstrumentationCommon.createPerfPingEvent(t.ImpressionGuid,i,"Submit",t.ConversationId)},e.prototype.logPerfPingEvent=function(t){Log2.LogEvent(t.EventType,t.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,t.ImpressionGuid,null,null);this._config.th&&ClientTestHooks.ClientApiLogNoConsole("perfPingEvent",[t])},e.prototype.logMasterPageImpression=function(n,t){if(t){if(!n){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}t.impressionGuid=n;this._clientInstrumentationProvider.logMasterPageImpression(t,this._host.getConversationId());this._config.th&&ClientTestHooks.ClientApiLogNoConsole("masterPageImpression",t,n)}},e.prototype.logInitializationPhase=function(t){var i=this._host.getConversationId(),o,f,e,c,l;if(i){o=this.getOffsetedNow();f=this.createMasterPageImpression(this._clientInstrumentationProvider.getInitPageName(),u,"",null,-1);t&&(f.enrichedClientInfo.isColdStart=1);this.logMasterPageImpression(i,f);e=-1;this._keystrokesInstrumentationData[e]={ImpressionGuid:i,ConversationId:i,Query:null,PendingDataSources:{},RankerExtraInfo:{},DataSources:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!0,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{}};this.updatePageIG(e);var s=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,h=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r=_w.performance;r&&r.timing&&(s=this.calculateOffsetTimePoint(r.timing.responseStart),h=this.calculateOffsetTimePoint(r.timing.responseEnd));c=[{JS:o,FBR:s,LBR:h,ABT:this._perfPingConversationStartTimestamp}];l=n.InstrumentationCommon.createPerfPingEvent(i,c,"Init",i);this.logPerfPingEvent(l)}},e.prototype.calculateOffsetTimePoint=function(n){return n-this._perfPingConversationStartTimestamp},e.prototype.getOffsetedNow=function(){return this.calculateOffsetTimePoint(this.getNowTimestamp())},e.prototype.createNonSuggestionsDataSource=function(t,i){var r=[],u,f;for(u in t)r.push(this._clientInstrumentationProvider.createNonSuggestionDataSourceObject(u,t[u]));for(u in i)r.push(this._clientInstrumentationProvider.createDataSourceObject(i[u]));return r.length?(f={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:r.length,DS:r},[f]):[]},e.prototype.createVirtualImpressionURL=function(t,i){var r=this.getOrigin()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(this._host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r},e.prototype.instrumentBcsPopulationEvent=function(t,i){var u=this._host.getConversationId(),f=u,r=n.InstrumentationCommon.createPerfPingEvent(f,undefined,"BCSPopulation",u);r.Data.BCS_V=t;r.Data.EV=i;this.logPerfPingEvent(r)},e.prototype.instrumentDebugEvent=function(t){var i=this._host.getConversationId(),u=i,r=n.InstrumentationCommon.createPerfPingEvent(u,undefined,"Debug",i);r.Data.Message=t;this.logPerfPingEvent(r)},e}();n.InstrumentationHelper=e}(AutoSuggest||(AutoSuggest={})),function(n){var t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c=function(){function c(t,i,r,u,f){u===void 0&&(u=Date.now);f===void 0&&(f=n.getWindowProtocol()+"//"+n.getWindowHost());this._host=t;this._instrumentationHelper=i;this._searchPreCacheHandler=r;this.getNowTimestamp=u;this._baseUrl=f}return c.prototype.getSearchUrl=function(t,i,r,u,e,o){var s,h;return(u||(u=(e?"/"+e:"")+"/search?q="+n.encodeQueryParameter(i)),s=this._baseUrl+u,s=this._instrumentationHelper.enrichTargetUrl(t,r,s,o||this._host.getFormCode()),o)?this.enrichUrlWithMarketInfo(s):(s=this.enrichUrlWithMuidInfo(s),h=this._host.getElToken(),h&&this._baseUrl.startsWith("https:")&&(s+=f+n.encodeQueryParameter(h)),s=this.enrichUrlWithMarketInfo(s),this._searchPreCacheHandler&&(s=this._searchPreCacheHandler.attempPreCacheAndEnrichUrl(s)),s)},c.prototype.enrichUrlWithMarketInfo=function(n){return n+e+this._host.getRegion()+o+this._host.getLanguage()},c.prototype.enrichUrlWithMuidInfo=function(f){var e,o,s;return _G.nclid&&(f+=t+n.encodeQueryParameter(_G.nclid),e=this.getNowTimestamp().toString(),f+=i+n.encodeQueryParameter(e),o=e.substring(0,e.length-3),f+=r+n.encodeQueryParameter(o),s=e.substring(e.length-3),f+=u+n.encodeQueryParameter(s)),f},c.prototype.enrichUrlWithCvid=function(t){return t+(s+n.encodeQueryParameter(this._host.getConversationId()))},c.prototype.enrichUrlWithSuggestionType=function(t,i){return t+(h+n.encodeQueryParameter(i))},c}();n.NavigationHelper=c}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function n(n,t,i){var r=this;this._config=n;this._host=t;this._selectableItemsContainer=i;t.bindKeyDown(function(n,t,u){switch(n){case 38:r.selectNextItem(!0);break;case 40:r.selectNextItem(!1)}i.onAfterKeyDown(n,t,u)})}return n.prototype.selectNextItem=function(n){var i=this._selectableItemsContainer.getSelectableItems(),f;if(i.length!=0){var r=this._selectableItemsContainer.getSelectedItem(),t=r?i.indexOf(r):-1,u=n?t==0:t==i.length-1;(!u||this._config.allowKeyboardNavCycling)&&(u&&this._selectableItemsContainer.allowUnselectedState()||(t=n?t<=0?i.length-1:t-1:(t+1)%i.length,f=i[t]),this._selectableItemsContainer.select(f,!0))}},n}();n.KeyboardEvtHandler=t}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r,u){this._config=n;this._host=t;this._instrumentationHelper=i;this._aggregator=r;this._rootViewModel=u;this._lastUsedId=-1;this._sequenceNumber=-1;this._suggestionsQueue={}}return t.prototype.initiateSequenceNumber=function(t,i){var s=this,u,f,r,e,o;if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}for(this.resetStateForNewQuery(t,i),this._highPriorityDataSources=[],this._normalPriorityDataSources=[],this._lowPriorityDataSources=[],u=0,f=this._config.enabledDataSources;u<f.length;u++)r=f[u],e=i.enabledDataSources[r],e&&(this._config.lowPriorityDataSources[r]||e.forceLowPriority?this._lowPriorityDataSources.push(r):this._config.highPriorityDataSources[r]?this._highPriorityDataSources.push(r):this._normalPriorityDataSources.push(r));this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0?this.processSuggestions(!1):(o=this.getLatencyTimeout(),o>0&&(this._bufferingTimer=sb_st(function(){return n.safeExecute(function(){s._bufferingTimer=null;s.processSuggestions(!0)},"processSuggestionsBuffering")},o)))},t.prototype.getLatencyTimeout=function(){return this._partialQuery.queryToFetch?this._config.latencyTimeout:this._config.latencyTimeoutForZeroInput},t.prototype.queueSuggestions=function(t,i,r,u){if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._suggestionsQueue[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error("Duplicate data source response"));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._suggestionsQueue[i]={suggestions:r,updated:!1};u&&(this._extraSignalsMap[i]=u);this._arrivedDataSources.push(i);this._allDataSourcesArrived=this._arrivedDataSources.length==this._highPriorityDataSources.length+this._normalPriorityDataSources.length+this._lowPriorityDataSources.length;this._processingStopped||this._instrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber):this.processSuggestions(!1)}},t.prototype.resetTimers=function(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null)},t.prototype.resetStateForNewQuery=function(t,i){this._arrivedDataSources=[];this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._extraSignalsMap={};this._isAnySuggestionRendered=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()},t.prototype.getDependencies=function(t){var i=this;return this._host.dataSourceDependencies(t).filter(function(t){return n.isDataSourceEnabled(t,i._partialQuery,i._config)})},t.prototype.haveAllDataSources=function(n){var t=this;return n.every(function(n){return!!t._suggestionsQueue[n]})},t.prototype.processSuggestions=function(t){var i=this,u=[],s=[],r,a=this.getLatencyTimeout()>0&&this._bufferingTimer==null,v=this.haveAllDataSources(this._normalPriorityDataSources),o=this.haveAllDataSources(this._highPriorityDataSources),y=o||a,h=o&&v,c,e,l,f;t&&this._instrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery);c=function(t,f){if(!t.updated&&i.getDependencies(f).every(function(t){return n.contains(i._arrivedDataSources,t)})){if(s.push(f),t.suggestions.length>0){var e=i.canHaveSuppressions(f)?t.suggestions.filter(function(n){return!i.isSuppressed(f,n,t.suggestions)}):t.suggestions;e.length>0&&(r||(r=i._isAnySuggestionRendered?i._rootViewModel.getSuggestions(!0):[]),u=u.concat(i.removeDuplicatesAndAssignIds(e,r,u,f)))}t.updated=!0}};e=function(n){var u,t,r;for(u in n)t=n[u],r=i._suggestionsQueue[t],r&&c(r,t)};y&&e(this._highPriorityDataSources);this._bufferingTimer&&h&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);l=this.getLatencyTimeout()>0?this._bufferingTimer==null:o;l&&(e(this._normalPriorityDataSources),e(this._lowPriorityDataSources));f=t&&!this._isAnySuggestionRendered;this._waitingForMoreResults&&h&&(this._waitingForMoreResults=!1,f=!0);this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(f=!0);(u.length>0||f)&&(r||(r=this._isAnySuggestionRendered?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(r,u,s,f));this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)},t.prototype.getAggregatorResult=function(t,i,r){var f=this,o=n.isBrowserOnline()&&[n.WebDataSource].concat(this.getDependencies(n.WebDataSource)).some(function(t){return n.isDataSourceEnabled(t,f._partialQuery,f._config)&&!n.contains(f._arrivedDataSources,t)}),e=null,u;return this._config.counterFactualLoggingOn&&(e=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,o,!0)),u=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,o,!1),this._config.counterFactualLoggingOn&&(u.isCounterFactualDiff=!this.isSuggestionOrderTheSame(u.topResults,e.topResults)||!this.isSuggestionOrderTheSame(u.suggestionsToAdd,e.suggestionsToAdd)),u},t.prototype.isSuggestionOrderTheSame=function(n,t){var r=function(n){return n.query+"\t"+n.type},i;if(n.length!=t.length)return!1;for(i=0;i<n.length;i++)if(r(n[i])!=r(t[i]))return!1;return!0},t.prototype.addSuggestions=function(t,i,r,u){var e=this,c=this._isAnySuggestionRendered?this._rootViewModel.getCurrentTopResults():[],f=this.getAggregatorResult(c,t,i),o,s,l,h,a,v;for(this._instrumentationHelper.instrumentAggregatorCall(this._sequenceNumber,f),i=f.suggestionsToAdd,o=f.suggestionsToRemove,s=0,l=f.topResults;s<l.length;s++)h=l[s],n.contains(t,h)&&!n.contains(c,h)&&o.push(h);(u||i.length!=0||o.length!=0||!n.sequenceEqual(c,f.topResults))&&(a=!this._isAnySuggestionRendered,a&&(this._isAnySuggestionRendered=!0,this._instrumentationHelper.instrumentRenderingStarted(this._sequenceNumber),this._rootViewModel.setExtraSignalsMap(this._extraSignalsMap)),v=n.safeExecute(function(){return e._rootViewModel.update(a,f.topResults,e._waitingForMoreResults,e._sequenceNumber,i,o,r,f.groupOrder,e._allDataSourcesArrived)},"rootViewModel.update",0,null,function(){return e._host.reloadWebView(!0)}),v==0&&(this._processingStopped=!0,this.resetTimers()))},t.prototype.removeDuplicatesAndAssignIds=function(n,t,i,r){var u=this,s=function(n){n.id||(n.id="id_"+ ++u._lastUsedId)},o;if(this._aggregator.canHaveDuplicates(r)){var e=[],h=function(o){var h=n[o],c=t.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)});if(c>=0)return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,t[c],h),"continue";if(c=i.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)}),c>=0)return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,i[c],h),"continue";if(f._aggregator.canHaveDuplicatesWithinDataSource(r)&&(c=e.findIndex(function(n){return u._aggregator.isDuplicate(u._partialQuery,n,h)}),c>=0))return f._instrumentationHelper.instrumentDuplicate(f._sequenceNumber,e[c],h),"continue";s(h);e.push(h)},f=this;for(o=0;o<n.length;++o)h(o);return e}return n.forEach(function(n){return s(n)}),n},t.prototype.canHaveSuppressions=function(n){return this._config.suppressDataSources[n]||this._config.dataSourcesWithSuppressedTypes[n]},t.prototype.isSuppressed=function(n,t){return this._config.suppressDataSources[n]||this._config.suppressTypes[t.type]},t}();n.SuggestionsRenderingManager=t}(AutoSuggest||(AutoSuggest={})),function(n){function f(n){var t,i;if(n.length==0)return 0;for(t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function t(n,t){var u,i,r;if(n.length===0)return t.length;if(t.length===0)return n.length;for(u=[],i=0;i<=t.length;i++)u[i]=[i];for(r=0;r<=n.length;r++)u[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=n.length;r++)u[i][r]=t.charAt(i-1)==n.charAt(r-1)?u[i-1][r-1]:Math.min(u[i-1][r-1]+1,Math.min(u[i][r-1]+1,u[i-1][r]+1));return u[t.length][n.length]}function s(n,i){return n&&(n=n.toLowerCase()),i&&(i=i.toLowerCase()),t(n,i)}function o(n,t,i){var r=0,u;return(t>0||i>0)&&(t>0&&i>0?(i>t&&(u=t,t=i,i=u),r=n/(t-n+i)):r=Number.MAX_VALUE),r}function h(n,t){return!n||!t?0:n.length+1<=t.length&&t[n.length]==" "?1:n.length==t.length?1:0}function c(n){var r=0,i=1,t;if(n&&n.length>1)for(t=1;t<n.length;t++)n.charAt(t)==n.charAt(t-1)?i++:i=1,i>r&&(r=i);else if(n)return 1;return r}function l(n){return n&&n.length>0?n.trim().split(" ").length:0}function a(n){var t=new RegExp("^[0-9a-zA-Z ]+$");return n&&t.test(n)?1:0}function v(n){return n&&n.length>0&&n.charAt(n.length-1)==" "?1:0}function y(n){return n&&n.length>0&&(n.includes("http://")||n.includes("https://")||n.includes("."))?1:0}function p(t,i,r,u){var e,o,s;t.includes("?")&&(r[117]=1,k(t)&&(r[127]=1));t.replace("///","").replace("//","").includes("/")&&(r[118]=1);t.includes(".")&&(r[119]=1);e=u.cvid+u.privacyNumber+t;r[120]=f(e);(t.startsWith("www.")||t.startsWith("http://www.")||t.startsWith("https://www."))&&(r[122]=1);t.startsWith("www.")||t.startsWith("http://")?r[123]=1:t.startsWith("https://")?r[124]=1:t.startsWith("ftp://")?r[125]=1:r[126]=1;i&&(o=n.normalizeUrl(t,15),s=n.normalizeUrl(i,15),o.startsWith(s)&&(r[187]=1))}function w(n,i,r,u,e){if(e){r[128]=t(e,i);r[129]=e.length;var o=u.cvid+u.privacyNumber+e;r[130]=f(o)}}function b(n,i,r){var e=n.toLocaleLowerCase(),s,u,f,h,c;if(r[140]=n.length,s=e.split(" "),r[144]=s.length,i)for(r[141]=t(n,i),r[142]=Math.min(100,o(r[141],i.length,n.length)),u=i.toLocaleLowerCase(),e.includes(u)&&(r[143]=1),e.startsWith(u)&&(r[188]=1),f=0,h=s;f<h.length;f++)if(c=h[f],c==u){r[145]=1;break}}function k(n){return ct.some(function(t){return n.startsWith(t)})}function d(n){var i=0,r,t;if(n)for(r in n)t=n[r],t&&t.prefixLaunchCount&&(i+=t.prefixLaunchCount);return i}function g(n,t,i,r){if(i){var u=i[n];u&&(t[47]=u.prefixLaunchCount,t[49]=u.lastLaunchTime,t[101]=r,r>0&&(t[100]=u.prefixLaunchCount/r))}}function nt(n,t,r,u,f,e){if(t){var s=i(u,r),o=t[s];o&&(f?(n[153]=o.ProbSugClickGivenPref,n[152]=o.ClicksOnSugGivenPref):e?(n[161]=o.Loglikelihood,n[162]=o.ProbSugClickGivenBackground,n[163]=o.ClicksOnSugGivenPref,n[164]=o.ProbSugClickGivenPref,n[165]=o.CCR,n[166]=o.EventCount,n[167]=o.ProbSugClickGivenTime,n[168]=o.CCRTime):(n[6]=o.Loglikelihood,n[3]=o.ProbSugClickGivenBackground,n[151]=o.ClicksOnSugGivenPref,n[0]=o.ProbSugClickGivenPref,n[94]=o.CCR,n[95]=o.EventCount,n[154]=o.ProbSugClickGivenTime,n[155]=o.CCRTime))}}function tt(n,t,i){if(t){var r=t[i];r&&(n[256]=r.PSGPCR,n[257]=r.PSGCCR,n[258]=r.PSGSTR)}}function i(n,t){return(n+"\t"+t).toLowerCase()}function r(t,i,r,u){i=="100"&&(i=n.GroupType.SearchSuggestions.toString());r==11..toString()&&r==0..toString();switch(t.athenaKeyType){case 0:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),i;case 1:return r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),r;case 2:return u||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key suggestion type is empty")),r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),u+"_"+r;default:return SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group type is not set")),""}}function u(n,t,i,r){switch(n.athenaKeyType){case 0:return i==t;case 1:return r==t;case 2:return r==t;default:return!1}}function it(n,t){var i={};return n?(t.athenaKeyType==2?ft(t,n,i):(rt(t,n,i),ut(t,n,i)),i):i}function rt(n,t,f){var a=t.Suggestions?t.Suggestions.split("\t"):[],v=t.ProbSugClickGivenPrefs?t.ProbSugClickGivenPrefs.split("\t"):[],y=t.ClicksOnSugGivenPrefs?t.ClicksOnSugGivenPrefs.split("\t"):[],p=t.ProbSugClickGivenBackground?t.ProbSugClickGivenBackground.split("\t"):[],w=t.Loglikelihoods?t.Loglikelihoods.split("\t"):[],l=t.SuggestionGroups?t.SuggestionGroups.split("\t"):[],b=t.ProbSugClickGivenPrefWeeks?t.ProbSugClickGivenPrefWeeks.split("\t"):[],k=t.ProbSugClickGivenPrefWeekends?t.ProbSugClickGivenPrefWeekends.split("\t"):[],c=n.athenaKeyType==0||!t.SuggestionHandOffTypes?[]:t.SuggestionHandOffTypes.split("\t"),s=a.length,d=e(),o;if(u(n,s,l.length,c.length))for(o=0;o<s;o++){var g=l&&l.length>o?l[o]:"",nt=c&&c.length>o?c[o]:"",tt=r(n,g,nt,""),h=i(a[o],tt);f[h]={SuggestionGroup:+l[o]};p.length==s&&(f[h].ProbSugClickGivenBackground=Number(p[o]));v.length==s&&(f[h].ProbSugClickGivenPref=Number(v[o]));y.length==s&&(f[h].ClicksOnSugGivenPref=Number(y[o]));w.length==s&&(f[h].Loglikelihood=Number(w[o]));n.athenaKeyType!=0&&c.length==s&&(f[h].SuggestionHandOffType=Number(c[o]));f[h].ProbSugClickGivenTime=b.length!=s||d?k.length==s&&d?Number(k[o]):f[h].ProbSugClickGivenPref:Number(b[o])}else SharedLogHelper.LogError("parseLLSignals",null,new Error("Length doesn't match"))}function ut(n,t,f){var a=t.CCRSuggestions?t.CCRSuggestions.split("\t"):[],l=t.CCRSuggestionGroups?t.CCRSuggestionGroups.split("\t"):[],v=t.CCRs?t.CCRs.split("\t"):[],y=t.EventCounts?t.EventCounts.split("\t"):[],c=n.athenaKeyType==0||!t.CCRSuggestionHandOffTypes?[]:t.CCRSuggestionHandOffTypes.split("\t"),p=t.CCRsWeek?t.CCRsWeek.split("\t"):[],w=t.CCRsWeekend?t.CCRsWeekend.split("\t"):[],s=a.length,b=e(),o;if(u(n,s,l.length,c.length))for(o=0;o<s;o++){var k=l&&l.length>o?l[o]:"",d=c&&c.length>o?c[o]:"",g=r(n,k,d,""),h=i(a[o],g);f[h]||(f[h]={SuggestionGroup:Number(l[o])});v.length==s&&(f[h].CCR=Number(v[o]));y.length==s&&(f[h].EventCount=Number(y[o]));n.athenaKeyType!=0&&c.length==s&&(f[h].CCRSuggestionHandOffType=Number(c[o]));f[h].CCRTime=p.length!=s||b?w.length==s&&b?Number(w[o]):f[h].CCR:Number(p[o])}else SharedLogHelper.LogError("parseCCRSignals",null,new Error("Length doesn't match"))}function ft(n,t,i){var s=t.SugTypes?t.SugTypes.split("\t"):[],h=t.HandOffTypes?t.HandOffTypes.split("\t"):[],c=t.PSGPCRs?t.PSGPCRs.split("\t"):[],l=t.PSGCCRs?t.PSGCCRs.split("\t"):[],a=t.PSGSTRs?t.PSGSTRs.split("\t"):[],e=s.length,f;if(u(n,e,0,h.length))for(f=0;f<e;f++){var v=s[f],y=h[f],o=r(n,"",y,v);i[o]={};c.length==e&&(i[o].PSGPCR=Number(c[f]));l.length==e&&(i[o].PSGCCR=Number(l[f]));a.length==e&&(i[o].PSGSTR=Number(a[f]))}else SharedLogHelper.LogError("parseGroupEngagementSignals",null,new Error("Length doesn't match"))}function e(t){var i=t?t.getDay():n.getDate().getDay();return i==6||i==0}function et(n){switch(n){case 0:case 3:case 5:case 12:case 17:case 18:case 22:case 23:case 24:case 26:case 28:case 40:case 56:case 57:case 91:case 94:case 97:case 99:case 100:case 103:case 135:case 142:case 153:case 154:case 162:case 164:case 165:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:case 184:case 185:case 186:case 190:case 192:case 194:case 196:case 198:case 200:case 202:case 204:case 206:case 207:case 209:case 210:case 212:case 213:case 215:case 216:case 218:case 219:case 221:case 222:case 224:case 225:case 227:case 228:case 233:case 234:case 236:case 237:case 239:case 240:case 242:case 243:case 245:case 247:case 249:case 251:case 255:case 256:case 257:case 258:case 260:case 261:case 262:case 263:case 264:return!0;case 1:case 2:case 4:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 19:case 20:case 21:case 25:case 27:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 37:case 38:case 39:case 40:case 42:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 59:case 60:case 61:case 63:case 64:case 65:case 70:case 82:case 83:case 85:case 86:case 87:case 88:case 89:case 90:case 92:case 93:case 95:case 96:case 98:case 101:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 136:case 137:case 138:case 139:case 140:case 141:case 143:case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 155:case 156:case 157:case 158:case 159:case 160:case 161:case 163:case 166:case 187:case 188:case 189:case 191:case 193:case 195:case 197:case 199:case 201:case 203:case 205:case 208:case 211:case 214:case 217:case 220:case 223:case 226:case 229:case 235:case 238:case 241:case 244:case 246:case 248:case 250:case 252:case 253:case 254:case 1e3:case 1001:case 1002:case 1004:case 1005:case 1006:case 1007:case 1008:case 1009:case 1010:case 1011:case 1012:case 265:return!1;default:throw new Error("Please configure if your new feature is a rate or not");}}function ot(n){var r,t,i;for(r in n)t=parseInt(r),i=n[t],n[t]=et(t)?Math.round(100*i):Math.round(i)}function st(n){var i=Object.keys(n);for(var t in i)n[t]||delete n[t]}function ht(n,t){n.featureStore||(n.featureStore={});n.featureStore[t]=1}n.stringHashCode=f;n.getEditDistance=t;n.getEditDistanceIgnoreCase=s;n.computeEditDistanceRatio=o;n.isWordBoundary=h;n.countMaxContiguousRepeatedChars=c;n.getNumberOfWords=l;n.containsOnlyDigitsLettersOrSpaces=a;n.endsWithSpace=v;n.prefixIsLikeUrl=y;n.computeUrlFeatures=p;n.computeDomainFeatures=w;n.computeTitleFeatures=b;n.getSumMruLaunches=d;n.setMRUSignal=g;n.setEngagementSignals=nt;n.setSuggestionGroupEngagementSignals=tt;n.getEngagementSignalKey=i;n.getAthenaGroupKey=r;n.checkAthenaGroupLength=u;n.parseWebEngagementSignals=it;n.isWeekend=e;n.convertFeaturesToCRank=ot;n.removeUndefinedAndZeroValues=st;n.setFlagInFeatureStore=ht;var ct=["http://www.bing.","www.bing.","https://www.bing.","http://cn.bing.","cn.bing.","https://cn.bing.","http://www.google.","www.google.","https://www.google.","http://www.yandex.","www.yandex.","https://www.yandex.","http://www.baidu.","www.baidu.","https://www.baidu.","http://www.yahoo.","www.yahoo.","https://www.yahoo."]}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){i.suggestionRankingModels={};var r=function(){function r(n,t){this._config=n;this._autoComplete=t}return r.prototype.rank=function(n,t,i,r,u,f,e,o){return this.addFeatureStoreToSuggestions(n,t,i,r,u,f,e,o),(n.queryToFetch||this._config.rerankZeroInput)&&t.sort(function(n,t){return t.rankingScore-n.rankingScore}),this.createRankerResponse(n,t)},r.prototype.addFeatureStoreToSuggestions=function(t,r,u,f,e,o,s,h){var p=this,v=n.safeExecute(function(){return p.createFeatureStore(t,r,u,f,e,o,s)},"createFeatureStore"),c,l,y,a;for(v=v||r.map(function(){return{}}),l=h?this._config.counterFactualRankerId:this._config.mainRankerId,l?(c=n.safeExecute(function(){return i.suggestionRankingModels[l]},"getRanker"),c||(SharedLogHelper.LogError("getRanker",l,new Error("Ranker not found")),h||Object.keys(i.suggestionRankingModels).length!=1||(c=i.suggestionRankingModels[Object.keys(i.suggestionRankingModels)[0]]))):SharedLogHelper.LogError("getRanker",l,new Error(h?"CounterFactualRankerId not defined ":"MainRankerId not defined")),y=function(t){var i=v[t];c&&(r[t].rankingScore=n.safeExecute(function(){return c(i)},"calculateRankingScore"));r[t].featureStore=i},a=0;a<r.length;a++)y(a)},r.prototype.createRankerResponse=function(i,r){var e=[],u,f,o;if(i.queryToFetch&&(u=this.getTopHitCandidate(i,r),this._config.fallbackClassifierId&&u&&(u.handoffType==0||u.handoffType==11)&&(u=u.type!=t.SyntheticQSCodes.PartialQuery&&this.getFallbackClassifierScore(u)>=.5?u:null),u&&(e.push(u),r.splice(r.indexOf(u),1),u.type==t.OnlineSuggestionTypes.Entity)))for(f=r.length;f--;)r[f].type==t.OnlineSuggestionTypes.Entity&&r[f]!=u&&(e.push(r[f]),r.splice(f,1));return o=i.queryToFetch?[]:[n.GroupType.Frequent,n.GroupType.SearchHistory],{topResults:e,groupOrder:o}},r.prototype.getFallbackClassifierScore=function(t){var u=this,r=n.safeExecute(function(){return i.suggestionRankingModels[u._config.fallbackClassifierId]},"getFallbackClassifier");return r?n.safeExecute(function(){return r(t.featureStore)},"calculateFallbackClassifierScore"):0},r.prototype.getTopHitCandidate=function(n,i){var f=this,r=i,u,e,o,s;if(this._config.forceTypedUrlsToTopHit)for(u=0;u<r.length;++u)if(e=r[u],e.hc&&t.considerAsTypedURL(e,this._config)){i.splice(u,1);r.unshift(e);break}return o=!this._config.allowWebOnTopWhenAutoCompletableTypedURLPresent&&i.some(function(i){return i.hc&&t.considerAsTypedURL(i,f._config)&&f._autoComplete.canAutoComplete(i,n)}),r=r.filter(function(n){return f.isAllowedInTopHit(n,o)}),s=r.filter(function(t){return f._autoComplete.canAutoComplete(t,n)}),s[0]||r[0]},r.prototype.isAllowedInTopHit=function(t,i){return t.handoffType==1?!0:!this._config.allowWebOnTopWhenAutoCompletableTypedURLPresent&&i?(n.setFlagInFeatureStore(t,1001),!1):this._config.allowAnyNonHcWebToTopHit||t.hc?!0:(n.setFlagInFeatureStore(t,1002),!1)},r.prototype.createFeatureStore=function(i,r,u,f,e,o,s){var h=this,l=n.getSumMruLaunches(f),c=i.queryToFetch,a=c.length,v=n.countMaxContiguousRepeatedChars(c),y=n.getNumberOfWords(c),p=n.containsOnlyDigitsLettersOrSpaces(c),w=n.endsWithSpace(c),b=n.prefixIsLikeUrl(c),k=i.parsedUrl&&i.parsedUrl.type==0;return r.map(function(r){var d={},g;return(u&&u.WebSignalsAvailable||e)&&(d[93]=1),s&&(d[149]=1),d[10]=a,d[105]=v,d[106]=y,d[110]=p,k&&(d[109]=1),b&&(d[160]=1),d[114]=w,h._autoComplete.canAutoComplete(r,i,d)&&(d[254]=1),g=h._autoComplete.getPrevAutoCompletedSuggestion(),g&&r.query==g.query&&(d[253]=1),h._config.forceTypedUrlsToTopHit&&r.hc&&t.considerAsTypedURL(r,h._config)&&(d[1e3]=1),h.populateSuggestionFeatures(d,c,r,o,e,f,l),h.setSugCategoryEngagmentSignals(d,u),h._config.enableCrankerFeatureConversion&&n.convertFeaturesToCRank(d),n.removeUndefinedAndZeroValues(d),d})},r.prototype.populateSuggestionFeatures=function(i,r,u,f,e,o,s){var h,l,c,a;this.setTypeSignal(u,i);this.setSuggestionQuerySignal(u.query,r,i);i[255]=this.getSuggestionGroupCcr(u);i[156]=u.webASPosition?u.webASPosition:100;u.hc&&(i[189]=1);this._config.enableHighConfidenceMetaSuggestionScoreFeature&&(i[17]=u.highConfidenceMetaSuggestionScore);this._config.enableHighConfidenceMetaSuggestionScoreFeature&&typeof u.prefetchConfidenceScore!="undefined"?i[23]=u.prefetchConfidenceScore:i[111]=1;u.handoffType==1&&u.url&&(n.computeUrlFeatures(u.url,r,i,f,!u.mayContainPII),h=n.getDomain(u.url),n.computeDomainFeatures(u,r,i,f,h,this._config,e),h&&this._config.athenaKeyType==1&&(l=n.getAthenaGroupKey(this._config,"",String(u.handoffType),""),n.setEngagementSignals(i,e,l,h,!0)));n.setMRUSignal(t.getSuggestionKey(u),i,o,s);u.visitCount&&(i[138]=u.visitCount);u.lastAccessed?i[9]=t.lastAccessedInDays(u.lastAccessed):i[19]=1;u.secondaryText&&!t.secondaryTextIsAnnotation(u)?n.computeTitleFeatures(HitHighlightingParser.removeMarkers(u.secondaryText),r,i):i[139]=1;c=n.getAthenaGroupKey(this._config,"",String(u.handoffType),u.type);this._config.athenaKeyType==2&&n.setSuggestionGroupEngagementSignals(i,e,c);this._config.athenaKeyType==1?(a=u.handoffType==1&&u.url?u.url:u.query,n.setEngagementSignals(i,e,c,a,!1)):n.setEngagementSignals(i,e,String(u.handoffType),u.query,!1)},r.prototype.setTypeSignal=function(n,i){n.isAnswer&&(i[116]=1);switch(n.type){case t.SyntheticQSCodes.PartialQuery:i[107]=1;break;case t.SyntheticQSCodes.PartialWebsite:i[108]=1;break;case t.OnlineSuggestionTypes.Deeplink:case t.OnlineSuggestionTypes.DirectNav:i[21]=1;break;case t.LocalSuggestionTypes.History:i[112]=1;break;case t.LocalSuggestionTypes.Favorite:i[113]=1}t.considerAsTypedURL(n,this._config)&&(i[104]=1)},r.prototype.setSuggestionQuerySignal=function(t,i,r){t||(r[65]=1);r[15]=t?t.length:i.length;t&&(r[70]=n.isWordBoundary(i,t));t&&(r[14]=n.getEditDistanceIgnoreCase(i,t));t&&(r[22]=Math.min(100,n.computeEditDistanceRatio(r[14],i.length,t.length)));t&&i&&t.toLowerCase()==i.toLowerCase()&&(r[20]=1);t&&i&&t.toLowerCase().includes(i.toLowerCase())&&(r[115]=1)},r.prototype.setSugCategoryEngagmentSignals=function(n,t){t&&(n[190]=t.UrlCCR,n[192]=t.WebCCR,n[194]=t.AnswerCCR,n[12]=t.PrefixProbability,n[196]=t.DNavCCR,n[198]=t.HistCCR,n[200]=t.PfCCR,n[202]=t.PweCCR,n[204]=t.OtherCCR,n[245]=t.FVCCR,n[247]=t.HUCCR,n[249]=t.TUCCR,n[251]=t.FQCCR,n[206]=t.UrlPSugClickGivenPref,n[207]=t.UrlPSugClickGivenBgnd,n[209]=t.WebPSugClickGivenPref,n[210]=t.WebPSugClickGivenBgnd,n[212]=t.AnswerPSugClickGivenPref,n[213]=t.AnswerPSugClickGivenBgnd,n[215]=t.DNavPSugClickGivenPref,n[216]=t.DNavPSugClickGivenBgnd,n[218]=t.HistPSugClickGivenPref,n[219]=t.HistPSugClickGivenBgnd,n[221]=t.PfPSugClickGivenPref,n[222]=t.PfPSugClickGivenBgnd,n[224]=t.PwePSugClickGivenPref,n[225]=t.PwePSugClickGivenBgnd,n[227]=t.OtherPSugClickGivenPref,n[228]=t.OtherPSugClickGivenBgnd,n[233]=t.FVPSugClickGivenPref,n[234]=t.FVPSugClickGivenBgnd,n[236]=t.HUPSugClickGivenPref,n[237]=t.HUPSugClickGivenBgnd,n[239]=t.TUPSugClickGivenPref,n[240]=t.TUPSugClickGivenBgnd,n[242]=t.FQPSugClickGivenPref,n[243]=t.FQPSugClickGivenBgnd,n[191]=t.UrlEvents,n[193]=t.WebEvents,n[195]=t.AnswerEvents,n[197]=t.DNavEvents,n[199]=t.HistEvents,n[201]=t.PfEvents,n[203]=t.PweEvents,n[205]=t.OtherEvents,n[246]=t.FVEvents,n[248]=t.HUEvents,n[250]=t.TUEvents,n[252]=t.FQEvents,n[208]=t.UrlLogL,n[211]=t.WebLogL,n[214]=t.AnswerLogL,n[217]=t.DNavLogL,n[220]=t.HistLogL,n[223]=t.PfLogL,n[226]=t.PweLogL,n[229]=t.OtherLogL,n[235]=t.FVLogL,n[238]=t.HULogL,n[241]=t.TULogL,n[244]=t.FQLogL)},r.prototype.getSuggestionGroupCcr=function(n){if(t.considerAsTypedURL(n,this._config))return.898;switch(n.type){case t.SyntheticQSCodes.PartialQuery:return.19;case t.LocalSuggestionTypes.History:return.308;case"AS":return.169;case"LS":return.152;case t.SyntheticQSCodes.PartialWebsite:return.77;case t.LocalSuggestionTypes.Frequent:return.995;case t.OnlineSuggestionTypes.Entity:return.442;case t.SyntheticQSCodes.TokenizedWebsite:return.724;case"OS":return.137;case t.OnlineSuggestionTypes.DirectNav:return.568;case"SC":return.287;case t.LocalSuggestionTypes.Favorite:return.166;case"LC":return.078;case"RI":return.091;case"DA":return.685;case t.OnlineSuggestionTypes.SearchHistory:return.116;case"TPP":return.612;case"SP":return.359;case"FACT":return.071;case"WA":return.398;default:return.228}},r}();i.FastRankRanker=r})(i=t.Ranking||(t.Ranking={}))})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function u(n,i,r,u,f){var e;if(f&&i.isThirdPartySearchProvider())e=t.Intents.Answer;else switch(r){case t.OnlineSuggestionTypes.SearchHistory:e=n.useHistoryIconForSearch&&n.serverIntentDetection>=2?t.Intents.HistorySearch:t.Intents.Search;break;case t.LocalSuggestionTypes.History:case t.LocalSuggestionTypes.TypedUrl:case t.LocalSuggestionTypes.Frequent:e=t.Intents.History;break;case t.LocalSuggestionTypes.Favorite:e=n.favoriteIconSupported?t.Intents.Favorite:t.Intents.History;break;default:e=u==1?e=t.Intents.DirectNav:t.Intents.Search}return(e==t.Intents.Search||e==t.Intents.HistorySearch)&&i.isBingThirdPartySearchProvider()&&(e=t.Intents.Answer),e}function c(n,i,r){switch(i){case t.OnlineSuggestionTypes.SearchHistory:return n.useHistoryIconForSearch?t.Icons.History:t.Icons.Search;case t.LocalSuggestionTypes.History:case t.LocalSuggestionTypes.TypedUrl:case t.LocalSuggestionTypes.Frequent:return t.Icons.History;case t.LocalSuggestionTypes.Favorite:return n.favoriteIconSupported?t.Icons.Favorite:t.Icons.History}return r==1?t.Icons.Globe:t.Icons.Search}function f(n,t,i){return{content:c(n,t,i),type:1}}function e(n,i,r,u){return r==1?n.titlePositionedNextToUrl?null:i.getLocString("Website"):i.getLocString("ProviderSearch",u||!i.isThirdPartySearchProvider()?t.BingSearchProvider:i.getMachineState().searchProvider)}function l(n,i){if(i.handoffType!=1)return!1;switch(i.type){case t.SyntheticQSCodes.PartialWebsite:case t.LocalSuggestionTypes.Frequent:case t.SyntheticQSCodes.TokenizedWebsite:return!1;default:return!0}}function i(i,r,o,s,h,c,l,a,v,y,p){y===void 0&&(y=null);var w=t.createSuggestion(y,o,h,c,e(i,r,s,!1),l,t.CssClass_Annotation,!0,f(i,p||o,s),s,u(i,r,p||o,s,!1),t.SyntheticQSCodes.KValues[o]?n.InstrumentedItem.getNonSuggestionInstrumentedItem(o,t.SyntheticQSCodes.KValues):n.InstrumentedItem.createInstrumentedItem(a),a,v,!1);return w.narratorText=t.getSuggestionNarratorText(w),w}function r(n,t,i,r){var u={query:n,text:null};return s(u,t,i,r),u}function s(t,i,r,u){var f,s,e,o;u.prettyPrintURLs&&n.getProtocol(t.query)!=2&&(f=n.normalizeUrl(t.query,23),s=!f.includes(".")&&!f.includes("/"),s||(e=n.removeUrlPrefixes(t.query,i,!0),e!=t.query&&(t.query=e,t.text=null)));t.text||r||(o=t.query.replace(/%20/g," "),t.text=i?HitHighlightingParser.addMarkers(o,i):o)}var o=["http:","https:","ftp:"],h=function(){function h(n,t){this._config=n;this._host=t}return h.prototype.parse=function(t,i,r,u,f,e){switch(r){case n.WebDataSource:this.parseOnlineResponse(t,u,e,i);break;case n.MRUDataSource:this.parseMRUResponse(u,e);break;default:this.parseLocalResponse(t,u,r,e,i)}},h.prototype.parseMRUResponse=function(t,i){i(n.MRUDataSource,[],t)},h.prototype.parseOnlineResponse=function(t,i,r,u){var e=this,o,f,s;i&&i.ELToken&&this._host.shouldRequestEltoken()&&this._host.setElToken(i.ELToken);o=i?i.Suggestions.map(function(n,r){return e.parseOnlineResponseSuggestion(t,u,i.Resources,n,r)}).filter(function(n){return!!n}):[];f=null;i&&i.RankingSignals&&(f=n.safeExecute(function(){return n.parseWebEngagementSignals(i.RankingSignals,e._config)},"parseWebEngagementSignals"));s=i?{engagementSignals:f,rankingSignals:i.RankingSignals}:null;r(n.WebDataSource,o,s)},h.prototype.parseOnlineResponseSuggestion=function(i,r,o,h,c){var a=h.Attributes,y=a.stype,k,d,p,tt,l,g;if(!i.queryToFetch&&y!=t.OnlineSuggestionTypes.SearchHistory)return null;var w=h.InstantAnswer,nt=w&&w.Content?w.Content.HTML:null,b=!!(nt||a.secondaryIconUrl||a.additionalInfoText),v=a.stype==t.OnlineSuggestionTypes.DirectNav||a.stype==t.OnlineSuggestionTypes.Deeplink?1:a.isVertical==="1"?9:0;return v==0&&!b&&this._host.isThirdPartySearchProvider()&&(v=11),h.SecondaryText?(k=y==t.OnlineSuggestionTypes.Deeplink?HitHighlightingParser.addMarkers(h.SecondaryText,i.queryToFetch):h.SecondaryText,d=t.CssClass_SecondaryText):(k=e(this._config,this._host,v,b),d=t.CssClass_Annotation),p={query:a.query,text:y==t.OnlineSuggestionTypes.Deeplink?null:h.Text},v==1&&s(p,i.queryToFetch,i.isZeroInput,this._config),tt=n.InstrumentedItem.createInstrumentedItem(r),l=t.createSuggestion(null,y,p.query,i.queryToFetch?p.text:HitHighlightingParser.addMarkers(p.text),k,a.url,d,a.hc==="1",n.getIconFromOnlineResponse(h)||f(this._config,y,v),v,u(this._config,this._host,y,v,b),tt,r,!1,b,nt),l.highConfidenceMetaSuggestionScore=h.HighConfidenceMetaSuggestionScore,l.highConfidenceSuggestionScore=a.hcs,l.suggestionLogMeta=a.lm,l.prefetchConfidenceScore=h.PrefetchConfidenceScore,l.isPrefetch=h.Attributes.pc==="1",l.webASPosition=c+1,l.answerHtml&&(g=JsonInject.GetResourceKeys([w]),g&&(l.executeScript=function(){return JsonInject.WriteAfterContentResources(JsonInject.FilterResources(o,g))})),l.additionalInfoText=a.additionalInfoText,a.secondaryIconUrl&&(l.secondaryIcon={content:a.secondaryIconUrl,type:0},l.text.includes(HitHighlightingParser.startMarker)||(l.text=HitHighlightingParser.addMarkers(l.text,i.originalQuery))),l.narratorText=t.getSuggestionNarratorText(l),l},h.prototype.parseLocalResponse=function(i,o,s,h,c){var v,y,tt,d,nt,ft,b;if(!o){h(s,[],null);return}for(v={},v[o.types.TYPE_FAVORITE]=t.LocalSuggestionTypes.Favorite,v[o.types.TYPE_HISTORY]=t.LocalSuggestionTypes.History,v[o.types.TYPE_TYPEDURL]=t.LocalSuggestionTypes.TypedUrl,v[o.types.TYPE_FREQUENT]=t.LocalSuggestionTypes.Frequent,y={},y[t.LocalSuggestionTypes.Favorite]={count:0,maxSuggestions:this._config.edgeMaxFavorites,isEnabled:!!i.queryToFetch},y[t.LocalSuggestionTypes.History]={count:0,maxSuggestions:this._config.edgeMaxHistory,isEnabled:!!i.queryToFetch},y[t.LocalSuggestionTypes.TypedUrl]={count:0,maxSuggestions:this._config.edgeMaxTypedUrls,isEnabled:!!i.queryToFetch},y[t.LocalSuggestionTypes.Frequent]={count:0,maxSuggestions:this._config.edgeMaxFrequents,isEnabled:i.isZeroInput},tt=[],d=0;d<o.results.length;++d){var l=o.results[d],a=v[l.type],p=y[a];if(!p.isEnabled||p.maxSuggestions&&p.count>=p.maxSuggestions){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l,"max "+p.maxSuggestions);continue}var w=l.url,it=l.title,g=1,rt=r(w,i.queryToFetch,i.isZeroInput,this._config),ut=a==t.LocalSuggestionTypes.Frequent,et=ut?it:rt.text,k=a==t.LocalSuggestionTypes.TypedUrl||ut||!it?null:HitHighlightingParser.addMarkers(it,i.queryToFetch),ot=a==t.LocalSuggestionTypes.TypedUrl&&(!l.autoComplete||this._config.serverIntentDetection||i.topHitRestriction!=0);if(a==t.LocalSuggestionTypes.History||ot){if(n.isJunkUrl(w)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l,"isJunkUrl");continue}if(n.isBingSearchUrl(w)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l,"isBingSearchUrl");continue}if(i.queryToFetch&&!i.isMultiWord&&this.suppressHistory(w,k,i)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l,"suppressHistory");continue}}if(a==t.LocalSuggestionTypes.Favorite&&i.queryToFetch&&!i.isMultiWord&&this.suppressFavorite(w,k,i)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l,"suppressFavorite");continue}t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,l);++p.count;nt=void 0;k?nt=t.CssClass_SecondaryText:(k=e(this._config,this._host,g,!1),nt=t.CssClass_Annotation);ft=l.iconUri?{content:"data:image/png;base64,"+l.iconUri,type:0}:f(this._config,a,g);b=t.createSuggestion(null,a,rt.query,et,k,w,nt,l.autoComplete,ft,g,u(this._config,this._host,a,g,!1),n.InstrumentedItem.createInstrumentedItem(c),c,!0,!1);b.lastAccessed=l.lastAccessed;b.visitCount=l.visitCount;b.narratorText=t.getSuggestionNarratorText(b);tt.push(b)}h(s,tt,null)},h.prototype.suppressHistory=function(t,i,r){var u=t.indexOf(":"),e=t.slice(u+1),f;return u>0&&(f=t.slice(0,u+1),!n.contains(o,f))?!r.queryToFetch.startsWith(f):!n.matchesOnDomain(e,r)&&!this.matchesOnTitle(i,r)},h.prototype.matchesOnTitle=function(n){var t,i,r;return n?(t=n.indexOf(HitHighlightingParser.startMarker),t<0)?!1:this._config.minLengthForTitleMatch?t==0?!0:(i=n.indexOf(HitHighlightingParser.endMarker),r=i-t-1,r>=this._config.minLengthForTitleMatch):!0:!1},h.prototype.suppressFavorite=function(t,i,r){var e=i&&i.includes(HitHighlightingParser.startMarker);if(e)return!1;var u=t.indexOf(":"),f=u>0?t.slice(0,u+1):"http:",s=t.slice(u+1);return f=="read:"||n.contains(o,f)?!n.matchesOnDomain(s,r):!0},h.createAutocompletedSuggestion=function(i,r,u){var f=Object.assign({},r),o=f.text?HitHighlightingParser.removeMarkers(f.text):f.query,e;return f.text=HitHighlightingParser.addMarkers(o,i.queryToFetch),f.secondaryText&&!t.secondaryTextIsAnnotation(f)&&(e=HitHighlightingParser.removeMarkers(f.secondaryText),f.secondaryText=HitHighlightingParser.addMarkers(e,i.queryToFetch)),f.hc=!0,f.instItem=t.SyntheticQSCodes.KValues[f.type]?n.InstrumentedItem.getNonSuggestionInstrumentedItem(f.type,t.SyntheticQSCodes.KValues):n.InstrumentedItem.createInstrumentedItem(u),f.sequenceNumber=u,f.narratorText=t.getSuggestionNarratorText(f),f.autoCompleteType=3,f},h.createWebsiteTokenizedSuggestion=function(u,f,e,o,s){var v,p,a;if(!l(f,o))return null;var y=["/","?","#"],k=function(n,t,i){var r=t.map(function(t){return n.indexOf(t,i)}).filter(function(n){return n>=0});return r.length<=0?-1:r.reduce(function(n,t){return Math.min(n,t)},Infinity)},h=o.url.toLowerCase();if(!h.startsWith("http")||(v=n.normalizeUrl(e.fixedUrl,15),!v||y.some(function(n){return v.includes(n)}))||(p=h.indexOf(n.normalizeUrl(h,31)),a=k(h,y,p),a<=0||a==h.length-1))return null;var w=o.url.substring(0,a)+"/",b=r(w,e.queryToFetch,e.isZeroInput,f),c=i(f,u,t.SyntheticQSCodes.TokenizedWebsite,1,b.query,b.text,w,s,o.mayContainPII,o.id,t.LocalSuggestionTypes.History);return o.type==t.OnlineSuggestionTypes.DirectNav&&(c.icon=o.icon,c.intent=o.intent,c.secondaryText=o.secondaryText,c.secondaryTextClass=o.secondaryTextClass),c},h.createPartialQuery=function(r,u,f,e){return i(r,u,t.SyntheticQSCodes.PartialQuery,u.isThirdPartySearchProvider()?11:0,f.originalQuery,HitHighlightingParser.addMarkers(f.queryToFetch),"/search?q="+n.encodeQueryParameter(f.queryToFetch),e,!1,"tpq")},h.createPartialWebsite=function(n,u,f,e){var o=r(f.fixedUrl,f.queryToFetch,f.isZeroInput,n);return i(n,u,t.SyntheticQSCodes.PartialWebsite,1,o.query,o.text,f.fixedUrl,e,!1,"tpw")},h.parseClientAutoComplete=function(n,u,f,e,o){var s=r(f,e,!e,n),h=i(n,u,t.LocalSuggestionTypes.TypedUrl,1,s.query,s.text,f,o,!0);return h.autoCompleteType=4,h},h}();t.SuggestionsParser=h})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,t,i,r){var u=this;this._config=n;this._host=t;this._navigationHelper=i;n.serverIntentDetection&&t.bindClientAutoComplete(function(n,t,i){return u.onClientAutoComplete(n,t,i,r.getSequenceNumber())});t.bindQueryChangedOrInitialized(function(n){u._previousAutoCompleteState=u._autoCompleteState;!n.queryToFetch&&u._autoCompleteState&&u.clearAutoComplete()})}return i.prototype.getAutocompletedSuggestion=function(n){return this._autoCompleteState&&(!n||this._autoCompleteState.forCurrentQuery)?this._autoCompleteState.suggestion:null},i.prototype.getPrevAutoCompletedSuggestion=function(){return this._previousAutoCompleteState?this._previousAutoCompleteState.suggestion:null},i.prototype.getAutocompletedQuery=function(){return this._autoCompleteState?this._autoCompleteState.prefix:null},i.prototype.isForcedAutoComplete=function(){return this._autoCompleteState?this._autoCompleteState.forCurrentQuery:!1},i.prototype.isConsideredValidAutoComplete=function(n,t,i){var r=this.checkIfIsValidAutoCompleteByClient(n,t);return r?!i||!r.isExactMatch:!1},i.prototype.canAutoComplete=function(t,i,r){var f,u,o;if(!i.originalQuery||!this.isConsideredValidAutoComplete(t,i,!1))return r&&i.originalQuery&&(r[1005]=1),!1;if(t.handoffType==1)return!0;if(i.intent==0)return r&&(r[1006]=1),!1;if(f=t.query.toLocaleLowerCase(),u=i.originalQuery.toLocaleLowerCase(),n.isNonHttpProtocol(f))return o=n.isNonHttpProtocol(u)&&!i.hasRegisteredProtocol,r&&!o&&(r[1007]=1),o;var s=f.indexOf(u),h=f.substring(s),e=n.tryParseUrl(h,!1);return!e||e.type!=0?!0:(r&&u.length<=e.length&&(r[1008]=1),u.length>e.length)},i.prototype.onQueryChanged=function(n,i){var f,r,e,u,o;n.originalQuery&&((this._autoCompleteState&&(f=!this._autoCompleteState.prefix,n.topHitRestriction==0||f?(r=this.checkIfIsValidAutoCompleteByClient(this._autoCompleteState.suggestion,n),r?f?this.storeAutoComplete(n.originalQuery,this._autoCompleteState.suggestion,r.isExactMatch):(e=this.getAutocompletedSuggestion(!1),this._autoCompleteState.suggestion=t.SuggestionsParser.createAutocompletedSuggestion(n,e,i),this._autoCompleteState.isExactMatch=r.isExactMatch,this._config.serverIntentDetection&&(this._autoCompleteState.forCurrentQuery=!1)):this.clearAutoComplete()):this.clearAutoComplete()),this.isForcedAutoComplete())||(u=this._autoCompleteState?this._autoCompleteState.suggestion:n.intent==0?t.SuggestionsParser.createPartialWebsite(this._config,this._host,n,i):t.SuggestionsParser.createPartialQuery(this._config,this._host,n,i),o=this.buildNavigateUrl(n,u,!1),this._host.setAddressBarContentAction(u.query,u.intent,o,!1,!1)))},i.prototype.setAddressBarContent=function(n,t,i,r){var u,f,e;n&&t&&(u=!1,i||r||(f=this.checkIfIsValidAutoCompleteByClient(t,n),u=f&&!f.isExactMatch),u?(this.storeAutoComplete(n.originalQuery,t,!1),t.autoCompleteType||(t.autoCompleteType=1)):this.clearAutoComplete(),e=this.buildNavigateUrl(n,t,u),this._host.setAddressBarContentAction(t.query,t.intent,e,i,u))},i.prototype.onClientAutoComplete=function(n,i,r,u){var f=t.SuggestionsParser.parseClientAutoComplete(this._config,this._host,i,n,u);this.storeAutoComplete(r?null:n,f,!1);this._host.setAddressBarContentAction(f.query,f.intent,f.url,!1,!0)},i.prototype.buildNavigateUrl=function(t,i,r){if(i.handoffType!=1)return this._navigationHelper.getSearchUrl(t.queryToFetch,i.query,i.type,i.url);var u=i.url;return r?n.safeExecute(function(){var i=t.originalQuery,r=u.toLocaleLowerCase().indexOf(i.toLocaleLowerCase());if(u.indexOf(i)==r)return u;var e=n.tryParseUrl(u,!1),o=u.substring(0,r)+i+u.substring(r+i.length),f=n.tryParseUrl(o,!1);return f.protocol=e.protocol,f.hostname=e.hostname,n.stripAuthenticationFromUrl(f)},"buildNavigateUrl",u):u},i.prototype.clearAutoComplete=function(){this._autoCompleteState=null},i.prototype.storeAutoComplete=function(n,t,i){this._autoCompleteState={suggestion:t,prefix:n,forCurrentQuery:!0,isExactMatch:i}},i.prototype.isCompatibleProtocolForAutocompletion=function(n,t){switch(n){case 1:return t==1;case 2:return t==2;case 3:return t!=0;case 0:return!0}},i.prototype._canAutocomplete=function(n,t){return n&&t&&n.startsWith(t)?{isExactMatch:n.length==t.length}:null},i.prototype.checkIfIsValidAutoCompleteByClient=function(t,i){var r=t.query.toLowerCase(),u=i.originalQuery.toLowerCase(),c,e,o,f,s,h,l;return t.handoffType!=1?this._canAutocomplete(r,u):(!this._config.serverIntentDetection||this._config.serverIntentDetection<2)&&(c=n.normalizeUrl(u,15),!c)?null:(e=n.getProtocol(u),o=n.getProtocol(r),/^\/{2,}$/.test(u)&&o!=0)?{isExactMatch:!1}:this.isCompatibleProtocolForAutocompletion(e,o)?this._config.serverIntentDetection>=2&&(f=this._canAutocomplete(r,u),f)?f:(s=this._config.serverIntentDetection>=2?7:3,r=n.normalizeUrl(r,s),u=n.normalizeUrl(u,s),this._config.serverIntentDetection>=2&&(f=this._canAutocomplete(r,u),f))?f:(h=n.hasWww(u),l=n.hasWww(r),l?h?this._canAutocomplete(r,u):e!=0?null:(r=n.normalizeUrl(r,8),this._config.serverIntentDetection>=2&&(f=this._canAutocomplete("."+r,u),f))?f:this._canAutocomplete(r,u):h?null:this._canAutocomplete(r,u)):null},i}();t.IEOneBoxAutoComplete=i})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function i(n){return n.type==t.SyntheticQSCodes.PartialQuery||n.type==t.SyntheticQSCodes.PartialWebsite}function r(n,t,i){if(t<100)for(var r=n.length-1;n.length>t&&r>=0;--r)i(n[r])&&n.splice(r,1)}t.trimList=r;var u=function(){function u(n,t,i,r,u){this._config=n;this._host=t;this._instrumentationHelper=i;this._autoComplete=r;this._ranker=u}return u.prototype.getOrCreatePartialWebsite=function(n,i){return this._instrumentationHelper.getInstrumentedSyntheticSuggestion(i,t.SyntheticQSCodes.PartialWebsite)||t.SuggestionsParser.createPartialWebsite(this._config,this._host,n,i)},u.prototype.getOrCreatePartialQuery=function(n,i){return this._instrumentationHelper.getInstrumentedSyntheticSuggestion(i,t.SyntheticQSCodes.PartialQuery)||t.SuggestionsParser.createPartialQuery(this._config,this._host,n,i)},u.prototype.createSyntheticSuggestions=function(n,t){var r=[],u,i;return n.queryToFetch&&(n.intent==0&&(i=this.getOrCreatePartialWebsite(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,i),r.push(i)),u=this.getOrCreatePartialQuery(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,u),r.push(u),n.intent==2&&(i=this.getOrCreatePartialWebsite(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,i),r.push(i))),r},u.prototype.canHaveDuplicates=function(i){switch(i){case n.WebDataSource:case t.DataSources.Local:case t.DataSources.TypedUrls:return!0;case n.MRUDataSource:return!1}throw new Error("New data source "+i+" needs to be explicity classified as needed deduping with other data sources or not");},u.prototype.canHaveDuplicatesWithinDataSource=function(n){return n==t.DataSources.Local},u.prototype.isDuplicate=function(t,i,r){return i.isAnswer!=r.isAnswer?!1:n.isDuplicateUrl(t,i.url,r.url)?(this.updateSuggestionMetaData(i,r),!0):!1},u.prototype.isDuplicateOfEntity=function(n,i){return i.type==t.OnlineSuggestionTypes.Entity&&!n.isAnswer&&n.handoffType==i.handoffType&&n.query.toLocaleLowerCase()==i.query.toLocaleLowerCase()},u.prototype.updateSuggestionMetaData=function(n,i){(!n.secondaryText||t.secondaryTextIsAnnotation(n))&&(n.secondaryText=i.secondaryText,n.secondaryTextClass=i.secondaryTextClass,n.narratorText=t.getSuggestionNarratorText(n));i.visitCount&&(n.visitCount=(n.visitCount||0)+i.visitCount);i.lastAccessed&&(!n.lastAccessed||n.lastAccessed<i.lastAccessed)&&(n.lastAccessed=i.lastAccessed);i.type==t.LocalSuggestionTypes.TypedUrl&&i.hc&&(n.hc=i.hc)},u.prototype.rank=function(u,f,e,o,s,h,c,l){var y=this,d=e[n.WebDataSource],p=null,v,rt,at,g,vt,a,ut,w,ft,yt,pt,dt,gt,nt,et,ot,wt,ni,bt,b,tt,ti,it;d&&d.rankingSignals&&(p=d.rankingSignals);p&&(p.WebSignalsAvailable=!0);var st={cvid:this._host.getConversationId(),privacyNumber:this._host.getPrivacyNumber()},ht=d?d.engagementSignals:null,kt=e[n.MRUDataSource],ct=kt?kt.RankingSignals:null,lt=this._host.getMachineState().domainJoined,k=this.createSyntheticSuggestions(o,h);for(this._config.rerankPartialQuery||this._ranker.addFeatureStoreToSuggestions(o,k,p,ct,ht,st,lt,l),this._config.enableFullSuppressions&&p&&(p.SuppressURLs&&(u.some(function(n){return n.type!=t.SyntheticQSCodes.PartialQuery&&(n.handoffType==0||n.handoffType==11)})||f.some(function(n){return n.type!=t.SyntheticQSCodes.PartialQuery&&(n.handoffType==0||n.handoffType==11)}))?f=f.filter(function(n){return n.handoffType!=1}):p.SuppressWeb&&(u.some(function(n){return n.type!=t.SyntheticQSCodes.PartialWebsite&&n.handoffType==1})||f.some(function(n){return n.type!=t.SyntheticQSCodes.PartialWebsite&&n.handoffType==1}))&&(f=f.filter(function(n){return n.handoffType!=0&&n.handoffType!=11}))),v=f.concat(u.filter(function(n){return!i(n)})),this._config.rerankPartialQuery&&(v=v.concat(k)),this._config.rerankWebASSuggestions||(at=this.separateRankableSuggestions(v),v=at.rankableSuggestions,rt=at.nonRankableSuggestions),g=this._ranker.rank(o,v,p,ct,ht,st,lt,l),s.length>0&&g.topResults.length>0&&this.isDuplicateOfEntity(s[0],g.topResults[0])&&(s=s.slice(1)),vt=s.filter(function(n){return n.pinned}),a=vt.concat(g.topResults.filter(function(n){return!vt.some(function(t){return y.isDuplicate(o,t,n)})})),a.length!=0&&this.allowOnTopHit(o,a[0])?this._config.rerankPartialQuery?(this._config.dedupAnswersWithWebAS&&!this._host.isThirdPartySearchProvider()&&a.some(function(n){return n.isAnswer&&n.query==o.queryToFetch})&&(v=v.filter(function(n){return n.type!=t.SyntheticQSCodes.PartialQuery})),o.intent==2&&a[0].handoffType==1&&(v=v.filter(function(n){return n.type!=t.SyntheticQSCodes.PartialWebsite}))):(ut=k.filter(function(n){return!a.some(function(t){return y.isDuplicate(o,t,n)||y._config.dedupAnswersWithWebAS&&t.isAnswer&&t.query==n.query&&n.handoffType==0})}),o.intent==2&&a[0].handoffType==1&&(ut=ut.filter(function(n){return n.type!=t.SyntheticQSCodes.PartialWebsite})),a=a.concat(ut)):(a=k.slice(0,1).concat(a.filter(function(n){return!k.some(function(t){return y.isDuplicate(o,n,t)})})),!this._config.rerankPartialQuery&&k.length>1&&(a=a.concat(k.slice(1)))),w=this.getAutocompletedSuggestion(a[0],o),w&&(a=a.filter(function(n){return!y.isDuplicate(o,n,w)}),a.length>0&&a[0].isAnswer&&a[0].type!=t.OnlineSuggestionTypes.Entity?(w.features=(w.features||[]).concat("DroppedAnswer"),this._config.dropAnswersOnForcedAutocomplete?a[0]=w:a.unshift(w)):a.unshift(w),n.setFlagInFeatureStore(a[0],1004),this._instrumentationHelper.instrumentSyntheticSuggestion(h,w)),this.tokenizeTopResult(o,a,h),ft=0,yt=a;ft<yt.length;ft++)pt=yt[ft],i(pt)||(pt.pinned=!0);if(dt=this._config.rerankWebASSuggestions?v:this.insertNotRankedSuggestions(v,rt,a),this._config.rerankWebASSuggestions||(this._ranker.addFeatureStoreToSuggestions(o,rt,p,ct,ht,st,lt,l),rt.forEach(function(t){return n.setFlagInFeatureStore(t,1012)})),gt=u.filter(function(t){return!n.contains(s,t)}),nt=dt.filter(function(i){return y.allowedInGroups(i)&&(!y._config.suppressHistoryWithoutMSA||i.type!=t.OnlineSuggestionTypes.SearchHistory||y._host.isSignedInWithMSA())&&!n.contains(gt,i)&&!a.some(function(n){return y.isDuplicate(o,n,i)})}),o.queryToFetch){if(a=a.concat(nt),nt=[],this._config.edgeMaxUrls>0){for(et=0,ot=0,wt=a;ot<wt.length;ot++)tt=wt[ot],(tt.handoffType==0||tt.handoffType==11)&&++et;if(ni=Math.max(this._config.totalMaxSuggestions-et,this._config.edgeMaxUrls),a.length>this._config.totalMaxSuggestions&&et>0)for(bt=0,b=0;b<a.length;++b)tt=a[b],tt.handoffType==1&&(++bt,b>0&&bt>ni&&!i(a[b])&&(a.splice(b,1),b-=1))}ti=function(t){return!i(t)&&!n.contains(s,t)};it=this._config.totalMaxSuggestions;c&&(it-=this._config.spaceReservedUntilWebArrives);r(a,it,ti)}else it=this._config.totalMaxSuggestionsForZeroInput-u.length,r(nt,it,function(){return!0});return{topResults:a,suggestionsToAdd:nt,suggestionsToRemove:[],groupOrder:g.groupOrder}},u.prototype.allowOnTopHit=function(t,i){var r,u,f;if(t.topHitRestriction==1&&i.query.toLocaleLowerCase()!=t.queryToFetch.toLocaleLowerCase())return n.setFlagInFeatureStore(i,1009),!1;if(this._config.preventAutoCompleteForJustWwwOrHttp&&i.handoffType==1){if(r=t.queryToFetch,r=="/"||!n.normalizeUrl(r,31))return n.setFlagInFeatureStore(i,1010),!1;if(u=r.toLowerCase(),f=n.normalizeUrl(i.url,31),("https".startsWith(u)||"www".startsWith(n.normalizeUrl(u,7)))&&!f.startsWith(u))return n.setFlagInFeatureStore(i,1011),!1}return this._autoComplete.canAutoComplete(i,t)},u.prototype.allowedInGroups=function(n){return!n.isAnswer},u.prototype.separateRankableSuggestions=function(n){for(var i,r=[],f=[],e=!0,u=0,o=n;u<o.length;u++)i=o[u],this.isRankableWebSuggestion(i)?e||n[0].type==t.OnlineSuggestionTypes.Entity&&i.type==t.OnlineSuggestionTypes.Entity?(r.push(i),e=!1):f.push(i):r.push(i);return{rankableSuggestions:r,nonRankableSuggestions:f}},u.prototype.insertNotRankedSuggestions=function(n,t,i){var u=this,r;if(n.length==0)return t;if(t.length==0)return n;if(i.some(function(n){return u.isRankableWebSuggestion(n)}))return t.concat(n);for(r=0;r<n.length;r++)if(this.isRankableWebSuggestion(n[r]))return n.slice(0,r+1).concat(t).concat(n.slice(r+1));return n.concat(t)},u.prototype.isRankableWebSuggestion=function(i){return n.isWebSuggestion(i)&&i.type!=t.SyntheticQSCodes.PartialQuery||i.isAnswer},u.prototype.getAutocompletedSuggestion=function(n,t){var i=this._autoComplete.getAutocompletedSuggestion(!0);return(i||!n||this._autoComplete.isConsideredValidAutoComplete(n,t,!0)||this._config.allowBreakingAutocomplete||(i=this._autoComplete.getAutocompletedSuggestion(!1)),!i||n&&n.url==i.url)?null:i},u.prototype.tokenizeTopResult=function(i,r,u){var o=r[0],f,e,s;if(o&&(this._config.serverIntentDetection||!t.considerAsTypedURL(o,this._config))&&!this._autoComplete.isForcedAutoComplete()&&(f=t.SuggestionsParser.createWebsiteTokenizedSuggestion(this._host,this._config,i,r[0],u),f)){for(o.type==t.OnlineSuggestionTypes.DirectNav?r[0]=f:r.unshift(f),e=0;e<r.length;++e)if(s=r[e],n.isDuplicateUrl(i,s.url,f.url)&&s.type!=t.SyntheticQSCodes.TokenizedWebsite){r.splice(e);break}this._instrumentationHelper.instrumentSyntheticSuggestion(u,f)}},u}();t.Aggregator=u})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r,u){var f=this;this._config=n;this._instrumentationHelper=i;this._sequenceNumberReader=r;this._page=u;this._itemLaunchEventHandlers=[];this.groups=[];this.topResults=[];this._lastUpdatedSequenceNumber=-1;this._topResultsRenderingDisabled=!1;this._groupRenderingDisabled=!1;t.bindDismissed(function(){f.topResults=[];f.renderTopResults();f.groups=[];f.renderGroups();f._partialQuery=null;f._extraSignalsMap=null;f._lastUpdatedSequenceNumber=-1});t.bindShown(function(){f._selectedItem=null})}return t.prototype.bindItemLaunch=function(n){this._itemLaunchEventHandlers.push(n)},t.prototype.onSuggestionLaunch=function(n){var t=this;this._itemLaunchEventHandlers.forEach(function(i){return i(n,t._partialQuery,t._extraSignalsMap)})},t.prototype.onQueryChanged=function(){this._extraSignalsMap=null},t.prototype.setExtraSignalsMap=function(n){this._extraSignalsMap=n},t.prototype.getCurrentTopResults=function(){return this.topResults.slice(0)},t.prototype.getTopResultsWhichFitInCanvas=function(n){return n},t.prototype.update=function(t,i,r,u,f,e,o,s,h){var l=this,p,w,c,a,k;t!=(u!=this._lastUpdatedSequenceNumber)&&SharedLogHelper.LogError("updateTopResult",t+" != (sequenceNumber "+u+" != lastUpdateSequenceNumber "+this._lastUpdatedSequenceNumber+")",new Error("Precondition failed"));this._lastUpdatedSequenceNumber=u;p=this.groups;t&&(this.groups=[],this.onGroupsCleared());w=this._selectedItem;c=this.topResults;i=this.getTopResultsWhichFitInCanvas(i);a=!n.sequenceEqual(i,c);a&&(this.topResults=i.slice(0));var v=!1,y=a?i.length:0,b=function(){v&&y==0&&(l._instrumentationHelper.instrumentTopResultRendered(u,i.map(function(n){return n.type})),v=!1)};a?(this.renderTopResultsAfter(function(){for(var e,t=0,i=l.topResults;t<i.length;t++)e=i[t],n.contains(c,e)?y-=1:l.setupIcon(u,e,!0,function(){y-=1;b()});l.onBeforeRenderTopResults(c,f,r,h)}),v=!0):(k=this.onBeforeRenderTopResults(c,f,r,h),k==0&&(this.renderTopResults(),v=!0));this._selectedItem&&(w!=this._selectedItem||t)&&n.contains(this.topResults,this._selectedItem)&&this._page.render(function(){var n=_ge(l._selectedItem.id);n&&(n.setAttribute("aria-selected","false"),n.setAttribute("aria-selected","true"))});return this.onAfterRenderTopResults(t,r,u,f,e,o,s,a,c,p,b)},t.prototype.setupIcon=function(n,t,i,r){r()},t.prototype.renderGroups=function(){this._groupRenderingDisabled||this._page.updateGroupsView(this.groups)},t.prototype.renderGroupsAfter=function(n){var t=this._groupRenderingDisabled;this._groupRenderingDisabled=!0;try{n()}finally{this._groupRenderingDisabled=t;this.renderGroups()}},t.prototype.renderTopResults=function(){this._topResultsRenderingDisabled||this._page.updateTopResultsView(this.topResults)},t.prototype.renderTopResultsAfter=function(n){var u=this._topResultsRenderingDisabled,t,i,r;this._topResultsRenderingDisabled=!0;try{n()}finally{for(this._topResultsRenderingDisabled=u,this.renderTopResults(),t=0,i=this.topResults;t<i.length;t++)r=i[t],r.executeScript&&r.executeScript()}},t.prototype.insertGroup=function(n,t){for(var u,f=t.indexOf(n.type),r=!1,i=0;i<this.groups.length;i++)if(u=t.indexOf(this.groups[i].type),u>f){this.groups.splice(i,0,n);r=!0;break}r||this.groups.push(n)},t}();n.BaseRootViewModel=t}(AutoSuggest||(AutoSuggest={})),function(n){var t="aria-selected",i=function(){function n(){var n=this,i;this._renderingInProgress=!1;this._narratorLaunchHandlers=[];i=new MutationObserver(function(i){var r,o,u,f,s,e;if(!n._renderingInProgress){for(r=[],u=0,f=i;u<f.length;u++)s=f[u],e=s.target,o=e.id,r.push(e.getAttribute(t)=="true"?1:0);(r.length==1&&r[0]==0||r.length==2&&r[0]^r[1])&&n._narratorLaunchHandlers.forEach(function(n){return n(o)})}});i.observe(document,{subtree:!0,attributes:!0,attributeFilter:[t]})}return n.prototype.bindOnNarratorLaunch=function(n){this._narratorLaunchHandlers.push(n)},n.prototype.render=function(n){var t=this;sb_ct(this._renderingTimer);this._renderingInProgress=!0;try{n()}finally{this._renderingTimer=sb_st(function(){return t._renderingInProgress=!1},0)}},n}();n.BasePage=i}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i=function(n){function t(t,i){var r=n.call(this)||this,u;return r._host=t,r._viewData={TestHooksEnabled:i.th,TitlePositionedNextToUrl:i.titlePositionedNextToUrl},u="en-US",r._groupsView=Sparkle.render("AutoSuggest:IEOneBoxGroups",{uiCulture:u,properties:{Groups:[]},viewData:r._viewData},_ge("groups")),r._topResultsView=Sparkle.render("AutoSuggest:IEOneBoxTopResults",{uiCulture:u,properties:{Suggestions:[]},viewData:r._viewData},_ge("topResults")),r}return __extends(t,n),t.prototype.setSuggestionClickHandler=function(n){this._suggestionClickHandler=n},t.prototype.updateGroupsView=function(n){var t=this;this.render(function(){Sparkle.update(t._groupsView,{uiCulture:t._host.getMachineState().lang,properties:{Groups:n,ClickHandler:t._suggestionClickHandler},viewData:t._viewData})})},t.prototype.updateTopResultsView=function(n){var t=this;this.render(function(){Sparkle.update(t._topResultsView,{uiCulture:t._host.getMachineState().lang,properties:{Suggestions:n,ClickHandler:t._suggestionClickHandler},viewData:t._viewData})})},t}(n.BasePage);t.Page=i})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function y(t,i,r,u,e,o){var s={impressionGuid:t,content:i,actionTarget:r,action:u,doActionNow:e,autocomplete:o};return n.objEquals(s,f)?null:(f=s,JSON.stringify(s))}function i(t){var i=_w[s],r;return i?(r=i.getCachedFrameMessage(t),n.safeExecute(function(){return JSON.parse(r)},"getCachedFrameMessage "+t)):null}function u(n,t){var i=_w[s];i&&i.postFrameMessage(n,t)}function p(){return Math.floor(Math.random()*Number.MAX_VALUE)}function e(){return _w.ClientTestHooks&&ClientTestHooks.getUrlValue("touchDevice",undefined)!==undefined?ClientTestHooks.isTesthookParamSet("touchDevice"):t.hololens||navigator.maxTouchPoints>0}var l=34,o=12,a=.862,s="ServiceUIFrameContext",h="smallSuggestionRow",f,v=["ar","dv","fa","he","ku-arab","pa-arab","prs","ps","sd-arab","syr","ug","ur","qps-plocm"],r,c;(function(n){n.DHP={WithContent:{Default:"EDGHPC",OnTop:"EDGHPT",Html:"ESPFR1"}};n.NTP={WithContent:{Default:"EDGNTC",OnTop:"EDGTCT",Html:"ENTFR1"},NoContent:{Default:"EDGENT",OnTop:"EDGNTT",Html:"ENTFR3"}};n.RegularTab="EDGEAR"})(r||(r={}));c=function(){function s(r,u){var f=this,e;this._config=r;this._seqNumberManager=u;this._oneBoxType=t.OneBoxTypes.RegularTab;this._appVisibleEventHandlers=[];this._shownEventHandlers=[];this._clientAutoCompleteEventHandlers=[];this._conversationStartEventHandlers=[];this._dismissedEventHandlers=[];this._appHiddenEventHandlers=[];this._onSubmitHandlers=[];this._queryChangedHandlers=[];this._keyDownHandlers=[];this._topHitRestriction=0;this._sequenceNumber=n.InstrumentationCommon.INVALID_SEQUENCE_NUMBER;this._lastKeyWasEnter=!1;this._pendingClientAutocomplete=!1;this._currentPaneHeight=0;this._root=_ge("root");this._paneCloseCount=0;this.bindKeyDown(function(t,i){var r=t==13;r&&!f._lastKeyWasEnter&&f._onSubmitHandlers.forEach(function(t){return n.safeExecute(function(){return t(!1,i)},"onSubmit handlers")});f._lastKeyWasEnter=r});sj_be(_w,"addressbarchanged",function(){var i=f._seqNumberManager.getSequenceNumber();i>f._sequenceNumber&&(f._topHitRestriction=0,f._sequenceNumber=i);t.autoCompleteTrace&&t.autoCompleteTrace(f,"*event* addressbarchanged (sq="+i+")");n.safeExecute(function(){return f.callQueryChangedHandlers(!1)},"addressbarchanged")});sj_be(_w,"keydown",function(i){var r,u;f._lastKeyCode=i.keyCode;f._lastModifierKeys={shiftKey:i.shiftKey,ctrlKey:i.ctrlKey,altKey:i.altKey};f._sequenceNumber=f._seqNumberManager.getSequenceNumber();f._topHitRestriction=n.isDeletionKey(f._lastKeyCode,f._lastModifierKeys)?1:0;t.autoCompleteTrace&&(r=i.shiftKey?"SHIFT+":"",r+=i.ctrlKey?"CTRL+":"",r+=i.altKey?"ALT+":"",u="keydown "+r+f._lastKeyCode+" (sq="+f._sequenceNumber+")",t.autoCompleteTrace(f,u));f._keyDownHandlers.forEach(function(t){return n.safeExecute(function(){return t(i.keyCode,{shiftKey:i.shiftKey,ctrlKey:i.ctrlKey,altKey:i.altKey})},"keydown")})});sj_be(_w,"locationavailable",function(){return n.safeExecute(function(){return f.tryRetrieveUserLocation()},"locationavailable")});sj_be(_w,"serviceuidismissed",function(){f._paneCloseCount+=1;t.autoCompleteTrace&&t.autoCompleteTrace(f,"*event* serviceuidismissed");f._dismissedEventHandlers.forEach(function(t){return n.safeExecute(function(){return t()},"serviceuidismissed")});f._appHiddenEventHandlers.forEach(function(t){return n.safeExecute(function(){return t()},"apphidden")})});sj_be(_w,"rpstokenavailable",function(){t.autoCompleteTrace&&t.autoCompleteTrace(f,"*event* rpstokenavailable");n.safeExecute(function(){return f.tryRetrieveRpsToken()},"rpstokenavailable")});sj_be(_w,"serviceuiopened",function(){t.autoCompleteTrace&&t.autoCompleteTrace(f,"*event* serviceuiopened");f.initializeConversation(!1)});sj_be(_w,"clientautocomplete",function(){f._machineState?n.safeExecute(function(){return f.onClientAutocomplete()},"clientautocomplete"):f._pendingClientAutocomplete=!0});sj_be(_w,"pagetypechanged",function(){return n.safeExecute(function(){var n=i("pagetypechanged");t.autoCompleteTrace&&t.autoCompleteTrace(f,"*event* pagetypechanged: "+JSON.stringify(n));n&&n.pageType&&(f._oneBoxType=n.pageType.toUpperCase())},"pagetypechanged")});r.th&&(e=_ge("ClientLog"),sj_be(e,"click",function(){e.innerHTML="";f.adjustHeight()}))}return s.prototype.initializeEvents=function(){var i=this;t.autoCompleteTrace&&t.autoCompleteTrace(this,"initialize");this.initializeConversation(!0);this.bindConversationStart(function(){i._pendingClientAutocomplete&&n.safeExecute(function(){return i.onClientAutocomplete()},"pendingClientAutocomplete")});this.bindDismissed(function(){i._machineState=null;i._userLocation=null;i._shouldRequestEltoken=!1;i._currentPaneHeight=0})},s.prototype.initializeConversation=function(r){var e=this,u=i("serviceUIConversation"),f;u&&(f=this._currentCVID,this._currentCVID=n.cleanGuid(u.conversationGuid),this._oneBoxType=u.type.toUpperCase(),t.autoCompleteTrace&&t.autoCompleteTrace(this,"cvid = "+this._currentCVID+", type = "+this._oneBoxType),this.tryRetrieveUserLocation(),this.tryRetrieveRpsToken(),this.getMachineState(),f!=this._currentCVID)&&(this._randomPrivacyNumber=p(),this._appVisibleEventHandlers.forEach(function(n){return n()}),this._shownEventHandlers.forEach(function(n){return n()}),this._conversationStartEventHandlers.forEach(function(n){return n()}),r&&n.safeExecute(function(){return e.callQueryChangedHandlers(!0)},"initializeConversation"))},s.prototype.bindOnSubmit=function(n){this._onSubmitHandlers.push(n)},s.prototype.bindQueryChangedOrInitialized=function(n){this._queryChangedHandlers.push(n)},s.prototype.bindKeyDown=function(n){this._keyDownHandlers.push(n)},s.prototype.bindAppVisible=function(n){this._appVisibleEventHandlers.push(n)},s.prototype.bindShown=function(n){this._shownEventHandlers.push(n)},s.prototype.bindConversationStart=function(n){this._conversationStartEventHandlers.push(n)},s.prototype.bindDismissed=function(n){this._dismissedEventHandlers.push(n)},s.prototype.bindAppHidden=function(n){this._appHiddenEventHandlers.push(n)},s.prototype.bindClearMRURequested=function(){},s.prototype.bindClientAutoComplete=function(n){this._clientAutoCompleteEventHandlers.push(n)},s.prototype.getLocString=function(t){for(var i,u=[],r=1;r<arguments.length;r++)u[r-1]=arguments[r];return this._locStrings?(i=this._locStrings[t],i&&u.length>0&&(i=n.formatString(i,u)),i):(SharedLogHelper.LogError("getLocString",t+(this._machineState?" [machineState available]":" [machineState not available]"),new Error("No locStrings")),"")},s.prototype.getRawImpressionGuid=function(){return this._currentRawImpressionGuid},s.prototype.getConversationId=function(){return this._currentCVID},s.prototype.getPrivacyNumber=function(){return this._randomPrivacyNumber},s.prototype.getQuery=function(){return this._lastQuery||this.refreshQuery(),this._lastQuery},s.prototype.setAddressBarContentAction=function(n,i,r,f,e){var o=y(this._currentRawImpressionGuid,n,r,i,f,e);t.autoCompleteTrace&&t.autoCompleteTrace(this,"setAddressBarContent "+o);o&&(u("setAddressBarContent",o),this._wasLastQueryAutocompleted=e)},s.prototype.setClientAutocompleteDelayWindow=function(n){this._config.serverIntentDetection>=2?u("setClientAutocompleteDelayWindow",JSON.stringify({delayWindow:n})):this._config.serverIntentDetection&&u("setScriptOverrideWindow",JSON.stringify({overrideWindow:n}))},s.prototype.adjustHeight=function(){var f=this,n,i,r;this._pendingAdjustSizeTimer&&(sb_ct(this._pendingAdjustSizeTimer),this._pendingAdjustSizeTimer=null);this._config.th&&(this._root.style.height="");n=this._root.offsetHeight;this._config.disableAnswerAnimation||(this._topResults===undefined&&(this._topResults=_ge("topResults").children[0]),this._topResults&&this._topResults.children.length>0&&(i=this._topResults.children[0],i.classList.contains("rich")&&i.offsetHeight==0&&(n+=t.AnswerHeight)));r=function(){u("adjustHeight",'{"height":'+n+"}");f._currentPaneHeight=n;f._pendingAdjustSizeTimer=null};!this._config.paneResizeDelay||n>=this._currentPaneHeight?r():this._pendingAdjustSizeTimer=sb_st(r,this._config.paneResizeDelay)},s.prototype.shouldRequestEltoken=function(){return this._shouldRequestEltoken},s.prototype.getElToken=function(){return this._elToken},s.prototype.setElToken=function(n){this._elToken=n;this._shouldRequestEltoken=!1},s.prototype.getFormCode=function(){if(this._oneBoxType!=t.OneBoxTypes.DefaultHomePage&&this._oneBoxType!=t.OneBoxTypes.NewTabPage)return r.RegularTab;var n=this.getMachineState(),i=r.DHP.WithContent;return this._oneBoxType==t.OneBoxTypes.NewTabPage&&(i=typeof n.newTabPageDisplayOption!="undefined"&&n.newTabPageDisplayOption==0?r.NTP.WithContent:r.NTP.NoContent),n.addressBarPosition=="frame"?n.searchIsFromHtmlAddressBox?i.Html:i.OnTop:i.Default},s.prototype.refreshQuery=function(){var n=this.getAddressbarContent(),i,r;n&&this._topHitRestriction==0&&(i=this._lastQuery?this._lastQuery.originalQuery.length:0,r=n.content.length,r>=i+10&&(this._topHitRestriction=1));this._lastQuery=n?t.parseQuery(n,this.getMachineState(),this.isThirdPartySearchProvider(),this._config,this._topHitRestriction,this._oneBoxType):null},s.prototype.callQueryChangedHandlers=function(n){var t=this,i=n?this.tryRetrieveClientAutoComplete(!0):null;if(this.refreshQuery(),!this._lastQuery){n||SharedLogHelper.LogError("callQueryChangedHandlers",null,new Error("address bar content is null"));return}n&&this.fireClientAutoCompleteEventHandlers(i,!0);this._queryChangedHandlers.forEach(function(n){return n(t._lastQuery,t._wasLastQueryAutocompleted)})},s.prototype.fireClientAutoCompleteEventHandlers=function(n,t){if(n&&n.content){var i=this._lastQuery?this._lastQuery.originalQuery:n.typedContent;this._clientAutoCompleteEventHandlers.forEach(function(r){return r(i,n.content,t)})}},s.prototype.onClientAutocomplete=function(){this._pendingClientAutocomplete=!1;var n=this.tryRetrieveClientAutoComplete(!1);this.fireClientAutoCompleteEventHandlers(n,!1)},s.prototype.tryRetrieveClientAutoComplete=function(n){var r=i("clientAutoComplete");if(t.autoCompleteTrace&&t.autoCompleteTrace(this,(n?"[cached]":"*event*")+" clientAutoComplete "+JSON.stringify(r)),r)if(r.preventAutocomplete!=undefined)r.preventAutocomplete&&(this._topHitRestriction=1);else if(r.content)return r;return null},s.prototype.tryRetrieveUserLocation=function(){var n=i("location");n&&(this._userLocation=n.location,this._shouldRequestEltoken=!0)},s.prototype.tryRetrieveRpsToken=function(){var n=i("rpsToken");n&&(this._rpsToken=n.rpsToken)},s.prototype.getAddressbarContent=function(){f=null;var n=i("addressBarContent");return n&&(this._currentRawImpressionGuid=n.addressbar.impressionGuid,t.autoCompleteTrace&&t.autoCompleteTrace(this,"getAddressbarContent "+JSON.stringify(n))),n?n.addressbar:null},s.prototype.applyAccentColor=function(t){var r,i,u;t=t.replace(",alpha","");r="accentColor";i=_d.getElementById(r);i||(i=sj_ce("style"),i.id=r,i.type="text/css",_d.head.appendChild(i));u=".cortanaIcon svg{fill:{0}}.accentColor{color:{0}}.sa_hv{border-left-color:{0}}";n.isHighContrastEnabled()||(u+=".sa_hv,.selectable.sa_hv:hover,.suggestion.sa_hv:hover{background-color:{1}}");i.innerHTML=n.formatString(u,[t,this.addTransparency(t,.3)])},s.prototype.addTransparency=function(n,t){return n.replace("rgb","rgba").replace(")",","+t+")")},s.prototype.applyRowHeight=function(){var n=this.useSmallSuggestionRow();this._smallSuggestionRow!=n&&(n?(t.SuggestionHeight=t.SmallerSuggestionHeight,this._root.classList.add(h)):(t.SuggestionHeight=t.DefaultSuggestionHeight,this._root.classList.remove(h)),this._smallSuggestionRow=n)},s.prototype.useSmallSuggestionRow=function(){switch(this._config.suggestionHeightType){case 0:return!0;case 1:return!e();case 2:return!1;default:throw new Error("Unsupported suggestion height type: "+this._config.suggestionHeightType);}},s.prototype.getCustomUrlParameters=function(){var t={},i=this.getMachineState();return t[n.Service.QueryParams.CountryCode]=i.market,t[n.Service.QueryParams.SetLang]=i.lang,t},s.prototype.getCustomHeaders=function(){var t={},i=this.getMachineState();this._userLocation&&(t["X-Search-Location"]=this._userLocation);i.cortana||(t["X-Device-isOptin"]="false");i.cortanaCapabilities&&(t["X-Search-CortanaAvailableCapabilities"]=i.cortanaCapabilities);this.isThirdPartySearchProvider()&&(t["X-Search-ThirdParty"]="true");e()&&(t["X-Device-Touch"]="true");var r=Math.max(n.getWindowWidth(),320),u=i.cortana?o+l:0,f=Math.round((r-2*o-u)*a);return t["X-Autosuggest-ContentWidth"]=f.toString(),this._rpsToken&&(t["X-Search-RPSToken"]=this._rpsToken),t},s.prototype.getMachineState=function(){return this._machineState||this.initializeMachineState(),this._machineState},s.prototype.isSignedInWithMSA=function(){return!!this._rpsToken},s.prototype.reloadWebView=function(){location.reload()},s.prototype.initializeMachineState=function(){var n=i("machineState");this._machineState=n;this.applyAccentColor(n.accentColor);this.checkCortanaStatus(n.cortana,n.market);this.applyLanguage(n.lang);this.applyInstrumentation(n.inPrivate,n.searchSuggestionsOn);this.applyRowHeight();t.autoCompleteTrace&&t.autoCompleteTrace(this,"thirdPartySearchProvider: "+n.thirdPartySearchProvider+", searchProvider: "+n.searchProvider)},s.prototype.checkCortanaStatus=function(n,t){_d.body.setAttribute("cortana",n&&t.toLowerCase()!="cn"?"on":"off")},s.prototype.applyLanguage=function(t){var i={uiCulture:t,name:"OneBox",namespace:"AutoSuggest"};this._locStrings=n.safeExecute(function(){return LocStringManager.getLocString(i)},"applyLanguage",null,t);this._locStrings||(i.uiCulture=t="en-US",this._locStrings=n.safeExecute(function(){return LocStringManager.getLocString(i)},"applyLanguage",null,t));_d.body.setAttribute("lang",t);_d.body.setAttribute("dir",v.some(function(n){return t=t.toLocaleLowerCase(),t==n||t.startsWith(n+"-")})?"rtl":"ltr")},s.prototype.applyInstrumentation=function(n,t){var i=n||t===!1;i&&(ClientInstConfig.isInstrumentationEnabled=!1)},s.prototype.getRegion=function(){return this.getMachineState().market},s.prototype.getLanguage=function(){return this.getMachineState().lang},s.prototype.isThirdPartySearchProvider=function(){var n=this.getMachineState();return n.thirdPartySearchProvider&&n.searchProvider!=t.BingSearchProvider},s.prototype.isBingThirdPartySearchProvider=function(){var n=this.getMachineState();return n.thirdPartySearchProvider&&n.searchProvider==t.BingSearchProvider},s.prototype.dataSourceDependencies=function(){return[]},s.prototype.getPaneCloseCount=function(){return this._paneCloseCount},s.prototype.hasFallbackHappened=function(){return!1},s}();t.Host=c;t.getCachedFrameMessage=i;t.postFrameMessage=u;t.hololens=navigator.userAgent.includes("Holographic");t.isTouchDevice=e})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){function f(t){switch(t){case n.GroupType.Frequent:return"FrequentSites";case n.GroupType.SearchHistory:return"SearchHistory"}throw new Error("Unknown group type: "+t);}var r="pushDown",u="slideIn",i="show",e=function(e){function o(t,i,r,u,f,o){var s=e.call(this,t,i,r,f,o)||this;return s._host=i,s._autoComplete=u,s._submitAlreadyDone=!0,s._resultsCounter={numberOfGroups:0,numberOfSuggestions:0,numberOfTopResultAnswers:0,numberOfTopResultSuggestions:0,numberOfTopResult2LinesSuggestions:0},s._isUserKeyboardNavigating=!1,s._maxHeight=s.getOneBoxMaxHeight(),sj_be(_w,"maxsizechanged",function(){return s._maxHeight=s.getOneBoxMaxHeight()}),o.setSuggestionClickHandler(function(i){return n.safeExecute(function(){t.alwaysUseCustomInstrumentation&&s.instrumentGpingForNonStandardLaunch(i,s._lastUpdatedSequenceNumber,null,1);s._instrumentationHelper.onItemClick(s._lastUpdatedSequenceNumber,!1,null);s.navigate(i)},"suggestionClickHandler")}),i.bindKeyDown(function(t){return s._isUserKeyboardNavigating=n.isUpOrDownKey(t)}),i.bindQueryChangedOrInitialized(function(){return s._isUserKeyboardNavigating=!1}),o.bindOnNarratorLaunch(function(n){for(var i,u=s.getSelectableItems(),t=0,r=u;t<r.length;t++)if(i=r[t],i.id==n){s.instrumentGpingForNonStandardLaunch(null,s._lastUpdatedSequenceNumber,null,2);s.navigate(i);break}}),s}return __extends(o,e),o.prototype.getSuggestions=function(){var n=this.getCurrentTopResults();return this.groups.forEach(function(t){return n=n.concat(t.suggestions)}),n},o.prototype.getSelectableItems=function(){for(var t,n=this.topResults,i=0,r=this.groups;i<r.length;i++)t=r[i],t.instItem&&(n=n.concat(t)),n=n.concat(t.suggestions);return n},o.prototype.getSelectedItem=function(){return this._selectedItem},o.prototype.select=function(t,i,r){r===void 0&&(r=!0);var u=this._selectedItem;u&&(u.selected=!1);this._selectedItem=t;t&&(t.selected=!0);(t&&n.contains(this.topResults,t)||u&&n.contains(this.topResults,u))&&this.renderTopResults();(t&&this.groups.some(function(i){return i==t||n.contains(i.suggestions,t)})||u&&this.groups.some(function(t){return t==u||n.contains(t.suggestions,u)}))&&this.renderGroups();t&&i&&this.setAddressBarText(t,r)},o.prototype.allowUnselectedState=function(){return!1},o.prototype.onAfterKeyDown=function(){},o.prototype.submit=function(n,t,i,r,u){if(!this._submitAlreadyDone){var f=u?3:0;if(this.instrumentGpingForNonStandardLaunch(null,t,r,f),i(),this._selectedItem)this.onSuggestionLaunch(this._selectedItem);this._submitAlreadyDone=!0}},o.prototype.instrumentGpingForNonStandardLaunch=function(i,r,u,f){var e,o,s;i?e=i.instItem.getHValue():!this._selectedItem||u&&u.ctrlKey?(o=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t.SyntheticQSCodes.NoSuggestion,t.SyntheticQSCodes.KValues),this._instrumentationHelper.instrumentSyntheticInstrumentedItem(r,t.SyntheticQSCodes.NoSuggestion,o),e=o.getHValue()):e=this._selectedItem.instItem.getHValue();this._instrumentationHelper.instrumentCustomGping(f,e,null,u);s=r>this._lastUpdatedSequenceNumber;this._instrumentationHelper.onItemClick(r,s,null)},o.prototype.onBeforeRenderTopResults=function(n){var f,s,u,e,o;if(this.topResults.length>0)for(this._partialQuery.queryToFetch&&(this._isUserKeyboardNavigating||(f=0,this.topResults[0].isAnswer&&this._host.isThirdPartySearchProvider()&&(f=this.topResults.findIndex(function(n){return n.type==t.SyntheticQSCodes.PartialQuery})),this.select(this.topResults[f],!0,!1))),s=!!this.topResults[0].answerHtml,s&&(this._config.disableAnswerAnimation?this.topResults[0].className=i:n.length>=1&&n[0].answerHtml&&(this.topResults[0].className=r)),u=0,e=this.topResults.slice(1);u<e.length;u++)o=e[u],o.answerHtml&&(o.className=i);return 1},o.prototype.setupAnimations=function(t){var f=this;this._config.disableAnswerAnimation||(this._topResultAnimationTimer&&(sb_ct(this._topResultAnimationTimer),this._topResultAnimationTimer=0),this.topResults.length>=1&&this.topResults[0].answerHtml&&(this.topResults[0].className=t.length!=0&&t[0].answerHtml?t[0].query!=this.topResults[0].query?u:i:r+" "+u,this._topResultAnimationTimer=sb_st(function(){return n.safeExecute(function(){return f.renderTopResults()},"topResultAnimationTimer")},1)))},o.prototype.navigate=function(n){this.setAddressBarContent(n,!0,!1);this.onSuggestionLaunch(n)},o.prototype.setAddressBarText=function(n,t){this.setAddressBarContent(n,!1,t)},o.prototype.setAddressBarContent=function(n,t,i){this._autoComplete.setAddressBarContent(this._partialQuery,n,t,i,!1)},o.prototype.getOneBoxMaxHeight=function(){var n=t.getCachedFrameMessage("maxSize");return n?n.height:0},o.prototype.onQueryChanged=function(n,t){this._submitAlreadyDone=!1;e.prototype.onQueryChanged.call(this,n,t);this._autoComplete.onQueryChanged(n,t);this._partialQuery&&this._partialQuery.equals(n)||(this._partialQuery=n)},o.prototype.onSuggestionsParsed=function(){},o.prototype.addGroup=function(i,r,u){if(this.groups.some(function(n){return n.type==i}))throw new Error("Trying to add repeated group "+i);var e={type:i,text:this._host.getLocString(f(i)),suggestions:[],instRegionName:n.GroupType[i]};return this.setSelectableGroupInfo(e,t.GroupHeaderQSCodes[i],r),this.insertGroup(e,u),e},o.prototype.setSelectableGroupInfo=function(i,r,u){if(this._config.enableHistorySettingsLink&&r==t.SyntheticQSCodes.ManageSearchHistory){var f=i;f.id="gr"+i.type;f.secondaryText=this._host.getLocString("ManageSearchHistory");f.secondaryTextClass="webHistoryGroupHeaderSecondaryText";f.intent=t.Intents.DirectNav;f.handoffType=1;f.query="https://www.bing.com/profile/history?fsi=1&FORM=EDGEHS";f.url=f.query;f.selected=!1;f.sequenceNumber=u;f.narratorText=t.getSuggestionNarratorText(f);f.instItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,t.SyntheticQSCodes.KValues,f.handoffType);this._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,r,f.instItem)}},o.prototype.getTopResultsWhichFitInCanvas=function(n){var u=[],i,r,t;for(this._resultsCounter.numberOfTopResultAnswers=0,this._resultsCounter.numberOfTopResultSuggestions=0,this._resultsCounter.numberOfTopResult2LinesSuggestions=0,i=0,r=n;i<r.length;i++)t=r[i],this.canFitSuggestion(!1,t)&&(t.answerHtml?this._resultsCounter.numberOfTopResultAnswers+=1:t.secondaryIcon||t.additionalInfoText?this._resultsCounter.numberOfTopResult2LinesSuggestions+=1:this._resultsCounter.numberOfTopResultSuggestions+=1,u.push(t));return u},o.prototype.canFitSuggestion=function(n){var i=this._maxHeight-t.GroupHeight*this._resultsCounter.numberOfGroups-t.SuggestionHeight*this._resultsCounter.numberOfSuggestions-t.SuggestionHeight*this._resultsCounter.numberOfTopResultSuggestions-t.Suggestion2LinesHeight*this._resultsCounter.numberOfTopResult2LinesSuggestions-t.AnswerHeight*this._resultsCounter.numberOfTopResultAnswers;return i>(n?t.GroupHeight+t.SuggestionHeight:t.SuggestionHeight)},o.prototype.onGroupsCleared=function(){this._resultsCounter.numberOfGroups=0;this._resultsCounter.numberOfSuggestions=0},o.prototype.onAfterRenderTopResults=function(n,i,r,u,f,e,o,s,h,c,l){var a=this,v=u.length>0||n&&c.length>0;if(s&&!v&&this._host.adjustHeight(),l(),f.length)throw new Error("Removing suggestions not supported");return this.setupAnimations(h),v&&(this.renderGroupsAfter(function(){for(var f,e=function(n){var u=t.getGroupType(n),i=a.groups.filter(function(n){return n.type==u})[0];a.canFitSuggestion(!i,n)&&(i||(i=a.addGroup(u,r,o),a._resultsCounter.numberOfGroups+=1),i.suggestions.push(n),a._resultsCounter.numberOfSuggestions+=1)},n=0,i=u;n<i.length;n++)f=i[n],e(f)}),this._host.adjustHeight(),this._instrumentationHelper.instrumentRenderFinished(r,e)),1},o}(n.BaseRootViewModel);t.RootViewModel=e})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function u(i,r,u,f,e,o){t(i,r,u,function(t){return f(t.status==200&&t.responseText?n.safeExecute(function(){return JSON.parse(t.responseText)},"JSON.parse"):null)},e,o)}function t(n,t,i,r,u,f){var e=sj_gx(),o,s;if(e.open(i?"POST":"GET",n,!0),t)for(o in t)e.setRequestHeader(o,t[o]);u&&(s=u.register(function(){return e.abort()},!1));e.onreadystatechange=function(){e.readyState==4&&(!f||f())&&(e.onreadystatechange=function(){},s&&u.unregister(s),r&&r({responseText:e.responseText,contentType:e.getResponseHeader("content-type")||"",status:e.status}))};e.withCredentials!==undefined&&(e.withCredentials=!0);e.send(i)}function f(n){var t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}var i,r;n.fetchUrlJson=u;n.fetchUrl=t;i=function(){function i(n,t){this._config=n;this._dataSource=t;this._delay=n.lowPriorityDataSources[t]?n.lowQpsDataSourcesFetchDelay:0}return i.prototype.getBaseUrl=function(){throw new Error("Not Implemented");},i.prototype.getPostBody=function(){return undefined},i.prototype.onBeforeFetchUrl=function(){},i.prototype.createUrl=function(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")},i.prototype.addParamsToUrl=function(n,t){var i=t?Object.keys(t):[];return i.length>0&&(n+=n.includes("?")?"&":"?",n+=i.map(function(n){return n+"="+t[n]}).join("&")),n},i.prototype.fetch=function(t,i,r,u,f,e,o){var h=this,s,c;if(n.isDataSourceEnabled(this._dataSource,t,this._config))if(s=this.addParamsToUrl(this.createUrl(t),e),c=this.getPostBody(t)||"",this._timer&&(sb_ct(this._timer),this._timer=null),this._delay>0&&!t.isFormulatedQuery)this._timer=sb_st(function(){return n.safeExecute(function(){sb_ct(h._timer);h._timer=null;h.onBeforeFetchUrl(r,s);h.fetchUrl(s,o,c,i,u,f)},"fetchDelay")},this._delay);else{this.onBeforeFetchUrl(r,s);this.fetchUrl(s,o,c,i,u,f)}},i.prototype.fetchUrl=function(i,r,u,f,e,o){var s=this;t(i,r,u,function(t){var r=t.responseText,o=t.contentType,u=t.status,e;u==200&&(s._config.th&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&o.includes("json")&&(e=n.safeExecute(function(){return JSON.parse(r)},"parseWebProviderResponse",null,i)));f(s._dataSource,e,u==200?n.DataSourceStateFor200Response:u.toString())},this._delay>0?e:null,o)},i}();n.JsonDataProvider=i;r=function(t){function i(i,r,u,f){var e=t.call(this,i,n.WebDataSource)||this;return e._instrumentationHelper=r,e._responseCacheManager=u,e._bundledRankingSignalsManager=f,e}return __extends(i,t),i.prototype.getBaseUrl=function(){return this._config.u},i.prototype.onBeforeFetchUrl=function(n,t){this._instrumentationHelper.instrumentSnRProviderFetchUrl(n,t)},i.prototype.fetch=function(i,r,u,f,e,o,s){var v=this,c,l,a,h;if(n.isDataSourceEnabled(this._dataSource,i,this._config)){if(this._bundledRankingSignalsManager&&(c=this._bundledRankingSignalsManager.tryGet(i),c)){l={RankingSignals:c,Suggestions:[]};a=this.addParamsToUrl(this.createUrl(i),o);this.onBeforeFetchUrl(u,a);r(this._dataSource,l,n.DataSourceStateFor200Response,2);return}h=r;h=function(n,t,i,u){v.processResourceResponse(t);r(n,t,i,u)};this._responseCacheManager?this.fetchWithCache(i,h,u,f,e,o,s):t.prototype.fetch.call(this,i,h,u,f,e,o,s)}},i.prototype.fetchWithCache=function(i,r,u,f,e,o,s){var c=this,l=i.getCacheKey(),a=this._responseCacheManager.tryGet(l),v,y,h;if(a){v=this.addParamsToUrl(this.createUrl(i),o);this.onBeforeFetchUrl(u,v);r(this._dataSource,a,n.DataSourceStateFor200Response,1)}else y=function(){return!0},h=r,h=function(n,t,u){e()&&r(n,t,u,0);i.queryToFetch&&c.responseIsValidForCaching(u,t)&&(t.ELToken&&(t=Object.assign({},t),delete t.ELToken),c._responseCacheManager.put(l,t))},t.prototype.fetch.call(this,i,h,u,f,y,o,s)},i.prototype.responseIsValidForCaching=function(t,i){var r="HS";return t==n.DataSourceStateFor200Response&&i!=null&&i.Suggestions.every(function(n){return!n.InstantAnswer&&n.Attributes.stype!=r})},i.prototype.processResourceResponse=function(n){var t,i;n&&(t=n.Resources,t)&&(this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles,i={Styles:t.Styles,Scripts:null},JsonInject.WriteHeadAndBeforeContentResources(i))},i.prototype.updateWithDownloadedResources=function(n){var t,i;for(t in n.Styles)for(i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]},i}(i);n.AsSuggestionsDataProvider=r;n.getIconFromOnlineResponse=f}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function e(n,t,i,u,f){typeof indexedDB!="undefined"&&new r(n,f,t,i,u)}function o(n,t,i,u,f){typeof indexedDB!="undefined"&&new r(n,f,t,i,u)}function s(n,t,i,u,f,e){typeof indexedDB!="undefined"&&new r(n,e,t,i,u,f)}function h(n,t,i,u,f,e){typeof indexedDB!="undefined"&&new r(n,e,t,i,u,f)}function c(n,t,r){i(n,"deleteDatabase requested");try{var f=indexedDB.deleteDatabase(n);f.onsuccess=function(){i(n,"deleteDatabase completed");t&&t()};f.onerror=u("deleteDatabase.onError",function(t){SharedLogHelper.LogError("deleteDB",n,t);r&&r(t)})}catch(e){r&&r(e)}}function u(n,t){return function(i){var r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}var f,i,r;(function(n){n.StorageNotAvailable="X";n.TimedOut="T";n.ErrorWhenQueryingDb="E";n.QuerySucceeded="R"})(f=t.StorageState||(t.StorageState={}));t.instanceWithNumberKeys=e;t.instanceWithStringKeys=o;t.instanceWithNumberKeysAndSecondaryKey=s;t.instanceWithStringKeysAndSecondaryKey=h;i=sa_config.th&&ClientTestHooks.isTesthookParamSet("dbTrace")?function(t,i){return n.log("["+t+"] "+i)}:function(){};t.deleteDatabase=c;t.handleErrorEvent=u;r=function(){function t(n,r,f,e,o,s){var h=this,c;this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";i(this._databaseName,"open requested");try{c=indexedDB.open(n,r||1)}catch(l){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}c.onsuccess=function(n){h._database=n.target.result;t._allInstances.push(h);i(h._databaseName,"open completed");f(h)};c.onupgradeneeded=function(n){var t,r;i(h._databaseName,"upgrading");t=n.target.result;t.objectStoreNames.contains(h._storeName)&&t.deleteObjectStore(h._storeName);r=t.createObjectStore(h._storeName);h._secondaryIndex&&r.createIndex(h._secondaryIndex,h._secondaryIndex,{unique:!1})};c.onerror=u("open.onError",e);c.onblocked=u("open.onBlocked",e)}return t.prototype.put=function(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,function(i,r,u){var f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)},t.prototype.putMultiple=function(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,function(t,i,r){var u=0,f=function(){if(u<n.length){var e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)},t.prototype.getValue=function(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",function(n){return t(n.target.result)},function(t,i,r){var u=t.get(n);u.onsuccess=i;u.onerror=r},i)},t.prototype.getRange=function(n,t,i,r){var u=this;this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(i.openCursor(e),r,f)},r)},t.prototype.getRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(e.openCursor(o),r,f)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))},t.prototype.removeRange=function(n,t,i,r){var u=this;this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(i.openCursor(e),r,f)},r)},t.prototype.removeRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(e.openCursor(o),r,f)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))},t.prototype.getAll=function(n,t){var i=this;this.safeDbOperation("getAll",null,"readonly",n,function(n,t,r){return i.queryFromCursor(n.openCursor(),t,r)},t)},t.prototype.close=function(){i(this._databaseName,"close requested");this.innerClose()},t.prototype.innerClose=function(){var f,e,r,u,o;if(t._requestsInProgress>0)i(this._databaseName,"delaying close because of "+t._requestsInProgress+" requests in progress"),this._closePending=!0;else for(f=function(t){t._database&&(n.safeExecute(function(){return t._database.close()},e._databaseName+".close"),i(t._databaseName,"close completed"),t._database=null,t.onClosed())},e=this,r=0,u=t._allInstances;r<u.length;r++)o=u[r],f(o)},t.prototype.queryFromCursor=function(n,t,i){var r=[];n.onsuccess=function(n){var i=n.target.result;i&&r.push({key:i.primaryKey,value:i.value});i&&r.length!=sa_config.maxIndexedDBCursorIterations?i["continue"]():t(r)};n.onerror=i},t.prototype.removeFromCursor=function(n,t,i){var r=0;n.onsuccess=function(n){var i=n.target.result;i&&(i["delete"](),r+=1);i&&r!=sa_config.maxIndexedDBCursorIterations?i["continue"]():t(null)};n.onerror=i},t.prototype.safeDbOperation=function(n,r,f,e,o,s){var h=this,l,c,a;i(this._databaseName,n+" requested"+(r?" "+r:""));t._requestsInProgress+=1;l=function(u){i(h._databaseName,n+" completed "+(r?r+" ":""));t._requestsInProgress-=1;e(u);h._closePending&&t._requestsInProgress==0&&h.innerClose()};c=function(n){t._requestsInProgress-=1;s(n);h._closePending&&t._requestsInProgress==0&&h.innerClose()};try{this._database?(a=this._database.transaction(this._storeName,f).objectStore(this._storeName),o(a,l,u(n+".onError",c))):c(new Error(n+" Database not initialized"))}catch(v){c(v)}},t}();r._requestsInProgress=0;r._allInstances=[]})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o){var s=this;this._config=n;this._storageFactory=t;this.createResponse=i;this.dataPopulated=r;this.getDataSourceState=u;this._dataSource=f;this._queryType=e;this._storageOpenInProgress=!1;this._pendingQueries=[];o&&(o.bindAppVisible(function(){return s.initStorage()}),o.bindDismissed(function(){return s._pendingQueries=[]}),o.bindAppHidden(function(){return s.teardownStorage()}))}return i.prototype.teardownStorage=function(){this._storage&&this._storage.close()},i.prototype.initStorage=function(){var n=this;!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(function(t){n._storage=t;n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(t){n.onError(t,"open storage");n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(){return n._storage=null}))},i.prototype.onError=function(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()},i.prototype.reloadStorage=function(){this.teardownStorage();this.initStorage()},i.prototype.isReady=function(){return!!this._storage},i.prototype.getKey=function(n){return n.queryToFetch?n.queryToFetch.toLocaleLowerCase():""},i.prototype.fetch=function(i,r,u,f,e){var s=this,o;n.isDataSourceEnabled(this._dataSource,i,this._config)&&(o=function(n,u){var f=u==t.StorageState.QuerySucceeded;e()&&r(s._dataSource,s.createResponse(i,n,f),s.getDataSourceState(u))},this.innerQueryStorage(this._queryType,this.getKey(i),function(n){return o(n,t.StorageState.QuerySucceeded)},function(){return o(null,t.StorageState.ErrorWhenQueryingDb)},function(){return o(null,t.StorageState.StorageNotAvailable)},function(){return o(null,t.StorageState.TimedOut)}))},i.prototype.withStorage=function(n){return this._storage?(n(this._storage),!0):!1},i.prototype.getMaxKey=function(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)},i.prototype.queryStorage=function(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)},i.prototype.innerQueryStorage=function(t,i,r,u,f,e){var h=this,s=null,o=!1,c=!0,a=function(){if(c)if(c=!1,h._storage){var n=function(n){s&&sb_ct(s);h.onError(n,"query");o||(o=!0,u())};t==0?h._storage.getValue(i,function(n){s&&sb_ct(s);o||(o=!0,r(n))},n):i?h._storage.getRange(i,h.getMaxKey(i),function(n){s&&sb_ct(s);o||(o=!0,r(n))},n):h._storage.getAll(function(n){s&&sb_ct(s);o||(o=!0,r(n))},n)}else s&&sb_ct(s),o||(o=!0,u())},l;if(this._storage)a();else if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(a);else{f();return}l=i?this._config.indexedDBTimeout:this._config.latencyTimeoutForZeroInput;l&&(s=sb_st(function(){return n.safeExecute(function(){c=!1;o||(o=!0,e())},"innerQueryStorage")},l))},i}();t.StorageBasedDataProvider=i})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i="LastUpdated",r=function(t){function r(r,u,f,e,o,s,h,c,l,a){var v=this;u&&u.bindItemLaunch(function(n,t,i){return v.onLaunch(n,t,i)});r.th&&ClientTestHooks.isTesthookParamSet("clearMru")&&sb_st(function(){return n.ClientSideStorage.deleteDatabase(c)},0);var y,p=function(t,r,u){return f(c,function(i){t(i);(!n.isValidDate(y)||n.getTimeDiffInDays(y)>=1)&&(y=n.getDate(),v.prune())},r,u,i)},w=function(n,t,i){return v.createMruResponse(n,t,i)},b=function(){return!0},k=function(t){return t==n.ClientSideStorage.StorageState.QuerySucceeded?undefined:t};return e.bindClearMRURequested(function(t){v.teardownStorage();n.ClientSideStorage.deleteDatabase(c,function(){return t(!0)},function(){return t(!1)})}),v=t.call(this,r,p,w,b,k,n.MRUDataSource,1,e)||this,v.candidatesEnabled=l,v.loggingEnabled=a,v.getSuggestionKey=o,v.getSuggestionDataKey=s,v.getGroupType=h,v._pendingWrites=[],v}return __extends(r,t),r.prototype.shouldStoreSuggestions=function(){return this._config.mruCandidatesEnabled&&(!this.candidatesEnabled||this.candidatesEnabled())},r.prototype.createMruResponse=function(n,t,i){var h=this,u,o,r,e,s;if(t=t||[],u=this.getKey(n),this._lastKey=i?u:null,o=t.filter(function(n){return n.key==u})[0],this._valueForLastKey=o?o.value:null,r={},this._config.mruSignalsEnabled&&this._valueForLastKey&&(r.RankingSignals=this._valueForLastKey.RankingSignals,r.WebRankingSignalsCache=this._valueForLastKey.WebRankingSignalsCache,r.EngagementSignalsCache=this._valueForLastKey.EngagementSignalsCache,r.SuppressedGroupsCache=this._valueForLastKey.SuppressedGroupsCache),this.shouldStoreSuggestions()){var f=[],l=this.getOldestDateToKeep(),a=function(n,t){var u,i,r,e;if(t.Suggestions)for(u=function(i){var r=v.getLastLaunchTime(t,i);r&&r>=l&&(f.push({lastLaunchTime:r,suggestionData:i}),i.remove=function(t){return h.remove(n,i,t)})},i=0,r=t.Suggestions;i<r.length;i++)e=r[i],u(e)},v=this;for(e=0,s=t;e<s.length;e++){var c=s[e],y=c.key,p=c.value;a(y,p)}f.length>0&&(r.Suggestions=[],f.sort(function(n,t){return t.lastLaunchTime-n.lastLaunchTime}),f.forEach(function(n){return h.addIfNotPresent(r.Suggestions,n.suggestionData,!0)}),u?u.length<=this._config.mruLengthA?r.Suggestions.splice(this._config.maxMruA):u.length<=this._config.mruLengthB&&r.Suggestions.splice(this._config.maxMruB):r.Suggestions.splice(this._config.maxMruZeroInput))}return r},r.removeRankerSignals=function(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t},r.prototype.addIfNotPresent=function(n,t,i){var e=JSON.stringify(t,r.removeRankerSignals),u=n.filter(function(n){return JSON.stringify(n,r.removeRankerSignals)==e})[0],f;u?i&&(f=u.remove,u.remove=function(n){return f(function(){return t.remove(n)})}):n.push(t)},r.prototype.onAfterWrite=function(){if(this._writing=!1,this._pendingWrites.length>0){var n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()},r.prototype.teardownStorage=function(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,t.prototype.teardownStorage.call(this))},r.prototype.onLaunch=function(t,i,r){var u=this,e,f;if(!this.loggingEnabled||this.loggingEnabled()){if(this._writing){this._pendingWrites.push(function(){return u.onLaunch(t,i,r)});return}this._writing=!0;e=r?r[n.WebDataSource]:null;f=this.getKey(i);this._lastKey==f?this.updateAndSaveLaunchData(f,this._valueForLastKey,t,e):this.queryStorage(f,function(n){return u.updateAndSaveLaunchData(f,n,t,e)},function(){return u.onAfterWrite()},function(){return u.onAfterWrite()},function(){return u.onAfterWrite()})}},r.prototype.remove=function(n,t,i){var r=this;if(this._writing){this._pendingWrites.push(function(){return r.remove(n,t,i)});return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,function(u){return r.removeAndSaveLaunchData(n,u,t,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})},r.getUnixTime=function(n){return n||(n=new Date),Math.round(n.getTime()/1e3)},r.prototype.createOrUpdateDbEntry=function(n,t,i,u){var f,e;return t?(t.LastUpdated=r.getUnixTime(),t.RankingSignals=t.RankingSignals||{}):t={LastUpdated:r.getUnixTime(),RankingSignals:{}},f=this.getSuggestionKey(i),t.RankingSignals[f]?(t.RankingSignals[f].prefixLaunchCount+=1,t.RankingSignals[f].lastLaunchTime=t.LastUpdated):t.RankingSignals[f]={prefixLaunchCount:1,lastLaunchTime:t.LastUpdated},this.getGroupType&&(t.RankingSignals[f].groupType=this.getGroupType(i)),this._config.mruSignalsEnabled&&u&&(t.WebRankingSignalsCache=u.rankingSignals,t.EngagementSignalsCache=u.engagementSignals,t.SuppressedGroupsCache=u.suppressedGroups),this.shouldStoreSuggestions()&&(e=i.getMruData(),e&&n&&(t.Suggestions||(t.Suggestions=[]),this.addIfNotPresent(t.Suggestions,e,!1)),t.Suggestions&&t.Suggestions.forEach(function(n){return delete n.remove})),t},r.prototype.getOldestDateToKeep=function(){var t=n.getDate();return t.setDate(t.getDate()-this._config.mruMaxAgeInDays),r.getUnixTime(t)},r.prototype.updateAndSaveLaunchData=function(t,i,r,u){var f=this;if(i=n.safeExecute(function(){return f.createOrUpdateDbEntry(t,i,r,u)},"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}this.getSuggestionDataKey&&this.removeOldLaunches(i,this.getOldestDateToKeep());this._lastKey=t;this._valueForLastKey=i;this.withStorage(function(n){return n.put(t,i,function(){return f.onAfterWrite()},function(n){f.onError(n,"updateAndSaveLaunchData");f.onAfterWrite()})})||this.onAfterWrite()},r.prototype.removeAndSaveLaunchData=function(n,t,i,r){var u=this,e,f;if(!t){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}if(e=JSON.stringify(i),f=(t.Suggestions||[]).findIndex(function(n){return JSON.stringify(n)==e}),f==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}t.Suggestions.splice(f,1);t.Suggestions.forEach(function(n){return delete n.remove});this._lastKey=n;this._valueForLastKey=t;this.withStorage(function(i){return i.put(n,t,function(){r&&r();u.onAfterWrite()},function(n){u.onError(n,"removeAndSaveLaunchData");u.onAfterWrite()})})||this.onAfterWrite()},r.prototype.getLastLaunchTime=function(n,t){if(n.RankingSignals){var i=n.RankingSignals[this.getSuggestionDataKey(t)];if(i)return i.lastLaunchTime}return undefined},r.prototype.removeOldLaunches=function(n,t){var r,u,f,i;if(n.Suggestions)for(r=n.Suggestions.length-1;r>=0;--r)i=this.getLastLaunchTime(n,n.Suggestions[r]),(!i||i<t)&&n.Suggestions.splice(r,1);if(n.RankingSignals)for(u in n.RankingSignals)f=n.RankingSignals[u],f&&(i=f.lastLaunchTime,(!i||i<t)&&delete n.RankingSignals[u])},r.prototype.prune=function(n){var t=this;if(this._writing){this._pendingWrites.push(function(){return t.prune(n)});return}this._writing=!0;this.withStorage(function(i){return i.removeRangeOnSecondaryKey(0,t.getOldestDateToKeep(),function(){n&&n();t.onAfterWrite()},function(n){t.onError(n,"MRUDataProvider prune");t.onAfterWrite()})})||this.onAfterWrite()},r}(n.ClientSideStorage.StorageBasedDataProvider);t.MRUDataProvider=r})(t=n.MRU||(n.MRU={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,i){var r=this,e,o,u,f,s;for(this._config=n,i.bindDismissed(function(){return r._localResponses.forEach(function(n){return r.clear(n)})}),this._localResponses=[{event:"localresultsavailable",message:"localResults",dataSource:t.DataSources.Local},{event:"typedurlsavailable",message:"typedUrls",dataSource:t.DataSources.TypedUrls}],e=function(n){n.lastResponse=o.fetchLocalResults(n.message);sj_be(_w,n.event,function(){n.lastResponse=r.fetchLocalResults(n.message);n.lastResponse&&n.lastResponse.addressbar&&n.awaitingQuery&&n.lastResponse.addressbar.content===n.awaitingQuery.originalQuery&&r.executeOnResponseReceivedHandler(n.awaitingQuery,n,n.awaitingHandler)})},o=this,u=0,f=this._localResponses;u<f.length;u++)s=f[u],e(s)}return i.prototype.clear=function(n){n.lastResponse=n.awaitingHandler=n.awaitingQuery=null},i.prototype.fetch=function(n,t){for(var i,r=0,u=this._localResponses;r<u.length;r++)i=u[r],i.lastResponse&&i.lastResponse.addressbar&&n.originalQuery===i.lastResponse.addressbar.content?this.executeOnResponseReceivedHandler(n,i,t):(i.awaitingQuery=n,i.awaitingHandler=t)},i.prototype.executeOnResponseReceivedHandler=function(t,i,r){n.isDataSourceEnabled(i.dataSource,t,this._config)&&r(i.dataSource,i.lastResponse,null);this.clear(i)},i.prototype.fetchLocalResults=function(n){return t.getCachedFrameMessage(n)},i}();t.LocalDataProvider=i})(t=n.IEOneBox||(n.IEOneBox={}))}(AutoSuggest||(AutoSuggest={}));0