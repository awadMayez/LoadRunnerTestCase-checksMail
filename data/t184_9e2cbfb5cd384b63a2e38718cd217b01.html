Jane.module("jane.left.js",function(){"use strict";!function(){function e(){ns.events.off("onCollectorCheckStart"),ns.events.off("onCollectorCheckSuccess"),ns.events.off("onCollectorCheckFail")}ns.action.define("collector.warning",function(e,t,r,n){var a;n?(a=n.target,Jane.c(["Неработающий сборщик","клик на полоску"])):a=t;var i=$(a).closest(".js-collectors-item-warning"),s=i.prev(),l=s.attr("data-popid"),d=ns.Model.get("collectors"),u=d.getById(l);if(u){var c={};$.each(u,function(e,o){return"password"===e?!0:void(c[e]=o)
});var m=s.text(),p=s.data("help-link"),f=s.data("company")||m.split("@")[1],h={hidden:c,mail:m,popid:l,time:u.human_time,server:f,company:f.substr(0,1).toUpperCase()+f.substr(1)};p&&(h.link=p);var g=s.offset().top+s.outerHeight()/2+1,v=o(s,h),y=v.find("form, .b-mail-button");y.filter("form").data({popid:l,y:g,$warning:i,$unactive:s})}}),ns.action.define("collector.edit-password",function(o,t,r,n){var a={event:n,params:t};a.event.preventDefault();var i,s=$(a.event.target),l=s.data(),d=s.find(".b-notification_loading, .b-mail-button, .b-notification_auth_failed"),u=d.filter(".b-notification_auth_failed"),c=d.filter(".b-notification_loading"),m=d.filter(".b-mail-button");
e(),ns.events.on("onCollectorCheckStart",function(){i=window.setTimeout(function(){c.removeClass("g-hidden"),u.addClass("g-hidden")},250)}),ns.events.on("onCollectorCheckFail",function(){e(),ns.events.trigger("daria:vCollectors:log","клик на новый пароль ошибка"),window.clearTimeout(i),c.addClass("g-hidden"),u.removeClass("g-hidden"),Jane.enableButton(m)}),ns.events.on("onCollectorEditSuccess.password-"+a.params.popid,function(){e(),ns.events.trigger("daria:vCollectors:log","клик на новый пароль успешный"),window.clearTimeout(i),ns.forcedRequest(["do-collector-run","do-collector-on"],{popid:l.popid}),Daria.Dialog.open({body:Jane.tt("left:collector-warning-popup-header",{header:"Сбор писем продолжен",src:"b-mail-icon_green-tick.gif"}),onTarget:{target:$(".js-collector-unactive[data-popid="+a.params.popid+"]"),side:"left",pos:"top"},onopen:function(){window.setTimeout(function(){Daria.Dialog.$dialog.hasClass("b-collectors__tick")&&Daria.Dialog.close()
},2e3)},additionalClass:"b-popup_yellow b-collectors__popup b-collectors__tick"}),l.$warning.remove()}),Jane.Services.runModules(["jane.setup.js"],function(){Daria.Collectors.Editor.run(s,a.params.owner)})}),ns.action.define("collector.stop",function(e,o,t,r){var n={event:r,params:o};ns.events.trigger("daria:vCollectors:log","клик на остановить сбор писем");var a={};n.event&&(a=$(n.event.target).closest("form").data()),Daria.Dialog.close().open({title:Jane.tt("left:collector-warning-popup-header",{header:"Удаление сборщика"}),body:Jane.tt("left:collector-remove-popup",{mail:n.params.mail,popid:n.params.popid}),width:480,onTarget:{x:$(".ns-view-left-box").outerWidth()+9,y:a.y-$(window).scrollTop(),side:"left",pos:"top"},additionalClass:"b-popup_yellow b-collectors__popup"}).$dialog.data(a)
}),ns.action.define("collector.kill",function(e,o){var t=o.popid;ns.forcedRequest([{id:"do-collector-remove",params:{popid:t}},{model:ns.Model.get("collectors").getMasterRequest()}]).then(function(){var e=Vow.resolve(),o=ns.Model.get("filters").getForCollector(t),r=_.map(o,function(e){return{id:"do-filters-delete",params:{id:e.filid}}});r.length&&(e=ns.forcedRequest([].concat(r,[{model:ns.Model.get("filters").getMasterRequest()}]))),e.then(function(){ns.events.atrigger("daria:vCollectors:update")
})}),Daria.Dialog.close()}),ns.action.define("collector.close-remove-popup",function(){Daria.Dialog.close()}),ns.action.define("collector.help-go",function(){return ns.events.trigger("daria:vCollectors:log","переход на настройки"),!0}),ns.action.define("collector.support-go",function(){return ns.events.trigger("daria:vCollectors:log","переход на поддержку"),!0});var o=function(e,o){Daria.Dialog.open({title:Jane.tt("left:collector-warning-popup-header",{header:'Не удаётся получить новые письма <span class="b-collectors__header-nobr">из ящика '+_.escape(o.mail)+"</span>"}),body:Jane.tt("left:collector-warning-popup",o),width:480,onopen:function(o){Jane.c(["Неработающий сборщик","показали"]),o._repositionDialog=r.bind(this,e),ns.events.on("minify",o._repositionDialog)
},onTarget:t(e),onclose:function(e){ns.events.trigger("daria:vCollectors:log","закрытие попапа"),ns.events.trigger("daria:vCollectors:setBrokenCollectorCookie"),ns.events.off("minify",e._repositionDialog),delete e._repositionDialog},additionalClass:"b-popup_yellow b-collectors__popup"});var n=Daria.Dialog.$dialog,a=n.find(".js-dialog-button");return n.on("keyup",".js-collector-passwd",function(){var e=nb.block(a.get(0)),o=nb.block(this);return e?$.trim(o.getValue())?void e.enable():void e.disable():e
}),n},t=function(e){var o={"default":{target:e,side:"left",pos:"top",needTail:!0}};return o["default"]},r=function(e){Daria.Dialog.params.onTarget=t(e),Daria.Dialog.position()}}(),ns.layout.define("folder",{folder:{}}),ns.layout.define("label",{label:{}}),ns.layout.define("collectors-item",{"collectors-item":{}}),function(){var e={useSSL:!0,useProtocol:Daria.IS_CORP?"imap":"pop",imap:{port:143,tpl:"login@domain",ssl:{port:993}},pop:{port:110,tpl:"login@domain",ssl:{port:995}}};ns.Model.define("collector-settings",{events:{"ns-model-init":function(){this.setData([{name:["mail15.com","nm.ru","pochta.ru","hotbox.ru","fromru.com","front.ru","hotmail.ru","krovatka.su","land.ru","mail333.com","nightmail.ru","pisem.net","pochtamt.ru","pop3.ru","rbcmail.ru","smtp.ru","qip.ru","newmail.ru","5ballov.ru","aeterna.ru","ziza.ru","memori.ru","photofile.ru","fotoplenka.ru"],useSSL:!1,useProtocol:"imap",imap:{server:"imap.qip.ru"},pop:{server:"pop.qip.ru"},teaser:"qip"},{name:["mail.ru"],useProtocol:"imap",imap:{server:"imap.mail.ru"},pop:{server:"pop.mail.ru",tpl:"login"},teaser:"mail",help:"http://help.mail.ru/mail-support",company:"mail.ru",SSLOnly:!0},{name:["list.ru"],useProtocol:"imap",imap:{server:"imap.mail.ru"},pop:{server:"pop.list.ru",tpl:"login"},favicon:"mail.ru",teaser:"mail",help:"http://help.mail.ru/mail-support",company:"mail.ru",SSLOnly:!0},{name:["bk.ru"],useProtocol:"imap",imap:{server:"imap.mail.ru"},pop:{server:"pop.bk.ru",tpl:"login"},favicon:"mail.ru",teaser:"mail",help:"http://help.mail.ru/mail-support",company:"mail.ru",SSLOnly:!0},{name:["inbox.ru"],useProtocol:"imap",imap:{server:"imap.mail.ru"},pop:{server:"pop.inbox.ru",tpl:"login"},favicon:"mail.ru",teaser:"mail",help:"http://help.mail.ru/mail-support",company:"mail.ru",SSLOnly:!0},{name:["rambler.ru"],useProtocol:"imap",imap:{server:"mail.rambler.ru"},pop:{server:"mail.rambler.ru"},teaser:"rambler",help:"http://help.rambler.ru/project.html?s=mail",company:"rambler.ru"},{name:["gmail.com"],useProtocol:"imap",imap:{server:"imap.gmail.com"},pop:{server:"pop.gmail.com"},favicon:"mail.google.com",teaser:"gmail",help:"http://support.google.com/mail",company:"gmail.com"},{name:["km.ru"],useSSL:!1,imap:null,pop:{server:"pop.km.ru"}},{name:["bossmail.ru"],useSSL:!1,imap:null,pop:{server:"pop.bossmail.ru"},favicon:"km.ru"},{name:["girlmail.ru"],useSSL:!1,imap:null,pop:{server:"pop.girlmail.ru"},favicon:"km.ru"},{name:["boymail.ru"],useSSL:!1,imap:null,pop:{server:"pop.boymail.ru"},favicon:"km.ru"},{name:["freemail.ru"],useSSL:!1,imap:null,pop:{server:"pop.freemail.ru"},favicon:"km.ru"},{name:["megabox.ru"],useSSL:!1,imap:null,pop:{server:"pop.megabox.ru"},favicon:"km.ru"},{name:["safebox.ru"],useSSL:!1,imap:null,pop:{server:"pop.safebox.ru"},favicon:"km.ru"},{name:["ua.fm"],imap:null,pop:{server:"pop.ua.fm"},favicon:"i.ua"},{name:["e1.ru"],useSSL:!1,imap:null,pop:{server:"mail.e1.ru"}},{name:["ngs.ru","eml.ru","mosk.ru"],imap:null,pop:{server:"mail.ngs.ru"}},{name:["mtu.ru","mtu-net.ru"],useSSL:!1,imap:null,pop:{server:"pop.mtu.ru",tpl:"login"},favicon:"mts.ru"},{name:["umail.ru"],imap:null,pop:{server:"pop.umail.ru",tpl:"login"}},{name:["nic.ru"],useProtocol:"imap",imap:{server:"mail.nic.ru",tpl:"login"},pop:{server:"mail.nic.ru",tpl:"login"}},{name:["i.ua"],imap:null,pop:{server:"pop.i.ua"}},{name:["yahoo.com","yahoo.co.kr","yahoo.co.nz","yahoo.com.mx","yahoo.com.tr","yahoo.dk","yahoo.gr","yahoo.ie","yahoo.in","yahoo.nl","yahoo.no","yahoo.pl","yahoo.ru","yahoo.se","yahoo.","yahoo.","yahoo.","yahoo."],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com"},teaser:"yahoo"},{name:["yahoo.ca"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.ca"},teaser:"yahoo"},{name:["yahoo.cn"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.cn"},teaser:"yahoo"},{name:["yahoo.co.id"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.co.id"},teaser:"yahoo"},{name:["yahoo.co.in"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.co.in"},teaser:"yahoo"},{name:["yahoo.co.jp"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.co.jp"},pop:{server:"pop.mail.yahoo.co.jp",tpl:"login"},teaser:"yahoo"},{name:["yahoo.co.th"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.co.th"},teaser:"yahoo"},{name:["yahoo.co.uk"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.co.uk"},teaser:"yahoo"},{name:["yahoo.com.ar"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.ar"},teaser:"yahoo"},{name:["yahoo.com.au"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.au"},teaser:"yahoo"},{name:["yahoo.com.br"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.br"},teaser:"yahoo"},{name:["yahoo.com.cn"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.cn"},teaser:"yahoo"},{name:["yahoo.com.hk"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.hk"},teaser:"yahoo"},{name:["yahoo.com.my"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.my"},teaser:"yahoo"},{name:["yahoo.com.pe"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.ar"},teaser:"yahoo"},{name:["yahoo.com.ph"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.ph"},teaser:"yahoo"},{name:["yahoo.com.sg"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.sg"},teaser:"yahoo"},{name:["yahoo.com.tw"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.tw"},teaser:"yahoo"},{name:["yahoo.com.vn"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.com.vn"},teaser:"yahoo"},{name:["yahoo.de"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.de"},teaser:"yahoo"},{name:["yahoo.es"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.es"},teaser:"yahoo"},{name:["yahoo.fr"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.fr"},teaser:"yahoo"},{name:["yahoo.it"],useProtocol:"imap",imap:{server:"imap.mail.yahoo.com"},pop:{server:"pop.mail.yahoo.it"},teaser:"yahoo"},{name:["ameritech.net"],imap:null,pop:{server:"pop.ameritech.yahoo.com"},teaser:"yahoo"},{name:["flash.net"],imap:null,pop:{server:"pop.flash.yahoo.com"},teaser:"yahoo"},{name:["nvbell.net"],imap:null,pop:{server:"pop.nvbell.yahoo.com"},teaser:"yahoo"},{name:["pacbell.net"],imap:null,pop:{server:"pop.pacbell.yahoo.com"},teaser:"yahoo"},{name:["prodigy.net"],imap:null,pop:{server:"pop.prodigy.yahoo.com"},teaser:"yahoo"},{name:["sbcglobal.net"],imap:null,pop:{server:"pop.sbcglobal.yahoo.com"},teaser:"yahoo"},{name:["snet.net"],imap:null,pop:{server:"pop.snet.yahoo.com"},teaser:"yahoo"},{name:["swbell.net"],imap:null,pop:{server:"pop.swbell.yahoo.com"},teaser:"yahoo"},{name:["verizon.net"],imap:null,pop:{server:"incoming.yahoo.verizon.net"},teaser:"yahoo"},{name:["wans.net"],imap:null,pop:{server:"pop.wans.yahoo.com"},teaser:"yahoo"},{name:["btinternet.com"],imap:null,pop:{server:"mail.btinternet.com"},teaser:"yahoo"},{name:["rogers.com","nl.rogers.com"],imap:null,pop:{server:"pop.broadband.rogers.com"},teaser:"yahoo"},{name:["aol.com"],useSSL:!1,useProtocol:"imap",imap:{server:"imap.aol.com",tpl:"login"},pop:{server:"pop.aol.com",tpl:"login"},favicon:"aol.com",teaser:"aol"},{name:["wow.com","love.com","game.com"],useSSL:!1,useProtocol:"imap",imap:{server:"imap.aol.com",tpl:"login"},pop:{server:"pop.aol.com",tpl:"login"},teaser:"aol"},{name:["rol.ru"],useProtocol:"imap",imap:{server:"imap.rol.ru"},pop:{server:"pop.rol.ru"}},{name:["ukr.net"],useProtocol:"imap",imap:{server:"imap.ukr.net"},pop:{server:"pop3.ukr.net"}},{name:["freemail.ukr.net"],imap:null,pop:{server:"freemail.ukr.net"}},{name:["infobox.ru"],imap:null,pop:{server:"mail.infobox.ru"}},{name:["mtw.ru"],useProtocol:"imap",imap:{server:"imap.mtw.ru",tpl:"login"},pop:{server:"pop.mtw.ru",tpl:"login"}},{name:["aaanet.ru"],useSSL:!1,imap:null,pop:{server:"pop3.aaanet.ru",tpl:"login"}},{name:["tochka.ru"],imap:null,pop:{server:"pop.tochka.ru",tpl:"login"}},{name:["mx.kaluga.ru"],imap:null,pop:{server:"mx.kaluga.ru",tpl:"login"},favicon:"kaluga.ru"},{name:["permonline.ru"],imap:null,pop:{server:"pop.permonline.ru"}},{name:["ro.ru","lenta.ru","myrambler.ru","autorambler.ru","r0.ru"],useProtocol:"imap",imap:{server:"imap.rambler.ru",tpl:"login"},pop:{server:"mail.rambler.ru"}},{name:["yandex.ru","narod.ru","ya.ru","yandex.com","yandex.com.tr","yandex.ua","yandex.kz","yandex.by","яндекс.рф"],useProtocol:"imap",imap:{server:"imap.yandex.ru"},pop:{server:"pop.yandex.ru"},favicon:"mail.yandex.ru","is-own":!0,teaser:"yandex",help:"http://help.yandex.ru/mail/?id=1113278"},{name:["hotmail.com","hotmail.de","hotmail.fr","hotmail.co.uk","hotmail.ru","hotmail.it","hotmail.es","hotmail.be","hotmail.se","hotmail.co.jp","hotmail.fi","hotmail.no","hotmail.ca","hotmail.nl","hotmail.gr","hotmail.com.tr","hotmail.co.za","hotmail.cz","hotmail.co.th","hotmail.co.nz","hotmail.rs","hotmail.com.ar","hotmail.com.hk","hotmail.dk","hotmail.co.il","hotmail.com.mx","hotmail.cl","hotmail.com.au","hotmail.lt","hotmail.lv","hotmail.my","hotmail.ch","hotmail.co","hotmail.co.id","hotmail.co.kr","live.ru","live.com","live.fr","live.ca","live.nl","msn.com","outlook.com"],imap:null,pop:{server:"pop3.live.com"},useSSL:!0,teaser:"outlook"},{name:["mynet.com"],imap:null,pop:{server:"pop.mynet.com"},useSSL:!1},{name:["superonline.com"],pop:null,imap:{server:"mail.superonline.com"},useProtocol:"imap",useSSL:!0},{name:["e-kolay.net"],pop:null,imap:{server:"pop3.e-kolay.net"},useProtocol:"imap",useSSL:!0,favicon:"ekolay.net"},{name:["ttnet.net.tr"],pop:null,imap:{server:"mail.ttnet.net.tr"},useProtocol:"imap",useSSL:!0,favicon:"ttnet.com.tr"},{name:["turk.net"],pop:null,imap:{server:"pop3.turk.net"},useProtocol:"imap",useSSL:!0},{name:["mynet.com.tr"],imap:null,pop:{server:"pop.mynet.com.tr"},favicon:"mynet.com"},{name:["74.ru","chelyabinsk.ru","chel.ru","domchel.ru","autochel.ru","chelfin.ru","mychel.ru","2074.ru","cheldiplom.ru"],imap:null,pop:{server:"pop3.74.ru"}},{name:["t-online.de"],useProtocol:"imap",imap:{server:"secureimap.t-online.de"},pop:{server:"popmail.t-online.de"},teaser:"yahoo"},{name:["alice.fr","aliceadsl.fr"],imap:null,pop:{server:"pop.alice.fr"},teaser:"yahoo"},{name:["arcor.de"],useProtocol:"imap",imap:{server:"imap.arcor.de",tpl:"login"},pop:{server:"pop3.arcor.de",tpl:"login"},teaser:"yahoo"},{name:["bbox.fr"],useProtocol:"imap",imap:{server:"imap.bbox.fr"},pop:{server:"pop3.bbox.fr"},teaser:"yahoo"},{name:["bouygtel.fr"],useProtocol:"imap",imap:{server:"imap.bouygtel.fr"},pop:{server:"pop.bouygtel.fr"},teaser:"yahoo"},{name:["caramail.com"],imap:null,pop:{server:"pop.lycos.co.uk"},teaser:"yahoo"},{name:["cegetel.fr","cegetel.net"],pop:null,imap:{server:"imap.cegetel.net"},useProtocol:"imap",teaser:"yahoo"},{name:["club-internet.fr","club-internet.net"],imap:null,pop:{server:"pop3.club-internet.fr"},teaser:"yahoo"},{name:["email.de"],imap:null,pop:{server:"pop3.web.de"},teaser:"yahoo"},{name:["fastwebnet.it"],imap:null,pop:{server:"pop.fastwebnet.it"},teaser:"yahoo"},{name:["free.fr"],useProtocol:"imap",pop:{server:"pop.free.fr",tpl:"login"},imap:{server:"imap.free.fr",tpl:"login"},teaser:"yahoo"},{name:["freenet.de"],useProtocol:"imap",imap:{server:"mx.freenet.de"},pop:{server:"mx.freenet.de"},teaser:"yahoo"},{name:["gmx.de","gmx.net","gmx.at","gmx.ch","gmx.eu","gmx.biz","gmx.org","gmx.info"],useProtocol:"imap",imap:{server:"imap.gmx.net"},pop:{server:"pop.gmx.net"},teaser:"yahoo"},{name:["googlemail.com"],useProtocol:"imap",pop:{server:"pop.googlemail.com"},imap:{server:"imap.googlemail.com"},teaser:"yahoo"},{name:["laposte.net"],useProtocol:"imap",imap:{server:"imap.laposte.net",tpl:"login"},pop:{server:"pop.laposte.net",tpl:"login"},teaser:"yahoo"},{name:["libero.it","iol.it","blu.it","inwind.it"],useProtocol:"imap",pop:{server:"popmail.libero.it"},imap:{server:"imapmail.libero.it"},useSSL:!1,teaser:"yahoo"},{name:["lybertysurf.fr"],imap:null,pop:{server:"pop.libertysurf.fr"},teaser:"yahoo"},{name:["lycos.co.uk"],imap:null,pop:{server:"pop.lycos.co.uk",tpl:"login"},teaser:"yahoo"},{name:["netcourrier.com"],imap:null,pop:{server:"mail.netcourrier.com"},teaser:"yahoo"},{name:["neuf.fr","sfr.fr"],useProtocol:"imap",pop:{server:"pop.sfr.fr"},imap:{server:"imap.sfr.fr"},useSSL:!1,teaser:"yahoo"},{name:["noos.fr"],imap:null,pop:{server:"pop.noos.fr"},teaser:"yahoo"},{name:["o2online.de"],imap:null,pop:{server:"pop.o2online.de"},teaser:"yahoo"},{name:["orange.fr"],useProtocol:"imap",imap:{server:"imap.orange.fr",tpl:"login"},pop:{server:"pop.orange.fr",tpl:"login"},useSSL:!1,teaser:"yahoo"},{name:["wanadoo.fr"],useProtocol:"imap",imap:{server:"imap.wanadoo.fr"},pop:{server:"pop.wanadoo.fr"},teaser:"yahoo"},{name:["tele2.fr"],imap:null,pop:{server:"pop.tele2.fr"},teaser:"yahoo"},{name:["telefonica.net"],pop:null,imap:{server:"imap.telefonica.net"},useProtocol:"imap",teaser:"yahoo"},{name:["terra.es"],useProtocol:"imap",pop:{server:"pop3.terra.es"},imap:{server:"imap4.terra.es"},useSSL:!1,teaser:"yahoo"},{name:["tim.it"],pop:null,imap:{server:"easyimap4.posta.tim.it"},useProtocol:"imap",teaser:"yahoo"},{name:["tin.it"],imap:null,pop:{server:"box.tin.it"},teaser:"yahoo"},{name:["tiscali.fr"],useProtocol:"imap",imap:{server:"imap.tiscali.fr"},pop:{server:"pop.tiscali.fr"},teaser:"yahoo"},{name:["tiscali.it"],useProtocol:"imap",imap:{server:"imap.tiscali.it"},pop:{server:"pop.tiscali.it"},teaser:"yahoo"},{name:["tre.it"],pop:null,imap:{server:"imap.tre.it"},useProtocol:"imap",teaser:"yahoo"},{name:["virgilio.it"],imap:null,pop:{server:"in.virgilio.it",tpl:"login"},teaser:"yahoo"},{name:["vodafone.de"],imap:null,pop:{server:"pop.email.vodafone.de"},teaser:"yahoo"},{name:["vodafone.it"],imap:null,pop:{server:"popmail.vodafone.it"},teaser:"yahoo"},{name:["email.ua"],imap:{server:"imap.email.ua"},pop:{server:"pop.email.ua"}},{name:["3g.ua"],imap:null,pop:{server:"pop.3g.ua"}},{name:["mail.ua"],useProtocol:"imap",imap:{server:"imap.mail.ru"},pop:{server:"pop.mail.ru"},useSSL:!0},{name:["a.ua"],useProtocol:"imap",imap:{server:"imap.a.ua"},pop:{server:"pop.a.ua"}},{name:["ukrpost.net"],useProtocol:"imap",imap:{server:"mail.ukrpost.ua"},pop:{server:"mail.ukrpost.ua"}},{name:["online.ua"],imap:null,pop:{server:"pop3.online.ua"},useSSL:!1},{name:["meta.ua"],imap:null,pop:{server:"pop.meta.ua"},useSSL:!0},{name:["tut.by"],useProtocol:"imap",imap:{server:"imap.gmail.com"},pop:{server:"pop.gmail.com"},useSSL:!0}])
}},methods:{getDefaultConfig:function(o,t){var r=$.extend({},e);return("undefined"==typeof o||null===o)&&(o=r.useProtocol),$.extend(r,r[o]),("undefined"==typeof t||null===t)&&(t=r.useSSL),t&&$.extend(r,r[o].ssl||{}),r.useProtocol=o,r.useSSL=t,delete r.imap,delete r.pop,delete r.ssl,r},getByDomain:function(o,t,r){if(!o)return null;for(var n,a=this.getData(),i=0,s=a.length;s>i;i++){var l=a[i];if(l.name&&$.inArray(o,l.name)>-1){n=$.extend(!0,{},e,l);break}}if(!n)return null;if(("undefined"==typeof t||null===t)&&(t=n.useProtocol),!n[t])return null;
if($.extend(n,n[t]),("undefined"==typeof r||null===r)&&(r=n.useSSL),r){if(!n[t].ssl)return null;$.extend(n,n[t].ssl||{})}return n.useProtocol=t,n.useSSL=r,delete n.imap,delete n.pop,delete n.name,delete n.ssl,n},getByServer:function(e){return _.find(this.getData(),function(o){return o.pop&&o.pop.server===e||o.imap&&o.imap.server===e})}}},ns.ModelStatic)}(),function(){ns.Model.define("collectors",{params:{no_cache:null},split:{items:".",params:{popid:".popid"},model_id:"collector"},methods:{getMasterRequest:function(){var e=this,o=ns.Model.get(this.id,_.assign({},this.params,{no_cache:1}));
return o.destroy(),o.once("ns-model-changed",function(){e.setData(this.getData())}),o},getData:function(){return this.data||[]},exists:function(e){return this.models.some(function(o){return o.get(".email")===e})},getById:function(e){return ns.Model.get("collector",{popid:e}).getData()},getCount:function(){return this.models.length}}})}(),ns.Model.define("collector",{events:{"ns-model-changed":"onModelChanged"},params:{popid:null},methods:{preprocessData:function(e){e.body&&(e=e.body);var o=e.email;
if(!o)if(_.contains(e.login,"@"))o=e.login;else{var t=ns.Model.get("collector-settings").getByServer(e.server);o=t?e.login+"@"+t.name:e.login}return e.email=o,e},onModelChanged:function(){var e=this.getData();e.last_connect&&(e.human_time=Jane.Date.humanDate(new Date(1e3*e.last_connect)))}}}),ns.Model.define("do-folder-clear",{params:{fid:null,method:null,old_f:null,from_f:null,subj_f:null}}),ns.Model.define("do-folder-mark-read",{params:{fid:null}}),ns.Model.define("do-folder-move",{params:{fid:null,parent_id:null}}),ns.Model.define("do-folder-rename",{params:{fname:null,fid:null,parent_id:null}}),ns.Model.define("do-folder-set-options",{params:{fid:null,prev:null}}),ns.Model.define("do-folder-set-symbol",{params:{fid:null,symbol:null}}),ns.Model.define("do-folders-add",{params:{folder_name:null,parent_id:null},methods:{getFid:function(){return this.get(".body.updated")
}}}),ns.Model.define("do-labels-add",{params:{label_name:null,label_color:null,label_type:null}}),ns.Model.define("do-labels-add-by-symbol",{params:{symbol:null}}),ns.Model.define("do-label",{params:{lid:null,ids:null,tids:null},methods:{getAffectedTids:function(){return this.select('.thread[.lid == "'+this.params.lid+'"].tid')}}}),ns.Model.define("do-unlabel",{params:{lid:null,ids:null,tids:null},methods:{getAffectedTids:function(){return this.select('.thread[.lid != "'+this.params.lid+'"].tid')
}}}),ns.Model.define("folder",{params:{fid:null},methods:{preprocessData:function(e){if(Daria.IS_CORP&&this.data){var o=["new","count"].some(function(o){return this.get("."+o)!==e[o]},this);o&&this._messagesInvalidate()}return e},hasDataChanged:function(e){return!_.isEqual(this.getData(),e)},adjustUnreads:function(e){if(this.isValid()){var o=this.getUnreadsCount(),t=Math.max(o+e,0);t!==o&&(this.set(".new",t),this.setHasUnread(t>0))}},getParent:function(){var e=this.get(".parent_id");return e?ns.Model.get("folder",{fid:e}):null
},getUnreadsCount:function(){return this.get(".new")},getSubfolders:function(){return this.get(".subfolder")},hasUnreads:function(){return this.getUnreadsCount()>0},hasNestingToggler:function(){var e=this.getSubfolders();if(!e||!e.length)return!1;var o=!0,t=ns.Model.get("settings").getSetting("hide_empty_folders");if(t&&this.hasUnreads()){var r=!1;e.forEach(function(e){r=r||!ns.Model.get("folders").isIncoming(e)||ns.Model.get("folder",{fid:e}).hasUnreads()}),r||(o=!1)}return o},isFolded:function(){return this.get(".folded")
},isOpen:function(){return this.get(".opened")},updateCounts:function(e){if(this.isValid()){e=_.defaults(e,{count:0,"new":0});var o=this.get(".count"),t=Math.max(o+e.count,0);o!==t&&this.set(".count",t);var r=this.getUnreadsCount(),n=Math.max(r+e["new"],0);r!==n&&this.set(".new",n);var a=ns.Model.get("folders");e["new"]&&!a.spamOrTrash(this.params.fid)&&a.adjustAllUnreads(e["new"])}},recalcOpened:function(){var e=this.getParent();if(e){var o=!0;e.isFolded()&&(o=!1),e.isOpen()||(o=!1),this.set(".opened",o),this._toggleSubfoldersOpened()
}},setHasUnread:function(e){var o=e||this.hasUnreads();o||this.getSubfolders().forEach(function(e){var t=ns.Model.get("folder",{fid:e}).get(".has-unread");o=o||t}),this.setIfChanged(".has-unread",o);var t=this.getParent();t&&"inbox"!==t.get(".symbol")&&t.setHasUnread(e)},setRecent:function(){this.setIfChanged(".recent",!0)},switchFolded:function(e){var o=this.getData(),t=this.get(".fid");if(!this.getSubfolders().length)return!1;var r=ns.Model.get("folders"),n=r.getOpenedFolders(),a=o.folded;if(_.isBoolean(e)){if(e===a)return a;
a=!e}Jane.Array.remove(n,t),a?(this.set(".folded",!1),n.push(t)):this.set(".folded",!0);var i=ns.Model.get("settings");return i.setOpenedFolders(n),this._toggleSubfoldersOpened(),!a},_toggleSubfoldersOpened:function(){this.getSubfolders().forEach(function(e){ns.Model.get("folder",{fid:e}).recalcOpened()})},_messagesInvalidate:function(){var e=this.params.fid,o=ns.page.current.params;o.current_folder!==e&&(ns.Model.invalidate("messages",function(o){return o.params.current_folder===e?(o.models.length&&o.models.forEach(function(e){ns.Model.get("messages",{thread_id:e.get(".tid")}).invalidate()
}),!0):void 0}),ns.Model.invalidate("messages-item-state",function(o){return o.params.current_folder===e}))}}}),function(){var e={},o={inbox:"Входящие",sent:"Отправленные",trash:"Удалённые",spam:"Спам",draft:"Черновики",outbox:"Исходящие",template:"Шаблоны",archive:"Архив"};e.getFolderById=function(e){return ns.Model.get("folder",{fid:e}).getData()},e.getFoldersByName=function(e){var o;return"object"==typeof this.data&&(o=_.find(this.data.folder,function(o){return o.name==e})),[o]},e.getSubfolders=function(e){return jpath(this.data,'.folder[.parent_id == "'+e+'"]')
},e.getSubfoldersFid=function(e){return $.map(this.getSubfolders(e)||[],function(e){return e.fid})},e.getAllSubfoldersFid=function(e){var o=function(e){for(var t=this.getSubfoldersFid(e),r=t.length;r--;)t=t.concat(o.call(this,t[r]));return t};return o.call(this,e)},e.spamOrTrash=function(e){return this.isFolder(e,["trash","spam"])},e.isIncoming=function(e){return!this.isFolder(e,["draft","outbox","sent","spam","trash","template","archive"])},e.getDroppableListFid=function(){var e=this,o=$.grep(this.get(".folder"),function(o){return e.isDroppable(o.fid)
});return o=$.map(o,function(e){return e.fid})},e.getMoveFoldersFid=function(e){if(!this.isDraggable(e))return[];var o=this.getDroppableListFid(),t=this.getAllSubfoldersFid(e);return t=t.concat(e),o=$.grep(o,function(e){return-1===$.inArray(e,t)})},e.comparePosition=function(e,o){var t=1e12,r=!e.symbol&&e.user,n=!o.symbol&&o.user,a=e.name.toLowerCase(),i=o.name.toLowerCase(),s=e.folder_options.position,l=o.folder_options.position,d=r?s:t+Number(e.order||0),u=n?l:t+Number(o.order||0);return"inbox"===e.symbol&&(d=-1),"inbox"===o.symbol&&(u=-1),u>d?-1:d>u?1:i>a?-1:a>i?1:0
},e.getNeighborFids=function(e){var o=e&&this.getFolderById(e);if(!o)return[];var t;t=o.parent_id?this.getSubfolders(o.parent_id):$.grep(this.get(".folder"),function(e){return!e.parent_id&&e.user&&!e.symbol}),t.sort(this.comparePosition);var r=$.map(t,function(e){return e.fid});return r},e.getParentFid=function(e){var o=e&&this.getFolderById(e);return o&&o.parent_id||this.getFolderBySymbol("inbox").fid},e.getTopParent=function(e){for(var o=this.getFolderById(this.getParentFid(e));o&&!o.symbol;)o=this.getFolderById(this.getParentFid(o.fid));
return o},e.isDroppable=function(e){var o=e&&this.getFolderById(e);if(!o)return!1;var t=this.getTopParent(e);return t&&"inbox"===t.symbol?o.user&&!o.symbol&&!o.shared||"inbox"===o.symbol:!1},e.isDraggable=function(e){var o=e&&this.getFolderById(e);if(!o)return!1;var t=this.getTopParent(e);return t&&"inbox"===t.symbol?o.user&&!o.symbol&&!o.shared:!1},e.moveIn=function(e,o){var t=$.Deferred();if(e===o)return t.resolve("donot"),t.promise();var r=this.getFolderById(e),n=this.getParentFid(e),a=this.getFolderById(o);
if(!r||!a)return t.reject("notfound"),t.promise();if(!this.isDraggable(e)||!this.isDroppable(o))return t.reject("noaccess"),t.promise();if(n===o)return t.resolve("donot"),t.promise();this.getFolderBySymbol("inbox").fid===o&&(o=0);var i;i=o?this.getSubfolders(o):$.grep(this.get(".folder"),function(e){return!e.parent_id});for(var s=0;s<i.length;s++)if(i[s].name===r.name)return t.reject("nameduplicate"),t.promise();return ns.forcedRequest([{id:"do-folder-move",params:{fid:e,parent_id:o}},{id:"folders"}]).then(function(){t.resolve("ok")
},function(){t.reject("actionerror")}),t.promise()},e.moveAfter=function(e,o){var t=$.Deferred();if(e===o)return t.resolve("donot"),t.promise();var r=this.getFolderById(e);if(!r||!$.isPlainObject(r.folder_options))return t.reject("notfound"),t.promise();if(!this.isDraggable(e))return t.reject("noaccessfid"),t.promise();var n,a=$({}),i=this;if(o){if(!this.isDroppable(o))return t.reject("noaccessover"),t.promise();var s=this.getParentFid(e),l=this.getParentFid(o);if(s!==l)a.queue(function(o){i.moveIn(e,l).done(o).fail(t.reject)
});else if(n=this.getNeighborFids(e),$.inArray(e,n)===$.inArray(o,n)+1)return t.resolve("donot"),t.promise()}else if(n=this.getNeighborFids(e),0===$.inArray(e,n))return t.resolve("donot"),t.promise();return a.queue(function(){ns.forcedRequest([{id:"do-folder-set-options",params:{fid:e,prev:o||0}},{id:"folders"}]).then(function(){t.resolve("ok");var r=i.getNeighborFids(o||e),n=$.inArray(e,r),a=$.inArray(o,r);(o&&n!==a+1||!o&&0!==n)&&Jane.ErrorLog.send({event:"folders.move.position",status:"position_error",fid:e+":"+i.getFolderById(e).folder_options.position,overFid:o+":"+i.getFolderById(o).folder_options.position})
},function(){t.reject("actionerror")})}),t.promise()},e.moveBefore=function(e,o){var t=$.Deferred(),r=this.getNeighborFids(o),n=r[$.inArray(o,r)-1];if(n)this.moveAfter(e,n).done(t.resolve).fail(t.reject);else{var a=$({}),i=this,s=this.getParentFid(o);a.queue(function(o){i.moveIn(e,s).done(o).fail(t.reject)}),a.queue(function(){i.moveAfter(e,!1).done(t.resolve).fail(t.reject)})}return t.promise()},e.getCount=function(e){var o=this.getFolderById(e);return o?o.count:null},e.getUnreadCount=function(e){var o=e?this.getFolderById(e):this.data;
return o?Number(o["new"]):null},e.getFoldersHash=function(){var e=this.getData(),o={};return e&&$.each(e.folder,function(){o[this.fid]=0}),o},e.isShared=function(e){var o=this.getFolderById(e);return!(!o||!o.shared)},e.getDefaultFolderName=function(e){return o[e]},e.setSymbol=function(e,o){var t=[{id:"do-folder-set-symbol",params:{fid:e,symbol:o}},{id:"folders"}];return ns.forcedRequest(t).then(function(e){var t=Vow.promise(),r=e[1].getFolderBySymbol(o);return r?(ns.events.trigger("daria:mFolders:symbolSet",r),t.fulfill(r)):t.reject(new Error(Daria.supplant("Symbol {symbol} was not set on folder",{symbol:o}))),t
})},e.isArchive=function(e){var o=this.getFolderById(e);return o?"archive"==o.symbol:!1},e.getCountUserFolders=function(){return jpath(this.data,".folder[.user]").length},e.createArchiveFolder=function(){var e,o=this,t=o.getFolderBySymbol("archive"),r=o.getFoldersByName("Archive").shift(),n=o.getFoldersByName("Архив").shift(),a=Vow.promise();return t||r||n?t||!r&&!n?a.fulfill(t):r?a=o.setSymbol(r.fid,"archive"):n&&(e=[{id:"do-folder-rename",params:{fname:"Archive",fid:n.fid}},{id:"folders"}],a=ns.forcedRequest(e).then(function(){return o.setSymbol(n.fid,"archive").fail(function(){})
})):(e=[{id:"do-folders-add",params:{folder_name:"Archive"}},{id:"folders"}],a=ns.forcedRequest(e).then(function(e){var o=Vow.promise(),t=e[1],r=t.getFolderByName("Archive");return r&&r.fid?o.fulfill(r):o.reject("New folder has no fid"),o}).then(function(e){return o.setSymbol(e.fid,"archive").fail(function(){})})),a},e.getHierarchyStructure=function(e){function o(n){var a=[];n=n.sort(t.comparePosition);for(var i=0;i<n.length;++i){var s=n[i];(!_.isFunction(e)||e(s))&&(s=_.clone(s),s.subfolder&&(s.items=o(s.subfolder.map(r))),delete s.subfolder,delete s.parent_id,a.push(s))
}return a}var t=this,r=this.getFolderById.bind(this),n=this.get(".folder"),a=_.find(n,{symbol:"inbox"});a.items=o(_.filter(n,function(e){return e.user&&!e.parent_id}));var i=_.filter(n,function(e){return!e.user&&!e.parent_id});return o(i,!0)},e.logDragndropAbility=function(){for(var e=this.get(".folder"),o=0,t=0,r=e.length;r>t;t++)if(this.isDraggable(e[t].fid)&&(o++,o>1))return void Jane.c("Драгндроп папок","Показ папок в инбоксе (больше 1, драг разрешен)")},ns.Model.define("folders",{split:{items:".folder",params:{fid:".fid"},model_id:"folder"},methods:$.extend({_ids:{},_symbols:{},_cacheBySymbol:{},preprocessData:function(e){this._hasUserFolders=!1,this._hasNestedFolders=!1;
for(var t=ns.page.current.params.current_folder,r={},n={},a={},i=e.folder,s={},l=this._getOpenedFolders(e),d=0,u=i.length;u>d;d++){var c=i[d],m=c.fid,p=c.symbol;s[m]=c;var f;if(t&&m!=t&&(f=this.getFolderById(m))&&c.count!=f.count&&Daria.messages.clearCacheByFID(m),p&&(p in o&&(c.name=o[p]),r[p]=m,n[p]=c,a[m]=p),!this._hasUserFolders&&c.user&&(this._hasUserFolders=!0),this._hasNestedFolders||!c.user&&!c.parent_id||(this._hasNestedFolders=!0),c.folded=c.subfolder.length>0?!_.includes(l,m):!1,c.opened=!0,c.parent_id){var h=s[c.parent_id];
h.folded&&(c.opened=!1),h.opened||(c.opened=!1)}}return this._ids=r,this._cacheBySymbol=n,this._symbols=a,this.toggleMarkFolders(e),e},_getOpenedFolders:function(e){return ns.Model.get("settings").hasSetting("folders_open")?this._getOpenedFoldersFromSettings():this._getOpenedFoldersFromData(e)},_getOpenedFoldersFromSettings:function(){var e=ns.Model.get("settings").getSetting("folders_open");return e?e.split(","):[]},_getOpenedFoldersFromData:function(e){var o=[];return e.folder.forEach(function(e){("inbox"===e.symbol||"draft"===e.symbol)&&o.push(e.fid),e.subfolder.length&&Array.prototype.push.apply(o,e.subfolder)
}),_.uniq(o)},getOpenedFolders:function(){return this._getOpenedFolders(this.data)},symbols:function(){return this._ids},ids:function(){return this._symbols},hasUserFolders:function(){return this._hasUserFolders},hasNestedFolders:function(){return this._hasNestedFolders},getFolderByName:function(e,o){var t,r=this.getData();if(r){var n;o||(n=this.getFidBySymbol("inbox")),t=_.find(r.folder,function(t){return t.name!==e?!1:o?t.parent_id==o:!t.parent_id||t.parent_id==n})}return t},getFolderBySymbol:function(e){return this._cacheBySymbol[e]
},getFidBySymbol:function(e){return this._ids[e]},isFolder:function(e,o){if(!e)return!1;Array.isArray(o)||(o=[o]);for(var t=0,r=o.length;r>t;t++){var n=o[t];if(this._ids.hasOwnProperty(n)&&e===this._ids[n])return!0}return!1},isCurrentFolder:function(e){return this.isFolder(ns.page.current.params.current_folder,e)},createTemplateFolder:function(){var e,t=Vow.promise(),r=this.getFolderBySymbol("template"),n=this.getFidBySymbol("draft"),a=this.getSubfolders(n),i=_.find(a,function(e){return"template"===e.name
}),s=_.find(a,function(e){return e.name===o.template});return r||i||s?r||!i&&!s?t.fulfill(r):i?t=this.setSymbol(i.fid,"template"):s&&(e=[{id:"do-folder-rename",params:{fname:"template",fid:s.fid,parent_id:n}},{id:"folders"}],t=ns.forcedRequest(e).then(function(){return this.setSymbol(s.fid,"template")}.bind(this))):(e=[{id:"do-folders-add",params:{folder_name:"template",parent_id:n}}],t=ns.forcedRequest(e).then(function(e){var o=e[0];return this.setSymbol(o.getFid(),"template")}.bind(this))),t},adjustUnreadCounters:function(e){var o=!1,t=0;
for(var r in e){var n=ns.Model.get("folder",{fid:r});n.adjustUnreads(e[r]),t+=e[r],o=!0}return o&&this.adjustAllUnreads(t),o},toggleMarkFolders:function(e){var o={};$.each(jpath(e,".folder[.parent_id && !.subfolders]"),function(t,r){var n,a=0;do{if(r=n?jpath(e,'.folder[.fid == "'+n+'"]')[0]:r,"inbox"===r.symbol)return!0;if(a+=Number(r["new"]),n in o)return!0;a?(r["has-unread"]=!0,o[r.fid]=1):r["has-unread"]=!1,n=r.parent_id}while(n)})},hasChildByFid:function(e,o){var t=this.getFolderById(e),r=t&&t.subfolder?t.subfolder:[],n=0!==r.length?r.indexOf(o)>-1:!1,a=this;
return _.forEach(r,function(e){n=n||a.hasChildByFid(e,o)}),n},adjustAllUnreads:function(e){var o=this.get(".new"),t=Math.max(o+e,0);o!==t&&this.set(".new",t)}},e)})}(),ns.Model.define("informer-news",{events:{"ns-model-changed":function(){var e=this.getData();if(e.empty&&(this.MAXAGE=0),this.MAXAGE){var o=this;window.setTimeout(function(){o.invalidate()},this.MAXAGE)}}},methods:{MAXAGE:9e5,turnOffCacheInvalidating:function(){this.MAXAGE=0}}}),ns.Model.define("messages-filters",{events:{"ns-model-init":"_onInit","ns-model-destroyed":"_onDestroy"},ctor:function(){this._onLoad=this._onLoad.bind(this)
},methods:{_onInit:function(){this.setData({}),this._onLoad(),ns.events.on("ns-page-after-load",this._onLoad)},_onDestroy:function(){ns.events.off("ns-page-after-load",this._onLoad)},_onLoad:function(){var e,o=ns.page.current.params,t=ns.Model.get("labels"),r=o.current_label===t.getImportantLID();e=o.important||r?"important":o.attachments?"attachments":o.unread?"unread":"inbox";var n=ns.Model.get("labels").getWaitingForReplyLabel();o.current_label&&o.current_label===n.lid&&(e="wait");var a=this.get(".filter");
a!==e&&this.set(".filter",e)}}},ns.ModelStatic),ns.Model.define("label",{events:{"ns-model-changed.count":"_onChangedCount"},params:{lid:null},methods:{_onChangedCount:function(){if(this.data&&this.data.hasOwnProperty("unused")){var e=this.get(".count");this.setIfChanged(".unused",!e,{silent:!0})}}}}),function(){ns.Model.define("labels",{split:{items:".label",params:{lid:".lid"},model_id:"label"},methods:{SO:{MTYPE:{PEOPLE:"4"},mtypes:[{id:"other",title:"other",description:"другое"},{id:"4",title:"people",description:"письмо от человека"},{id:"2",title:"registration",description:"письмо с учетными данными"},{id:"5",title:"eticket",description:"электронный билет"},{id:"6",title:"eshop",description:"статус интернет-покупки"},{id:"8",title:"bounce",description:"статус доставки письма"},{id:"12",title:"greeting",description:"письмо от яндекса"},{id:"13",title:"news",description:"общая рассылка (новости/акции)"},{id:"7",title:"notification",description:"уведомление о новом сообщении"},{id:"22",title:"personalnews",description:"индивидуальная рассылка"},{id:"28",title:"cancel",description:"отмена какой-либо брони"},{id:"35",title:"hotel",description:"бронирования гостиниц"},{id:"36",title:"yamoney",description:"письма с деньгами"},{id:"invite",title:"invite",description:"приглашение"}],ftypes:[{id:"other",title:"other",description:"другое"},{id:"14",title:"s_grouponsite",description:"скидочного сервиса"},{id:"15",title:"s_datingsite",description:"сайта знакомств"},{id:"17",title:"s_bank",description:"банка"},{id:"18",title:"s_social",description:"социальной сети"},{id:"16",title:"s_aviaeticket",description:"авиакомпании (или агента)"},{id:"19",title:"s_travel",description:"тур. оператора"},{id:"20",title:"s_zdticket",description:"жд-компании"},{id:"21",title:"s_realty",description:"агентства недвижимости"},{id:"23",title:"s_eshop",description:"интернет-магазина"},{id:"24",title:"s_company",description:"какой-либо компании"},{id:"33",title:"s_forum",description:"форума"},{id:"31",title:"s_advert",description:"доски объявлений"},{id:"25",title:"s_job",description:"рекрутинговой компании"},{id:"34",title:"s_mobile",description:"мобильного оператора"},{id:"32",title:"s_provider",description:"провайдера"},{id:"29",title:"s_tech",description:"IT компании"},{id:"26",title:"s_game",description:"какой-либо игры"},{id:"30",title:"s_media",description:"медиа-портала"},{id:"45",title:"s_state",description:"государственных услуг"},{id:"47",title:"s_news",description:"новостей"},{id:"48",title:"s_event",description:"сервиса по продаже билетов"},{id:"other",title:"other",description:"другое"}]},_cacheByLid:{},_cacheByName:{},_cacheUserLabelsByName:{},LABEL_PINNED_SYMBOL_NAME:"pinned_label",LABEL_MUTE_SYMBOL_NAME:"mute_label",preprocessData:function(e){return this._cacheByName={},this._cacheUserLabelsByName={},this._cacheByLid={},this.sortLabels(e.label),e.label.forEach(function(e){var o,t=e.name,n=r[t];
n?("dating"==n?o="Все письма от сайтов знакомств":"groupon"==n?o="Все письма от скидочных сервисов":"yasupport"==n?(o="Все письма от поддержки Яндекса",e.yaservice=!0):"videoletter"==n?(o="Все видеописьма",e.yaservice=!0):"eticket"==n?o="Все электронные билеты":t.indexOf("ya")>-1||"moikrug"==t?(o="Все письма от сервиса "+n,e.yaservice=!0):o="Все письма от сайта "+n,e.social=!0,e.title=o):(e.user&&e.name.length>15&&(e.name=e.name.substr(0,15)+"…"),delete e.social),"important_label"===e.symbolicName&&(e.name="Важные")
}),e},sortLabels:function(e){var o=ns.Model.get("settings").getSetting("label_sort");o&&e.sort(n[o])},getMTypeById:function(e){for(var o=this.SO.mtypes.length;o--;)if(this.SO.mtypes[o].id===e)return this.SO.mtypes[o];return null},getFTypeById:function(e){for(var o=this.SO.ftypes.length;o--;)if(this.SO.ftypes[o].id===e)return this.SO.ftypes[o];return null},extractFirstMType:function(e){var o=$.map(this.SO.mtypes,function(e){return e.id});return e=$.map(e,function(e){return-1!=$.inArray(String(e),o)?e:void 0
}),e[0]||null},extractFirstFType:function(e){var o=$.map(this.SO.ftypes,function(e){return e.id});return e=$.map(e,function(e){return-1!=$.inArray(String(e),o)?e:void 0}),e[0]||null},getSOLabelName:function(o){var t=this.getLabelById(o);return t&&t.name&&0===t.name.indexOf(e)?t.name:null},getImportantLID:function(){var e=this.getLabelBySymbolicName("important_label");return e?e.lid:null},getPriorityLID:function(){var e=this.getLabelBySymbolicName("hamon_label");return e?e.lid:null},getLIDByName:function(e){var o=this.getLabelByName(e);
return o?o.lid:null},getLabelById:function(e){return ns.Model.get("label",{lid:e}).getData()},getLabelBySymbolicName:function(e){if(!this._cacheByLid.hasOwnProperty(e)){var o=_.find(this.models,function(o){return o.get(".symbolicName")===e});o&&(this._cacheByLid[e]=o.getData())}return this._cacheByLid[e]},getLabelByName:function(e){if(!this._cacheByName.hasOwnProperty(e)&&!this._cacheUserLabelsByName.hasOwnProperty(e)){var o=_.find(this.models,function(o){return o.get(".name")===e});o&&(this._cacheByName[e]=o.getData())
}return this._cacheByName[e]||this._cacheUserLabelsByName[e]},getUserLabelByName:function(e){if(!this._cacheUserLabelsByName.hasOwnProperty(e)){var o=_.find(this.models,function(o){return o.get(".user")&&o.get(".name")===e});o&&(this._cacheUserLabelsByName[e]=o.getData())}return this._cacheUserLabelsByName[e]},adjustCounters:function(e){var o=!1;for(var t in e){var r=this.getLabelById(t);if(r){var n=ns.Model.get("label",{lid:r.lid});n.set(".count",r.count+e[t]),o=!0}}return o&&this.touch(),o},getLabelsHash:function(){var e={};
return this.models.forEach(function(o){var t=o.getData(),r=t.lid&&(t.user||t["default"])&&!t.social&&!("deleted"==t.name&&t["default"]);r&&(e[t.lid]=0)}),e},getUserLabelsCount:function(){var e=0;return this.models.forEach(function(o){o.get(".user")&&e++}),e},isSocial:function(e){var o=this.getLabelById(e);return Boolean(o&&"social"in o)},getWaitingForReplyLabel:function(){return this.getLabelByName(o)},getDelayedMessageLabel:function(){return this.getLabelByName(t)},getPinnedLabel:function(){return this.getLabelBySymbolicName(this.LABEL_PINNED_SYMBOL_NAME)
},canShowEventWidget:function(e){var o=this;return!e.some(function(e){var t=o.getLabelById(e);return t&&"not_show_widget_event"===t.name})},getMuteThreadLabel:function(){return this.getLabelBySymbolicName(this.LABEL_MUTE_SYMBOL_NAME)},hasUnusedUserLabels:function(){return this.models.some(function(e){return e.get(".user")&&e.get(".unused")})}}});var e="SystMetkaSO:",o="remindme_threadabout:mark",t="delayed_message",r={yaru:"Я.ру",yandexfotki:"Яндекс.Фотки",yandexvideo:"Яндекс.Видео",yadirect:"Яндекс.Директ",yacards:"Яндекс.Открытки",yamarket:"Яндекс.Маркет",yanarod:"Яндекс.Народ",yaauto:"Яндекс.Авто",yacal:"Яндекс.Календарь",yasupport:"yasupport",yamoney:"Яндекс.Деньги",yandexmusic:"Яндекс.Музыка",yandexwiki:"Яндекс.Вики",yasitesearch:"Яндекс.Поиск",yaxml:"Яндекс.XML",yawebmaster:"Яндекс.Вебмастер",yabetatest:"Яндекс.Бета",yadisk:"Яндекс.Диск",videoletter:"videoletter",moikrug:"Мой Круг",jira:"jira",yandexcom:"Yandex",yandexru:"Яндекс",yandexcomtr:"Yandex",atushka:"atushka",odnoklassniki:"Odnoklassniki.ru",liveinternet:"Liveinternet.ru",livejournal:"Livejournal.com",vkontakte:"Vkontakte.ru",facebook:"Facebook.com",friendfeed:"Friendfeed.com",habrahabr:"Habrahabr.ru",mirtesen:"Mirtesen.ru",twitter:"Twitter.com",headhunter:"HeadHunter.ru",ozonru:"Ozon.ru",fotostrana:"Fotostrana.ru",subscribe:"Subscribe.ru",mnogoru:"Mnogo.ru",executive:"E-xecutive.ru",myspace:"Myspase.com",youtube:"Youtube.com",professionali:"Professionali.ru",rutube:"Rutube.ru",pingadmin:"Ping-admin.ru",markafoni:"Markafoni.com",yonja:"Yonja.com",formspring:"Formspring.me",oley:"Oley.com",stumbleupon:"Stumbleupon.com",vedomostiru:"Ведомости","yves-rocherru":"yves-rocher.ru",workua:"Work.ua",wordpresscom:"Wordpress",womanjournalru:"wmj.ru",vshtate:"vshtate.ru",vkrugudruzei:"vkrugudruzei",victoriassecretcom:"Victoria's Secret",topshopru:"TOPSHOP",superjob:"SuperJob.ru",smartresponderru:"smartresponder.ru",skyperu:"skype.com",ottoru:"otto.ru",molotokru:"molotok.ru",mcafeecom:"McAfee.com",linkedin:"Linkedin",lamodaru:"lamoda.ru",geometriaru:"Geometria.ru",futuretodayru:"FutureToday.ru",freelance:"Free-lance.ru",evernoteru:"Evernote.com",dissercatcom:"disserCat.com",bookingcom:"Booking.com",b2bcenterru:"B2B-Center.ru",applecom:"Apple.com","24open":"24open",datingsite:"dating",vtnrf0datingsite:"dating",grouponsite:"groupon","4square":"foursquare.com",allegropl:"allegro.pl",darudarorg:"darudar.org",ebaycom:"ebay.com",forum2x2ru:"forum2x2.ru",gideparkru:"gidepark.ru",joobleru:"jooble.ru",justclickru:"JustClick.ru",kolizeoru:"kolizeo.ru",newsprofipostorg:"profi-post.org",newsquickofficecom:"Quickoffice.com",servicegirlsgogamesru:"GirlsgoGames.ru",tradesu:"trade.su",biznesbombaru:"biznesbomba.ru",gate32ru:"gate-32.ru",specservercom:"specserver.com",butikru:"butik.ru",pcdaysru:"pcdays.ru","7yaru":"7ya.ru",info74ru:"info74.ru",floridecorru:"floridecor.ru",allsoftru:"allsoft.ru",forumhouseru:"forumhouse.ru",shopdeluxeru:"shopdeluxe.ru",loccitaneru:"loccitane.ru",emeacom:"ea.com",yarabota:"Яндекс.Работа",yarealty:"Яндекс.Недвижимость",vtnrf024open:"24open.ru",vtnrf04square:"Foursquare",vtnrf07yaru:"7я.ру",vtnrf0afyru:"AFY.ru",vtnrf0allegropl:"Аллегро",vtnrf0allsoftru:"Allsoft",vtnrf0applecom:"Apple",vtnrf0aukroua:"Aukro.ua",vtnrf0avitoru:"AVITO.ru",vtnrf0b2bcenterru:"В2В-Center",vtnrf0beonru:"BeOn",vtnrf0bigbuzzyru:"groupon",vtnrf0biznesbombaru:"Biznesbomba",vtnrf0bookingcom:"Booking.com",vtnrf0burningmancom:"BurningMan.com",vtnrf0busuucom:"busuu.com",vtnrf0butikru:"Бутик.ру",vtnrf0chocolifeme:"Chocolife.me",vtnrf0crewardscom:"crewards.com",vtnrf0darudarorg:"Дару-дар",vtnrf0dealextremecom:"DealExtreme",vtnrf0diaryru:"Diary.ru",vtnrf0dissercatcom:"DisserCat.com",vtnrf0drimmicom:"Drimmicom",vtnrf0ebaycom:"Ebay",vtnrf0emeacom:"EA.com",vtnrf0emirates:"Emirates",vtnrf0evernoteru:"Evernote",vtnrf0executive:"Executive",vtnrf0facebook:"Facebook",vtnrf0floridecorru:"Флор&Декор",vtnrf0formspring:"Formspring",vtnrf0forum2x2ru:"2x2",vtnrf0forumhouseru:"Хост.ру",vtnrf0freelance:"Freelance",vtnrf0friendfeed:"Friendfeed",vtnrf0futuretodayru:"Futuretoday",vtnrf0gate32ru:"Gate32",vtnrf0geometriaru:"Geometria",vtnrf0getresponsecom:"Getresponse.com",vtnrf0gideparkru:"Гайдпарк",vtnrf0githubcom:"Github.com",vtnrf0googlegroupscom:"Google groups",vtnrf0googlecom:"Google",vtnrf0grouponsite:"groupon",vtnrf0gurboyru:"groupon",vtnrf0habrahabr:"Хабрахабр",vtnrf0headhunter:"HH.ru",vtnrf0imnicamailcom:"Imnica mail",vtnrf0info74ru:"Инфо74",vtnrf0infobonprixde:"Bonprix",vtnrf0internetprosru:"Интернет опрос",vtnrf0iskusnitsaru:"Искусница",vtnrf0jobsmarketru:"Jobsmarket.ru",vtnrf0joobleru:"Joobler.u",vtnrf0justclickru:"Just Click",vtnrf0kolizeoru:"KOLIZEO.ru",vtnrf0lamodaru:"Lamoda.ru",vtnrf0linkedin:"Linkedin",vtnrf0liveinternet:"LiveInternet",vtnrf0livejournal:"Livejournal",vtnrf0loccitaneru:"L'occitane",vtnrf0mailluxaleru:"Luxale",vtnrf0markafoni:"Markafoni",vtnrf0mcafeecom:"McAfee",vtnrf0mirtesen:"Мир Тесен",vtnrf0mnogoru:"MNOGO.ru",vtnrf0moikrug:"Мой Круг",vtnrf0molotokru:"Молоток.ру",vtnrf0myfantru:"groupon",vtnrf0myspace:"MY SPACE ",vtnrf0notifyastrostarru:"Астростар.ру",vtnrf0oley:"Oley",vtnrf0ottoru:"Oтто.ру",vtnrf0ozonru:"Озон.ру",vtnrf0pathcom:"Path.com",vtnrf0paypalcom:"PayPal.com",vtnrf0pcdaysru:"PC Days",vtnrf0pingadmin:"Ping-Admin.Ru",vtnrf0professionali:"Профессионалы",vtnrf0quelleinforu:"Quelle",vtnrf0quickofficecom:"Quickoffice",vtnrf0radiomarketru:"Радио Маркет",vtnrf0rdwru:"Работа для Вас",vtnrf0regru:"reg.ru",vtnrf0rutube:"Rutube",vtnrf0servicegirlsgogamesru:"GirlsgoGames",vtnrf0skyperu:"Skype.ru",vtnrf0smartresponderru:"SmartResponder",vtnrf0specservercom:"specserver.com",vtnrf0sprashivairu:"Спрашивай.ру",vtnrf0stumbleupon:"Stumbleupon",vtnrf0subscribe:"Subscribe",vtnrf0superjob:"Superjob",vtnrf0teszveszhu:"teszves",vtnrf0topshopru:"Топ-Шоп.ру",vtnrf0tradesu:"TRADE.SU",vtnrf0twitter:"twitter",vtnrf0vabankcom:"vabank.com",vtnrf0vedomostiru:"Ведомости",vtnrf0victoriassecretcom:"Victoria's secret",vtnrf0vkrugudruzei:"В кругу друзей ",vtnrf0vshtate:"В Штате",vtnrf0wmjru:"Womanjournal",vtnrf0wordpresscom:"Wordpress",vtnrf0workua:"Work.ua",vtnrf0yangutucom:"Yangutu",vtnrf0yonja:"Yonja",vtnrf0youtube:"Youtube","vtnrf0yves-rocherru":"Yves Rocher",vtnrf07vetrovmskru:"7 Ветров",vtnrf0anketkaru:"Анкетка.ру",vtnrf0askfm:"Ask.fm",vtnrf0aviasalesru:"Aviasales.ru",vtnrf0babyblogru:"БебиБлог",vtnrf0babyru:"бэби.ру",vtnrf0bio4freecom:"Bio4free.com",vtnrf0chingoraclecom:"Chingoracle.com",vtnrf0dotnewsru:"Dotnews.ru",vtnrf0edarlingru:"Edarling.ru",vtnrf0finance1ru:"Finance1.ru",vtnrf0fxcluborg:"Forex club",vtnrf0gamenetru:"GameNet",vtnrf0horoscopofreecom:"Horoscopofree.com",vtnrf0jobru:"Job.ru",vtnrf0kissesru:"Kisses.ru",vtnrf0liststarotaroru:"ТароТаро",vtnrf0liveexpertru:"Liveexpert.ru",vtnrf0livemasterru:"Livemaster.ru",vtnrf0malinaru:"Малина",vtnrf0mamsyru:"Mamsy.ru",vtnrf0meggymallru:"Meggy Mall",vtnrf0mithostru:"Mitinfo.ru",vtnrf0pokerstarscom:"PokerStars.com",vtnrf0prestigeua:"Prestige",vtnrf0probelovnet:"Пробелов.Нет",vtnrf0promenadru:"Promenad",vtnrf0qualitynetua:"Quality.net",vtnrf0rabotaua:"Rabota.ua",vtnrf0rugionru:"RUgion",vtnrf0sapatoru:"Sapato.ru",vtnrf0slandoru:"Slando.ru",vtnrf0softkeyru:"Softkey.ru",vtnrf0stilagoinfo:"Emailvision",vtnrf0taggedmailcom:"Tagged",vtnrf0theboutiqueru:"Boutique.ru",vtnrf0topfacecom:"Topface",vtnrf0torrnadoru:"torrНадо.ru",vtnrf0transportlineru:"TransportLine",vtnrf0trudcom:"Trud.com",vtnrf0westwingru:"Westwing",vtnrf0wildberriesru:"Wildberries",vtnrf0wmmailru:"Wmmail.ru",vtnrf0worldoftanksru:"World of Tanks",vtnrf0yourclotheseu:"Boutique.ru"},n={by_abc:function(e,o){return e instanceof ns.Model&&(e=e.getData()),o instanceof ns.Model&&(o=o.getData()),e.name.toLowerCase().localeCompare(o.name.toLowerCase())
},by_count:function(e,o){return e instanceof ns.Model&&(e=e.getData()),o instanceof ns.Model&&(o=o.getData()),e.user||o.user?e.count===o.count?n.by_abc(e,o):o.count-e.count:-1}}}(),ns.Model.define("labels-state",{events:{"ns-model-init":"_onInit"},methods:{_onInit:function(){this.setData({isVisibleUnused:!1})},toggleVisibleUnused:function(){this.set(".isVisibleUnused",!this.isVisibleUnused())},isVisibleUnused:function(){return this.get(".isVisibleUnused")}}},ns.ModelStatic),ns.Model.define("scroller-left",{events:{"ns-model-init":"clean"},methods:{EVENT_NAME:"daria:vScrollerLeft:scroll",_getScroller:function(){return $(Daria.is2pane()?window:".js-scroller-left")
},getScrollOffset:function(){return 30}}},"scroller-common"),ns.Model.define("do-collector-remove",{params:{popid:null,fids:null}}),ns.View.define("left-col-setup-focus-mixin",{methods:{getFocusableChildren:function(){return Daria.hasFeature("new-left-column")?[this]:[]},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":this.focusAction()}},focusOn:function(){this.$node.find(".js-left-col-setup-focus-target").addClass("is-focused")
},focusOff:function(){this.$node.find(".js-left-col-setup-focus-target").removeClass("is-focused")}}}),ns.View.define("banner",{events:{"ns-page-after-load@init":"init","ns-page-after-load@show":"draw","yabs:loaded@show":"draw","daria:vThemesSelector:new-schema@show":"draw"},yateModule:"left",methods:{init:function(){this.nodeId||(this.nodeId="js-main-rtb-"+Math.random(),this.node.innerHTML='<div class="b-banner" id="'+this.nodeId+'"></div>')},draw:function(){Daria.yabs&&Daria.yabs.load(this.nodeId)
}}}),function(){var e=Daria.getCookie("broken_collector");ns.ViewCollection.edefine("collectors",{models:{collectors:{"ns-model-changed":"forceUpdate","ns-model-insert":"onCollectorsListChanged","ns-model-remove":"onCollectorsListChanged","ns-model-destroyed":"onCollectorsListChanged"},"collector-settings":!0,settings:{"ns-model-changed":!1,"ns-model-changed.no_collectors_promo":"invalidate"}},split:{byModel:"collectors",intoViews:function(e){return e.get(".email")?"collectors-item":!1}},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","daria:vCollectors:log@show":"_log","daria:vCollectors:setBrokenCollectorCookie@show":"_setBrokenCollectorCookie","daria:vCollectors:showPopupAboutCreate@show":"_showPopupAboutCreate","daria:vCollectors:update@show":"forceUpdate"},yateModule:"left",methods:{Metrika:"Промо сборщиков",onShow:function(){this._cmBaseBindMenuableElements({$node:this.$node,selector:".js-context-menu-target"})
},onHide:function(){this._cmBaseUnbindMenuableElements()},onHtmlInit:function(){var o=this.$node.find(".js-collector-unactive"),t=o.first().next();this.$warnings=o.next(),t.length&&(e?this.$warnings.removeClass("g-hidden").each(function(){Jane.c(["Неработающий сборщик","показ полоски слева"])}):window.setTimeout(function(){ns.action.run("collector.warning",t)},100))},onCollectorsListChanged:function(){this.invalidate(),this.forceUpdate()},_log:function(o,t){Jane.c(e?["Неработающий сборщик","клик на полоску",t]:["Неработающий сборщик",t])
},_showPopupAboutCreate:function(e,o){this.update().then(function(){var e=this.$node.find('.js-collectors-item[data-email="'+o.email+'"]');if(e.length){var t=225,r=e.offset().top+e.height()/2-$(window).scrollTop();Daria.Dialog.open({title:"Ящик подключен к Яндекс.Почте",body:"<p>Копирование писем из ящика "+o.email+" начнётся в&#160;течение&#160;10&#160;минут.</p><p>Вы сможете в любой момент увидеть все письма из указанного ящика, нажав на эту метку.</p>",onTarget:{x:t,y:r,side:"left",pos:"bottom"},width:455})
}},this)},_setBrokenCollectorCookie:function(){this.$warnings.first().hasClass("g-hidden")&&(this.$warnings.removeClass("g-hidden").each(function(){Jane.c(["Неработающий сборщик","показ полоски слева"])}),Daria.setCookie("broken_collector","1",30))},getFocusableChildren:function(){return Daria.nsTreeWalker.getViewsChildren(this)}}},"context-menu-mixin-collectors",ns.ViewCollection)}(),ns.View.define("collectors-item",{models:{collector:"keepValid","collector-settings":"keepValid"},params:{popid:null},yateModule:"left",methods:{onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();
break;case"blur":this.focusOff();break;case"enter":this.open()}},open:function(){var e=this.getModel("collector").get(".info");ns.page.go(ns.router.generateUrl("messages",{request:e,scope:"rpopinfo",search:"search"}))},focusOn:function(){this.$node.find(".js-collectors-item").addClass("mail-CollectorsList-Item_focus")},focusOff:function(){this.$node.find(".js-collectors-item").removeClass("mail-CollectorsList-Item_focus")}}}),ns.View.edefine("collectors-setup",{events:{"click@show .js-open-promo":"onClickOpenPromo"},models:{collectors:"invalidate"},yateModule:"left",methods:{onClickOpenPromo:function(e){var o=ns.parseQuery(e.currentTarget.getAttribute("data-params"));
return Daria.openCollectorPopup(o),!1},focusAction:function(){Daria.openCollectorPopup({from:"addbutton"})}}},"left-col-setup-focus-mixin",ns.View),ns.View.define("folder",{events:{"ns-view-init":"onInit","click@show .js-folder-mark-all-read":"onClickMarkAllRead","click@show .js-switch-open":"onClickSwitchFolded","click@show .js-folder-info-link":"onClickInfoLink"},models:{folder:{"ns-model-changed":"onFolderModelChanged","ns-model-changed.folded":"onFolderModelChanged"},settings:{"ns-model-changed":!1,"ns-model-changed.hide_empty_folders":"forceUpdate"}},yateModule:"left",methods:{onInit:function(){this._folderId=this.params.fid
},onFolderModelChanged:function(e,o){return"ns-model-changed.folded"===e?void this.$node.toggleClass("is-folded",this.getModel("folder").isFolded()):void(".folded"!==o&&this.forceUpdate())},onClickSwitchFolded:function(){return this.switchFolded(),!1},onClickMarkAllRead:function(e){e.preventDefault(),e.stopPropagation(),nb.trigger("popup-close"),Daria.Dialog.close(),ns.Model.get("settings").isSet("no_popup_mark_read")?Daria.Folder.markRead(this.params.fid):this.showMarkAllReadPopup(this.params.fid)
},onClickInfoLink:function(e){ns.events.trigger("daria:vMessages:recalculate"),e.stopPropagation()},showMarkAllReadPopup:function(e){var o={withoutTail:!0,autofocus:!0,autoclose:!0,where:this.$node,how:{my:"left bottom",at:"right-105px top"}};this._popup||(this._popup=nb.block(ns.renderNode({},"mark-all-as-read-dialog-popup","left")),this._popup.on("nb-closed",function(){this.off("click .js-apply-mark-read"),this.off("click .js-cancel-mark-read"),this.off("click .js-always-mark-read")})),this._popup.on("click .js-apply-mark-read",this.onMarkAllAsReadPopupClose.bind(this,e)),this._popup.on("click .js-cancel-mark-read",this.onMarkAllAsReadPopupClose.bind(this)),this._popup.open(o)
},onMarkAllAsReadPopupClose:function(e){var o=this._popup.$node.find("input[name=js-always-mark-all-read]");o.prop("checked")&&ns.Model.get("settings").setSettingOn("no_popup_mark_read"),e&&Daria.Folder.markRead(e),this._popup.close()},switchFolded:function(){this.getModel("folder").switchFolded()},open:function(){ns.page.go(ns.router.generateUrl("messages",{current_folder:this.params.fid}))},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;
case"space":this.switchFolded();break;case"enter":this.open()}},focusOn:function(){this.$node.addClass("mail-FolderList-Item_focus")},focusOff:function(){this.$node.removeClass("mail-FolderList-Item_focus")},getParentReferenceParams:function(){var e=ns.Model.get("folder",{fid:this._folderId});if(e){var o=e.getParent();return o&&o.isFolded()?{params:{fid:o.params.fid}}:void 0}}}}),function(){ns.ViewCollection.edefine("folders",{models:{folders:{"ns-model-changed":"forceUpdate"},settings:{"ns-model-changed":"keepValid","ns-model-changed.folders_open":"forceUpdate","ns-model-changed.hide_empty_folders":"forceUpdate"}},split:{byModel:"folders",intoLayouts:function(e){var o=this.getModel("settings"),t=e.get(".symbol");
if("outbox"===t&&0===e.get(".count"))return!1;if(!e.isOpen())return!1;if(o.isSet("hide_empty_folders")){var r=_.includes(["inbox","draft","outbox","sent","template","trash","spam","archive"],t);return r||e.get(".has-unread")||e.hasUnreads()?"folder":!1}return"folder"}},events:{"ns-view-htmldestroy":"_onNsViewHtmldestroy","ns-view-hide":"_onNsViewHide","ns-view-show":"_onNsViewShow","ns-view-touch":"_onNsViewTouch","daria:folders.move:done@show":"_onUpdate","daria:vFolders:update@show":"_onUpdate","daria:folder-remove-done@show":"_onUpdate","dragndrop.dragenter@show":"_onDragEnter","dragndrop.drop@show":"_onDrop","click@show .js-folders-item":"_onClickFoldersItem"},yateModule:"left",ctor:function(){Modernizr.testProp("order")&&this.initAds()
},methods:{CLASS_CURRENT:"mail-NestedList-Item_current",CLASS_UPDATED:"mail-NestedList-Item_updated",CLASS_CLOSED:"is-folded",CLASS_JS_NESTING:"js-folders-nesting",CLASS_JS_NESTING_INBOX:"js-folders-nesting-inbox",CLASS_JS_ITEM:"js-folders-item",CLASSES_FOLDERS_GROUP:"mail-FolderList mail-NestedList js-folders",CLASS_FAKE_FOLDER_GROUP:"mail-FolderList_fake",_onNsViewShow:function(){this._cmBaseBindMenuableElements({$node:this.$node,selector:"."+this.CLASS_JS_ITEM}),Modernizr.testProp("order")&&this.startAds()
},_onNsViewHide:function(){this._cmBaseUnbindMenuableElements(),this.stopAds()},_onNsViewHtmldestroy:function(){this.focus&&(this.focus.destroy(),this.focus=null)},_onNsViewTouch:function(){this.adNodes&&this.attachAdNodes(this.adNodes);var e=ns.page.current.params,o=this._getFolderIdByParams(e);if(this.selected&&this.selected!==o&&this._getItemNodeByFid(this.selected).removeClass(this.CLASS_CURRENT),o){var t=this.getModel("folders");this._getItemNodeByFid(o).addClass(this.CLASS_CURRENT).removeClass(this.CLASS_UPDATED);
var r=t.getFolderById(o);r&&ns.Model.get("reset-unvisited",{fid:r.fid}).resetUnvisited().then(function(e){e&&"recent"in r&&delete r.recent}),this.selected=o}},getAds:function(){var e=this.getAdsModel();return e.getLeftColAds()},getAdNodes:function(e){var o=this,t=e.map(function(e){return o.getAdsNode(e)});return t},getAdStyleNode:function(e){var o={},t=this;e.forEach(function(e,r){if(!(r>2)){var n=r+1,a=t.getAdStyleVars(e,n);for(var i in a)o["\\${"+n+"_"+i+"}"]=a[i]}});var r,n=ns.tmpl({},"left-col-ad-style","left"),a=n.textContent;
for(var i in o)r=new RegExp(i,"gm"),a=a.replace(r,o[i]);return n.textContent=a,n},attachAdNodes:function(e){var o=3;this._getFakeFolderGroups().remove(),e.length<o&&(e=e.concat(this._createFakeFolderNodesRange(o-e.length))),this.$node.parent().prepend(e)},createAdMapping:function(e){var o=[{url:e.url,title:e.title},{url:e.url,title:e.domain},{url:e.url,title:e.body}];return Array.isArray(e.sitelinks)&&Array.prototype.push.apply(o,e.sitelinks),e.vcardUrl&&o.push({url:e.vcardUrl,title:"Адрес и телефон"}),e.region&&o.push({url:e.url,title:e.region}),o
},getAdsNode:function(e){var o=ns.tmpl(e,"left-col-ad","left"),t=this.createAdMapping(e);return t.forEach(function(t){var r=_.assign(t,{adId:e.adId}),n=ns.tmpl(r,"left-col-ad-field","left");t.url&&Jane.DOM.setUrlClickHandler(n,t.url),o.appendChild(n)}),Jane.DOM.preventClicks(o),o},getAdStyleVars:function(e,o){var t=4,r=0;Array.isArray(e.sitelinks)&&(r=e.sitelinks.length);var n=0;e.region&&n++,e.vcardUrl&&n++;var a=t+r,i=a+n,s={image:e.leftColImage?o:0,favicon:e.domain?o:0,image_url:e.leftColImage||"",favicon_url:e.domain?"//favicon.yandex.net/favicon/"+e.domain:"",greenlinks:a,lastlink:i-1,hidden:i};
return s},_getItemNode:function(e){return $(e).closest("."+this.CLASS_JS_ITEM)},_createFakeFolderNode:function(){var e=this.CLASSES_FOLDERS_GROUP+" ns-view-container-desc ns-view-folders ns-view-id-"+_.random(1e3,5e3)+" "+this.CLASS_FAKE_FOLDER_GROUP;return $("<div/>",{"class":e,"data-key":"view=folders"})},_createFakeFolderNodesRange:function(e){for(var o=[],t=0;e>t;++t)o.push(this._createFakeFolderNode());return o},_getFakeFolderGroups:function(){return this.$node.parent().find("."+this.CLASS_FAKE_FOLDER_GROUP)
},_getItemNodeByFid:function(e){return this.$node.find(".fid-"+e)},_onClickFoldersItem:function(e){var o=$(e.currentTarget).hasClass(this.CLASS_CURRENT);return o&&Jane.c("Левая колонка",Daria.is2pane()?"2pane":"3pane","Список папок","Текущая папка пользователя","Клик"),Daria.is3pane()?!0:Daria.messages.params4SimplePath(ns.page.current.params)?(o&&ns.page.go(Jane.Page.generateUrl.closeMessage()),o||ns.events.trigger("daria:vFolders:folder-transition"),!0):!0},_onDragEnter:function(e,o){var t=this._getItemNode(o.currentTarget);
this._timer=setTimeout(function(){t.removeClass(this.CLASS_CLOSED),ns.Model.get("folder",{fid:o.fid}).switchFolded(!1)},300)},_onDrop:function(){this._timer&&clearTimeout(this._timer)},_onUpdate:function(){this.forceUpdate()},_getFolderIdByParams:function(e){var o,t=this.getModel("folders");if(!e.search&&"search"!==ns.page.current.page){if("message"==ns.page.current.page&&e.ids)o=ns.Model.get("message",{ids:e.ids}).getFolderId();else if("compose2"==ns.page.current.page&&e.ids){var r=ns.Model.get("message",{ids:e.ids}).getFolderId(),n=Daria.array2obj([t.getFidBySymbol("outbox"),t.getFidBySymbol("draft"),t.getFidBySymbol("template")]);
r in n&&(o=r)}else o=e.current_folder;if(Daria.is3pane()&&!o){var a=e.ids||e.thread_id;a&&(o=ns.Model.get("message",{ids:a}).getFolderId())}return o}},getFocusableChildren:function(){return Daria.nsTreeWalker.getViewsChildren(this)}}},"context-menu-mixin-folders","ads-mixin",ns.ViewCollection)}(),ns.View.edefine("folders-setup",{yateModule:"left",events:{"click .js-folders-setup-add":"addFolder"},methods:{focusAction:function(){this.addFolder()},addFolder:function(){ns.action.run("folders.add",{"only-create":1})
}}},"left-col-setup-focus-mixin",ns.View),ns.View.define("informer-news",{models:{"informer-news":!0,settings:{"ns-model-changed":!1,"ns-model-changed.color_scheme":"onChangeTheme"}},events:{"ns-view-show":"toggleCopyright"},methods:{onChangeTheme:function(){this.keepValid(),this.toggleCopyright()},toggleCopyright:function(){var e=!!ns.Model.get("theme-"+Daria.getThemeId()).get(".copyright"),o=ns.Model.get("themes").getCurrentTheme().hasSkinSaver(),t=!e&&!o;this.$node.toggleClass("mail-Informer-News_with-gap",t)
}},yateModule:"left"}),ns.View.define("messages-filters",{models:{"messages-filters":{"ns-model-changed":"forceUpdate"}},yateModule:"left"}),ns.View.define("messages-filters-focus-mixin",{methods:{getFocusableChildren:function(){return[this]},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":this.open()}},focusOn:function(){this.$node.find(".js-labels-item").addClass("mail-LabelList-Item_focus")},focusOff:function(){this.$node.find(".js-labels-item").removeClass("mail-LabelList-Item_focus")
}}}),ns.View.edefine("messages-filters-wait",{models:{"messages-filters":!0,labels:{"ns-model-changed":"forceUpdate"},folders:{"ns-model-changed":"forceUpdate"}},yateModule:"left",methods:{open:function(){var e=ns.Model.get("labels"),o=e.getLabelByName("remindme_threadabout:mark");ns.page.go(ns.router.generateUrl("messages",{current_label:o.lid}))}}},"messages-filters-focus-mixin",ns.View),ns.View.edefine("messages-filters-important",{models:{"messages-filters":!0,labels:{"ns-model-changed":"forceUpdate"},folders:{"ns-model-changed":"forceUpdate"}},yateModule:"left",methods:{open:function(){ns.page.go(ns.router.generateUrl("messages",{important:"important"}))
}}},"messages-filters-focus-mixin",ns.View),ns.View.edefine("messages-filters-unread",{models:{"messages-filters":!0,labels:{"ns-model-changed":"forceUpdate"},folders:{"ns-model-changed":"forceUpdate"}},yateModule:"left",methods:{open:function(){ns.page.go(ns.router.generateUrl("messages",{unread:"unread"}))}}},"messages-filters-focus-mixin",ns.View),ns.View.edefine("messages-filters-attachments",{models:{"messages-filters":!0,labels:{"ns-model-changed":"forceUpdate"},folders:{"ns-model-changed":"forceUpdate"}},yateModule:"left",methods:{open:function(){ns.page.go(ns.router.generateUrl("messages",{attachments:"attachments"}))
}}},"messages-filters-focus-mixin",ns.View),function(){ns.ViewCollection.edefine("labels",{models:{labels:{"ns-model-changed":"onModelLabelsChanged"},"labels-state":{"ns-model-changed":"keepValid","ns-model-changed.isVisibleUnused":"forceUpdate"}},split:{byModel:"labels",intoViews:function(e){if(e.get(".user")){var o=this.getModel("labels-state").isVisibleUnused();Daria.resize.isWithCompactLeftColumn&&(o=!1);var t=e.get(".lid")===ns.page.current.params.current_label;if(o||t||!o&&!e.get(".unused"))return"label"
}return!1}},events:{"ns-view-show":"onShow","ns-view-hide":"onHide","daria:vLabels:update@show":"forceUpdate","daria:label-remove-done@show":"forceUpdate"},yateModule:"left",methods:{onShow:function(){this._cmBaseBindMenuableElements({$node:this.$node,selector:".js-labels-item"})},onHide:function(){this._cmBaseUnbindMenuableElements()},onModelLabelsChanged:function(){var e=this.getModel("labels");e.sortLabels(e.models),this.forceUpdate()},getFocusableChildren:function(){return Daria.nsTreeWalker.getViewsChildren(this)
}}},"context-menu-mixin-labels",ns.ViewCollection)}(),ns.View.define("label",{events:{"ns-page-after-load":"onAfterPageLoad"},models:{label:"forceUpdate"},params:{lid:null},yateModule:"left",methods:{onAfterPageLoad:function(){var e=ns.page.current.params,o=this.params.lid===e.current_label;this.$node.find(".js-labels-item ").toggleClass("is-checked",o)},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":this.open()}},open:function(){ns.page.go(ns.router.generateUrl("messages",{current_label:this.params.lid}))
},focusOn:function(){this.$node.find(".js-labels-item").addClass("mail-LabelList-Item_focus")},focusOff:function(){this.$node.find(".js-labels-item").removeClass("mail-LabelList-Item_focus")}}}),ns.View.edefine("labels-setup",{models:{labels:{"ns-model-changed":"keepValid","ns-model-remove":"forceUpdate"},"labels-state":{"ns-model-changed":"keepValid"}},events:{"click .js-labels-setup-add":"addLabel","click@show .js-hidden-labels-toggler":"onClickHiddenLabelsToggler"},yateModule:"left",methods:{onClickHiddenLabelsToggler:function(){this.getModel("labels-state").toggleVisibleUnused()
},focusAction:function(){this.addLabel()},addLabel:function(){ns.action.run("labels.add",{"only-create":1})}}},"left-col-setup-focus-mixin",ns.ViewRivets),ns.View.define("left-col-toolbar",{events:{"click .js-left-col-toolbar-compose":"onComposeClick","click .js-left-col-toolbar-refresh":"_refreshMetrika"},yateModule:"left",methods:{onComposeClick:function(e){this._composeMetrika(),e.ctrlKey||e.metaKey&&Modernizr.mac||"compose2"===ns.page.current.page&&(e.preventDefault(),e.stopPropagation(),ns.events.trigger("daria:vLeftColToolbar:composeClick"))
},_composeMetrika:function(){Jane.c("Toolbar",Daria.Metric.getPath(),Daria.is2pane()?"2pane":"3pane","написать","клик")},_refreshMetrika:function(){Jane.c("Toolbar",Daria.Metric.getPath(),Daria.is2pane()?"2pane":"3pane","проверить","клик")}}}),ns.View.edefine("skin-saver",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-page-before-load@show":"onPageBeforeLoad","click .js-preview-skin":"togglePreviewMode","daria:vSkinSaver:rotateSkin@show":"forceUpdate"},models:{settings:{"ns-model-changed":"onSettingsChanged","ns-model-changed.color_scheme":"forceUpdate"},"skin-saver-state":{"ns-model-changed":!1,"ns-model-changed.previewMode":"forceUpdate"}},yateModule:"left",methods:{onShow:function(){var e=this.getModel("skin-saver-state");
this.togglePageScroll(!e.isPreviewMode()),this.nbCheckbox=nb.$block(".js-save-skin",this.$node),this.nbCheckbox&&this.nbCheckbox.on("nb-changed",this.onCheckboxChange.bind(this))},onHide:function(){this.togglePageScroll(!0),this.nbCheckbox&&this.nbCheckbox.off("nb-changed")},togglePageScroll:function(e){var o=["DOMMouseScroll","mousewheel","scroll"];o.forEach(function(o){window.removeEventListener(o,this.preventScroll),e||window.addEventListener(o,this.preventScroll)},this)},preventScroll:function(e){e.stopPropagation(),e.preventDefault();
var o=ns.Model.get("skin-saver-state"),t=o.get(".scrollTop");$("body").scrollTop(t)},onCheckboxChange:function(){var e=ns.Model.get("themes").getCurrentTheme();this.isSaved()?e.removeSavedSkin():(e.saveCurrentSkin(),Jane.c(["Выпадушка тем","оставить этот фон"]))},isSaved:function(){return ns.Model.get("themes").getCurrentTheme().currentSkinIsSaved()},togglePreviewMode:function(){var e=this.getModel("skin-saver-state"),o=!e.isPreviewMode();this.togglePageScroll(!o),e.set(".scrollTop",$("body").scrollTop()),e.togglePreviewMode(o),o&&Jane.c(["Выпадушка тем","показать фон"])
},onSettingsChanged:function(e,o){o=o||"",/-skin$/.test(o)&&this.forceUpdate()},hasPreview:function(){return ns.Model.get("themes").getCurrentTheme().hasPreview()},getSkinText:function(){var e=ns.Model.get("themes").getCurrentTheme();return"love_is"!==e.get(".data.name")?e.getSkinText():void 0},onPageBeforeLoad:function(e,o){if(!_.isEqual(o[0],o[1])){var t=this.getModel("skin-saver-state");t.isPreviewMode()&&(t.togglePreviewMode(!1),window.history.forward())}}}}),function(){var e=ns.Model.get("folders");
yr.externals["has-user-folders"]=function(){return e.hasUserFolders()}}()});