Jane.module("jane.noscript.js",function(){var t={};!function(){function e(t){return t.replace(/&/g,"&amp;")}function n(t){Array.isArray(t)&&(t={item:t}),this.root={data:t,parent:null,name:"",doc:this},this._vars={},this._keys={}}t.log=function(){};var r={},i=/&/g,o=/</g,s=/>/g,a=/"/g,u=/&amp;/g,l=/&lt;/g,c=/&gt;/g;t.text2xml=function(t){return null==t?"":(""+t).replace(i,"&amp;").replace(o,"&lt;").replace(s,"&gt;")},t.xml2text=function(t){return null==t?"":(""+t).replace(l,"<").replace(c,">").replace(u,"&")
},t.text2attr=function(t){return null==t?"":(""+t).replace(i,"&amp;").replace(a,"&quot;").replace(o,"&lt;").replace(s,"&gt;")},t.xml2attr=function(t){return null==t?"":(""+t).replace(a,"&quot;").replace(o,"&lt;").replace(s,"&gt;")},t.register=function(e,n){if(t.isRegistered(e))throw Error('Module "'+e+'" already exists');for(var i=n.imports||[],o=[n],s=0,a=i.length;a>s;s++){var u=r[i[s]];if(!u)throw Error('Module "'+i[s]+"\" doesn't exist");o=o.concat(u.imports)}n.imports=o,r[e]=n},t.isRegistered=function(t){return!!r[t]
},t.run=function(t,e,i){i=i||"";var o=r[t];if(!o)throw'Module "'+t+'" is undefined';var s=new n(e),a=o.a(o,0,[s.root],i,{a:{}});return a},t.join=function(t,e){return t.concat(e)},t.nodeValue=function(t){var e=t.data;return"object"==typeof e?"":e},t.nodeName=function(t){var e=t[0];return e?e.name:""},t.simpleScalar=function(e,n){var r=n.data;if(!r)return"";if("*"===e){for(var i in r)return t.simpleScalar(i,n);return""}var o=r[e];return"object"==typeof o?"":void 0===o?"":o},t.simpleBoolean=function(e,n){var r=n.data;
if(!r)return!1;if("*"===e){for(var i in r){var o=t.simpleBoolean(i,n);if(o)return!0}return!1}var o=r[e];return o?Array.isArray(o)?o.length:!0:!1},t.nodeset2scalar=function(t){if(!t.length)return"";var e=t[0].data;return"object"==typeof e?"":e},t.nodeset2boolean=function(t){return t&&t.length>0?!!t[0].data:!1},t.nodeset2xml=function(e){return t.scalar2xml(t.nodeset2scalar(e))},t.nodeset2attrvalue=function(e){return t.scalar2attrvalue(t.nodeset2scalar(e))},t.scalar2xml=t.text2xml,t.xml2scalar=t.xml2text,t.xml2attrvalue=t.xml2attr,t.scalar2attrvalue=t.text2attr,t.object2nodeset=function(t){return[new n(t).root]
},t.array2nodeset=function(t){var e={item:t};return[new n(e).root]},t.cmpSN=function(e,n){for(var r=0,i=n.length;i>r;r++)if(e==t.nodeValue(n[r]))return!0;return!1},t.cmpNN=function(e,n){var r=n.length;if(0===r)return!1;if(1===r)return t.cmpSN(t.nodeValue(n[0]),e);for(var i=[],o=t.nodeValue(n[0]),s=0,a=e.length;a>s;s++){var u=t.nodeValue(e[s]);if(u==o)return!0;i[s]=u}for(var l=1;r>l;l++){o=t.nodeValue(n[l]);for(var s=0,a=e.length;a>s;s++)if(i[s]==o)return!0}return!1},t.shortTags={br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,wbr:!0},t.closeAttrs=function(e){var n=e.s;
if(n){var r="",i=e.a;for(var o in i)r+=" "+o+'="'+i[o].quote()+'"';return r+=t.shortTags[n]?"/>":">",e.s=null,r}return""},t.copyAttrs=function(t,e){for(var n in e)t[n]=e[n]},t.scalarAttr=function(t){this.s=null==t?"":""+t},t.scalarAttr.prototype.quote=function(){return t.text2attr(this.s)},t.scalarAttr.prototype.addxml=function(n){return new t.xmlAttr(e(this.s)+n)},t.scalarAttr.prototype.addscalar=function(e){return new t.scalarAttr(this.s+e)},t.xmlAttr=function(t){this.s=null==t?"":""+t},t.xmlAttr.prototype.quote=function(){return t.xml2attr(this.s)
},t.xmlAttr.prototype.addscalar=function(n){return new t.xmlAttr(this.s+e(n))},t.slice=function(t,e,n){return t=""+t,n?t.slice(e,n):t.slice(e)},t.exists=function(t){return t.length>0},t.grep=function(t,e){for(var n=[],r=0,i=t.length;i>r;r++){var o=t[r];e(o,r,i)&&n.push(o)}return n},t.byIndex=function(t,e){return t.slice(e,e+1)},t.sort=function(t,e,n){for(var r=[],i=0,o=t.length;o>i;i++){var s=t[i],a=e(s,i,o);r.push({node:s,value:a})}for(var u=n?-1:1,l=n?1:-1,c=r.sort(function(t,e){var n=t.value,r=e.value;
return r>n?l:n>r?u:0}),f=[],i=0,o=c.length;o>i;i++)f.push(c[i].node);return f},t.nodeset2data=function(t){var e=t.length;if(0===e)return"";if(1===e)return t[0].data;for(var n=[],r=0;e>r;r++)n.push(t[r].data);return n},t.externals={};var f=function(){};f.prototype.a=function(t,e,n,r,i){var o,s="";arguments.length>5&&(o=Array.prototype.slice.call(arguments,5));for(var a=t.imports,u=0,l=n.length;l>u;u++){for(var c,f,p=n[u],h=!1,d=e,v=a.length;!h&&v>d;){c=a[d++];var y=c.matcher[r];if(y){var g=y[p.name]||y["*"];
if(g)for(var _=0,m=g.length;!h&&m>_;){var w=g[_++];f=c[w];var b=f.j;if(b)c.matched(b,f.a,p,u,l)&&(h=w);else for(var x=f.s,V=f.a,E=0,M=x.length;M>E;E++)if(c.matched(x[E],V[E],p,u,l)){h=w;break}}}}h&&(s+=o?f.apply(t,[t,p,u,l,i].concat(o)):f(t,p,u,l,i))}return s},f.prototype.matched=function(t,e,n,r,i){if(1===t)return!n.parent;for(var o=t.length,s=o-2;s>=0;){if(!n)return!1;var a=t[s];switch(a){case 0:var u=t[s+1];if("*"!==u&&u!==n.name)return!1;n=n.parent;break;case 2:case 4:var l=t[s+1];if(!l(this,n,r,i))return!1
}s-=2}return e&&n.parent?!1:!0},f.prototype.s=function(t,e){return this.n(t,[e])},f.prototype.n=function(e,n){for(var r,i=n,o=i.length,s=0,a=e.length;a>s;s+=2){r=[];var u=e[s],l=e[s+1];switch(u){case 0:for(var c=0;o>c;c++)t.selectNametest(l,i[c],r);break;case 1:for(var c=0;o>c;c++){for(var f=0,p=i[c];l>f&&p;)p=p.parent,f++;p&&r.push(p)}break;case 2:for(var c=0;o>c;c++){var p=i[c];l(this,p,c,o)&&r.push(p)}break;case 3:var p=i[l];r=p?[p]:[];break;case 4:if(o>0){var p=i[0];l(this,p.doc.root,0,1)&&(r=r.concat(i))
}}if(i=r,o=i.length,!o)return[]}return r},t.selectNametest=function(e,n,r){var i=n.data;if(!i||"object"!=typeof i)return r;if("*"===e){if(Array.isArray(i))for(var o=0,s=i.length;s>o;o++)t.selectNametest(o,n,r);else for(e in i)t.selectNametest(e,n,r);return r}if(i=i[e],void 0===i)return r;var a=n.doc;if(Array.isArray(i))for(var o=0,s=i.length;s>o;o++)r.push({data:i[o],parent:n,name:e,doc:a});else r.push({data:i,parent:n,name:e,doc:a});return r},t.document=function(t){var e;return e=new n(t.length?t[0].data:{}),[e.root]
},t.subnode=function(t,e,n){var r=n.doc;if(Array.isArray(e)){for(var i=[],o=0,s=e.length;s>o;o++)i.push({data:e[o],name:t,parent:n,doc:r});return i}return[{data:e,name:t,parent:n,doc:r}]},f.prototype.v=function p(t,e){var p=e.doc._vars,n=p[t];if(void 0===n){var r=this.findSymbol(t);n="function"==typeof r?r(this,e,0,1):r,p[t]=n}return n},f.prototype.f=function(t,e,n,r,i){var o=this.findSymbol(t);if(arguments.length>5){var s=Array.prototype.slice.call(arguments);return s[0]=this,o.apply(this,s)}return void 0!==i?o(this,e,n,r,i):o(this,e,n,r)
},f.prototype.k=function h(e,n,r,i){function o(t){var e,n=l[t];if(a.xml){if(e="",n)for(var r=0,i=n.length;i>r;r++){var o=n[r];e+=s.b(c,o.c,o.i,o.l,{})}}else if(e=[],n)for(var r=0,i=n.length;i>r;r++){var o=n[r];e=e.concat(s.b(c,o.c,o.i,o.l))}return u[t]=e,e}var h=r.doc._keys,s=this.findSymbol(e),a=h[e];a||(a=this._initKey(s,e,n,r));var u=a.values,l=a.nodes,c=this;if(i){var f;if(a.xml){f="";for(var p=0,d=n.length;d>p;p++){var r=n[p];f+=o(t.nodeValue(r))}}else{f=[];for(var p=0,d=n.length;d>p;p++){var r=n[p];
f=f.concat(o(t.nodeValue(r)))}}return f}var v=u[n];return void 0===v&&(v=o(n)),v},f.prototype._initKey=function(e,n,r,i){function o(t,e){var n=l[t];n||(n=l[t]=[]),n.push(e)}var s=i.doc._keys,a=s[n]={};a.xml="xml"===e.bt;var u=e.n(this,i),l=a.nodes={};if("nodeset"===e.ut)for(var c=0,f=u.length;f>c;c++)for(var p=u[c],h=e.u(this,p,c,f),d=0,v=h.length;v>d;d++)o(t.nodeValue(h[d]),{c:p,i:c,l:f});else for(var c=0,f=u.length;f>c;c++){var p=u[c],h=e.u(this,p,c,f);o(h,{c:p,i:c,l:f})}return a.values={},a},f.prototype.findSymbol=function(t){for(var e=this.imports,n=0,r=e.length;r>n;n++){var i=e[n],o=i[t];
if(void 0!==o)return o}},t.Module=f}(),"undefined"!=typeof module&&(module.exports=t),function(t){var e,n=function(){var e=[],n=function(t){return e.push(t),1===e.length},r=function(){var t=e,n=0,r=e.length;for(e=[];r>n;)t[n++]()};if("function"==typeof setImmediate)return function(t){n(t)&&setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(t){n(t)&&process.nextTick(r)};var i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=1,s=document.createTextNode("");return new i(r).observe(s,{characterData:!0}),function(t){n(t)&&(s.data=o*=-1)
}}if(t.postMessage){var a=!0;if(t.attachEvent){var u=function(){a=!1};t.attachEvent("onmessage",u),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",u)}if(a){var l="__promise"+Math.random()+"_"+new Date,c=function(t){t.data===l&&(t.stopPropagation&&t.stopPropagation(),r())};return t.addEventListener?t.addEventListener("message",c,!0):t.attachEvent("onmessage",c),function(e){n(e)&&t.postMessage(l,"*")}}}var f=t.document;if("onreadystatechange"in f.createElement("script")){var p=function(){var t=f.createElement("script");
t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,r()},(f.documentElement||f.body).appendChild(t)};return function(t){n(t)&&p()}}return function(t){n(t)&&setTimeout(r,0)}}(),r=function(t){n(function(){throw t})},i=function(t){return"function"==typeof t},o=function(t){return null!==t&&"object"==typeof t},s=Object.prototype.toString,a=Array.isArray||function(t){return"[object Array]"===s.call(t)},u=function(t){for(var e=[],n=0,r=t.length;r>n;)e.push(n++);return e
},l=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},c=function(t){var e=function(e){this.name=t,this.message=e};return e.prototype=new Error,e},f=function(t,e){return function(n){t.call(this,n,e)}},p=function(){this._promise=new d};p.prototype={promise:function(){return this._promise},resolve:function(t){this._promise.isResolved()||this._promise._resolve(t)},reject:function(t){this._promise.isResolved()||(g.isPromise(t)?(t=t.then(function(t){var e=g.defer();
return e.reject(t),e.promise()}),this._promise._resolve(t)):this._promise._reject(t))},notify:function(t){this._promise.isResolved()||this._promise._notify(t)}};var h={PENDING:0,RESOLVED:1,FULFILLED:2,REJECTED:3},d=function(t){if(this._value=e,this._status=h.PENDING,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[],t){var n=this,r=t.length;t(function(t){n.isResolved()||n._resolve(t)},r>1?function(t){n.isResolved()||n._reject(t)}:e,r>2?function(t){n.isResolved()||n._notify(t)
}:e)}};d.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==h.PENDING},isFulfilled:function(){return this._status===h.FULFILLED},isRejected:function(){return this._status===h.REJECTED},then:function(t,e,n,r){var i=new p;return this._addCallbacks(i,t,e,n,r),i.promise()},"catch":function(t,n){return this.then(e,t,n)},fail:function(t,n){return this.then(e,t,n)},always:function(t,e){var n=this,r=function(){return t.call(this,n)};return this.then(r,r,e)},progress:function(t,n){return this.then(e,e,t,n)
},spread:function(t,e,n){return this.then(function(e){return t.apply(this,e)},e,n)},done:function(t,e,n,i){this.then(t,e,n,i).fail(r)},delay:function(t){var e,n=this.then(function(n){var r=new p;return e=setTimeout(function(){r.resolve(n)},t),r.promise()});return n.always(function(){clearTimeout(e)}),n},timeout:function(t){var e=new p,n=setTimeout(function(){e.reject(new g.TimedOutError("timed out"))},t);return this.then(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise().always(function(){clearTimeout(n)
}),e.promise()},_vow:!0,_resolve:function(t){if(!(this._status>h.RESOLVED)){if(t===this)return void this._reject(TypeError("Can't resolve promise with itself"));if(this._status=h.RESOLVED,t&&t._vow)return void(t.isFulfilled()?this._fulfill(t.valueOf()):t.isRejected()?this._reject(t.valueOf()):t.then(this._fulfill,this._reject,this._notify,this));if(o(t)||i(t)){var e;try{e=t.then}catch(n){return void this._reject(n)}if(i(e)){var r=this,s=!1;try{e.call(t,function(t){s||(s=!0,r._resolve(t))},function(t){s||(s=!0,r._reject(t))
},function(t){r._notify(t)})}catch(n){s||this._reject(n)}return}}this._fulfill(t)}},_fulfill:function(t){this._status>h.RESOLVED||(this._status=h.FULFILLED,this._value=t,this._callCallbacks(this._fulfilledCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=e)},_reject:function(t){this._status>h.RESOLVED||(this._status=h.REJECTED,this._value=t,this._callCallbacks(this._rejectedCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=e)
},_notify:function(t){this._callCallbacks(this._progressCallbacks,t)},_addCallbacks:function(t,n,r,o,s){r&&!i(r)?(s=r,r=e):o&&!i(o)&&(s=o,o=e);var a;this.isRejected()||(a={defer:t,fn:i(n)?n:e,ctx:s},this.isFulfilled()?this._callCallbacks([a],this._value):this._fulfilledCallbacks.push(a)),this.isFulfilled()||(a={defer:t,fn:r,ctx:s},this.isRejected()?this._callCallbacks([a],this._value):this._rejectedCallbacks.push(a)),this._status<=h.RESOLVED&&this._progressCallbacks.push({defer:t,fn:o,ctx:s})},_callCallbacks:function(t,e){var r=t.length;
if(r){var i=this.isResolved(),o=this.isFulfilled(),s=this.isRejected();n(function(){for(var n,a,u,l=0;r>l;)if(n=t[l++],a=n.defer,u=n.fn){var c,f=n.ctx;try{c=f?u.call(f,e):u(e)}catch(p){a.reject(p);continue}i?a.resolve(c):a.notify(c)}else o?a.resolve(e):s?a.reject(e):a.notify(e)})}}};var v={cast:function(t){return g.cast(t)},all:function(t){return g.all(t)},race:function(t){return g.anyResolved(t)},resolve:function(t){return g.resolve(t)},reject:function(t){return g.reject(t)}};for(var y in v)v.hasOwnProperty(y)&&(d[y]=v[y]);
var g={Deferred:p,Promise:d,defer:function(){return new p},when:function(t,e,n,r,i){return g.cast(t).then(e,n,r,i)},fail:function(t,n,r){return g.when(t,e,n,r)},always:function(t,e,n){return g.when(t).always(e,n)},progress:function(t,e,n){return g.when(t).progress(e,n)},spread:function(t,e,n,r){return g.when(t).spread(e,n,r)},done:function(t,e,n,r,i){g.when(t).done(e,n,r,i)},isPromise:function(t){return o(t)&&i(t.then)},cast:function(t){return t&&t._vow?t:g.resolve(t)},valueOf:function(t){return t&&i(t.valueOf)?t.valueOf():t
},isFulfilled:function(t){return t&&i(t.isFulfilled)?t.isFulfilled():!0},isRejected:function(t){return t&&i(t.isRejected)?t.isRejected():!1},isResolved:function(t){return t&&i(t.isResolved)?t.isResolved():!0},resolve:function(t){var e=g.defer();return e.resolve(t),e.promise()},fulfill:function(t){var e=g.defer(),n=e.promise();return e.resolve(t),n.isFulfilled()?n:n.then(null,function(t){return t})},reject:function(t){var e=g.defer();return e.reject(t),e.promise()},invoke:function(e){var n,r=Math.max(arguments.length-1,0);
if(r){n=Array(r);for(var i=0;r>i;)n[i++]=arguments[i]}try{return g.resolve(n?e.apply(t,n):e.call(t))}catch(o){return g.reject(o)}},all:function(t){var e=new p,n=a(t),r=n?u(t):l(t),i=r.length,o=n?[]:{};if(!i)return e.resolve(o),e.promise();var s=i;return g._forEach(t,function(t,n){o[r[n]]=t,--s||e.resolve(o)},e.reject,e.notify,e,r),e.promise()},allResolved:function(t){var e=new p,n=a(t),r=n?u(t):l(t),i=r.length,o=n?[]:{};if(!i)return e.resolve(o),e.promise();var s=function(){--i||e.resolve(t)};return g._forEach(t,s,s,e.notify,e,r),e.promise()
},allPatiently:function(t){return g.allResolved(t).then(function(){var e,n,r,i,o=a(t),s=o?u(t):l(t),c=s.length,f=0;if(!c)return o?[]:{};for(;c>f;)r=s[f++],i=t[r],g.isRejected(i)?(e||(e=o?[]:{}),o?e.push(i.valueOf()):e[r]=i.valueOf()):e||((n||(n=o?[]:{}))[r]=g.valueOf(i));if(e)throw e;return n})},any:function(t){var e=new p,n=t.length;if(!n)return e.reject(Error()),e.promise();var r,i=0;return g._forEach(t,e.resolve,function(t){i||(r=t),++i===n&&e.reject(r)},e.notify,e),e.promise()},anyResolved:function(t){var e=new p,n=t.length;
return n?(g._forEach(t,e.resolve,e.reject,e.notify,e),e.promise()):(e.reject(Error()),e.promise())},delay:function(t,e){return g.resolve(t).delay(e)},timeout:function(t,e){return g.resolve(t).timeout(e)},_forEach:function(t,e,n,r,i,o){for(var s=o?o.length:t.length,a=0;s>a;)g.when(t[o?o[a]:a],f(e,a),n,r,i),++a},TimedOutError:c("TimedOut")},_=!0;"object"==typeof module&&"object"==typeof module.exports&&(module.exports=g,_=!1),"object"==typeof modules&&i(modules.define)&&(modules.define("vow",function(t){t(g)
}),_=!1),"function"==typeof define&&(define(function(t,e,n){n.exports=g}),_=!1),_&&(t.vow=g)}("undefined"!=typeof window?window:global),vow.Promise.prototype.__vow_reject=vow.Promise.prototype._reject,vow.Promise.prototype._reject=function(t){t instanceof Error&&ns.log.exception("promise.exception",t),this.__vow_reject(t)},window.yr=t,window.NS_IS_TOUCH=!1,function(t){var e=function(t){this._res=t,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]
};e.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(t){this.isResolved()||(this._isFulfilled=!0,this._res=t,this._callCallbacks(this._fulfilledCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=n)},reject:function(t){this.isResolved()||(this._isRejected=!0,this._res=t,this._callCallbacks(this._rejectedCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=n)
},notify:function(t){this.isResolved()||this._callCallbacks(this._progressCallbacks,t)},then:function(t,r,i,o){r&&!s(r)?(o=r,r=n):i&&!s(i)&&(o=i,i=n);var a,u=new e;return this._isRejected||(a={promise:u,fn:s(t)?t:n,ctx:o},this._isFulfilled?this._callCallbacks([a],this._res):this._fulfilledCallbacks.push(a)),this._isFulfilled||(a={promise:u,fn:r,ctx:o},this._isRejected?this._callCallbacks([a],this._res):this._rejectedCallbacks.push(a)),this.isResolved()||this._progressCallbacks.push({promise:u,fn:i,ctx:o}),u
},fail:function(t,e){return this.then(n,t,e)},always:function(t,e){var n=this,r=function(){return t.call(this,n)};return this.then(r,r,e)},progress:function(t,e){return this.then(n,n,t,e)},spread:function(t,e,n){return this.then(function(e){return t.apply(this,e)},e,n)},done:function(t,e,n,r){this.then(t,e,n,r).fail(o)},delay:function(t){var n,r=this.then(function(r){var i=new e;return n=setTimeout(function(){i.fulfill(r)},t),i});return r.always(function(){clearTimeout(n)}),r},timeout:function(t){var n=new e,r=setTimeout(function(){n.reject(Error("timed out"))
},t);return n.sync(this),n.always(function(){clearTimeout(r)}),n},sync:function(t){t.then(this.fulfill,this.reject,this.notify,this)},_callCallbacks:function(t,e){var n=t.length;if(n){var o=this.isResolved(),s=this.isFulfilled();i(function(){for(var i,a,u,l=0;n>l;)if(i=t[l++],a=i.promise,u=i.fn){var c,f=i.ctx;try{c=f?u.call(f,e):u(e)}catch(p){a.reject(p);continue}o?r.isPromise(c)?function(t){c.then(function(e){t.fulfill(e)},function(e){t.reject(e)},function(e){t.notify(e)})}(a):a.fulfill(c):a.notify(c)
}else o?s?a.fulfill(e):a.reject(e):a.notify(e)})}}};var n,r={Promise:e,promise:function(t){return arguments.length?r.isPromise(t)?t:new e(t):new e},when:function(t,e,n,i,o){return r.promise(t).then(e,n,i,o)},fail:function(t,e,i){return r.when(t,n,e,i)},always:function(t,e,n){return r.promise(t).always(e,n)},progress:function(t,e,n){return r.promise(t).progress(e,n)},spread:function(t,e,n,i){return r.promise(t).spread(e,n,i)},done:function(t,e,n,i,o){r.promise(t).done(e,n,i,o)},isPromise:function(t){return t&&s(t.then)
},valueOf:function(t){return r.isPromise(t)?t.valueOf():t},isFulfilled:function(t){return r.isPromise(t)?t.isFulfilled():!0},isRejected:function(t){return r.isPromise(t)?t.isRejected():!1},isResolved:function(t){return r.isPromise(t)?t.isResolved():!0},fulfill:function(t){return r.when(t,n,function(t){return t})},reject:function(t){return r.when(t,function(t){var n=new e;return n.reject(t),n})},resolve:function(t){return r.isPromise(t)?t:r.when(t)},invoke:function(e){try{return r.promise(e.apply(t,a.call(arguments,1)))
}catch(n){return r.reject(n)}},forEach:function(t,e,n,i){for(var o=i?i.length:t.length,s=0;o>s;)r.when(t[i?i[s]:s],e,n),++s},all:function(t){var n=new e,i=l(t),o=i?c(t):f(t),s=o.length,a=i?[]:{};if(!s)return n.fulfill(a),n;var u=s,p=function(){if(!--u){for(var e=0;s>e;)a[o[e]]=r.valueOf(t[o[e++]]);n.fulfill(a)}},h=function(t){n.reject(t)};return r.forEach(t,p,h,o),n},allResolved:function(t){var n=new e,i=l(t),o=i?c(t):f(t),s=o.length,a=i?[]:{};if(!s)return n.fulfill(a),n;var u=function(){--s||n.fulfill(t)
};return r.forEach(t,u,u,o),n},allPatiently:function(t){return r.allResolved(t).then(function(){var e,n,i,o,s=l(t),a=s?c(t):f(t),u=a.length,p=0;if(!u)return s?[]:{};for(;u>p;)i=a[p++],o=t[i],r.isRejected(o)?(e||(e=s?[]:{}),s?e.push(o.valueOf()):e[i]=o.valueOf()):e||((n||(n=s?[]:{}))[i]=r.valueOf(o));if(e)throw e;return n})},any:function(t){var n=new e,i=t.length;if(!i)return n.reject(Error()),n;var o,s=0,a=function(t){n.fulfill(t)},u=function(t){s||(o=t),++s===i&&n.reject(o)};return r.forEach(t,a,u),n
},delay:function(t,e){return r.promise(t).delay(e)},timeout:function(t,e){return r.promise(t).timeout(e)}},i=function(){var e=[],n=function(t){return 1===e.push(t)},r=function(){var t=e,n=0,r=e.length;for(e=[];r>n;)t[n++]()};if("function"==typeof setImmediate)return function(t){n(t)&&setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(t){n(t)&&process.nextTick(r)};if(t.postMessage){var i=!0;if(t.attachEvent){var o=function(){i=!1};t.attachEvent("onmessage",o),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",o)
}if(i){var s="__promise"+ +new Date,a=function(t){t.data===s&&(t.stopPropagation&&t.stopPropagation(),r())};return t.addEventListener?t.addEventListener("message",a,!0):t.attachEvent("onmessage",a),function(e){n(e)&&t.postMessage(s,"*")}}}var u=t.document;if("onreadystatechange"in u.createElement("script")){var l=function(){var t=u.createElement("script");t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,r()},(u.documentElement||u.body).appendChild(t)};return function(t){n(t)&&l()
}}return function(t){n(t)&&setTimeout(r,0)}}(),o=function(t){i(function(){throw t})},s=function(t){return"function"==typeof t},a=Array.prototype.slice,u=Object.prototype.toString,l=Array.isArray||function(t){return"[object Array]"===u.call(t)},c=function(t){for(var e=[],n=0,r=t.length;r>n;)e.push(n++);return e},f=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},p=!0;"object"==typeof exports&&(module.exports=r,p=!1),"object"==typeof modules&&(modules.define("vow",function(t){t(r)
}),p=!1),"function"==typeof define&&(define(function(t,e,n){n.exports=r}),p=!1),p&&(t.Vow=r)}(this),Vow.Promise.prototype.__reject=Vow.Promise.prototype.reject,Vow.Promise.prototype.reject=function(t){t instanceof Error&&ns.log.exception("promise.exception",t),this.__reject(t)},function(e,n){"use strict";var r={};r.de="undefined"==typeof e,r.inherit=function(t,e,n){var i=function(){};i.prototype=e.prototype;var o=t.prototype=new i;if(n)if(Array.isArray(n))for(var s=0,a=n.length;a>s;s++)r.extend(o,n[s]);
else r.extend(o,n);return o.super_=e.prototype,o.constructor=t,t},r.extend=function(t){for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t},r.nop=function(){},r.true=function(){return!0},r.false=function(){return!1},r.value=function(t){return function(){return t}},r.logger=function(t){return t?function(){var e=[].slice.call(arguments);console.log.apply(null,[t].concat(e))}:console.log},r.next=r.de?function(t){process.nextTick(t)}:function(t){setTimeout(t,0)
},r.de&&(module.exports=r);var r=r||require("./no.base.js");r.Parser=function(t,e){this._rules=t,this._tokens=e||{}},r.Parser.prototype.start=function(t,e){this.input=t,this.p=0,this.s=t;var n=this.parse(e);return this.s&&this.error("End of string expected"),n},r.Parser.prototype.parse=function(t,e){var n=this._rules[t],r=this.p,i=n.call(this,e);return i._start=r,i._end=this.p,i._input=this.input,i},r.Parser.prototype.test=function(t){var e=this._tokens[t];if(e){var n=e.exec(this.s);return n&&n[0]
}return this.la(t.length)===t?t:void 0},r.Parser.prototype.match=function(t){var e=this.test(t);return e||this.error("Token "+t+" expected"),this.move(e.length),e},r.Parser.prototype.la=function(t){return this.s.substr(0,t||1)},r.Parser.prototype.move=function(t){t||(t=1),this.s=this.s.substr(t),this.p+=t},r.Parser.prototype.skip=function(){var t=/^\s+/.exec(this.s);t&&this.move(t[0].length)},r.Parser.prototype.error=function(t){throw Error(t+" at "+this.p+": "+this.s)};var r=r||require("./no.base.js");
r.de&&(require("./no.parser.js"),module.exports=r),function(){function t(t){this.data=t}function e(e,r){if(r instanceof t)return n(r,e.scalar());for(var i=r.nodes,o=e.scalar(),s=0;s<i.length;s++)if(o==i[s].scalar())return!0;return!1}function n(e,n){var r=e.data;if(Array.isArray(r)){for(var i=0;i<r.length;i++)if(new t(r[i]).scalar()==n)return!0;return!1}return e.scalar()==n}function i(){this.nodes=[]}function o(t,e){var n=t+"::"+e,r=b[n];return r||(r=b[n]=u(w.start(t,e))),r}function s(t){var e={};
for(var n in t)e[n]=r.jpath.expr(t[n]);return function(t,n,i){var o={};for(var s in e)o[s]=r.jpath.toScalar(e[s](t,n,i));return o}}function a(t){for(var e=[],n=t.length,i=0;n>i;i++)e.push(r.jpath.expr(t[i]));return function(t,i,o){for(var s=[],a=0;n>a;a++)s.push(r.jpath.toScalar(e[a](t,i,o)));return s}}function u(t){for(var e=[],n="jpath"===t._id?c(t,e):l(t,e),i="",o=0;n>=o;o++)i+="function t"+o+"(node, root, vars, funcs) {\n"+e[o]+"\n}\n\n";return i+="return function(data, vars, funcs) {\nvar node = new no.JNode(data);\nreturn t"+n+"(node, node, vars, funcs);\n}\n",Function("no",i)(r)
}function l(t,e){var n="return ("+f(t,e)+");";return e.push(n)-1}function c(t,e){var n="";t.abs&&(n+="node = root;\n");for(var r=t.steps,i=0,o=r.length;o>i;i++){var s=r[i],a=s._id;switch(a){case"nametest":n+='node = node.nametest("'+s.nametest+'");\n';break;case"star":n+="node = node.startest();\n";break;case"pred":case"index":s.expr._as="pred"===a?v:h;var u=l(s.expr,e);n+="node = node."+a+"(t"+u+", root, vars, funcs);\n";break;case"guard":n+="if (!("+f(s.expr,e)+")) { return node.empty; }\n"}"guard"!==a&&(n+="if (node.isEmpty()) { return node.empty; }\n")
}return n+="return node;",e.push(n)-1}function f(t,e){var n;switch(t._id){case"root":n="root";break;case"self":n="node";break;case"number":n=t.value;break;case"string_literal":n=JSON.stringify(t.value);break;case"string":n="("+t.value.map(function(t){return t._as=h,f(t,e)}).join(" + ")+")";break;case"var":n='(new no.JNode(vars["'+t.name+'"]))';break;case"func":n='funcs["'+t.name+'"](';for(var r=0,i=t.args.length;i>r;r++){var o=t.args[r];o._as=h,n+=r?",":"",n+=f(o,e)}n+=")";break;case"unop":t.expr._as="!"===t.op?v:h,n=t.op+"("+f(t.expr,e)+")";
break;case"binop":var s,i=t.left,a=t.right,u=i._type,l=a._type,p=t.op;switch(p){case"&&":case"||":s=u===v&&l===v?v:h;break;case"==":case"!=":u===l||u!==v&&l!==v||(s=v);break;default:s=h}s&&(i._as=a._as=s);var y=f(i,e),g=f(a,e);if("=="===p||"!="===p){if(u===d||l===d){if(u===h){var _=g;g=y,y=_}var m=u===l?"N":"S";n="("+y+").cmp"+m+"("+g+")"}n&&"!="===p&&(n="!("+n+")")}void 0===n&&(n="("+y+" "+t.op+" "+g+")");break;case"subexpr":n="("+f(t.expr,e)+")";break;case"jpath":var w=c(t,e);n="t"+w+"(node, root, vars, funcs)";
break;case"filter":var w=c(t.jpath,e);n="t"+w+'(new no.JNode(vars["'+t.name+'"]), root, vars, funcs)'}return t._as&&t._as!==t._type&&(t._type===d?n="("+n+")."+t._as+"()":t._type===h&&(n="!!("+n+")")),n}function p(t){for(var e=t.split("."),n=1,r=e.length-1,i="var r = data; var t;";r>n;n++)i+='t = r["'+e[n]+'"];',i+='if (t == null) { t = r["'+e[n]+'"] = {}; }',i+="r = t;";return i+='r["'+e[n]+'"] = value;',i+="return data;",new Function("data","value",i)}t.prototype.empty=new i,t.prototype.isEmpty=function(){return!1
},t.prototype.nametest=function(e,n){var r=this.data;if(!r)return this.empty;if(Array.isArray(r)){n||(n=new i);for(var o=0;o<r.length;o++)new t(r[o]).nametest(e,n);return n}var s=r[e];if(void 0===s)return this.empty;var a=new t(s);return n?n.push(a):a},t.prototype.startest=function(e){e||(e=new i);var n=this.data;if(Array.isArray(n))for(var r=0;r<n.length;r++)new t(n[r]).startest(e);else for(var o in n)this.nametest(o,e);return e},t.prototype.pred=function(e,n,r,o){var s=this.data;if(Array.isArray(s)){for(var a=new i,u=0;u<s.length;u++){var l=new t(s[u]);
e(l,n,r,o)&&a.push(l)}return a}return e(this,n,r,o)?this:this.empty},t.prototype.index=function(e,n,r,i){var o=this.data;if(Array.isArray(o)){var s=o[e(this,n,r,i)];return void 0!==s?new t(s).toNodeset():this.empty}return 0===e?this:this.empty},t.prototype.toArray=function(){return[this.data]},t.prototype.toNodeset=function(){return(new i).push(this)},t.prototype.scalar=function(){var t=this.data;return"object"==typeof t?"":t},t.prototype.boolean=function(){var t=this.data;return Array.isArray(t)?t.length>0:!!t
},t.prototype.cmpN=function(n){var r=this.data;if(Array.isArray(r)){for(var i=0;i<r.length;i++)if(e(new t(r[i]),n))return!0;return!1}return e(this,n)},t.prototype.cmpS=function(t){return n(this,t)},i.prototype.empty=t.prototype.empty,i.prototype.isEmpty=function(){return!this.nodes.length},i.prototype.push=function(t){return this.nodes.push(t),this},i.prototype.nametest=function(t,e){var n=this.nodes;e||(e=new i);for(var r=0;r<n.length;r++)n[r].nametest(t,e);return e},i.prototype.startest=function(t){var e=this.nodes;
t||(t=new i);for(var n=0;n<e.length;n++)e[n].startest(t);return t},i.prototype.pred=function(t,e,n,r){for(var o=this.nodes,s=new i,a=0;a<o.length;a++){var u=o[a];t(u,e,n,r)&&s.push(u)}return s},i.prototype.index=function(t){var e=this.nodes[t];return void 0!==e?(new i).push(e):this.empty},i.prototype.toArray=function(){for(var t=[],e=this.nodes,n=0;n<e.length;n++)t.push(e[n].data);return t},i.prototype.scalar=function(){var t=this.nodes;return t.length?t[0].scalar():""},i.prototype.boolean=function(){var t=this.nodes;
return t.length?t[0].boolean():!1},i.prototype.cmpN=function(t){for(var e=this.nodes,n=0,r=e.length;r>n;n++)if(e[n].cmpN(t))return!0;return!1},i.prototype.cmpS=function(t){for(var e=this.nodes,n=0,r=e.length;r>n;n++)if(e[n].cmpS(t))return!0;return!1},r.JNode=t,r.JNodeset=i;var h="scalar",d="nodeset",v="boolean",y={"*":6,"/":6,"%":6,"+":5,"-":5,"<=":4,">=":4,"<":4,">":4,"==":3,"!=":3,"&&":2,"||":1},g={};g.SELF=/^\.(?![a-zA-Z_*.[])/,g.ROOT=/^\/(?![.[])/,g.BINOP=/^(?:\+|-|\*|\/|%|==|!=|<=|>=|<|>|&&|\|\|)/,g.UNOP=/^(?:\+|-|!)/,g.DIGIT=/^[0-9]/,g.ID=/^[a-zA-Z_][a-zA-Z0-9-_]*/,g.NUMBER=/^[0-9]+(?:\.[0-9]+)?/,g.CHARS=/^[^"{}\\]+/;
var _={};_.expr=function(){function t(t){for(var r,i,o;(r=e[0])&&y[r]>=t;)o=n.shift(),i=n.shift(),n.unshift({_id:"binop",_type:"+-*/%".indexOf(r)>-1?h:v,_local:i._local||o._local,op:e.shift(),left:i,right:o})}var e=[],n=[this.parse("unary")];this.skip();for(var r,i=0;r=this.test("BINOP");){this.move(r.length),this.skip();var o=y[r];i>=o&&t(o),e.unshift(r),n.unshift(this.parse("unary")),this.skip(),i=o}return t(0),n[0]},_.unary=function(){var t;if(t=this.test("UNOP")){this.move();var e=this.parse("unary");
return{_id:"unop",_type:"!"===t?v:h,_local:e._local,op:t,expr:e}}return this.parse("primary")},_.primary=function(){var t=this.la();switch(t){case'"':return this.parse("string");case".":case"/":return this.parse("jpath");case"(":return this.parse("subexpr")}if(this.test("DIGIT"))return{_id:"number",_type:h,value:this.match("NUMBER")};var e=this.match("ID");if(this.test("."))return{_id:"filter",_type:d,name:e,jpath:this.parse("jpath")};if(this.test("(")){this.move(),this.skip();var n=[];if(!this.test(")"))for(n.push(this.parse("expr")),this.skip();this.test(",");)this.move(),this.skip(),n.push(this.parse("expr")),this.skip();
return this.match(")"),{_id:"func",_type:h,name:e,args:n}}return{_id:"var",_type:d,name:e}},_.subexpr=function(){this.move(),this.skip();var t=this.parse("expr");return this.skip(),this.match(")"),{_id:"subexpr",_type:t._type,_local:t._local,expr:t}},_.jpath=function(){if(this.test("SELF"))return this.move(),{_id:"self",_type:d,_local:!0};if(this.test("ROOT"))return this.move(),{_id:"root",_type:d};var t;this.test("/")&&(this.move(),t=!0);for(var e=[];;){var n=this.la();if("."===n)e.push(this.parse("step"));
else{if("["!==n)break;var r=this.parse("pred");"guard"===r._id?e.unshift(r):e.push(r)}}return{_id:"jpath",_type:d,_local:!t,abs:t,steps:e}},_.step=function(){this.move();var t=this.la();return"["===t?this.parse("pred"):"*"===t?(this.move(),{_id:"star"}):{_id:"nametest",nametest:this.match("ID")}},_.pred=function(){this.move(),this.skip();var t=this.parse("expr");this.skip(),this.match("]");var e="index";return t._local?e="pred":t._type===v&&(e="guard"),{_id:e,expr:t}},_.string=function(){this.match('"');
var t=this.parse("string_content");return this.match('"'),t};var m={"{{":"{","}}":"}",'\\"':'"',"\\\\":"\\"};_.string_content=function(){function t(){i&&(r.push(e(i)),i="")}function e(t){return{_id:"string_literal",_type:h,value:t}}for(var n,r=[],i="";this.s;)if(n=m[this.la(2)])i+=n,this.move(2);else{if(n=this.la(),'"'===n)break;"\\"===n?(i+=n,this.move()):"{"===n?(t(),this.move(),this.skip(),r.push(this.parse("expr")),this.skip(),this.match("}")):i+=this.match("CHARS")}return t(),r.length||r.push(e("")),{_id:"string",_type:h,value:r}
};var w=new r.Parser(_,g),b={};r.jpath=function(t,e,n,i){return r.jpath.toScalar(r.jpath.expr(t)(e,n,i))},r.jpath.raw=function(t,e,n,i){return r.jpath.expr(t)(e,n,i)},r.jpath.scalar=function(t){var e=r.jpath.expr(t);return function(t,n,i){return r.jpath.toScalar(e(t,n,i))}},r.jpath.boolean=function(t){var e=r.jpath.expr(t);return function(t,n,i){return r.jpath.toBoolean(e(t,n,i))}},r.jpath.string=function(t){return o(t,"string_content")},r.jpath.expr=function(t){var e=typeof t;return"string"===e?o(t,"expr"):t&&"object"===e?Array.isArray(t)?a(t):s(t):function(){return t
}},r.jpath.toScalar=function(e){return e instanceof t?e.data:e instanceof i?e.isEmpty()?void 0:e.toArray():e},r.jpath.toBoolean=function(e){return e instanceof t||e instanceof i?e.boolean():e};var x={};r.jpath.set=function(t,e,n){var r=x[t]||(x[t]=p(t));return r(e,n)}}();var i={};i.todo=function(){throw new Error("Unimplemented")},i.parseQuery=function(t){var e={};return t.split("&").forEach(function(n){var r=n.split("="),o=r.shift();if(o){var s=r.join("=");if("undefined"==typeof s)s="";else try{s=decodeURIComponent(s)
}catch(a){s="",i.log.info("ns.parseQuery.invalid-param",{query:t,chunk:n})}o in e?(Array.isArray(e[o])||(e[o]=[e[o]]),e[o].push(s)):e[o]=s}}),e},i.renderString=function(e,n,r){return t.run(r||"main",e,n)},i.renderNode=function(t,e,n){var r=i.html2node(i.renderString(t,e,n));return r?r.firstChild:null},i.init=function(){i.action.init(),i.router.init(),i.history.init(),i.initMainView()},i.initMainView=function(){var t=i.View.create("app");t._setNode(n.getElementById("app")),t.invalidate(),i.MAIN_VIEW=t
},i.assert=function(t){t||i.assert.fail.apply(this,Array.prototype.slice.call(arguments,1))},i.assert.fail=function(t,e){for(var n=Array.prototype.slice.call(arguments,2),r=0;r<n.length;r++)e=e.replace("%s",n[r]);throw new Error("["+t+"] "+e)},i.key=function(t,e){var n=t;e=e||{};for(var r in e)n+="&"+r+"="+encodeURIComponent(e[r]);return n},i.params2query=function(t){var e,n,r=[];for(e in t)if(n=t[e],Array.isArray(n))for(var i=0;i<n.length;i++)r.push(encodeURIComponent(e)+"="+encodeURIComponent(n[i]));
else r.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return r.join("&")},i.reset=function(){i.action&&i.action._reset(),i.router._reset(),i.layout._reset(),i.Model._reset(),i.View._reset(),i.request._reset(),i.page._reset(),i.page.history.reset(),i.MAIN_VIEW=null},i.VERSION="0.8.11",i.L={},i.L.VIEW="view",i.L.ASYNC="async",i.L.BOX="box",i.V={},i.V.STATUS={NONE:"none",LOADING:"loading",OK:"ok",INVALID:"invalid"},i.M={},i.M.STATUS={ERROR:"error",INITED:"inited",NONE:"none",OK:"ok",INVALID:"invalid"},i.R={NOT_APP_URL:"ns-router-not-app",NOT_FOUND:"not-found",REDIRECT:"ns-router-redirect"},i.U={},i.U.STATUS={MODELS:"models",EXPIRED:"expired"},i.U.EXEC={GLOBAL:"global",ASYNC:"async",PARALLEL:"parallel"},i.DEBUG=!1,i.H={DEFAULTS:{dataType:"json",type:"POST"}},i.V.EVENTS={click:"click",dblclick:"dblclick",mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"},i.V.DOM_EVENTS=["blur","change","input","click","dblclick","dragstart","dragenter","dragover","dragleave","drag","drop","dragend","focus","focusin","focusout","keydown","keypress","keyup","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","resize","scroll","submit"],i.V.NS_EVENTS=["ns-view-async","ns-view-destroyed","ns-view-init","ns-view-htmlinit","ns-view-show","ns-view-touch","ns-view-hide","ns-view-htmldestroy"],i.IS_TOUCH=function(){return"boolean"==typeof e.NS_IS_TOUCH?e.NS_IS_TOUCH:Boolean("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)
}(),i.IS_TOUCH&&(i.V.DOM_EVENTS.push("swipe","swipeleft","swiperight","tap","touchstart","touchmove","touchend"),i.V.EVENTS={click:"tap",dblclick:"doubletap",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"}),function(t){t.replaceNode=function(t,e){return t===e?!0:t.parentNode?(t.parentNode.replaceChild(e,t),!0):!1},t.removeNode=function(t){var e=t.parentNode;e&&e.removeChild(t)},t.html2node=function(t){if(!t)return null;var e=n.createElement("div");return e.innerHTML=t,e},t.childrenIterator=function(t){return function(t){var e=-1;
return{getNext:function(){return e++,t[e]||null}}}(t.children)};var e=/[\t\r\n]/g;t.hasClass="undefined"!=typeof n&&n.createElement("div").classList?function(t,e){return t.classList.contains(e)}:function(t,n){return n=" "+n+" ",1===t.nodeType&&(" "+t.className+" ").replace(e," ").indexOf(n)>=0},t.byClass="undefined"!=typeof n&&n.getElementsByClassName?function(t,e){return e=e||n,e.getElementsByClassName(t)}:function(t,e){return e=e||n,$(e).find("."+t)}}(i),function(t){var e=/[&<>"'\/]/g,n=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};
return function(e){return t[e]}}();t.entityify=function(t){return String(t).replace(e,n)};var r=/&([^&;]+);/g,i=function(){var t={amp:"&",lt:"<",gt:">",quot:'"',"#x27":"'","#x2F":"/"};return function(e,n){return t[n]||e}}();t.deentityify=function(t){return String(t).replace(r,i)}}(i),i.Events={},i.Events.on=function(t,e){var n=this._nsevents_handlers||(this._nsevents_handlers={});return i.assert("function"==typeof e,"ns.Events",'Handler for event "%s" in not a function.',t),(n[t]||(n[t]=[])).push(e),this
},i.Events.once=function(t,e){var n=this,r=function(){n.off(t,r),e.apply(this,arguments)};return r.__original=e,this.on(t,r),this},i.Events.off=function(t,e){var n;if(e){if(n=this._nsevents_handlers&&this._nsevents_handlers[t])for(var r=0,i=n.length;i>r;r++)if(n[r]===e||n[r].__original===e){n.splice(r,1);break}}else n=this._nsevents_handlers,n&&(n[t]=null);return this},i.Events.trigger=function(t){var e=this._nsevents_handlers&&this._nsevents_handlers[t];if(e){e=e.slice();for(var n=0,r=e.length;r>n;n++)try{e[n].apply(this,arguments)
}catch(o){i.log.exception("ns.events",o,{name:t})}}return this},i.Events.atrigger=function(){var t=this,e=arguments;r.next(function(){t.trigger.apply(t,e)})},i.Events.forward=function(t,e){return this.on(t,function(t,n){e.trigger(t,n)})},i.events=r.extend({},i.Events),function(){function t(t){return"function"==typeof t}i.history={},i.history.init=function(){$(e).on("popstate",function(t){t.preventDefault(),t.stopPropagation(),i.history.onpopstate(t)}),$(n).on(i.V.EVENTS.click,"a",i.history._onAnchorClick)
},i.history.pushState=function(n,r){t(e.history.pushState)&&e.history.pushState(null,r||i.page.title(n),n)},i.history.replaceState=function(n,r){t(e.history.replaceState)&&e.history.replaceState(null,r||i.page.title(n),n)},i.history.onpopstate=function(){i.page.go("",!0)},i.history.followAnchorHref=function(t){return i.page.go(t)},i.history._onAnchorClick=function(t){var n=t.currentTarget;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return!0;if(n.protocol&&!/^https?:/.test(n.protocol))return!0;if(n.hostname&&n.hostname!==e.location.hostname)return!0;
if(i.router.baseDir){var r=n.pathname,o=i.router.baseDir;if(r.substr(0,o.length)!==o)return!0}var s=n.getAttribute("href");if(!s||n.getAttribute("target"))return!0;var a=i.history.followAnchorHref(s,n);return Vow.isPromise(a)?(t.preventDefault(),!0):void 0}}(),i.http=function(t,e,n){n=r.extend({},i.H.DEFAULTS,n),n.url=t,n.data=e;var o=new Vow.Promise;return $.ajax(n).done(function(t){o.fulfill(t)}).fail(function(t,e,n){var r=n||e||"unknown error";o.reject({error:r,xhr:t})}),o},i.object={},i.object.clone=function(t){if(t&&"object"==typeof t){var e;
if(Array.isArray(t)){e=[];for(var n=0;n<t.length;n++)e.push(i.object.clone(t[n]))}else{e={};for(var r in t)e[r]=i.object.clone(t[r])}return e}return t},i.object.isEmpty=function(t){for(var e in t)return!1;return!0},function(){i.profile={},i.profile.startTimer=function(t){this._profileTimes||(this._profileTimes={}),i.assert(!this._profileTimes[t],"ns.profile","Timer '%s' is in use",t),this._profileTimes[t]=Date.now()},i.profile.stopTimer=function(t){return this._profileTimes||(this._profileTimes={}),i.assert(this._profileTimes[t],"ns.profile","Timer '%s' haven't been started",t),this._profileTimes[t]=Date.now()-this._profileTimes[t],this._profileTimes[t]
},i.profile.switchTimer=function(t,e){this.stopTimer(t),this.startTimer(e)},i.profile.getTimer=function(t){this._profileTimes||(this._profileTimes={});var e=this._profileTimes[t];return"number"==typeof e?e:0/0},i.profile.getTimers=function(){return r.extend({},this._profileTimes)}}(),function(t,e){t.action={};var n={},r=!1;t.action.define=function(t,e){if(t in n)throw new Error("[ns.action] Can't redefine '"+t+"'");n[t]=e},t.action.copy=function(t,e){if(e in n)throw new Error("[ns.action] Can't redefine '"+e+"'");
if(!(t in n))throw new Error("[ns.action] '"+t+"' is not defined");n[e]=n[t]},t.action.run=function(e,r,i,o){var s=n[e];t.assert(s,"ns.action","%s is not defined",e);try{return s(e,r,i,o)}catch(a){t.log.exception("ns.action",a)}},t.action.getParams=function(t){var e=t.getAttribute("data-params");if(e&&"{"===e.charAt(0))try{return JSON.parse(e)}catch(n){}return{}},t.action.init=function(){if(!r){r=!0;var e=$("body"),n=".ns-action",i=[t.V.EVENTS.click,t.V.EVENTS.dblclick].join(" ");e.on(i,n,this._process)
}},t.action._process=function(n){var r=n.currentTarget,i=r.getAttribute("dblclick"===n.type?"data-dblclick-action":"data-click-action"),o=!0;return i&&(o=t.action.run(i,t.action.getParams(r),r,n)),o===e||Vow.isPromise(o)?!1:o},t.action._reset=function(){n={}}}(i),function(){i.Model=function(){},r.extend(i.Model.prototype,i.Events);var t={},e={},n={},o=0;i.Model.prototype.STATUS=i.M.STATUS,i.Model.prototype.RETRY_LIMIT=3,i.Model.prototype.status=i.M.STATUS.NONE,i.Model.prototype.key=null,i.Model.prototype.params=null,i.Model.prototype._errorFixingPromise=null,i.Model.prototype._init=function(t,e){this.id=t,this._reset(),this.info=i.Model.info(t),r.extend(this,i.Model.getKeyAndParams(t,e,this.info)),this._reinit()
},i.Model.prototype._reinit=function(){this.status===this.STATUS.NONE&&(this._bindEvents(),this.status=this.STATUS.INITED,this.trigger("ns-model-init"))},i.Model.prototype._reset=function(t){this.data=null,this.error=null,this._softReset(t),this._version=0},i.Model.prototype._softReset=function(t){this.status=t||this.STATUS.NONE,this.retries=0},i.Model.prototype._bindEvents=function(){for(var t in this.info.events){var e=this.info.events[t];Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;r>n;n++)this.on(t,this._prepareCallback(e[n]))
}},i.Model.prototype._unbindEvents=function(){for(var t in this.info.events){var e=this.info.events[t];Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;r>n;n++)this.off(t,this._prepareCallback(e[n]))}},i.Model.prototype._prepareCallback=function(t){return"string"==typeof t&&(t=this[t]),i.assert("function"==typeof t,"ns.Model","Can't find method '%s' in '%s' to bind event",t,this.id),t},i.Model.prototype.invalidate=function(){this._softReset(this.STATUS.INVALID)},i.Model.prototype.destroy=function(){this.trigger("ns-model-before-destroyed"),this._reset(this.STATUS.NONE),this.trigger("ns-model-destroyed"),this._unbindEvents()
},i.Model.prototype.isValid=function(){return this.status===this.STATUS.OK},i.Model.prototype.getData=function(){return this.data},i.Model.prototype.get=function(t){var e=this.data;return e?r.jpath(t,e):void 0},i.Model.prototype.select=function(t){var e=this.data;return e?r.jpath.raw(t,e).toArray():[]},i.Model.prototype.set=function(t,e,n){var i=this.data;if(this.isValid()&&i&&(r.jpath.set(t,i,e),n=n||{},n.jpath=t,this.touch(n),!n.silent))for(var o=t.split("."),s=o.length;s>1;){var a=o.slice(0,s).join(".");
this.trigger("ns-model-changed"+a,a,t),s--}},i.Model.prototype.setData=function(t,e){return this._reinit(),!t||this.isValid()&&!this.hasDataChanged(t)||(this.data=this._beforeSetData(this.preprocessData(t),e),this.status=this.STATUS.OK,this.error=null,this.touch(e)),this},i.Model.prototype.hasDataChanged=function(t){return!!t},i.Model.prototype.getError=function(){return this.error},i.Model.prototype.setError=function(t){this.isErrorCanBeFixed(t)?this._errorFixingPromise=this.fixError(t):(this.data=null,this.error=t,this.status=this.STATUS.ERROR)
},i.Model.prototype.isErrorCanBeFixed=function(){return!1},i.Model.prototype.fixError=function(){return Vow.resolve()},i.Model.prototype._beforeSetData=function(t){return t},i.Model.prototype.preprocessData=function(t){return t},i.Model.prototype.getRequestParams=function(){return i.Model._getKeyParams(this.id,this.params,this.info)},i.Model.prototype._canRequest=function(){return this.canRequest()&&(!this.retries||!this.isDo())&&this.retries<this.RETRY_LIMIT},i.Model.prototype.canRequest=r.true,i.Model.prototype.extractData=function(t){return t?t.data:void 0
},i.Model.prototype.extractError=function(t){return t?t.error:void 0},i.Model.prototype.isDo=function(){return this.info.isDo},i.Model.prototype.getVersion=function(){return this._version},i.Model.prototype._incVersion=function(){this._version++},i.Model.prototype.touch=function(t){if(t=t||{},!t.silent){this._incVersion(),this.trigger("ns-model-touched");var e=t.jpath||"";this.trigger("ns-model-changed",e)}},i.Model.prototype.prepareRequest=function(t){return this.requestID=t,this.retries++,this.promise=new Vow.Promise,this
},i.Model.prototype.finishRequest=function(){this._errorFixingPromise?this._errorFixingPromise.then(this.__finishRequest,this.__finishRequest,this):this.__finishRequest()},i.Model.prototype.__finishRequest=function(){this._errorFixingPromise&&(this._errorFixingPromise=null,this.retries=0),this.promise.fulfill()},i.Model.prototype.destroyWith=function(t){i.Model.destroyWith(this,t)},i.Model.get=function(e,r){var i=this._find(e,r);if(!i){var o=t[e];i=new o,i._init(e,r),i.isDo()||(n[e][i.key]=i)}return i._reinit(),i
},i.Model.getValid=function(t,e){var n=this._find(t,e);return n&&n.isValid()?n:null},i.Model._find=function(t,r){i.assert(t in e,"ns.Model","'%s' is not defined",t);var o=i.Model.key(t,r);return n[t][o]||null},i.Model.destroy=function(t){if(!t.isDo()){var e=t.id,r=t.key,i=n[e][r];i&&t.destroy()}},i.Model.isValid=function(t,e){return!!i.Model.getValid(t,e)},i.Model.define=function(o,s,a){i.assert(!(o in e),"ns.Model","Can't redefine '%s'",o),s=s||{},"undefined"==typeof s.isCollection&&(s.isCollection=!!s.split);
var u=a;"string"==typeof a?(u=t[a],i.assert(u,"ns.Model","Can't find '%s' to extend '%s'",a,o)):a||(u=s.uniq?i.ModelUniq:s.isCollection?i.ModelCollection:i.Model);var l=s.ctor||function(){};return l=r.inherit(l,u,s.methods),s.ready=!1,e[o]=s,t[o]=l,n[o]={},l},i.Model._reset=function(){n={},t={},e={}},i.Model._clear=function(){for(var t in e)n[t]={}},i.Model.info=function(t){var e=i.Model.infoLite(t);return e.ready||(e.params=e.params||{},e.events=e.events||{},e.isDo=/^do-/.test(t),e.ready=!0),e},i.Model.infoLite=function(t){var n=e[t];
return i.assert(n,"ns.Model","'%s' is not defined",t),n},i.Model.key=function(t,e,n){return i.Model.getKeyAndParams(t,e,n).key},i.Model.getKeyAndParams=function(t,e,n){if(n=n||i.Model.info(t),n.isDo)return{key:"do-"+t+"-"+o++,params:e};var r="model="+t,s=i.Model._getKeyParams(t,e,n);return{key:i.key(r,s),params:s}},i.Model._getKeyParams=function(t,e,n){if(e=e||{},n=n||i.Model.info(t),"function"==typeof n.params)return n.params(e);for(var r=n.params,o=n.pNames||(n.pNames=Object.keys(n.params)),s={},a=0,u=o.length;u>a;a++){var l=o[a],c=e[l];
c=void 0===c?r[l]:c,null!=c&&(s[l]=c)}return"function"==typeof n.paramsRewrite&&(s=n.paramsRewrite(s)),s},i.Model.invalidate=function(t,e){e=e||function(){return!0};var r=n[t];for(var i in r){var o=r[i];e(o)&&o.invalidate()}},i.Model.destroyWith=function(t,e){Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;r>n;n++){var o=e[n];i.assert(o instanceof i.Model,"ns.Model","destroyWith called for '%s' while one of the withModels is not instance of ns.Model",t.id),o.on("ns-model-destroyed",function(){i.Model.destroy(t)
})}},i.Model.isCollection=function(t){return(t.info||i.Model.infoLite(t.id)).isCollection},i.Model.traverse=function(t,e){i.Model.infoLite(t),i.assert("function"==typeof e,"ns.Model.traverse","callback must be a function");var r=n[t];for(var o in r)e(r[o])},i.ModelUniq=function(){},r.inherit(i.ModelUniq,i.Model),i.ModelUniq.prototype.__superInit=i.ModelUniq.prototype._init,i.ModelUniq.prototype._init=function(t){var e=i.Model.info(t);e.events.changed=e.events.changed||[];var n=e.events.changed,r=function(){var t=this,e=this.params[this.uniqName];
this.uniqCached||(this.uniqCached={}),e.forEach(function(e,n){t.uniqCached[n]=!0})};Array.isArray(n)?n.unshift(r):e.events.changed=[r,e.events.changed],this.__superInit.apply(this,arguments)},i.ModelUniq.prototype._superIsValid=i.Model.prototype.isValid,i.ModelUniq.prototype.isValid=function(){return-1===this.key.indexOf("&"+this.uniqName+"=")?!0:this._superIsValid()},i.ModelUniq.prototype.uniqName="",i.ModelUniq.prototype.uniqPath="",i.ModelUniq.prototype.uniqCached=null,i.ModelUniq.prototype.uniq=function(t,e){var n=this,i=this.uniqName,o=r.extend({},t);
if(this.uniqCached||(this.uniqCached={}),e)for(var s in t)e[s]=s===i?[]:t[s];return o[i]=[].concat(o[i]).map(function(t){return n.uniqCached[t]?(e&&e[i].push(t),null):t}),o[i].length||delete o[i],e&&!e[i].length&&delete e[i],o},i.ModelUniq.prototype.uniqFromKey=function(t){return((t.split(this.uniqName+"=")[1]||"").split("&")[0]||"").split(",")},i.ModelUniq.prototype.uniqFromJSON=i.todo,i.ModelUniq.prototype.getData=function(t){var e=this,r=this.uniqPath,i=[].concat(t[this.uniqName]),o={};o[r]=[];
var s=n[this.id];for(var a in s)for(var u=s[a],l=e.uniqFromKey(a),c=0,f=i.length;f>c;c++)if(l.indexOf(i[c])>-1){var p=e.uniqFromJSON(u.data,i[c]);p&&o[r].push(p),i.splice(c,1),c--}return o}}(),function(){i.ModelCollection=function(){},r.inherit(i.ModelCollection,i.Model),i.ModelCollection.prototype.DEFAULT_ITEMS_SPLIT=".items",i.ModelCollection.prototype._init=function(){this._modelsEvents={},this.models=[],i.Model.prototype._init.apply(this,arguments)},i.ModelCollection.prototype.getData=function(){if(this.isValid()){var t;
t=this.info.split?this.info.split.items:this.info.jpathItems?this.info.jpathItems:this.DEFAULT_ITEMS_SPLIT,this.data||(this.data={}),"/"===t?this.data=[]:r.jpath.set(t,this.data,[]);var e=r.jpath(t,this.data);this.models.forEach(function(t){e.push(t.getData())})}return this.data},i.ModelCollection.prototype._reset=function(){i.Model.prototype._reset.apply(this,arguments),this.clear()},i.ModelCollection.prototype._beforeSetData=function(t,e){var n=this.info.split;if(n){var i=r.jpath(n.items||this.DEFAULT_ITEMS_SPLIT,t),o=this._splitModels(i,e),s=this.__filterExistsModels(this.models,o),a=this.__filterExistsModels(o,this.models);
this.__removeModels(a),this.__insertModels(s,0),this.models=o}else this.clear();return t},i.ModelCollection.prototype._splitModels=function(t,e){for(var n=this.info.split,o=[],s=0,a=t.length;a>s;s++){var u=t[s],l={};for(var c in n.params)l[c]=r.jpath(n.params[c],u);var f;f="function"==typeof n.model_id?n.model_id(u,l):n.model_id,f&&o.push(i.Model.get(f,l).setData(u,e))}return o},i.ModelCollection.prototype._subscribeSplit=function(t){var e=this;this.bindModel(t,"ns-model-changed",function(n,r){e.onItemChanged(n,t,r)
}),this.bindModel(t,"ns-model-touched",function(n){e.onItemTouched(n,t)}),this.bindModel(t,"ns-model-before-destroyed",function(n){e.onItemDestroyed(n,t)})},i.ModelCollection.prototype.__filterExistsModels=function(t,e){for(var n=this.__buildModelsHash(t),r=[],i=0,o=e.length;o>i;i++){var s=e[i];n.hasOwnProperty(s.key)||r.push(s)}return r},i.ModelCollection.prototype.__buildModelsHash=function(t){for(var e={},n=0,r=t.length;r>n;n++)e[t[n].key]=0;return e},i.ModelCollection.prototype.bindModel=function(t,e,n){var r=this._modelsEvents[t.key]||(this._modelsEvents[t.key]={});
t.on(e,n),r[e]=n},i.ModelCollection.prototype.unbindModel=function(t,e){var n=this._modelsEvents[t.key];n&&n[e]&&(t.off(e,n[e]),delete n[e])},i.ModelCollection.prototype.onItemChanged=function(t,e,n){this.trigger("ns-model-changed",{model:e,jpath:n})},i.ModelCollection.prototype.onItemTouched=function(){this._version++},i.ModelCollection.prototype.onItemDestroyed=function(t,e){this.remove(e)},i.ModelCollection.prototype.getSelfVersion=function(){return this._versionSelf},i.ModelCollection.prototype._incVersion=function(){i.Model.prototype._incVersion.apply(this,arguments),this._versionSelf=this._version
},i.ModelCollection.prototype._unsubscribeSplit=function(t){if(t.key in this._modelsEvents){var e=this._modelsEvents[t.key];for(var n in e)t.off(n,e[n]);delete this._modelsEvents[t.key]}},i.ModelCollection.prototype.clear=function(){var t=this.models;if(this.models=[],t&&t.length){var e=this;t.forEach(function(t){e._unsubscribeSplit(t)}),this.trigger("ns-model-remove",t)}},i.ModelCollection.prototype.insert=function(t,e){this._reinit(),isNaN(e)&&(e=this.models.length),Array.isArray(t)||(t=[t]);for(var n=[],r=this.__buildModelsHash(t),i=0,o=t.length;o>i;i++){var s=t[i];
0===r[s.key]&&(n.push(s),r[s.key]++)}var a=this.__filterExistsModels(this.models,n);return this.__insertModels(a,e)},i.ModelCollection.prototype.__insertModels=function(t,e){for(var n=0,r=t.length;r>n;n++)this.models.splice(e+n,0,t[n]),this._subscribeSplit(t[n]);return t.length>0?(this.status=this.STATUS.OK,this.trigger("ns-model-insert",t),!0):!1},i.ModelCollection.prototype.remove=function(t){Array.isArray(t)||(t=[t]);for(var e=this._modelsIndexToInstance(t),n=[],r=0,i=e.length;i>r;r++){var o=e[r],s=this.models.indexOf(o);
s>-1&&(o._itemToRemoveIndex=s,n.push(o))}return this.__removeModels(n)},i.ModelCollection.prototype.__removeModels=function(t){t=t.sort(function(t,e){return e._itemToRemoveIndex-t._itemToRemoveIndex});for(var e=0,n=t.length;n>e;e++)this._unsubscribeSplit(t[e]),this.models.splice(t[e]._itemToRemoveIndex,1);return t.length?(this.trigger("ns-model-remove",t),!0):!1},i.ModelCollection.prototype._modelsIndexToInstance=function(t){for(var e=[],n=0,r=t.length;r>n;n++){var i=t[n];if("number"==typeof i){var o=this.models[i];
this.models[i]&&e.push(o)}else e.push(i)}return e}}(),function(){function t(e,i){var s={};if("string"==typeof e)s[e]=!0,e=s;else if(Array.isArray(e)){for(var a=0,u=e.length;u>a;a++)s[e[a]]=!0;e=s}var l={};for(var c in e){var f=c;c.indexOf("{")>-1&&(f=r.jpath.string(c)(i));var p,h=e[c];switch(typeof h){case"function":p=t(h(i),i);break;case"object":case"string":p=t(h,i);break;default:p={}}l[o(f)]={type:n(f),views:p}}return l}function e(t,e){var r=i.object.clone(e);for(var s in t){var u=s.split(a),l=u.length;
if(n(u[l-1])!==i.L.BOX)throw new Error("[ns.layout] Can't overwrite view layout '"+u[l-1]+"'");for(var c=r,f=0;l-1>f;f++)if(c=c[o(u[f])].views,!c)throw new Error('[no.layout] Path "'+u.slice(0,f).join(" ")+'" is undefined in this layout and cannot be extended');c[o(u[l-1])]=t[s]}return r}function n(t){var e=t.substr(-1);return"@"===e?i.L.BOX:"&"===e?i.L.ASYNC:i.L.VIEW}function o(t){if(a.test(t))return t;var e=t.slice(-1);return("@"===e||"&"===e)&&(t=t.slice(0,-1)),t}i.layout={};var s={},a=/\s+/;i.layout.define=function(t,e,n){if(s[t])throw new Error("[ns.layout] Can't redefine '"+t+"'");
s[t]={layout:e,parent_id:n}},i.layout.undefine=function(t){delete s[t]},i.layout._reset=function(){s={}},i.layout.page=function(n,r){var o=s[n];if(!o)throw new Error("[ns.layout] '"+n+"' is not defined");var a=t(o.layout,r);if(o.parent_id){var u=i.layout.page(o.parent_id,r);a=e(a,u)}return a},i.layout.generateSimple=function(t,e){e=e||"ns-auto-layout-";var n=e+t;if(n in s)return n;var r={};return r[t]={},i.layout.define(n,r),n}}(),function(t){t.log={},t.log.debug=function(){console.log.apply(console,arguments)
},t.log.info=function(){},t.log.error=function(){},t.log.exception=function(){}}(i),function(){function t(t){return i.events.trigger("ns-page-after-load",t),t}function r(t){return i.events.trigger("ns-page-error-load",t),Vow.reject(t)}i.page={},i.page.current={},i.page.currentUrl=null,i.page.DEFAULT_HISTORY_ACTION="push",i.page.go=function(t,n){if(n?n===!0&&(n="replace"):n=i.page.DEFAULT_HISTORY_ACTION,t=t||i.page.getCurrentUrl(),!i.page.block.check(t))return t!==i.page.currentUrl&&i.history.replaceState(i.page.currentUrl),Vow.reject("block");
var o=i.router(t);return o.page===i.R.NOT_APP_URL?("replace"===n?e.location.replace(o.redirect):e.location=o.redirect,new Vow.Promise):(i.events.trigger("ns-page-before-load",[i.page.current,o],t),"push"===n&&t===i.page.currentUrl&&(n="preserve"),i.page.followRoute(o).then(function(){return i.page._setCurrent(o,t),i.page._fillHistory(t,n),o.page===i.R.REDIRECT?i.page.redirect(o.redirect):(i.page.title(),i.page.startUpdate(o))},r))},i.page.followRoute=function(){return Vow.fulfill()},i.page.startUpdate=function(e){var n=i.layout.page(e.page,e.params),o=new i.Update(i.MAIN_VIEW,n,e.params);
return o.start().then(t,r)},i.page._setCurrent=function(t,e){i.page.current=t,i.page.currentUrl=e},i.page._fillHistory=function(t,e){switch(e){case"init":i.page.history.push(t);break;case"push":i.history.pushState(t),i.page.history.push(t);break;case"replace":i.history.replaceState(t),i.page.history.replace(t);break;case"redirect":i.history.replaceState(t),i.page.history.redirect(t)}},i.page.redirect=function(t){return i.history.replaceState(t),i.page.go(t,"redirect")},i.page.title=function(){n.title="NoScript app "+i.page.currentUrl.url
},i.page._reset=function(){this.current={},this.currentUrl=""},i.page.getDefaultUrl=function(){return i.router.url("/")},i.page.getCurrentUrl=function(){return e.location.pathname+e.location.search}}(),function(){i.page.block={},i.page.block._checkers=[],i.page.block.add=function(t){return i.page.block._checkers.push(t),this},i.page.block.remove=function(t){var e=i.page.block._checkers,n=e.indexOf(t);return n>-1&&e.splice(n,1),this},i.page.block.clear=function(){return i.page.block._checkers=[],this
},i.page.block.check=function(t){for(var e=i.page.block._checkers,n=0,r=e.length;r>n;n++)if(e[n](t)===!1)return!1;return!0}}(),function(){i.page.history={},i.page.history._current=null,i.page.history._history=[],i.page.history.push=function(t){var e=i.page.history;if(e._current&&e._current!==t){var n=i.page.history.getPrevious();n===t?e._history.pop():e._history.push(e._current)}e._current=t},i.page.history.replace=function(t){var e=i.page.history,n=e._history.pop(),r=e._current;n!==t&&r!==t&&e._history.push(t),e._current=t
},i.page.history.redirect=function(t){var e=i.page.history;e._current=t,e._previous=e.getPrevious()},i.page.history.back=function(){var t=i.page.history,e=t.getPrevious();return e?t._history.pop():e=i.page.getDefaultUrl(),t._current=e,i.page.go(e)},i.page.history.getPrevious=function(t){t=t||0;var e=i.page.history._history,n=e.length;return e[n-t-1]},i.page.history.reset=function(){i.page.history._current=null,i.page.history._history=[]}}(),function(){function t(t){for(var e={},n=0,r=t.length;r>n;n++){var i="."+n,o=t[n];
e["_model"+i]=o.id;var s=o.getRequestParams();for(var a in s)e[a+i]=s[a]}return e}function e(t,e){for(var n=[],r=0,i=t.length;i>r;r++)n.push({id:t[r],params:e});return n}function n(t){return t.promise}function o(t,n){"string"==typeof t&&(t=[t]),"string"==typeof t[0]&&(n=n||{},t=e(t,n));for(var r=[],o=0,s=t.length;s>o;o++){var a=t[o];r.push(a instanceof i.Model?a:a.model&&a.model instanceof i.Model?a.model:i.Model.get(a.id,a.params))}return r}function s(t){return t.id}i.request=function(t,e,n){return i.request.models(o(t,e),n)
},i.forcedRequest=function(t,e,n){return n=n||{},n.forced=!0,i.request.models(o(t,e),n)},i.request.models=function(t,e){t=t.map(function(t){return t.getRequest?t.getRequest():t});var n=new u(t,e);return n.start()},i.request.requestParams={},i.request.addRequestParams=function(t){r.extend(t,i.request.requestParams)},i.request.URL="/models/",i.request.canProcessResponse=function(){return!0},i.request._reset=function(){i.request.manager._keys={}},i.request.extractModel=function(t,e){var n,r;e?(n=t.extractData(e),n||(r=t.extractError(e),r||(r={id:"INVALID_FORMAT",reason:"response should contain result or error"}))):r={id:"NO_DATA",reason:"Server returned no data"},n?t.setData(n):t.setError(r)
};var a=0,u=function(t,e){this.id=a++,this.models=t,this.options=e||{},this.promise=new Vow.Promise};u.prototype.start=function(){for(var t=[],e=[],n=this.models,r=0,o=n.length;o>r;r++){var s=n[r],a=i.request.manager.add(s,this.id,this.options.forced);a===!0?e.push(s):a instanceof i.Model&&t.push(s)}return this.request(t,e),this.promise},u.prototype.request=function(e,r){var o,a=[];if(r.length){var u=[],l=[];if(r.forEach(function(t){if("function"==typeof t.request){var e=t.request().then(function(){i.request.manager.done(t)
},function(){i.request.manager.done(t)});t.promise=e,l.push(e)}else u.push(t)}),a=a.concat(l),u.length){var c=t(u),f=u.map(s);i.request.addRequestParams(c),o=i.http(i.request.URL+"?_m="+f.join(","),c),a=a.concat(u.map(n))}}if(e.length&&(a=a.concat(e.map(n))),a.length){var p=this;o&&o.then(function(t){i.request.canProcessResponse(t)===!1?(i.request.manager.clean(p.models),p.promise.reject({error:"CANT_PROCESS",invalid:p.models,valid:[]})):p.extract(u,t)},function(t){i.log.error("ns.request.http",t),p.extract(u,{})
}),Vow.all(a).then(this.start.bind(this))}else{i.request.manager.clean(this.models);for(var h=[],d=[],v=0,y=this.models.length;y>v;v++){var g=this.models[v];g.isValid()?h.push(g):d.push(g)}d.length?this.promise.reject({invalid:d,valid:h}):this.promise.fulfill(this.models)}},u.prototype.extract=function(t,e){for(var n=e&&e.models||[],r=0,o=t.length;o>r;r++){var s=t[r],a=n[r];s.requestID>this.id||(i.request.extractModel(s,a),i.request.manager.done(s),s.finishRequest())}}}(),i.request.manager={STATUS:{LOADING:0,FAILED:1,DONE:2},_keys:{},add:function(t,e,n){var r=this.STATUS,i=t.key,o=this._keys[i];
return o?t.isValid()&&!n?!1:o.status===r.LOADING?t.isDo()?o.model:n?(o.model.requestID=e,!0):o.model:o.status===r.FAILED?o.model._canRequest()?(this._createRequest(t,e),!0):(t.status=t.STATUS.ERROR,this.done(t,!0),!1):t.isValid()?!1:t._canRequest()?(this._createRequest(t,e),!0):!1:t.isValid()?n&&t.requestID!==e?(this._createRequest(t,e),!0):!1:t.canRequest()?(this._createRequest(t,e),!0):!1},done:function(t,e){var n=this._keys[t.key];n&&(n.status=t.isValid()||e?this.STATUS.DONE:this.STATUS.FAILED)
},clean:function(t){for(var e=0,n=t.length;n>e;e++){var r=t[e];r.retries=0,delete this._keys[r.key]}},_createRequest:function(t,e){this._keys[t.key]={status:this.STATUS.LOADING,model:t},t.prepareRequest(e)}},i.router=function(t){var e=i.router.baseDir,n=i.router._routes;if(0!==t.indexOf(e))return{page:i.R.NOT_APP_URL,params:{},redirect:t};t=t.substring(e.length),t||(t="/");var r=i.router._processRedirect(n.redirect,t);if(r)return{page:i.R.REDIRECT,params:{},redirect:e+r};var o=t.split("?"),s=o.shift();
if(s in n.rewriteUrl){var a=o.join("?");t=n.rewriteUrl[s]+(a?"?"+a:"")}for(var u=n.route,l=0,c=u.length;c>l;l++){var f=u[l],p=i.router._parseUrl(f,t);if(p)return f.page in n.rewriteParams&&(p=n.rewriteParams[f.page](p)),{page:f.page,params:p}}return{page:i.R.NOT_FOUND,params:{}}},i.router.encodeParamValue=encodeURIComponent,i.router.decodeParamValue=decodeURIComponent,i.router.URL_FIRST_SYMBOL="/",i.router._getParamsRouteFromUrl=function(t,e){for(var n,r=t.params,o={},s=r.length,a=0;s>a;a++){n=r[a];
var u=e[a+1];if(u)try{u=i.router.decodeParamValue(u,n.name)}catch(l){u=""}u||(u=n.default_value),o[n.name]=u}return o},i.router._parseUrl=function(t,e){var n=t.regexp.exec(e);if(n){var o=i.router._getParamsRouteFromUrl(t,n),s=n[t.params.length+1];return s&&r.extend(o,i.parseQuery(s)),o}return null},i.router._processRedirect=function(t,e){for(var n,r=0,o=t.length;o>r;r++){var s=t[r];if("function"==typeof s.path){var a=i.router._parseUrl(s,e);a&&(n=s.path(a,e))}else s.regexp.test(e)&&(n=s.path);if(n)return n
}return null},i.router.init=function(){var t=i.router.routes;i.router._regexps={};for(var e in i.router.regexps)i.router._regexps[e]=new RegExp("^"+i.router.regexps[e]+"$");var n={};n.redirect=t.redirect||{},n.rewriteUrl=t.rewriteUrl||{},n.rewriteParams=t.rewriteParams||{};var r=t.route||{},o=[],s={};for(var a in r){var u=r[a],l=i.router.compile(a);l.page=u,o.push(l),s[u]=s[u]||[],s[u].push(l)}n.route=o,n.routeHash=s;var c=t.redirect||{},f=[];for(var p in c){var l=i.router.compile(p);f.push({regexp:l.regexp,path:c[p],params:l.params})
}n.redirect=f,i.router._routes=n},i.router.url=function(t){return i.router.baseDir+t||"/"},i.router.generateUrl=function(t,e){var n,r=i.router._routes.routeHash[t];e=e||{},i.assert(r&&r.length,"ns.router","Could not find route with id '%s'!",t);for(var o=0;o<r.length&&(n=i.router._generateUrl(r[o],e),null===n);o++);return i.assert(null!==n,"ns.router","Could not generate url for layout id '%s'!",t),i.router.url(n)},i.router._generateUrl=function(t,e){for(var n,o,s,a,u,l=[],c=r.extend({},e),f=i.router._routes.rewriteUrl,p=0;p<t.sections.length;p++){o=t.sections[p],s="";
for(var h=0;h<o.items.length;h++)if(u=o.items[h],u.name){a=e[u.name];var d=u.name in e;if(u.is_optional&&!d&&(a=u.default_value),u.is_filter&&a!==u.filter_value)return null;if(!u.is_optional&&!d)return null;if(u.is_optional&&!d)continue;if(!i.router._isParamValid(a,u.type))return null;s+=i.router.encodeParamValue(a,u.name),delete c[u.name]}else s+=u.default_value;(s||!o.is_optional)&&l.push(s)}n=l.join("/"),n=n?i.router.URL_FIRST_SYMBOL+n:"";for(var v=!0;v;){v=!1;for(var y in f){var g=f[y],_=g.length,m=n.substr(0,_);
if(m===g){var w=n.charAt(_);"/"!==w&&"?"!==w&&w||(n=y+n.substr(g.length),v=!0)}}}var b=i.params2query(c);return b?n+"?"+b:n},i.router.compile=function(t){t=t.replace(/\/$/,""),t[0]===i.router.URL_FIRST_SYMBOL&&(t=t.substr(1));var e=t.split("/"),n=e.map(i.router._parseSection),r=n.map(i.router._generateSectionRegexp);"/"===r[0][0]&&(r[0]=i.router.URL_FIRST_SYMBOL+r[0].substr(1));var o=r.join(""),s=[];return n.forEach(function(t){s=s.concat(t.items.filter(function(t){return!!t.name}))}),o="^"+o+"/?(?:\\?(.*))?$",{regexp:new RegExp(o),params:s,sections:n}
},i.router._parseSection=function(t){for(var e=0,n=-1,r=-1,o=[];;){if(n=t.indexOf("{",e),0>n)break;r=t.indexOf("}",n),i.assert(r>0,"ns.router","could not parse parameter in url section: %s",t),n>e&&o.push({default_value:t.substr(e,n-e)}),o.push(i.router._parseParam(t.substr(n+1,r-n-1))),e=r+1}return e<t.length&&o.push({default_value:t.substr(e)}),{is_optional:o.length&&o.filter(function(t){return t.is_optional}).length===o.length,items:o}},i.router._parseParam=function(t){var e,n,r,o,s,a,u=!1;e=t.split("=");
var l=e[0].split(":");return a=l[0],n=l[1]||"id",3===e.length?(o=!1,u=!0,s=e[2],i.assert(s,"ns.router","Parameter '%s' value must be specified",a),i.assert(i.router._isParamValid(s,n),"ns.router","Wrong value for '%s' parameter",a)):(o=2===e.length,r=e[1]),{name:a,type:n,default_value:r,is_optional:o,is_filter:u,filter_value:s}},i.router._generateSectionRegexp=function(t){var e="";return t.items.forEach(function(t){e+=i.router._generateParamRegexp(t)}),e=t.is_optional?"(?:/(?!/)"+e+")?":"/"+e},i.router._generateParamRegexp=function(t){var e,n=i.router.regexps;
return t.default_value&&!t.name?t.default_value:(t.type&&i.assert(t.type in n,"ns.router","Could not find regexp for type '%s'!",t.type),t.is_filter&&t.filter_value?e="("+t.filter_value+")":(e=n[t.type],e="("+e+")",t.is_optional&&(e="(?:"+e+")?")),e)},i.router._isParamValid=function(t,e){var n=i.router._regexps[e];return i.assert(n,"ns.router","Could not find regexp for type '%s'!",e),n.test(t)},i.router._reset=function(){this.baseDir="",this._routes=null,this.routes={},this.regexps={id:"[A-Za-z_][A-Za-z0-9_-]*","int":"[0-9]+"}
},i.router._reset(),function(){function t(t){for(var e={},n=[],r=0,i=t.length;i>r;r++){var o=t[r].models;for(var s in o){var a=o[s],u=a.key;e[u]||(n.push(a),e[u]=!0)}}return n}function e(t){return t.parentUpdate?e(t.parentUpdate):t.EXEC_FLAG===i.U.EXEC.PARALLEL}i.Update=function(t,e,n,r){if(this.view=t,!(this.view.id in e))throw new Error("[ns.Update] Can't find view layout");this.layout=e[this.view.id],this.params=n,this.id=++o,this.promise=new Vow.Promise,r=r||{},this.EXEC_FLAG=r.execFlag||i.U.EXEC.GLOBAL,this.parentUpdate=r.parentUpdate,this.log("created instance",this,"with layout",this.layout,"and params",this.params),this.startTimer("full"),r.timers&&(this._profileTimes.__parent=r.timers),i.Update._addToQueue(this)||this.abort()
},r.extend(i.Update.prototype,i.profile);var n=[],o=-1;i.Update.prototype.STATUS=i.U.STATUS,i.Update.prototype._EVENTS_ORDER=["ns-view-hide","ns-view-htmldestroy","ns-view-htmlinit","ns-view-async","ns-view-show","ns-view-touch"],i.Update.prototype._requestCount=0,i.Update.prototype.log=function(){if(i.DEBUG){var t=Array.prototype.slice.apply(arguments);"generated html"===t[0]&&(t[1]=i.html2node(t[1])),i.log.debug.apply(i.log,["[ns.Update]",this.id].concat(t))}},i.Update.prototype._requestModels=function(t){var e="requestModels."+this._requestCount;
this.startTimer(e),this.log("started models request",t);var n=!this._checkModelsInvalid(t);if(n)return this.stopTimer(e),this.log("received models",t),Vow.fulfill(t);var r=i.request.models(t);return r.always(function(){this.stopTimer(e)},this),r.then(this._onRequestModelsOK,this._onRequestModelsError,this)},i.Update.prototype._onRequestModelsOK=function(t){return this.log("received models",t),t},i.Update.prototype._onRequestModelsError=function(t){this.log("failed to receive models",t);var e={error:this.STATUS.MODELS,expired:this._expired(),invalidModels:t.invalid,validModels:t.valid};
return i.Update.handleError(e,this)?[].concat(t.invalid,t.valid):Vow.reject(e)},i.Update.prototype._checkModelsInvalid=function(t){return(t||[]).some(function(t){return!t.isValid()})},i.Update.prototype._getActiveViews=function(){var t="collectModels."+this._requestCount;this.startTimer(t);var e={sync:[],async:[],hasPatchLayout:!1};return this.view.destroyed||this.view._getRequestViews(e,this.layout,this.params),this.stopTimer(t),this.log("collected incomplete views",e),e},i.Update.prototype._requestSyncModels=function(){var e=this._getActiveViews(),n=t(e.sync);
return this.log("collected needed models",n),this._requestModels(n).then(function(t){return e.hasPatchLayout&&!this._checkModelsInvalid(t)?(this._requestCount++,this._requestSyncModels()):void 0},null,this)},i.Update.prototype._requestAllModels=function(){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);var e=new Vow.Promise,n=this._getActiveViews(),r=t(n.sync);this.log("collected needed models",r);var i=this._requestModels(r),o=n.async.map(function(t){return t.updateAfter(this.promise,this.params,this)
},this);return i.then(function(t){return n.hasPatchLayout&&!this._checkModelsInvalid(t)?(this._requestCount++,void e.sync(this._requestAllModels())):void e.fulfill({async:o})},function(t){e.reject(t)},this),e},i.Update.prototype._applyLayout=function(){this._getActiveViews()},i.Update.prototype._generateHTML=function(){return this._expired()?this._rejectWithStatus(this.STATUS.EXPIRED):Vow.fulfill(this._renderUpdateTree())},i.Update.prototype._renderUpdateTree=function(){this.startTimer("collectViews");
var t={views:{}};this.view.destroyed||this.view._getUpdateTree(t),this.log("created render tree",t),this.stopTimer("collectViews");var e;return i.object.isEmpty(t.views)||(this.startTimer("generateHTML"),e=this.applyTemplate(t,this.params,this.layout),this.log("generated html",e),this.stopTimer("generateHTML")),e},i.Update.prototype._insertNodes=function(t){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);this.startTimer("triggerHideEvents");var e={"ns-view-hide":[],"ns-view-htmldestroy":[]};
this.view.destroyed||this.view.beforeUpdateHTML(e,!1),this._triggerViewEvents(e);var n={"ns-view-async":[],"ns-view-htmlinit":[],"ns-view-show":[],"ns-view-touch":[]};return this.switchTimer("triggerHideEvents","insertNodes"),this.view.destroyed||this.view._updateHTML(t,{toplevel:!0},n),this.switchTimer("insertNodes","triggerEvents"),this._triggerViewEvents(n),this.stopTimer("triggerEvents"),Vow.fulfill()},i.Update.prototype._triggerViewEvents=function(t){for(var e=this.getTimers(),n=0,r=this._EVENTS_ORDER.length;r>n;n++)for(var i=this._EVENTS_ORDER[n],o=t[i]||[],s=o.length-1;s>=0;s--)o[s].trigger(i,this.params,e)
},i.Update.prototype._updateDOM=function(){if(this._expired())return this._rejectWithStatus(this.STATUS.EXPIRED);var t=this._renderUpdateTree();this.startTimer("html2node");var e=i.html2node(t||"");this.stopTimer("html2node"),this._insertNodes(e)},i.Update.prototype.prefetch=function(){return this.log("started `prefetch` scenario"),this._requestSyncModels().then(this._fulfill,this._reject,this),this.promise},i.Update.prototype.generateHTML=function(){return this.log("started `generateHTML` scenario"),Vow.invoke(this._requestSyncModels.bind(this)).then(this._generateHTML,null,this).then(this._fulfill,this._reject,this),this.promise
},i.Update.prototype.prerender=function(){return this.log("started `prerender` scenario"),i.todo(),this.promise},i.Update.prototype.render=function(){return this._expired()?(this._reject({error:this.STATUS.EXPIRED}),this.promise):(this.log("started `render` scenario"),Vow.invoke(this._requestAllModels.bind(this)).then(function(t){this._updateDOM(),this._fulfill(t)},this._reject,this).then(null,this._reject,this),this.promise)},i.Update.prototype.start=i.Update.prototype.render,i.Update.prototype.reconstruct=function(t){return this.log("started `reconstruct` scenario"),this._applyLayout(),Vow.invoke(this._insertNodes.bind(this),t).then(function(){this._fulfill({async:[]})
},this._reject,this),this.promise},i.Update.prototype.applyTemplate=function(t){return i.renderString(t,null,"")},i.Update.prototype._expired=function(){return this.promise.isResolved()||-1===n.indexOf(this)},i.Update.prototype.abort=function(){this._reject({error:i.U.STATUS.EXPIRED})},i.Update.prototype._fulfill=function(t){this.promise.isResolved()||(i.Update._removeFromQueue(this),this.stopTimer("full"),this.promise.fulfill(t),this.perf(this.getTimers()),this.log("successfully finished scenario"))
},i.Update.prototype._reject=function(t){this.promise.isResolved()||(i.Update._removeFromQueue(this),this.stopTimer("full"),this.promise.reject(t),this.log("scenario was rejected with reason",t))},i.Update.prototype._rejectWithStatus=function(t){return Vow.reject({error:t})},i.Update.prototype.isGlobal=function(){return this.EXEC_FLAG===i.U.EXEC.GLOBAL},i.Update.prototype.perf=function(){},i.Update.handleError=function(){return!1},i.Update._removeFromQueue=function(t){var e=n.indexOf(t);e>-1&&n.splice(e,1)
},i.Update._addToQueue=function(t){var r,o,s=n,a=i.U.EXEC,u=a.GLOBAL,l=a.ASYNC,c=t.EXEC_FLAG;if(c===u){var f=[];for(r=s.length-1;r>=0;r--){var p=s[r];e(p)?f.push(p):p.abort()}n=f}else if(c===l&&!e(t))for(r=0,o=s.length;o>r;r++)if(s[r].EXEC_FLAG===u)return!1;return n.push(t),!0}}(),function(){var t=0,o=/ns-view-id-\d+/;i.View=function(){},r.extend(i.View.prototype,i.Events),i.View.prototype.STATUS=i.V.STATUS,i.View.prototype._$document="undefined"==typeof n?null:$(n),i.View.prototype._$window="undefined"==typeof e?null:$(e),i.View.prototype.key=null,i.View.prototype.params=null,i.View.prototype.node=null,i.View.prototype.$node=null,i.View.prototype.views=null,i.View.prototype.id=null,i.View.prototype._visible=!1,i.View.prototype.__uniqueId=null,i.View.prototype.__modelsEventsBinded=!1,i.View.prototype._init=function(t,e,n){this.id=t,this.__setUniqueId(),this.async=n,this.info=i.View.info(t),r.extend(this,i.View.getKeyAndParams(this.id,e||{},this.info)),this._initModels(),this._modelsVersions={},this.views={},this.status=this.STATUS.NONE,this.destroyed=!1,this.__customInit(),this._bindCreateEvents(),this.trigger("ns-view-init")
},i.View.prototype.__setUniqueId=function(){this.__uniqueId||(this.__uniqueId="ns-view-id-"+ ++t)},i.View.prototype.__customInit=r.nop,i.View.prototype._initModels=function(){this.models={},this._modelsHandlers={};for(var t in this.info.models)if(!this.models[t]){var e=i.Model.get(t,this.params);this.models[t]=e,this._modelsHandlers[e.key]={}}},i.View.prototype._getView=function(t){return this.views[t]},i.View.prototype._addView=function(t,e,n){var r=this._getView(t);return r||(r=n===i.L.BOX?new i.Box(t,e):i.View.create(t,e,n===i.L.ASYNC),this.views[r.id]=r),r
},i.View.prototype.__onHtmldestroy=function(){this._unbindEvents("init")},i.View.prototype._htmlinit=function(t){this._bindEvents("init"),t.push(this)},i.View.prototype.hideAndUnbindEvents=function(){this.__onHide()},i.View.prototype.__onHide=function(){var t=!this.isLoading()&&this._visible===!0;t&&this._unbindEvents("show"),this._visible=!1},i.View.prototype._show=function(t){return this.isLoading()||this._visible?!1:(this.__modelsEventsBinded||this.__bindModelsEvents(),this._bindEvents("show"),this._visible=!0,t&&t.push(this),!0)
},i.View.prototype.__bindModelsEvents=function(){this.__modelsEventsBinded=!0;var t=this.models;for(var e in t){var n=t[e];this.__bindModelEvents(n)}},i.View.prototype.__bindModelEvents=function(t){var e=this.info.models[t.id];for(var n in e){var o=e[n],s=this[o]||e[n];i.View.assert("function"==typeof s,4,[this.id,o,t.id]),s===this.keepValid&&(s=r.nop),this.__bindModelEvent(t,n,this._invokeModelHandler.bind(this,s,t))}},i.View.prototype._invokeModelHandler=function(t,e){return this._saveModelVersion(e.id),t.apply(this,Array.prototype.slice.call(arguments,2))
},i.View.prototype.__bindModelEvent=function(t,e,n){t.on(e,n),this._modelsHandlers[t.key][e]=n},i.View.prototype.__unbindModelsEvents=function(){var t=this.models;for(var e in t){var n=t[e];this.__unbindModelEvent(n)}},i.View.prototype.__unbindModelEvent=function(t){var e=this._modelsHandlers[t.key];for(var n in e)t.off(n,e[n]),delete e[n]},i.View.prototype._prepareCallback=function(t){if("string"==typeof t){var e=this[t];return i.View.assert(!!e,5,[t,this.id]),e}return t},i.View.prototype._bindEventHandlers=function(t,e){for(var n=[],r=0,i=t.length;i>r;r++){var o=t[r],s=[].concat(o);
s[e]=this._prepareCallback(o[e]).bind(this),n.push(s)}return n},i.View.prototype._getEvents=function(t){var e="_"+t+"Events";if(!this[e]){var n=this.info[t+"Events"],r=this.info[t+"Nsevents"];this[e]={bind:this._bindEventHandlers(n.bind,2),delegate:this._bindEventHandlers(n.delegate,2),nsevents:this._bindEventHandlers(r,1)}}return this[e]},i.View.prototype._bindEvents=function(t){var e,n,r,o=this.$node,s=this._getEvents(t),a=s.delegate;for(e=0,n=a.length;n>e;e++)r=a[e],"window"===r[1]||"document"===r[1]?this["_$"+r[1]].on(r[0],r[2]):r[1]?o.on(r[0],r[1],r[2]):o.on(r[0],r[2]);
var u=s.bind;for(e=0,n=u.length;n>e;e++)r=u[e],o.find(r[1]).on(r[0],r[2]);var l=s.nsevents;for(e=0,n=l.length;n>e;e++)r=l[e],i.events.on(r[0],r[1])},i.View.prototype._bindCreateEvents=function(){for(var t=0,e=this.info.createEvents.length;e>t;t++){var n=this.info.createEvents[t];this.on(n[0],this._prepareCallback(n[1]))}},i.View.prototype._unbindEvents=function(t){var e,n,r,o=this.$node,s=this._getEvents(t),a=s.delegate;for(e=0,n=a.length;n>e;e++)r=a[e],"window"===r[1]||"document"===r[1]?this["_$"+r[1]].off(r[0],r[2]):r[1]?o.off(r[0],r[1],r[2]):o.off(r[0],r[2]);
var u=s.bind;for(e=0,n=u.length;n>e;e++)r=u[e],o.find(r[1]).off(r[0],r[2]);var l=s.nsevents;for(e=0,n=l.length;n>e;e++)r=l[e],i.events.off(r[0],r[1])},i.View.prototype.invalidate=function(){for(var t=this._getDescendantsAndSelf(),e=0,n=t.length;n>e;e++){var r=t[e];r.status===this.STATUS.OK&&(r.status=this.STATUS.INVALID)}},i.View.prototype.isOk=function(){return this.status===this.STATUS.OK},i.View.prototype.isLoading=function(){return this.status===this.STATUS.LOADING},i.View.prototype.isNone=function(){return this.status===this.STATUS.NONE
},i.View.prototype.isValid=function(){return this.isOk()&&this.isModelsValidWithVersions()},i.View.prototype.isValidSelf=i.View.prototype.isValid,i.View.prototype.isValidWithDesc=function(){if(!this.isValid())return!1;for(var t in this.views)if(!this.views[t].isValidWithDesc())return!1;return!0},i.View.prototype.isModelsValidWithVersions=function(){return this.isModelsValid(this._modelsVersions)},i.View.prototype.isModelsValid=function(t){var e=this.models;for(var n in e){var r=e[n];if(!r.isValid()||t&&this._getModelVersion(n)>t[n])return!1
}return!0},i.View.prototype.isVisible=function(){return this._visible},i.View.prototype._apply=function(t){var e=this.views;for(var n in e)t(e[n],n)},i.View.prototype._saveLayout=function(t){this.layout={},this.layout[this.id]={views:t}},i.View.prototype._getRequestViews=function(t,e,n){var r=this.__evaluateState();this.__registerInUpdate(r,t);var o=!1;r&&(o=!0,"function"==typeof this.patchLayout&&(this.isModelsValid()?this.__patchLayout(e,n):(o=!1,t.hasPatchLayout=!0)));var s=e.views;if(this._saveLayout(s),o){for(var a in s)this._addView(a,n,s[a].type);
var u=this.id;this._apply(function(e,r){var o=s[r];i.View.assert(!!o,13,[u]),e._getRequestViews(t,o,n)})}return t},i.View.prototype.__patchLayout=function(t,e){t.views={};var n=this.patchLayout(e);i.View.assert(!!n,11);var o=i.layout.page(n,e);this.__checkPatchLayout(o),r.extend(t.views,o)},i.View.prototype.__checkPatchLayout=function(t){for(var e in t)i.View.assert(t[e].type===i.L.BOX,12)},i.View.prototype.__evaluateState=function(){this.asyncState=!1;var t=!0;return this.async?this.shouldBeSync||this.isModelsValid()?t=!0:(this.asyncState=!0,t=!1):(this.isValidSelf()||this.invalidate(),t=!0),this.shouldBeSync=!1,t
},i.View.prototype.__registerInUpdate=function(t,e){t?e.sync.push(this):e.async.push(this)},i.View.prototype._getUpdateTree=function(t){return this.isValid()?this._apply(function(e){e._getUpdateTree(t)}):t.views[this.id]=this._getViewTree(),t},i.View.prototype._getCommonTree=function(){var t={box:this.info.isBox,collection:this.info.isCollection,id:this.id,key:this.key,models:{},params:this.params,state:this.asyncState?"loading":"ok",tree:{},uniqueId:this.__uniqueId,views:{}};return t.tree[this.id]=!0,t
},i.View.prototype._getTree=function(){var t=this._getCommonTree(),e=this.patchTree(t);return e&&"object"==typeof e&&!Array.isArray(e)&&(t=r.extend(e,t)),t},i.View.prototype._getViewTree=function(){var t=this._getTree();return t.models=this._getModelsForTree(),"loading"===t.state?t:(this.isModelsValid()?t.views=this._getDescViewTree():t.state="error",t)},i.View.prototype.patchTree=r.nop,i.View.prototype._getDescViewTree=function(){var t={};return this._apply(function(e,n){t[n]=e._getViewTree()}),t
},i.View.prototype._getPlaceholderTree=function(){var t=this._getTree();return t.state="placeholder",this.info.isCollection?t.views=this._getDescViewTree():this._apply(function(e){e._getUpdateTree(t)}),t},i.View.prototype._getModelsForTree=function(){var t={},e=this.models;for(var n in e){var r=e[n];t[n]={},r.isValid()?(t[n].status="ok",t[n][n]=r.getData()):(t[n].status="error",t[n][n]=r.getError())}return t},i.View.prototype.getModel=function(t){return this.models[t]},i.View.prototype.getModelData=function(t,e){var n=this.getModel(t);
return e?n.get(e):n.getData()},i.View.prototype._getDescendantsAndSelf=function(t){return t=t||[],t.push(this),this._apply(function(e){e._getDescendantsAndSelf(t)}),t},i.View.prototype._setNode=function(t){var e=this.STATUS;t?(this.node=t,this.$node=$(t),this.status=this.asyncState?e.LOADING:e.OK):this.status=e.NONE},i.View.prototype._extractNodeByKey=function(t){var e=t.querySelector('[data-key="'+this.key+'"]');if(!e)return null;var n=e.className;return-1===n.indexOf(this.__uniqueId)&&(e.className=n.replace(o,this.__uniqueId)),e
},i.View.prototype._extractNode=function(t){var e=i.byClass(this.__uniqueId,t)[0];return e&&e.getAttribute("data-key")===this.key||(e=this._extractNodeByKey(t)),e},i.View.prototype._selfBeforeUpdateHTML=function(t,e){if(e){var n=this._visible===!0&&!this.isLoading();return void(n&&t["ns-view-hide"].push(this))}var r=!this.isValidSelf();r&&this.node&&!this.isLoading()&&(this._visible===!0&&t["ns-view-hide"].push(this),t["ns-view-htmldestroy"].push(this))},i.View.prototype.beforeUpdateHTML=function(t,e){this._selfBeforeUpdateHTML(t,e),this.asyncState||this._apply(function(n){n.beforeUpdateHTML(t,e)
})},i.View.prototype._updateHTML=function(t,e,n){var o;o=e.toplevel?r.extend({},e):e;var s,a=!this.isValid();a&&(s=this._extractNode(t),i.View.assert(!!s,6,[this.id]),e.toplevel&&(this.node&&(i.replaceNode(this.node,s),o.parent_added=!0),o.toplevel=!1),this.node&&!this.isLoading()&&(this.__onHide(),this.__onHtmldestroy()),!this.node||e.parent_added||o.parent_added||i.replaceNode(this.node,s),this._setNode(s),this.isOk()?this._htmlinit(n["ns-view-htmlinit"]):this.isLoading()&&n["ns-view-async"].push(this),this._saveModelsVersions()),this.isOk()&&(this._show(n["ns-view-show"]),n["ns-view-touch"].push(this)),s=s||t,this.asyncState||this._apply(function(t){t._updateHTML(s,o,n)
})},i.View.prototype._saveModelsVersions=function(){for(var t in this.models)this._saveModelVersion(t)},i.View.prototype._getModelVersion=function(t){return this.models[t].getVersion()},i.View.prototype._saveModelVersion=function(t){this._modelsVersions[t]=this._getModelVersion(t)},i.View.prototype.keepValid=i.View.prototype._saveModelsVersions,i.View.prototype.updateAfter=function(t,e,n){this._asyncPromise=new Vow.Promise;var r=this;return t.then(function(){r.update(e,{parentUpdate:n,timers:n.getTimers()})
}),this._asyncPromise},i.View.prototype.update=function(t,e){this.shouldBeSync=!0;var n=this.params;if(t&&(n=r.extend({},this.params,t)),!this.layout){var o="ns-temp-layout-for-"+this.id,s={};s[this.id]={},i.layout.define(o,s),this.layout=i.layout.page(o,n),i.layout.undefine(o)}e=e||{},e.execFlag=e.execFlag||i.U.EXEC.ASYNC;var a=new i.Update(this,this.layout,n,e).render();return this._asyncPromise&&this._asyncPromise.sync(a),a},i.View.prototype.destroy=function(){this._apply(function(t){t.destroy()
}),this.trigger("ns-view-destroyed"),this.views={},this.node&&!this.isLoading()&&(this.isVisible()&&(this.trigger("ns-view-hide"),this.hideAndUnbindEvents()),this.trigger("ns-view-htmldestroy"),this.__onHtmldestroy()),this.__unbindModelsEvents(),this.node&&(this.$node.off().removeData().remove(),this.node=null,this.$node=null),this.info=null,this.layout=null,this.models=null,this.params=null,this.status=this.STATUS.NONE,this.destroyed=!0,this._modelsHandlers=null};var s={},a={};i.View.define=function(t,e,n){i.View.assert(!(t in s),1,[t]),e=e||{};
var o=this;"string"==typeof n?(o=a[n],i.View.assert(!!o,2,[n,t])):"function"==typeof n&&(o=n);var u=e.ctor||function(){};return u=r.inherit(u,o,e.methods),e.models=this._formatModelsDecl(e.models||{}),e.events=e.events||{},e.isBox=!1,e.isCollection=!1,e.ready=!1,s[t]=e,a[t]=u,u},i.View._reset=function(){a={},s={}},i.View.infoLite=function(t){var e=s[t];return i.View.assert(!!e,3,[t]),e},i.View.info=function(t){var e=i.View.infoLite(t);return e.ready||(i.View._initInfoParams(e),i.View._initInfoEvents(e),e.ready=!0),e
},i.View._initInfoParams=function(t){if(t.params){if(i.View.assert(!t["params+"],7),i.View.assert(!t["params-"],8),"function"==typeof t.params)return void(t.pGroups=[]);var e,n=[];e=Array.isArray(t.params)?t.params:[t.params];for(var o=0;o<e.length;o++){var s=e[o];n.push({pNames:Object.keys(s),pFilters:s,pDefaults:{}})}t.pGroups=n}else{var a={};for(var u in t.models){var l=i.Model.info(u);i.View.assert(!!l,9,[u]),"object"==typeof l.params&&r.extend(a,l.params)}var c=t["params-"];if(c){for(var o=0;o<c.length;o++)delete a[c[o]];
delete t["params-"]}t["params+"]&&(r.extend(a,t["params+"]),delete t["params+"]);var f=Object.keys(a);t.pGroups=f.length?[{pNames:f,pFilters:{},pDefaults:a}]:[]}},i.View._initInfoEvents=function(t){t.createEvents=[],t.initEvents={bind:[],delegate:[]},t.showEvents={bind:[],delegate:[]},t.initNsevents=[],t.showNsevents=[];for(var e in t.events){var n=e.split(" "),r=n.shift().split("@"),o=r.length>1?r.pop():"";o=!o||"init"!==o&&"show"!==o?"":o;var s=r.join("@"),a=n.join(" ");if(s){var u=t.events[e],l=i.V.DOM_EVENTS.indexOf(s)>-1;
if(l){var c=[s,a,t.events[e]],f="window"===a||"document"===a,p=f||!("scroll"===s&&a);o||(o=f?"show":"init"),t[o+"Events"][p?"delegate":"bind"].push(c)}else i.V.NS_EVENTS.indexOf(s)>-1?t.createEvents.push([s,u]):(o=o||"show",t[o+"Nsevents"].push([s,u]))}}},i.View.getKey=function(t,e,n){return this.getKeyAndParams(t,e,n).key},i.View.getKeyAndParams=function(t,e,n){n=n||i.View.info(t)||{};var o;return o="function"==typeof n.params?n.params(r.extend({},e)):i.View._getKeyParams(t,e,n),"function"==typeof n.paramsRewrite&&(o=n.paramsRewrite(o)),i.View.assert(!!o,10,[t]),{params:o,key:i.key("view="+t,o)}
},i.View._getKeyParams=function(t,e,n){var o={},s=!1;for(var a in n.models){var u=i.Model.info(a);"function"==typeof u.params&&(s=!0,r.extend(o,u.params(e)))}s&&(r.extend(o,e),e=o);var l=n.pGroups||[];if(!l.length)return s?e:{};for(var c=0;c<l.length;c++){for(var f=l[c],p=f.pNames||[],h=f.pFilters||{},d=f.pDefaults||{},v={},y=0,g=p.length;g>y;y++){var _=p[y],m=e[_],w=h[_],b=_ in d;if(m=void 0===m?d[_]:m,null!=m||!b){if(null==m||w&&m!==w){v=null;break}v[_]=m}}if(v)return v}return null},i.View.create=function(t,e,n){var r=a[t];
i.View.assert(!!r,3,[t]);var o=new r;return o._init(t,e,n),o},i.View.assert=function(t,e,n){if(!t){n=Array.isArray(n)?n:[];var r=["ns.View",i.View.ERROR_CODES[e]].concat(n);i.assert.fail.apply(i,r)}},i.View.ERROR_CODES={1:"Can't redefine '%s'",2:"Can't find '%s' to extend '%s'",3:"'%s' is not defined",4:"'%s' can't find handler '%s' for model '%s'",5:"Can't find method '%s' in '%s'",6:"Can't find node for '%s'",7:"you cannot specify params and params+ at the same time",8:"you cannot specify params and params- at the same time",9:"Model %s is not defined!",10:"Could not generate key for view %s",11:"#patchLayout MUST returns valid layout ID",12:"#patchLayout MUST returns layout with ns.Box at top",13:'You cannot change children inside of a regular view. Maybe "%s" should be ns.Box.'},i.View.defaultModelEvents={"ns-model-insert":"invalidate","ns-model-remove":"invalidate","ns-model-changed":"invalidate","ns-model-destroyed":"invalidate"},i.View._expandModelsDecl=function(t){if(!Array.isArray(t))return t;
for(var e={},n=0,i=t.length;i>n;n++)e[t[n]]=r.extend({},this.defaultModelEvents);return e},i.View._formatModelsDecl=function(t){var e=this._expandModelsDecl(t);for(var n in e){var r=u(e[n]),i=null;"string"==typeof r&&(i=r,r={});for(var o in this.defaultModelEvents){var s=this.defaultModelEvents[o];r[o]=void 0===r[o]?i||s:u(r[o])}e[n]=r}return e};var u=function(t){return!0===t?"invalidate":!1===t?"keepValid":t}}(),i.ViewCollection=function(){},r.extend(i.ViewCollection,i.View),r.inherit(i.ViewCollection,i.View),i.ViewCollection.define=function(t,e,n){e=e||{},n=n||this;
var r=i.View.define.call(this,t,e,n);if(i.assert(e.split,"ns.ViewCollection","'%s'  must define 'split' section",t),i.assert(!(e.split.intoViews&&e.split.intoLayouts),"ns.ViewCollection","'%s' can't define 'split.intoViews' and 'split.intoLayouts' sections at same time",t),"string"==typeof e.split.intoViews){var o=i.layout.generateSimple(e.split.intoViews,"ns-auto-layout-"+t);delete e.split.intoViews,e.split.intoLayouts=new Function("",'return "'+o+'"')}else"function"==typeof e.split.intoViews&&(e.split.intoLayouts=function(n,r){var o=e.split.intoViews.call(this,n,r);
return o?i.layout.generateSimple(o,"ns-auto-layout-"+t):null});i.assert(e.split.intoLayouts,"ns.ViewCollection","'%s'  must define 'split.intoLayouts' section",t),i.assert(e.split.byModel,"ns.ViewCollection","'%s'  must define 'split.byModel' section",t);var s=e.split.byModel in e.models&&i.Model.infoLite(e.split.byModel).isCollection;return i.assert(s,"ns.ViewCollection","'%s'  must depend on ns.ModelCollection",t),e.isCollection=!0,e.modelCollectionId=e.split.byModel,r},i.ViewCollection.prototype.__customInit=function(){this.__itemsToRemove=[],this.__model2View={},this.__view2ModelKey={}
},i.ViewCollection.eventsModelCollectionDefault={"ns-model-insert":"keepValid","ns-model-remove":"keepValid","ns-model-changed":"invalidate","ns-model-destroyed":"invalidate"},i.ViewCollection._expandModelsDecl=function(t){if(!Array.isArray(t))return t;for(var e={},n=0,o=t.length;o>n;n++){var s=t[n];e[s]=i.Model.infoLite(s).isCollection?r.extend({},this.eventsModelCollectionDefault):r.extend({},this.defaultModelEvents)}return e},i.ViewCollection.prototype._invokeModelHandler=function(t,e,n,r){return r&&r.model?void 0:(this._saveModelVersion(e.id),t.apply(this,Array.prototype.slice.call(arguments,2)))
},i.ViewCollection.prototype._getModelVersion=function(t){var e,n=this.models[t];return e=t===this.info.modelCollectionId?n.getSelfVersion():n.getVersion()},i.ViewCollection.prototype.forEachItem=function(t){var e=this.models[this.info.modelCollectionId];if(e.isValid())for(var n=e.models,r=0,i=n.length;i>r;r++){var o=this.getItemByModel(n[r]);o&&t(o)}},i.ViewCollection.prototype.getItemByModel=function(t){var e=t.key;return this.__model2View[e]},i.ViewCollection.prototype.isValid=function(){return this.isValidSelf()&&this.isValidDesc()
},i.ViewCollection.prototype.isValidDesc=function(){for(var t in this.views)if(!this.views[t].isValid())return!1;return!0},i.ViewCollection.prototype.invalidate=function(){this.status===this.STATUS.OK&&(this.status=this.STATUS.INVALID)},i.ViewCollection.prototype.invalidateAll=i.View.prototype.invalidate,i.ViewCollection.prototype._getView=function(t,e){var n=i.View.getKey(t,e);return this._getViewByKey(n)},i.ViewCollection.prototype._getViewByKey=function(t){return this.views&&this.views[t]||null
},i.ViewCollection.prototype._addView=function(t,e,n){var r=this._getView(t,e);if(!r){r=i.View.create(t,e);var o=r.key,s=n.key;this.views[o]=r,this.__model2View[s]=r,this.__view2ModelKey[o]=s}return r},i.ViewCollection.prototype._deleteView=function(t){var e=t.key,n=this.__view2ModelKey[e];delete this.views[e],delete this.__model2View[n],delete this.__view2ModelKey[e]},i.ViewCollection.prototype._apply=function(t){var e=this.views;for(var n in e)t(e[n],e[n].id)},i.ViewCollection.prototype._getRequestViews=function(t,e,n){var o=e.views,s=this.__evaluateState();
if(this.__registerInUpdate(s,t),s){var a=this.models[this.info.modelCollectionId],u={};if(a.isValid()){for(var l=a.models,c=this.info.split.intoLayouts,f=[],p=0,h=l.length;h>p;p++){var d=l[p],v=r.extend({},n,d.params),y=c.call(this,d,v);if(y){var g=i.layout.page(y,v);f.push(g);for(var _ in g){var m=this._addView(_,v,d);m._getRequestViews(t,g[_],v),u[m.key]=null}}}o["ns-view-container"]=f,this.__collectInactiveViews(u)}else t.hasPatchLayout=!0}return this._saveLayout(o),t},i.ViewCollection.prototype.__collectInactiveViews=function(t){var e=this;
this._apply(function(n){n.key in t||(e._deleteView(n),e.__itemsToRemove.push(n))})},i.ViewCollection.prototype.__destroyInactiveViews=function(){for(var t=this.__itemsToRemove,e=0,n=t.length;n>e;e++)t[e].destroy();this.__itemsToRemove=[]},i.ViewCollection.prototype._getUpdateTree=function(t){var e;return e=this.isValidSelf()?this._getPlaceholderTree():this._getViewTree(),t.views[this.id]=e,t},i.ViewCollection.prototype._getDescViewTree=function(){var t={};t["ns-view-collection-container"]=[];var e=this.isValidSelf();
return this.forEachItem(function(n){var r=null;if(e)if(n.info.isCollection&&n.isValidSelf())r=n._getPlaceholderTree();else if(n.isValid()){if(!n.isValidWithDesc()){var i={views:{}};return n._getUpdateTree(i),void t["ns-view-collection-container"].push(i.views)}}else r=n._getViewTree();else r=n.isValidSelf()?n._getPlaceholderTree():n._getViewTree();if(r){var o={};o[n.id]=r,t["ns-view-collection-container"].push(o)}}),t},i.ViewCollection.prototype._updateHTML=function(t,e,n){var o,s=this._extractNode(t),a=$(s).hasClass("ns-view-placeholder");
if(o=e.toplevel?r.extend({},e):e,this.isValidSelf())!e.toplevel&&a&&(i.replaceNode(s,this.node),o=r.extend({},e),o.toplevel=!0,o.parent_added=!0);else{var u=!!this.node;if(!s)throw new Error("[ns.ViewCollection] Can't find node for '"+this.id+"'");e.toplevel?a?o.toplevel=!0:(this.node&&i.replaceNode(this.node,s),o.toplevel=!1,o.parent_added=!0,this._setNode(s)):a?(i.replaceNode(s,this.node),o.toplevel=!1,o.parent_added=!0):this._setNode(s),u&&!this.isLoading()&&(this.__onHide(),this.__onHtmldestroy()),this.isOk()?this._htmlinit(n["ns-view-htmlinit"]):this.isLoading()&&n["ns-view-async"].push(this)
}if(this.isOk()&&(this._show(n["ns-view-show"]),n["ns-view-touch"].push(this),this._saveModelsVersions()),!this.isLoading()){var l={},c=this.__getContainer();s=s||this.node;var f;this.forEachItem(function(t){if(a){var e=!t.isValid();t._updateHTML(s,o,n),e&&(f?$(f.node).after(t.node):$(c).prepend(t.node))}else{var u=t.isValid(),p=o;u&&(p=r.extend({},o),p.toplevel=!0),t._updateHTML(s,p,n),u&&i.replaceNode(t._extractNode(s),t.node)}l[t.key]=t,f=t})}this.__destroyInactiveViews(),this.isLoading()||this.__sortViewItems()
},i.ViewCollection.prototype.__getContainer=function(){var t;return t=i.hasClass(this.node,"ns-view-container-desc")?this.node:i.byClass("ns-view-container-desc",this.node)[0],i.assert(t,"ns.ViewCollection","Can't find descendants container (.ns-view-container-desc element) for '"+this.id+"'"),t},i.ViewCollection.prototype.__sortViewItems=function(){var t=this.__getContainer(),e=i.childrenIterator(t);this.forEachItem(function(n){var r=e.getNext();r!==n.node&&(r?t.insertBefore(n.node,r):t.appendChild(n.node))
})},i.Box=function(t,e){this.id=t,this.__setUniqueId(),this.params=e,this.views={},this.key=i.Box.getKey(t),this.node=null,this.active={},this._visible=!1,this.destroyed=!1,this.info={isBox:!0,isCollection:!1}},i.Box.prototype._getViewKey=function(t,e,n){var r;return r=n===i.L.BOX?i.Box.getKey(t):i.View.getKey(t,e)},i.Box.prototype._getView=function(t,e,n){var r=this._getViewKey(t,e,n);return this.views[r]},i.Box.prototype._addView=function(t,e,n){var r=this._getView(t,e,n);return r||(r=n===i.L.BOX?new i.Box(t,e):i.View.create(t,e,n===i.L.ASYNC),this.views[r.key]=r),r
},i.Box.prototype._getDescendantsAndSelf=function(t){var e=this.views;t.push(this);for(var n in e){var r=e[n];r._getDescendantsAndSelf(t)}return t},i.Box.prototype._getRequestViews=function(t,e,n){var r=e.views,i={};for(var o in r){var s=r[o],a=this._addView(o,n,s.type);a._getRequestViews(t,s,n),i[o]=a.key}this.active=i},i.Box.prototype._getUpdateTree=function(t){if(this.isNone())t.views[this.id]=this._getViewTree();else for(var e in this.active){var n=this.active[e];this.views[n]._getUpdateTree(t)
}},i.Box.prototype._getViewTree=function(){var t=this._getCommonTree();for(var e in this.active){var n=this.active[e];t.views[e]=this.views[n]._getViewTree()}return t},i.Box.prototype.beforeUpdateHTML=function(t,e){for(var n in this.views){var r=this.views[n],i=e||this.active[r.id]!==r.key;r.beforeUpdateHTML(t,i)}},i.Box.prototype._hideInactiveViews=function(){for(var t in this.views){var e=this.views[t];if(this.active[e.id]!==e.key){e.node&&i.removeNode(e.node);for(var n=e._getDescendantsAndSelf([]),r=0,o=n.length;o>r;r++)n[r].hideAndUnbindEvents()
}}},i.Box.prototype._updateHTML=function(t,e,n){var r;if(!this.node||!e.toplevel){var o=i.byClass("ns-view-"+this.id,t)[0];o&&(r=this.node,this.node=o,this._visible=!1)}if(!this.node)throw new Error("[ns.Box] Can't find node for '"+this.id+"'");this._hideInactiveViews();var s=this.views,a=this.active;for(var u in a){var l=a[u],c=s[l];c._updateHTML(t,e,n)}this._transferViewsToNewNode(r),this._sortViewNodes(),this._show()},i.Box.prototype._sortViewNodes=function(){var t=this.active,e=this.views,n=i.childrenIterator(this.node);
for(var r in t){var o=t[r],s=e[o],a=n.getNext();a!==s.node&&(a?this.node.insertBefore(s.node,a):this.node.appendChild(s.node))}},i.Box.prototype._transferViewsToNewNode=function(t){if(t){var e=this.views;for(var n in e){var r=e[n];if(this.active[r.id]!==r.key){var i=r.node;t.contains(i)&&this.node.appendChild(i)}}}},i.Box.prototype._show=function(){return this._visible===!1&&(this._visible=!0),!1},i.Box.prototype.hideAndUnbindEvents=function(){this._visible===!0&&(this._visible=!1)},i.Box.prototype.isNone=function(){return!this.node
},i.Box.prototype.isValid=function(){return!!this.node},i.Box.prototype.destroy=function(){var t=this.views;for(var e in t)t[e].destroy();this.node&&($(this.node).off().removeData().remove(),this.node=null,this.$node=null),this.active=null,this.key=null,this.params=null,this.views=null,this._visible=!1,this.destroyed=!0},i.Box.prototype.__setUniqueId=i.View.prototype.__setUniqueId,i.Box.prototype._getCommonTree=i.View.prototype._getCommonTree,i.Box.prototype.isValidWithDesc=i.View.prototype.isValidWithDesc,i.Box.prototype.isOk=r.true,i.Box.prototype.isLoading=r.false,i.Box.getKey=function(t){return"box="+t
},e.no=r,e.ns=i}(window,document),t.externals["ns-url"]=function(t){return ns.router.url(t)},t.externals["ns-generate-url"]=function(t,e){return ns.router.generateUrl(t,e)},function(){function e(e,n,i,o,s,a,u){var l=t.nodeset2data(e),c=l.bosphorus,f=r(c,n,i,o,s,a,u);return Array.isArray(f)?t.array2nodeset(f):t.object2nodeset(f)}function n(e,n,r,o,s,a,u,l){var c=t.nodeset2data(e),f=c.bosphorus,p=f.getModel(n);ns.assert(p,"noscript-bosphorus","Model is undefined");var h=i(f,p,r,o,s,a,u,l);return Array.isArray(h)?t.array2nodeset(h):t.object2nodeset(h)
}function r(t,e,n,r,i,o,s){try{return t[e](n,r,i,o,s)}catch(a){return ns.log.exception("ns-view-call",a,{id:t.id,key:t.key,method:e}),[]}}function i(t,e,n,r,i,o,s,a){try{return e[n](r,i,o,s,a)}catch(u){return ns.log.exception("ns-model-call",u,{id:t.id,key:t.key,method:n,model:e.id}),[]}}ns.View.prototype.patchTree=function(){return{bosphorus:this}},t.externals["_ns-view-call"]=e,t.externals["_ns-view-call-scalar"]=e,t.externals["_ns-model-call"]=n,t.externals["_ns-model-call-scalar"]=n}(),ns.page.forceReload=function(t){var e=window.location;
window.removeEventListener("hashchange",ns.history.onpopstate,!1),e.replace(t||e.hash),e.reload()},ns.page.hashReplace=function(t){if(!t)return!1;ns.page._forceHashChange=t;var e=window.location.href.toString().replace(/#.+$/,"")+t;return window.location.replace(e),!0},ns.page._forceHashChange=null,ns.router.URL_FIRST_SYMBOL="#",ns.history.init=function(){window.addEventListener("hashchange",ns.history.onpopstate,!1),$(document).on("click","a",ns.history._onAnchorClick)},ns.history.pushState=function(t){ns.page._forceHashChange=t,window.location.href=t
},ns.history.replaceState=function(t){ns.page._forceHashChange=t,window.location.replace(t)},ns.history.onpopstate=function(){var t,e=ns.page.getCurrentUrl(),n=ns.page._forceHashChange;try{t=decodeURIComponent(n)}catch(r){}return n&&n==e||t&&t==e?!1:void ns.page.go(e)},ns.history.init=function(){window.addEventListener("hashchange",ns.history.onpopstate,!1)},function(){function t(t,e){return e.forEach(function(e){if("string"==typeof e){var n=ns.View.info(e);t.events=no.extend({},n.events,t.events)
}}),e.slice(0,e.length-1).forEach(function(e){if("string"==typeof e){var n=ns.View.info(e);t.methods=no.extend({},n.methods,t.methods)}}),t}var e=[ns.View,ns.ViewCollection];e.forEach(function(e){e.edefine=function(n,r){r=r||{};var i=Array.prototype.slice.call(arguments,2);return r=t(r,i),e.define(n,r,arguments[arguments.length-1])}})}(),function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};
return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;n>i;i++)r[i-2]=arguments[i];var o=t&&(g(t)?t.apply(this,r):y.apply(void 0,[this,t].concat(r))),s=e&&(g(e)?e.apply(this,r):y.apply(void 0,[this,e].concat(r)));!j.DEBUG||m(o)&&m(s)||C("Обработчик события не должен возвращать результат")}function i(t,e,n){return l(t,e)?e:(("invalidate"===t&&"keepValid"===e||"keepValid"===t&&"invalidate"===e)&&j.assert.fail("ns.View.define","Попытка определить подписки с противоположными действиями. Событие: %s",n),E(t,E(e,r)))
}function o(t,e){return l(t,e)?e:b(t,e,i)}function s(t,e){return l(t,e)?e:t}function a(t,e,n){return l(t,e)?e:"methods"===n?b(t,e,s):"events"===n?o(t,e):"models"===n?b(this._formatModelsDecl(t),this._formatModelsDecl(e),o):"ctor"===n?function(){e&&e.call(this),t&&t.call(this)}:void 0}function u(t){return _(t)&&j.View.info(t)||t}function l(t,e){return m(t)||t===e}function c(t,e,n){n=f(n);var r=u(n.pop()),i=a.bind(t),o=v(e,"mixins",[]);return o=p(o,n),o=h(o),o.unshift(e),o=M(o,function(t){return x(u(t),k)
}),o.push(i),o=T(o,A),o=b(o,x(r,S),i),o=d(o,e)}var f=n(1),p=n(98),h=n(101),d=n(102),v=n(112),y=n(122),g=n(20),_=n(127),m=n(128),w=n(124),b=n(129),x=n(139),V=n(143),E=n(148),M=n(189),T=n(218),j=n(219),k=["methods","ctor","events","models"],S=["ctor","events","models"],A=V(b),C=E(y,function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];var i=n.shift();t.apply(void 0,[window,"console.warn","[ns.View.define] "+i].concat(n))}),O=E(y,function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];
var i=n.shift();t.apply(void 0,[window,"console.log","[ns.View.define] "+i].concat(n))});[j.View,j.ViewCollection].forEach(function(t){t.defineNg=function(e,n){for(var r=arguments.length,i=Array(r>2?r-2:0),o=2;r>o;o++)i[o-2]=arguments[o];return j.DEBUG&&O("Определение вида %s, mixins: %o, %o",e,i,v(n,"mixins",[])),t.define(e,c(t,n,i),w(i))},t.defineModelEvents=function(e){var n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return d({},e,v(t._formatModelsDecl({test:n}),"test"))}})},function(t,e,n){function r(t){return i(t,!1,!0)
}var i=n(2);t.exports=r},function(t,e,n){function r(t,e,n,x,V,E,M){var k;if(x&&(k=E?x(t,V,E,M):x(t)),void 0!==k)return k;if(!m(t))return t;var S=y(t);if(S){if(k=h(t),!e)return l(t,k)}else{var C=p(t),O=C==T||C==j;if(g(t))return u(t,e);if(C==A||C==b||O&&!E){if(_(t))return E?t:{};if(k=v(O?{}:t),!e)return c(t,a(k,t))}else{if(!G[C])return E?t:{};k=d(t,C,r,e)}}M||(M=new i);var U=M.get(t);if(U)return U;if(M.set(t,k),!S)var R=n?f(t):w(t);return o(R||t,function(i,o){R&&(o=i,i=t[o]),s(k,o,r(i,e,n,x,o,t,M))
}),k}var i=n(3),o=n(44),s=n(45),a=n(46),u=n(62),l=n(63),c=n(64),f=n(67),p=n(70),h=n(76),d=n(77),v=n(92),y=n(56),g=n(95),_=n(22),m=n(21),w=n(48),b="[object Arguments]",x="[object Array]",V="[object Boolean]",E="[object Date]",M="[object Error]",T="[object Function]",j="[object GeneratorFunction]",k="[object Map]",S="[object Number]",A="[object Object]",C="[object RegExp]",O="[object Set]",U="[object String]",R="[object Symbol]",D="[object WeakMap]",N="[object ArrayBuffer]",P="[object DataView]",L="[object Float32Array]",I="[object Float64Array]",q="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",H="[object Uint8Array]",$="[object Uint8ClampedArray]",K="[object Uint16Array]",J="[object Uint32Array]",G={};
G[b]=G[x]=G[N]=G[P]=G[V]=G[E]=G[L]=G[I]=G[q]=G[F]=G[B]=G[k]=G[S]=G[A]=G[C]=G[O]=G[U]=G[R]=G[H]=G[$]=G[K]=G[J]=!0,G[M]=G[T]=G[D]=!1,t.exports=r},function(t,e,n){function r(t){this.__data__=new i(t)}var i=n(4),o=n(12),s=n(13),a=n(14),u=n(15),l=n(16);r.prototype.clear=o,r.prototype["delete"]=s,r.prototype.get=a,r.prototype.has=u,r.prototype.set=l,t.exports=r},function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=n(5),o=n(6),s=n(9),a=n(10),u=n(11);
r.prototype.clear=i,r.prototype["delete"]=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t){function e(){this.__data__=[]}t.exports=e},function(t,e,n){function r(t){var e=this.__data__,n=i(e,t);if(0>n)return!1;var r=e.length-1;return n==r?e.pop():s.call(e,n,1),!0}var i=n(7),o=Array.prototype,s=o.splice;t.exports=r},function(t,e,n){function r(t,e){for(var n=t.length;n--;)if(i(t[n][0],e))return n;return-1}var i=n(8);t.exports=r},function(t){function e(t,e){return t===e||t!==t&&e!==e
}t.exports=e},function(t,e,n){function r(t){var e=this.__data__,n=i(e,t);return 0>n?void 0:e[n][1]}var i=n(7);t.exports=r},function(t,e,n){function r(t){return i(this.__data__,t)>-1}var i=n(7);t.exports=r},function(t,e,n){function r(t,e){var n=this.__data__,r=i(n,t);return 0>r?n.push([t,e]):n[r][1]=e,this}var i=n(7);t.exports=r},function(t,e,n){function r(){this.__data__=new i}var i=n(4);t.exports=r},function(t){function e(t){return this.__data__["delete"](t)}t.exports=e},function(t){function e(t){return this.__data__.get(t)
}t.exports=e},function(t){function e(t){return this.__data__.has(t)}t.exports=e},function(t,e,n){function r(t,e){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!o||r.length<a-1)return r.push([t,e]),this;n=this.__data__=new s(r)}return n.set(t,e),this}var i=n(4),o=n(17),s=n(29),a=200;t.exports=r},function(t,e,n){var r=n(18),i=n(25),o=r(i,"Map");t.exports=o},function(t,e,n){function r(t,e){var n=o(t,e);return i(n)?n:void 0}var i=n(19),o=n(28);t.exports=r},function(t,e,n){function r(t){if(!a(t)||s(t))return!1;
var e=i(t)||o(t)?v:c;return e.test(u(t))}var i=n(20),o=n(22),s=n(23),a=n(21),u=n(27),l=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,f=Function.prototype,p=Object.prototype,h=f.toString,d=p.hasOwnProperty,v=RegExp("^"+h.call(d).replace(l,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},function(t,e,n){function r(t){var e=i(t)?u.call(t):"";return e==o||e==s}var i=n(21),o="[object Function]",s="[object GeneratorFunction]",a=Object.prototype,u=a.toString;
t.exports=r},function(t){function e(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=e},function(t){function e(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}t.exports=e},function(t,e,n){function r(t){return!!o&&o in t}var i=n(24),o=function(){var t=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=r},function(t,e,n){var r=n(25),i=r["__core-js_shared__"];t.exports=i},function(t,e,n){var r=n(26),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();
t.exports=o},function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,function(){return this}())},function(t){function e(t){if(null!=t){try{return r.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var n=Function.prototype,r=n.toString;t.exports=e},function(t){function e(t,e){return null==t?void 0:t[e]}t.exports=e},function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=n(30),o=n(38),s=n(41),a=n(42),u=n(43);
r.prototype.clear=i,r.prototype["delete"]=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t,e,n){function r(){this.__data__={hash:new i,map:new(s||o),string:new i}}var i=n(31),o=n(4),s=n(17);t.exports=r},function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=n(32),o=n(34),s=n(35),a=n(36),u=n(37);r.prototype.clear=i,r.prototype["delete"]=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t,e,n){function r(){this.__data__=i?i(null):{}
}var i=n(33);t.exports=r},function(t,e,n){var r=n(18),i=r(Object,"create");t.exports=i},function(t){function e(t){return this.has(t)&&delete this.__data__[t]}t.exports=e},function(t,e,n){function r(t){var e=this.__data__;if(i){var n=e[t];return n===o?void 0:n}return a.call(e,t)?e[t]:void 0}var i=n(33),o="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;t.exports=r},function(t,e,n){function r(t){var e=this.__data__;return i?void 0!==e[t]:s.call(e,t)}var i=n(33),o=Object.prototype,s=o.hasOwnProperty;
t.exports=r},function(t,e,n){function r(t,e){var n=this.__data__;return n[t]=i&&void 0===e?o:e,this}var i=n(33),o="__lodash_hash_undefined__";t.exports=r},function(t,e,n){function r(t){return i(this,t)["delete"](t)}var i=n(39);t.exports=r},function(t,e,n){function r(t,e){var n=t.__data__;return i(e)?n["string"==typeof e?"string":"hash"]:n.map}var i=n(40);t.exports=r},function(t){function e(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=e
},function(t,e,n){function r(t){return i(this,t).get(t)}var i=n(39);t.exports=r},function(t,e,n){function r(t){return i(this,t).has(t)}var i=n(39);t.exports=r},function(t,e,n){function r(t,e){return i(this,t).set(t,e),this}var i=n(39);t.exports=r},function(t){function e(t,e){for(var n=-1,r=t?t.length:0;++n<r&&e(t[n],n,t)!==!1;);return t}t.exports=e},function(t,e,n){function r(t,e,n){var r=t[e];s.call(t,e)&&i(r,n)&&(void 0!==n||e in t)||(t[e]=n)}var i=n(8),o=Object.prototype,s=o.hasOwnProperty;t.exports=r
},function(t,e,n){function r(t,e){return t&&i(e,o(e),t)}var i=n(47),o=n(48);t.exports=r},function(t,e,n){function r(t,e,n,r){n||(n={});for(var o=-1,s=e.length;++o<s;){var a=e[o],u=r?r(n[a],t[a],a,n,t):void 0;i(n,a,void 0===u?t[a]:u)}return n}var i=n(45);t.exports=r},function(t,e,n){function r(t){return s(t)?i(t):o(t)}var i=n(49),o=n(58),s=n(53);t.exports=r},function(t,e,n){function r(t,e){var n=s(t)||o(t)?i(t.length,String):[],r=n.length,u=!!r;for(var c in t)!e&&!l.call(t,c)||u&&("length"==c||a(c,r))||n.push(c);
return n}var i=n(50),o=n(51),s=n(56),a=n(57),u=Object.prototype,l=u.hasOwnProperty;t.exports=r},function(t){function e(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}t.exports=e},function(t,e,n){function r(t){return i(t)&&a.call(t,"callee")&&(!l.call(t,"callee")||u.call(t)==o)}var i=n(52),o="[object Arguments]",s=Object.prototype,a=s.hasOwnProperty,u=s.toString,l=s.propertyIsEnumerable;t.exports=r},function(t,e,n){function r(t){return o(t)&&i(t)}var i=n(53),o=n(55);t.exports=r},function(t,e,n){function r(t){return null!=t&&o(t.length)&&!i(t)
}var i=n(20),o=n(54);t.exports=r},function(t){function e(t){return"number"==typeof t&&t>-1&&t%1==0&&n>=t}var n=9007199254740991;t.exports=e},function(t){function e(t){return!!t&&"object"==typeof t}t.exports=e},function(t){var e=Array.isArray;t.exports=e},function(t){function e(t,e){return e=null==e?n:e,!!e&&("number"==typeof t||r.test(t))&&t>-1&&t%1==0&&e>t}var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;t.exports=e},function(t,e,n){function r(t){if(!i(t))return o(t);var e=[];for(var n in Object(t))a.call(t,n)&&"constructor"!=n&&e.push(n);
return e}var i=n(59),o=n(60),s=Object.prototype,a=s.hasOwnProperty;t.exports=r},function(t){function e(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||n;return t===r}var n=Object.prototype;t.exports=e},function(t,e,n){var r=n(61),i=r(Object.keys,Object);t.exports=i},function(t){function e(t,e){return function(n){return t(e(n))}}t.exports=e},function(t){function e(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}t.exports=e},function(t){function e(t,e){var n=-1,r=t.length;
for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}t.exports=e},function(t,e,n){function r(t,e){return i(t,o(t),e)}var i=n(47),o=n(65);t.exports=r},function(t,e,n){var r=n(61),i=n(66),o=Object.getOwnPropertySymbols,s=o?r(o,Object):i;t.exports=s},function(t){function e(){return[]}t.exports=e},function(t,e,n){function r(t){return i(t,s,o)}var i=n(68),o=n(65),s=n(48);t.exports=r},function(t,e,n){function r(t,e,n){var r=e(t);return o(t)?r:i(r,n(t))}var i=n(69),o=n(56);t.exports=r},function(t){function e(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];
return t}t.exports=e},function(t,e,n){var r=n(71),i=n(17),o=n(72),s=n(73),a=n(74),u=n(75),l=n(27),c="[object Map]",f="[object Object]",p="[object Promise]",h="[object Set]",d="[object WeakMap]",v="[object DataView]",y=Object.prototype,g=y.toString,_=l(r),m=l(i),w=l(o),b=l(s),x=l(a),V=u;(r&&V(new r(new ArrayBuffer(1)))!=v||i&&V(new i)!=c||o&&V(o.resolve())!=p||s&&V(new s)!=h||a&&V(new a)!=d)&&(V=function(t){var e=g.call(t),n=e==f?t.constructor:void 0,r=n?l(n):void 0;if(r)switch(r){case _:return v;
case m:return c;case w:return p;case b:return h;case x:return d}return e}),t.exports=V},function(t,e,n){var r=n(18),i=n(25),o=r(i,"DataView");t.exports=o},function(t,e,n){var r=n(18),i=n(25),o=r(i,"Promise");t.exports=o},function(t,e,n){var r=n(18),i=n(25),o=r(i,"Set");t.exports=o},function(t,e,n){var r=n(18),i=n(25),o=r(i,"WeakMap");t.exports=o},function(t){function e(t){return r.call(t)}var n=Object.prototype,r=n.toString;t.exports=e},function(t){function e(t){var e=t.length,n=t.constructor(e);
return e&&"string"==typeof t[0]&&r.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var n=Object.prototype,r=n.hasOwnProperty;t.exports=e},function(t,e,n){function r(t,e,n,r){var A=t.constructor;switch(e){case m:return i(t);case f:case p:return new A(+t);case w:return o(t,r);case b:case x:case V:case E:case M:case T:case j:case k:case S:return c(t,r);case h:return s(t,r,n);case d:case g:return new A(t);case v:return a(t);case y:return u(t,r,n);case _:return l(t)}}var i=n(78),o=n(80),s=n(81),a=n(85),u=n(86),l=n(89),c=n(91),f="[object Boolean]",p="[object Date]",h="[object Map]",d="[object Number]",v="[object RegExp]",y="[object Set]",g="[object String]",_="[object Symbol]",m="[object ArrayBuffer]",w="[object DataView]",b="[object Float32Array]",x="[object Float64Array]",V="[object Int8Array]",E="[object Int16Array]",M="[object Int32Array]",T="[object Uint8Array]",j="[object Uint8ClampedArray]",k="[object Uint16Array]",S="[object Uint32Array]";
t.exports=r},function(t,e,n){function r(t){var e=new t.constructor(t.byteLength);return new i(e).set(new i(t)),e}var i=n(79);t.exports=r},function(t,e,n){var r=n(25),i=r.Uint8Array;t.exports=i},function(t,e,n){function r(t,e){var n=e?i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var i=n(78);t.exports=r},function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return o(r,i,new t.constructor)}var i=n(82),o=n(83),s=n(84);t.exports=r},function(t){function e(t,e){return t.set(e[0],e[1]),t
}t.exports=e},function(t){function e(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}t.exports=e},function(t){function e(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}t.exports=e},function(t){function e(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}var n=/\w*$/;t.exports=e},function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return o(r,i,new t.constructor)}var i=n(87),o=n(83),s=n(88);t.exports=r
},function(t){function e(t,e){return t.add(e),t}t.exports=e},function(t){function e(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}t.exports=e},function(t,e,n){function r(t){return s?Object(s.call(t)):{}}var i=n(90),o=i?i.prototype:void 0,s=o?o.valueOf:void 0;t.exports=r},function(t,e,n){var r=n(25),i=r.Symbol;t.exports=i},function(t,e,n){function r(t,e){var n=e?i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var i=n(78);t.exports=r},function(t,e,n){function r(t){return"function"!=typeof t.constructor||s(t)?{}:i(o(t))
}var i=n(93),o=n(94),s=n(59);t.exports=r},function(t,e,n){function r(t){return i(t)?o(t):{}}var i=n(21),o=Object.create;t.exports=r},function(t,e,n){var r=n(61),i=r(Object.getPrototypeOf,Object);t.exports=i},function(t,e,n){(function(t){var r=n(25),i=n(97),o="object"==typeof e&&e&&!e.nodeType&&e,s=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=s&&s.exports===o,u=a?r.Buffer:void 0,l=u?u.isBuffer:void 0,c=l||i;t.exports=c}).call(e,n(96)(t))},function(t){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t
}},function(t){function e(){return!1}t.exports=e},function(t,e,n){function r(){for(var t=arguments.length,e=Array(t?t-1:0),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return t?i(a(n)?s(n):[n],o(e,1)):[]}var i=n(69),o=n(99),s=n(63),a=n(56);t.exports=r},function(t,e,n){function r(t,e,n,s,a){var u=-1,l=t.length;for(n||(n=o),a||(a=[]);++u<l;){var c=t[u];e>0&&n(c)?e>1?r(c,e-1,n,s,a):i(a,c):s||(a[a.length]=c)}return a}var i=n(69),o=n(100);t.exports=r},function(t,e,n){function r(t){return s(t)||o(t)||!!(a&&t&&t[a])
}var i=n(90),o=n(51),s=n(56),a=i?i.isConcatSpreadable:void 0;t.exports=r},function(t){function e(t){return t?r.call(t):t}var n=Array.prototype,r=n.reverse;t.exports=e},function(t,e,n){var r=n(103),i=n(104),o=n(105),s=n(107),a=s(function(t){return t.push(void 0,i),r(o,void 0,t)});t.exports=a},function(t){function e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}t.exports=e},function(t,e,n){function r(t,e,n,r){return void 0===t||i(t,o[n])&&!s.call(r,n)?e:t
}var i=n(8),o=Object.prototype,s=o.hasOwnProperty;t.exports=r},function(t,e,n){var r=n(47),i=n(106),o=n(109),s=i(function(t,e,n,i){r(e,o(e),t,i)});t.exports=s},function(t,e,n){function r(t){return i(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(i--,s):void 0,a&&o(n[0],n[1],a)&&(s=3>i?void 0:s,i=1),e=Object(e);++r<i;){var u=n[r];u&&t(e,u,r,s)}return e})}var i=n(107),o=n(108);t.exports=r},function(t,e,n){function r(t,e){return e=o(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,s=o(n.length-e,0),a=Array(s);++r<s;)a[r]=n[e+r];
r=-1;for(var u=Array(e+1);++r<e;)u[r]=n[r];return u[e]=a,i(t,this,u)}}var i=n(103),o=Math.max;t.exports=r},function(t,e,n){function r(t,e,n){if(!a(n))return!1;var r=typeof e;return("number"==r?o(n)&&s(e,n.length):"string"==r&&e in n)?i(n[e],t):!1}var i=n(8),o=n(53),s=n(57),a=n(21);t.exports=r},function(t,e,n){function r(t){return s(t)?i(t,!0):o(t)}var i=n(49),o=n(110),s=n(53);t.exports=r},function(t,e,n){function r(t){if(!i(t))return s(t);var e=o(t),n=[];for(var r in t)("constructor"!=r||!e&&u.call(t,r))&&n.push(r);
return n}var i=n(21),o=n(59),s=n(111),a=Object.prototype,u=a.hasOwnProperty;t.exports=r},function(t){function e(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}t.exports=e},function(t,e,n){function r(t,e,n){var r=null==t?void 0:i(t,e);return void 0===r?n:r}var i=n(113);t.exports=r},function(t,e,n){function r(t,e){e=o(e,t)?[e]:i(e);for(var n=0,r=e.length;null!=t&&r>n;)t=t[s(e[n++])];return n&&n==r?t:void 0}var i=n(114),o=n(120),s=n(121);t.exports=r},function(t,e,n){function r(t){return i(t)?t:o(t)
}var i=n(56),o=n(115);t.exports=r},function(t,e,n){var r=n(116),i=n(117),o=/^\./,s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,u=r(function(t){t=i(t);var e=[];return o.test(t)&&e.push(""),t.replace(s,function(t,n,r,i){e.push(r?i.replace(a,"$1"):n||t)}),e});t.exports=u},function(t,e,n){function r(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;
if(o.has(i))return o.get(i);var s=t.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new(r.Cache||i),n}var i=n(29),o="Expected a function";r.Cache=i,t.exports=r},function(t,e,n){function r(t){return null==t?"":i(t)}var i=n(118);t.exports=r},function(t,e,n){function r(t){if("string"==typeof t)return t;if(o(t))return u?u.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}var i=n(90),o=n(119),s=1/0,a=i?i.prototype:void 0,u=a?a.toString:void 0;t.exports=r},function(t,e,n){function r(t){return"symbol"==typeof t||i(t)&&a.call(t)==o
}var i=n(55),o="[object Symbol]",s=Object.prototype,a=s.toString;t.exports=r},function(t,e,n){function r(t,e){if(i(t))return!1;var n=typeof t;return"number"==n||"symbol"==n||"boolean"==n||null==t||o(t)?!0:a.test(t)||!s.test(t)||null!=e&&t in Object(e)}var i=n(56),o=n(119),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=r},function(t,e,n){function r(t){if("string"==typeof t||i(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}var i=n(119),o=1/0;t.exports=r},function(t,e,n){var r=n(123),i=n(107),o=i(r);
t.exports=o},function(t,e,n){function r(t,e,n){s(e,t)||(e=o(e),t=u(t,e),e=a(e));var r=null==t?t:t[l(e)];return null==r?void 0:i(r,t,n)}var i=n(103),o=n(114),s=n(120),a=n(124),u=n(125),l=n(121);t.exports=r},function(t){function e(t){var e=t?t.length:0;return e?t[e-1]:void 0}t.exports=e},function(t,e,n){function r(t,e){return 1==e.length?t:i(t,o(e,0,-1))}var i=n(113),o=n(126);t.exports=r},function(t){function e(t,e,n){var r=-1,i=t.length;0>e&&(e=-e>i?0:i+e),n=n>i?i:n,0>n&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;
for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}t.exports=e},function(t,e,n){function r(t){return"string"==typeof t||!i(t)&&o(t)&&u.call(t)==s}var i=n(56),o=n(55),s="[object String]",a=Object.prototype,u=a.toString;t.exports=r},function(t){function e(t){return void 0===t}t.exports=e},function(t,e,n){var r=n(130),i=n(106),o=i(function(t,e,n,i){r(t,e,n,i)});t.exports=o},function(t,e,n){function r(t,e,n,p,h){if(t!==e){if(!l(e)&&!f(e))var d=a(e);o(d||e,function(o,a){if(d&&(a=o,o=e[a]),c(o))h||(h=new i),u(t,e,a,n,r,p,h);
else{var l=p?p(t[a],o,a+"",t,e,h):void 0;void 0===l&&(l=o),s(t,a,l)}})}}var i=n(3),o=n(44),s=n(131),a=n(110),u=n(132),l=n(56),c=n(21),f=n(134);t.exports=r},function(t,e,n){function r(t,e,n){(void 0!==n&&!i(t[e],n)||"number"==typeof e&&void 0===n&&!(e in t))&&(t[e]=n)}var i=n(8);t.exports=r},function(t,e,n){function r(t,e,n,r,v,y,g){var _=t[n],m=e[n],w=g.get(m);if(w)return void i(t,n,w);var b=y?y(_,m,n+"",t,e,g):void 0,x=void 0===b;x&&(b=m,u(m)||h(m)?u(_)?b=_:l(_)?b=s(_):(x=!1,b=o(m,!0)):p(m)||a(m)?a(_)?b=d(_):!f(_)||r&&c(_)?(x=!1,b=o(m,!0)):b=_:x=!1),x&&(g.set(m,b),v(b,m,r,y,g),g["delete"](m)),i(t,n,b)
}var i=n(131),o=n(2),s=n(63),a=n(51),u=n(56),l=n(52),c=n(20),f=n(21),p=n(133),h=n(134),d=n(138);t.exports=r},function(t,e,n){function r(t){if(!s(t)||h.call(t)!=a||o(t))return!1;var e=i(t);if(null===e)return!0;var n=f.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==p}var i=n(94),o=n(22),s=n(55),a="[object Object]",u=Function.prototype,l=Object.prototype,c=u.toString,f=l.hasOwnProperty,p=c.call(Object),h=l.toString;t.exports=r},function(t,e,n){var r=n(135),i=n(136),o=n(137),s=o&&o.isTypedArray,a=s?i(s):r;
t.exports=a},function(t,e,n){function r(t){return o(t)&&i(t.length)&&!!A[O.call(t)]}var i=n(54),o=n(55),s="[object Arguments]",a="[object Array]",u="[object Boolean]",l="[object Date]",c="[object Error]",f="[object Function]",p="[object Map]",h="[object Number]",d="[object Object]",v="[object RegExp]",y="[object Set]",g="[object String]",_="[object WeakMap]",m="[object ArrayBuffer]",w="[object DataView]",b="[object Float32Array]",x="[object Float64Array]",V="[object Int8Array]",E="[object Int16Array]",M="[object Int32Array]",T="[object Uint8Array]",j="[object Uint8ClampedArray]",k="[object Uint16Array]",S="[object Uint32Array]",A={};
A[b]=A[x]=A[V]=A[E]=A[M]=A[T]=A[j]=A[k]=A[S]=!0,A[s]=A[a]=A[m]=A[u]=A[w]=A[l]=A[c]=A[f]=A[p]=A[h]=A[d]=A[v]=A[y]=A[g]=A[_]=!1;var C=Object.prototype,O=C.toString;t.exports=r},function(t){function e(t){return function(e){return t(e)}}t.exports=e},function(t,e,n){(function(t){var r=n(26),i="object"==typeof e&&e&&!e.nodeType&&e,o=i&&"object"==typeof t&&t&&!t.nodeType&&t,s=o&&o.exports===i,a=s&&r.process,u=function(){try{return a&&a.binding("util")}catch(t){}}();t.exports=u}).call(e,n(96)(t))},function(t,e,n){function r(t){return i(t,o(t))
}var i=n(47),o=n(109);t.exports=r},function(t,e,n){var r=n(140),i=n(99),o=n(141),s=n(107),a=n(121),u=s(function(t,e){return null==t?{}:o(t,r(i(e,1),a))});t.exports=u},function(t){function e(t,e){for(var n=-1,r=t?t.length:0,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}t.exports=e},function(t,e,n){function r(t,e){return t=Object(t),i(t,e,function(e,n){return n in t})}var i=n(142);t.exports=r},function(t){function e(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var s=e[r],a=t[s];n(a,s)&&(o[s]=a)}return o
}t.exports=e},function(t,e,n){function r(t,e){if("function"!=typeof t)throw new TypeError(l);return e=void 0===e?0:c(u(e),0),s(function(n){var r=n[e],s=a(n,0,e);return r&&o(s,r),i(t,this,s)})}var i=n(103),o=n(69),s=n(107),a=n(144),u=n(145),l="Expected a function",c=Math.max;t.exports=r},function(t,e,n){function r(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:i(t,e,n)}var i=n(126);t.exports=r},function(t,e,n){function r(t){var e=i(t),n=e%1;return e===e?n?e-n:e:0}var i=n(146);t.exports=r
},function(t,e,n){function r(t){if(!t)return 0===t?t:0;if(t=i(t),t===o||t===-o){var e=0>t?-1:1;return e*s}return t===t?t:0}var i=n(147),o=1/0,s=1.7976931348623157e308;t.exports=r},function(t,e,n){function r(t){if("number"==typeof t)return t;if(o(t))return s;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=l.test(t);return n||c.test(t)?f(t.slice(2),n?2:8):u.test(t)?s:+t}var i=n(21),o=n(119),s=0/0,a=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt;
t.exports=r},function(t,e,n){function r(t,e){return e=null==e?i:e,o(e,t)}var i=n(149),o=n(150);t.exports=r},function(t){function e(t){return t}t.exports=e},function(t,e,n){var r=n(107),i=n(151),o=n(184),s=n(186),a=32,u=r(function(t,e){var n=s(e,o(u));return i(t,a,void 0,e,n)});u.placeholder={},t.exports=u},function(t,e,n){function r(t,e,n,r,x,V,E,M){var T=e&y;if(!T&&"function"!=typeof t)throw new TypeError(d);var j=r?r.length:0;if(j||(e&=~(m|w),r=x=void 0),E=void 0===E?E:b(h(E),0),M=void 0===M?M:h(M),j-=x?x.length:0,e&w){var k=r,S=x;
r=x=void 0}var A=T?void 0:l(t),C=[t,e,n,r,x,k,S,V,E,M];if(A&&c(C,A),t=C[0],e=C[1],n=C[2],r=C[3],x=C[4],M=C[9]=null==C[9]?T?0:t.length:b(C[9]-j,0),!M&&e&(g|_)&&(e&=~(g|_)),e&&e!=v)O=e==g||e==_?s(t,e,M):e!=m&&e!=(v|m)||x.length?a.apply(void 0,C):u(t,e,n,r);else var O=o(t,e,n);var U=A?i:f;return p(U(O,C),t,e)}var i=n(152),o=n(154),s=n(156),a=n(157),u=n(187),l=n(165),c=n(188),f=n(172),p=n(174),h=n(145),d="Expected a function",v=1,y=2,g=8,_=16,m=32,w=64,b=Math.max;t.exports=r},function(t,e,n){var r=n(149),i=n(153),o=i?function(t,e){return i.set(t,e),t
}:r;t.exports=o},function(t,e,n){var r=n(74),i=r&&new r;t.exports=i},function(t,e,n){function r(t,e,n){function r(){var e=this&&this!==o&&this instanceof r?u:t;return e.apply(a?n:this,arguments)}var a=e&s,u=i(t);return r}var i=n(155),o=n(25),s=1;t.exports=r},function(t,e,n){function r(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);
case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=i(t.prototype),r=t.apply(n,e);return o(r)?r:n}}var i=n(93),o=n(21);t.exports=r},function(t,e,n){function r(t,e,n){function r(){for(var o=arguments.length,p=Array(o),h=o,d=u(r);h--;)p[h]=arguments[h];var v=3>o&&p[0]!==d&&p[o-1]!==d?[]:l(p,d);if(o-=v.length,n>o)return a(t,e,s,r.placeholder,void 0,p,v,void 0,void 0,n-o);var y=this&&this!==c&&this instanceof r?f:t;return i(y,this,p)}var f=o(t);
return r}var i=n(103),o=n(155),s=n(157),a=n(161),u=n(184),l=n(186),c=n(25);t.exports=r},function(t,e,n){function r(t,e,n,m,w,b,x,V,E,M){function T(){for(var h=arguments.length,d=Array(h),v=h;v--;)d[v]=arguments[v];if(A)var y=l(T),g=s(d,y);if(m&&(d=i(d,m,w,A)),b&&(d=o(d,b,x,A)),h-=g,A&&M>h){var _=f(d,y);return u(t,e,r,T.placeholder,n,d,_,V,E,M-h)}var U=k?n:this,R=S?U[t]:t;return h=d.length,V?d=c(d,V):C&&h>1&&d.reverse(),j&&h>E&&(d.length=E),this&&this!==p&&this instanceof T&&(R=O||a(R)),R.apply(U,d)
}var j=e&g,k=e&h,S=e&d,A=e&(v|y),C=e&_,O=S?void 0:a(t);return T}var i=n(158),o=n(159),s=n(160),a=n(155),u=n(161),l=n(184),c=n(185),f=n(186),p=n(25),h=1,d=2,v=8,y=16,g=128,_=512;t.exports=r},function(t){function e(t,e,r,i){for(var o=-1,s=t.length,a=r.length,u=-1,l=e.length,c=n(s-a,0),f=Array(l+c),p=!i;++u<l;)f[u]=e[u];for(;++o<a;)(p||s>o)&&(f[r[o]]=t[o]);for(;c--;)f[u++]=t[o++];return f}var n=Math.max;t.exports=e},function(t){function e(t,e,r,i){for(var o=-1,s=t.length,a=-1,u=r.length,l=-1,c=e.length,f=n(s-u,0),p=Array(f+c),h=!i;++o<f;)p[o]=t[o];
for(var d=o;++l<c;)p[d+l]=e[l];for(;++a<u;)(h||s>o)&&(p[d+r[a]]=t[o++]);return p}var n=Math.max;t.exports=e},function(t){function e(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&r++;return r}t.exports=e},function(t,e,n){function r(t,e,n,r,h,d,v,y,g,_){var m=e&c,w=m?v:void 0,b=m?void 0:v,x=m?d:void 0,V=m?void 0:d;e|=m?f:p,e&=~(m?p:f),e&l||(e&=~(a|u));var E=[t,e,h,x,w,V,b,y,g,_],M=n.apply(void 0,E);return i(t)&&o(M,E),M.placeholder=r,s(M,t,e)}var i=n(162),o=n(172),s=n(174),a=1,u=2,l=4,c=8,f=32,p=64;t.exports=r
},function(t,e,n){function r(t){var e=s(t),n=a[e];if("function"!=typeof n||!(e in i.prototype))return!1;if(t===n)return!0;var r=o(n);return!!r&&t===r[0]}var i=n(163),o=n(165),s=n(167),a=n(169);t.exports=r},function(t,e,n){function r(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=s,this.__views__=[]}var i=n(93),o=n(164),s=4294967295;r.prototype=i(o.prototype),r.prototype.constructor=r,t.exports=r},function(t){function e(){}t.exports=e
},function(t,e,n){var r=n(153),i=n(166),o=r?function(t){return r.get(t)}:i;t.exports=o},function(t){function e(){}t.exports=e},function(t,e,n){function r(t){for(var e=t.name+"",n=i[e],r=s.call(i,e)?n.length:0;r--;){var o=n[r],a=o.func;if(null==a||a==t)return o.name}return e}var i=n(168),o=Object.prototype,s=o.hasOwnProperty;t.exports=r},function(t){var e={};t.exports=e},function(t,e,n){function r(t){if(u(t)&&!a(t)&&!(t instanceof i)){if(t instanceof o)return t;if(f.call(t,"__wrapped__"))return l(t)
}return new o(t)}var i=n(163),o=n(170),s=n(164),a=n(56),u=n(55),l=n(171),c=Object.prototype,f=c.hasOwnProperty;r.prototype=s.prototype,r.prototype.constructor=r,t.exports=r},function(t,e,n){function r(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}var i=n(93),o=n(164);r.prototype=i(o.prototype),r.prototype.constructor=r,t.exports=r},function(t,e,n){function r(t){if(t instanceof i)return t.clone();var e=new o(t.__wrapped__,t.__chain__);return e.__actions__=s(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e
}var i=n(163),o=n(170),s=n(63);t.exports=r},function(t,e,n){var r=n(152),i=n(173),o=150,s=16,a=function(){var t=0,e=0;return function(n,a){var u=i(),l=s-(u-e);if(e=u,l>0){if(++t>=o)return n}else t=0;return r(n,a)}}();t.exports=a},function(t,e,n){var r=n(25),i=function(){return r.Date.now()};t.exports=i},function(t,e,n){var r=n(175),i=n(176),o=n(177),s=n(149),a=n(178),u=n(179),l=i?function(t,e,n){var s=e+"";return i(t,"toString",{configurable:!0,enumerable:!1,value:r(a(s,u(o(s),n)))})}:s;t.exports=l
},function(t){function e(t){return function(){return t}}t.exports=e},function(t,e,n){var r=n(18),i=function(){var t=r(Object,"defineProperty"),e=r.name;return e&&e.length>2?t:void 0}();t.exports=i},function(t){function e(t){var e=t.match(n);return e?e[1].split(r):[]}var n=/\{\n\/\* \[wrapped with (.+)\] \*/,r=/,? & /;t.exports=e},function(t){function e(t,e){var r=e.length,i=r-1;return e[i]=(r>1?"& ":"")+e[i],e=e.join(r>2?", ":" "),t.replace(n,"{\n/* [wrapped with "+e+"] */\n")}var n=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;
t.exports=e},function(t,e,n){function r(t,e){return i(v,function(n){var r="_."+n[0];e&n[1]&&!o(t,r)&&t.push(r)}),t.sort()}var i=n(44),o=n(180),s=1,a=2,u=8,l=16,c=32,f=64,p=128,h=256,d=512,v=[["ary",p],["bind",s],["bindKey",a],["curry",u],["curryRight",l],["flip",d],["partial",c],["partialRight",f],["rearg",h]];t.exports=r},function(t,e,n){function r(t,e){var n=t?t.length:0;return!!n&&i(t,e,0)>-1}var i=n(181);t.exports=r},function(t,e,n){function r(t,e,n){if(e!==e)return i(t,o,n);for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;
return-1}var i=n(182),o=n(183);t.exports=r},function(t){function e(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}t.exports=e},function(t){function e(t){return t!==t}t.exports=e},function(t){function e(t){var e=t;return e.placeholder}t.exports=e},function(t,e,n){function r(t,e){for(var n=t.length,r=s(e.length,n),a=i(t);r--;){var u=e[r];t[r]=o(u,n)?a[u]:void 0}return t}var i=n(63),o=n(57),s=Math.min;t.exports=r},function(t){function e(t,e){for(var r=-1,i=t.length,o=0,s=[];++r<i;){var a=t[r];
(a===e||a===n)&&(t[r]=n,s[o++]=r)}return s}var n="__lodash_placeholder__";t.exports=e},function(t,e,n){function r(t,e,n,r){function u(){for(var e=-1,o=arguments.length,a=-1,f=r.length,p=Array(f+o),h=this&&this!==s&&this instanceof u?c:t;++a<f;)p[a]=r[a];for(;o--;)p[a++]=arguments[++e];return i(h,l?n:this,p)}var l=e&a,c=o(t);return u}var i=n(103),o=n(155),s=n(25),a=1;t.exports=r},function(t,e,n){function r(t,e){var n=t[1],r=e[1],v=n|r,y=(u|l|p)>v,g=r==p&&n==f||r==p&&n==h&&t[7].length<=e[8]||r==(p|h)&&e[7].length<=e[8]&&n==f;
if(!y&&!g)return t;r&u&&(t[2]=e[2],v|=n&u?0:c);var _=e[3];if(_){var m=t[3];t[3]=m?i(m,_,e[4]):_,t[4]=m?s(t[3],a):e[4]}return _=e[5],_&&(m=t[5],t[5]=m?o(m,_,e[6]):_,t[6]=m?s(t[5],a):e[6]),_=e[7],_&&(t[7]=_),r&p&&(t[8]=null==t[8]?e[8]:d(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=v,t}var i=n(158),o=n(159),s=n(186),a="__lodash_placeholder__",u=1,l=2,c=4,f=8,p=128,h=256,d=Math.min;t.exports=r},function(t,e,n){function r(t,e){var n=a(t)?i:s;return n(t,o(e,3))}var i=n(140),o=n(190),s=n(212),a=n(56);
t.exports=r},function(t,e,n){function r(t){return"function"==typeof t?t:null==t?s:"object"==typeof t?a(t)?o(t[0],t[1]):i(t):u(t)}var i=n(191),o=n(205),s=n(149),a=n(56),u=n(209);t.exports=r},function(t,e,n){function r(t){var e=o(t);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(n){return n===t||i(n,t,e)}}var i=n(192),o=n(202),s=n(204);t.exports=r},function(t,e,n){function r(t,e,n,r){var u=n.length,l=u,c=!r;if(null==t)return!l;for(t=Object(t);u--;){var f=n[u];if(c&&f[2]?f[1]!==t[f[0]]:!(f[0]in t))return!1
}for(;++u<l;){f=n[u];var p=f[0],h=t[p],d=f[1];if(c&&f[2]){if(void 0===h&&!(p in t))return!1}else{var v=new i;if(r)var y=r(h,d,p,t,e,v);if(!(void 0===y?o(d,h,r,s|a,v):y))return!1}}return!0}var i=n(3),o=n(193),s=1,a=2;t.exports=r},function(t,e,n){function r(t,e,n,a,u){return t===e?!0:null==t||null==e||!o(t)&&!s(e)?t!==t&&e!==e:i(t,e,r,n,a,u)}var i=n(194),o=n(21),s=n(55);t.exports=r},function(t,e,n){function r(t,e,n,r,y,_){var m=l(t),w=l(e),b=d,x=d;m||(b=u(t),b=b==h?v:b),w||(x=u(e),x=x==h?v:x);var V=b==v&&!c(t),E=x==v&&!c(e),M=b==x;
if(M&&!V)return _||(_=new i),m||f(t)?o(t,e,n,r,y,_):s(t,e,b,n,r,y,_);if(!(y&p)){var T=V&&g.call(t,"__wrapped__"),j=E&&g.call(e,"__wrapped__");if(T||j){var k=T?t.value():t,S=j?e.value():e;return _||(_=new i),n(k,S,r,y,_)}}return M?(_||(_=new i),a(t,e,n,r,y,_)):!1}var i=n(3),o=n(195),s=n(200),a=n(201),u=n(70),l=n(56),c=n(22),f=n(134),p=2,h="[object Arguments]",d="[object Array]",v="[object Object]",y=Object.prototype,g=y.hasOwnProperty;t.exports=r},function(t,e,n){function r(t,e,n,r,u,l){var c=u&a,f=t.length,p=e.length;
if(f!=p&&!(c&&p>f))return!1;var h=l.get(t);if(h&&l.get(e))return h==e;var d=-1,v=!0,y=u&s?new i:void 0;for(l.set(t,e),l.set(e,t);++d<f;){var g=t[d],_=e[d];if(r)var m=c?r(_,g,d,e,t,l):r(g,_,d,t,e,l);if(void 0!==m){if(m)continue;v=!1;break}if(y){if(!o(e,function(t,e){return y.has(e)||g!==t&&!n(g,t,r,u,l)?void 0:y.add(e)})){v=!1;break}}else if(g!==_&&!n(g,_,r,u,l)){v=!1;break}}return l["delete"](t),l["delete"](e),v}var i=n(196),o=n(199),s=1,a=2;t.exports=r},function(t,e,n){function r(t){var e=-1,n=t?t.length:0;
for(this.__data__=new i;++e<n;)this.add(t[e])}var i=n(29),o=n(197),s=n(198);r.prototype.add=r.prototype.push=o,r.prototype.has=s,t.exports=r},function(t){function e(t){return this.__data__.set(t,n),this}var n="__lodash_hash_undefined__";t.exports=e},function(t){function e(t){return this.__data__.has(t)}t.exports=e},function(t){function e(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(e(t[n],n,t))return!0;return!1}t.exports=e},function(t,e,n){function r(t,e,n,r,i,V,M){switch(n){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;
t=t.buffer,e=e.buffer;case b:return t.byteLength==e.byteLength&&r(new o(t),new o(e))?!0:!1;case p:case h:case y:return s(+t,+e);case d:return t.name==e.name&&t.message==e.message;case g:case m:return t==e+"";case v:var T=u;case _:var j=V&f;if(T||(T=l),t.size!=e.size&&!j)return!1;var k=M.get(t);if(k)return k==e;V|=c,M.set(t,e);var S=a(T(t),T(e),r,i,V,M);return M["delete"](t),S;case w:if(E)return E.call(t)==E.call(e)}return!1}var i=n(90),o=n(79),s=n(8),a=n(195),u=n(84),l=n(88),c=1,f=2,p="[object Boolean]",h="[object Date]",d="[object Error]",v="[object Map]",y="[object Number]",g="[object RegExp]",_="[object Set]",m="[object String]",w="[object Symbol]",b="[object ArrayBuffer]",x="[object DataView]",V=i?i.prototype:void 0,E=V?V.valueOf:void 0;
t.exports=r},function(t,e,n){function r(t,e,n,r,s,u){var l=s&o,c=i(t),f=c.length,p=i(e),h=p.length;if(f!=h&&!l)return!1;for(var d=f;d--;){var v=c[d];if(!(l?v in e:a.call(e,v)))return!1}var y=u.get(t);if(y&&u.get(e))return y==e;var g=!0;u.set(t,e),u.set(e,t);for(var _=l;++d<f;){v=c[d];var m=t[v],w=e[v];if(r)var b=l?r(w,m,v,e,t,u):r(m,w,v,t,e,u);if(!(void 0===b?m===w||n(m,w,r,s,u):b)){g=!1;break}_||(_="constructor"==v)}if(g&&!_){var x=t.constructor,V=e.constructor;x!=V&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof V&&V instanceof V)&&(g=!1)
}return u["delete"](t),u["delete"](e),g}var i=n(48),o=2,s=Object.prototype,a=s.hasOwnProperty;t.exports=r},function(t,e,n){function r(t){for(var e=o(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,i(s)]}return e}var i=n(203),o=n(48);t.exports=r},function(t,e,n){function r(t){return t===t&&!i(t)}var i=n(21);t.exports=r},function(t){function e(t,e){return function(n){return null==n?!1:n[t]===e&&(void 0!==e||t in Object(n))}}t.exports=e},function(t,e,n){function r(t,e){return a(t)&&u(e)?l(c(t),e):function(n){var r=o(n,t);
return void 0===r&&r===e?s(n,t):i(e,r,void 0,f|p)}}var i=n(193),o=n(112),s=n(206),a=n(120),u=n(203),l=n(204),c=n(121),f=1,p=2;t.exports=r},function(t,e,n){function r(t,e){return null!=t&&o(t,e,i)}var i=n(207),o=n(208);t.exports=r},function(t){function e(t,e){return null!=t&&e in Object(t)}t.exports=e},function(t,e,n){function r(t,e,n){e=u(e,t)?[e]:i(e);for(var r,f=-1,p=e.length;++f<p;){var h=c(e[f]);if(!(r=null!=t&&n(t,h)))break;t=t[h]}if(r)return r;var p=t?t.length:0;return!!p&&l(p)&&a(h,p)&&(s(t)||o(t))
}var i=n(114),o=n(51),s=n(56),a=n(57),u=n(120),l=n(54),c=n(121);t.exports=r},function(t,e,n){function r(t){return s(t)?i(a(t)):o(t)}var i=n(210),o=n(211),s=n(120),a=n(121);t.exports=r},function(t){function e(t){return function(e){return null==e?void 0:e[t]}}t.exports=e},function(t,e,n){function r(t){return function(e){return i(e,t)}}var i=n(113);t.exports=r},function(t,e,n){function r(t,e){var n=-1,r=o(t)?Array(t.length):[];return i(t,function(t,i,o){r[++n]=e(t,i,o)}),r}var i=n(213),o=n(53);t.exports=r
},function(t,e,n){var r=n(214),i=n(217),o=i(r);t.exports=o},function(t,e,n){function r(t,e){return t&&i(t,e,o)}var i=n(215),o=n(48);t.exports=r},function(t,e,n){var r=n(216),i=r();t.exports=i},function(t){function e(t){return function(e,n,r){for(var i=-1,o=Object(e),s=r(e),a=s.length;a--;){var u=s[t?a:++i];if(n(o[u],u,o)===!1)break}return e}}t.exports=e},function(t,e,n){function r(t,e){return function(n,r){if(null==n)return n;if(!i(n))return t(n,r);for(var o=n.length,s=e?o:-1,a=Object(n);(e?s--:++s<o)&&r(a[s],s,a)!==!1;);return n
}}var i=n(53);t.exports=r},function(t){function e(t,e){return e(t)}t.exports=e},function(t){t.exports=ns}]),function(){var t,e,n,r,i=function(t,e){return function(){return t.apply(e,arguments)}},o=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},s=[].slice,a={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t={binders:{},components:{},formatters:{},adapters:{},config:{prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,n){return this.call(t,e,n.view.models)
}}},"jQuery"in window?(r="on"in jQuery.prototype?["on","off"]:["bind","unbind"],e=r[0],n=r[1],t.Util={bindEvent:function(t,n,r){return jQuery(t)[e](n,r)},unbindEvent:function(t,e,r){return jQuery(t)[n](e,r)},getInputValue:function(t){var e;return e=jQuery(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):t.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,n){return t.addEventListener(e,n,!1)}:function(t,e,n){return t.attachEvent("on"+e,n)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,n){return t.removeEventListener(e,n,!1)
}:function(t,e,n){return t.detachEvent("on"+e,n)}}(),getInputValue:function(t){var e,n,r,i;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(i=[],n=0,r=t.length;r>n;n++)e=t[n],e.selected&&i.push(e.value);return i}return t.value}},t.View=function(){function e(e,n,r){var o,s,a,u,l,c,f,p,h;for(this.els=e,this.models=n,this.options=null!=r?r:{},this.update=i(this.update,this),this.publish=i(this.publish,this),this.sync=i(this.sync,this),this.unbind=i(this.unbind,this),this.bind=i(this.bind,this),this.select=i(this.select,this),this.build=i(this.build,this),this.componentRegExp=i(this.componentRegExp,this),this.bindingRegExp=i(this.bindingRegExp,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),f=["config","binders","formatters","adapters"],l=0,c=f.length;c>l;l++){if(s=f[l],this[s]={},this.options[s]){p=this.options[s];
for(o in p)a=p[o],this[s][o]=a}h=t[s];for(o in h)a=h[o],null==(u=this[s])[o]&&(u[o]=a)}this.build()}return e.prototype.bindingRegExp=function(){return new RegExp("^"+this.config.prefix+"-")},e.prototype.componentRegExp=function(){return new RegExp("^"+this.config.prefix.toUpperCase()+"-")},e.prototype.build=function(){var e,n,r,i,s,a,u,l,c,f=this;for(this.bindings=[],a=[],e=this.bindingRegExp(),r=this.componentRegExp(),n=function(e,n,r,i){var o,s,a,u,l,c,p;return l={},p=function(){var t,e,n,r;for(n=i.split("|"),r=[],t=0,e=n.length;e>t;t++)c=n[t],r.push(c.trim());
return r}(),o=function(){var t,e,n,r;for(n=p.shift().split("<"),r=[],t=0,e=n.length;e>t;t++)s=n[t],r.push(s.trim());return r}(),u=o.shift(),l.formatters=p,(a=o.shift())&&(l.dependencies=a.split(/\s+/)),f.bindings.push(new t[e](f,n,r,u,l))},s=function(i){var u,l,c,p,h,d,v,y,g,_,m,w,b,x,V,E,M,T,j,k,S,A,C,O,U,R,D,N,P,L;if(o.call(a,i)<0){if(3===i.nodeType){if(y=t.TextTemplateParser,(h=f.config.templateDelimiters)&&(w=y.parse(i.data,h)).length&&(1!==w.length||w[0].type!==y.types.text)){for(V=0,j=w.length;j>V;V++)m=w[V],_=document.createTextNode(m.value),i.parentNode.insertBefore(_,i),1===m.type&&n("TextBinding",_,null,m.value);
i.parentNode.removeChild(i)}}else if(r.test(i.tagName))b=i.tagName.replace(r,"").toLowerCase(),f.bindings.push(new t.ComponentBinding(f,i,b));else if(null!=i.attributes){for(U=i.attributes,E=0,k=U.length;k>E;E++)if(u=U[E],e.test(u.name)){if(b=u.name.replace(e,""),!(c=f.binders[b])){R=f.binders;for(d in R)x=R[d],"*"!==d&&-1!==d.indexOf("*")&&(g=new RegExp("^"+d.replace("*",".+")+"$"),g.test(b)&&(c=x))}if(c||(c=f.binders["*"]),c.block){for(D=i.childNodes,M=0,S=D.length;S>M;M++)v=D[M],a.push(v);l=[u]
}}for(N=l||i.attributes,T=0,A=N.length;A>T;T++)u=N[T],e.test(u.name)&&(b=u.name.replace(e,""),n("Binding",i,b,u.value))}for(P=function(){var t,e,n,r;for(n=i.childNodes,r=[],e=0,t=n.length;t>e;e++)v=n[e],r.push(v);return r}(),L=[],O=0,C=P.length;C>O;O++)p=P[O],L.push(s(p));return L}},c=this.els,u=0,l=c.length;l>u;u++)i=c[u],s(i)},e.prototype.select=function(t){var e,n,r,i,o;for(i=this.bindings,o=[],n=0,r=i.length;r>n;n++)e=i[n],t(e)&&o.push(e);return o},e.prototype.bind=function(){var t,e,n,r,i;for(r=this.bindings,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.bind());
return i},e.prototype.unbind=function(){var t,e,n,r,i;for(r=this.bindings,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.unbind());return i},e.prototype.sync=function(){var t,e,n,r,i;for(r=this.bindings,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.sync());return i},e.prototype.publish=function(){var t,e,n,r,i;for(r=this.select(function(t){return t.binder.publishes}),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.publish());return i},e.prototype.update=function(t){var e,n,r,i,o,s,a;null==t&&(t={});for(n in t)r=t[n],this.models[n]=r;
for(s=this.bindings,a=[],i=0,o=s.length;o>i;i++)e=s[i],a.push(e.update(t));return a},e}(),t.Binding=function(){function e(t,e,n,r,o){this.view=t,this.el=e,this.type=n,this.keypath=r,this.options=null!=o?o:{},this.update=i(this.update,this),this.unbind=i(this.unbind,this),this.bind=i(this.bind,this),this.publish=i(this.publish,this),this.sync=i(this.sync,this),this.set=i(this.set,this),this.eventHandler=i(this.eventHandler,this),this.formattedValue=i(this.formattedValue,this),this.setBinder=i(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.model=void 0,this.setBinder()
}return e.prototype.setBinder=function(){var t,e,n,r;if(!(this.binder=this.view.binders[this.type])){r=this.view.binders;for(t in r)n=r[t],"*"!==t&&-1!==t.indexOf("*")&&(e=new RegExp("^"+t.replace("*",".+")+"$"),e.test(this.type)&&(this.binder=n,this.args=new RegExp("^"+t.replace("*","(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},e.prototype.formattedValue=function(t){var e,n,r,i,o,a;
for(a=this.formatters,i=0,o=a.length;o>i;i++)n=a[i],e=n.split(/\s+/),r=e.shift(),n=this.view.formatters[r],(null!=n?n.read:void 0)instanceof Function?t=n.read.apply(n,[t].concat(s.call(e))):n instanceof Function&&(t=n.apply(null,[t].concat(s.call(e))));return t},e.prototype.eventHandler=function(t){var e,n;return n=(e=this).view.config.handler,function(r){return n.call(t,this,r,e)}},e.prototype.set=function(t){var e;return t=this.formattedValue(t instanceof Function&&!this.binder["function"]?t.call(this.model):t),null!=(e=this.binder.routine)?e.call(this,this.el,t):void 0
},e.prototype.sync=function(){var e,n,r,i,o,s,a,u,l;if(this.model!==this.observer.target){for(a=this.dependencies,r=0,o=a.length;o>r;r++)n=a[r],n.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(u=this.options.dependencies)?u.length:void 0))for(l=this.options.dependencies,i=0,s=l.length;s>i;i++)e=l[i],n=new t.Observer(this.view,this.model,e,this.sync),this.dependencies.push(n)}return this.set(this.observer.value())},e.prototype.publish=function(){var e,n,r,i,o,a,u,l,c;
for(i=t.Util.getInputValue(this.el),u=this.formatters.slice(0).reverse(),o=0,a=u.length;a>o;o++)n=u[o],e=n.split(/\s+/),r=e.shift(),(null!=(l=this.view.formatters[r])?l.publish:void 0)&&(i=(c=this.view.formatters[r]).publish.apply(c,[i].concat(s.call(e))));return this.observer.publish(i)},e.prototype.bind=function(){var e,n,r,i,o,s,a;if(null!=(o=this.binder.bind)&&o.call(this,this.el),this.observer=new t.Observer(this.view,this.view.models,this.keypath,this.sync),this.model=this.observer.target,null!=this.model&&(null!=(s=this.options.dependencies)?s.length:void 0))for(a=this.options.dependencies,r=0,i=a.length;i>r;r++)e=a[r],n=new t.Observer(this.view,this.model,e,this.sync),this.dependencies.push(n);
return this.view.config.preloadData?this.sync():void 0},e.prototype.unbind=function(){var t,e,n,r,i;for(null!=(r=this.binder.unbind)&&r.call(this,this.el),this.observer.unobserve(),i=this.dependencies,e=0,n=i.length;n>e;e++)t=i[e],t.unobserve();return this.dependencies=[]},e.prototype.update=function(t){var e;return null==t&&(t={}),this.model=this.observer.target,null!=(e=this.binder.update)?e.call(this,t):void 0},e}(),t.ComponentBinding=function(e){function n(e,n,r){var s,a,u,l,c;for(this.view=e,this.el=n,this.type=r,this.unbind=i(this.unbind,this),this.bind=i(this.bind,this),this.update=i(this.update,this),this.locals=i(this.locals,this),this.component=t.components[this.type],this.attributes={},this.inflections={},l=this.el.attributes||[],a=0,u=l.length;u>a;a++)s=l[a],c=s.name,o.call(this.component.attributes,c)>=0?this.attributes[s.name]=s.value:this.inflections[s.name]=s.value
}return u(n,e),n.prototype.sync=function(){},n.prototype.locals=function(t){var e,n,r,i,o,s,a,u,l;null==t&&(t=this.view.models),o={},u=this.inflections;for(n in u)for(e=u[n],l=e.split("."),s=0,a=l.length;a>s;s++)i=l[s],o[n]=(o[n]||t)[i];for(n in t)r=t[n],null==o[n]&&(o[n]=r);return o},n.prototype.update=function(t){var e;return null!=(e=this.componentView)?e.update(this.locals(t)):void 0},n.prototype.bind=function(){var e,n;return null!=this.componentView?null!=(n=this.componentView)?n.bind():void 0:(e=this.component.build.call(this.attributes),(this.componentView=new t.View(e,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(e,this.el))
},n.prototype.unbind=function(){var t;return null!=(t=this.componentView)?t.unbind():void 0},n}(t.Binding),t.TextBinding=function(t){function e(t,e,n,r,o){this.view=t,this.el=e,this.type=n,this.keypath=r,this.options=null!=o?o:{},this.sync=i(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[]}return u(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(t.Binding),t.KeypathParser=function(){function t(){}return t.parse=function(t,e,n){var r,i,s,a,u,l;
for(a=[],i={"interface":n,path:""},s=u=0,l=t.length;l>u;s=u+=1)r=t.charAt(s),o.call(e,r)>=0?(a.push(i),i={"interface":r,path:""}):i.path+=r;return a.push(i),a},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var n,r,i,o,s,a,u;for(a=[],o=t.length,n=0,r=0;o>r;){if(n=t.indexOf(e[0],r),0>n){a.push({type:this.types.text,value:t.slice(r)});break}if(n>0&&n>r&&a.push({type:this.types.text,value:t.slice(r,n)}),r=n+e[0].length,n=t.indexOf(e[1],r),0>n){s=t.slice(r-e[1].length),i=a[a.length-1],(null!=i?i.type:void 0)===this.types.text?i.value+=s:a.push({type:this.types.text,value:s});
break}u=t.slice(r,n).trim(),a.push({type:this.types.binding,value:u}),r=n+e[1].length}return a},t}(),t.Observer=function(){function e(t,e,n,r){this.view=t,this.model=e,this.keypath=n,this.callback=r,this.unobserve=i(this.unobserve,this),this.realize=i(this.realize,this),this.value=i(this.value,this),this.publish=i(this.publish,this),this.read=i(this.read,this),this.set=i(this.set,this),this.adapter=i(this.adapter,this),this.update=i(this.update,this),this.initialize=i(this.initialize,this),this.parse=i(this.parse,this),this.parse(),this.initialize()
}return e.prototype.parse=function(){var e,n,r,i,s,a;return e=function(){var t,e;t=this.view.adapters,e=[];for(n in t)s=t[n],e.push(n);return e}.call(this),a=this.keypath[0],o.call(e,a)>=0?(i=this.keypath[0],r=this.keypath.substr(1)):(i=this.view.config.rootInterface,r=this.keypath),this.tokens=t.KeypathParser.parse(r,e,i),this.key=this.tokens.pop()},e.prototype.initialize=function(){return this.objectPath=[],this.target=this.realize(),null!=this.target?this.set(!0,this.key,this.target,this.callback):void 0
},e.prototype.update=function(){var t,e;return(t=this.realize())!==this.target&&(null!=this.target&&this.set(!1,this.key,this.target,this.callback),null!=t&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,this.value()!==e)?this.callback():void 0},e.prototype.adapter=function(t){return this.view.adapters[t["interface"]]},e.prototype.set=function(t,e,n,r){var i;return i=t?"subscribe":"unsubscribe",this.adapter(e)[i](n,e.path,r)},e.prototype.read=function(t,e){return this.adapter(t).read(e,t.path)
},e.prototype.publish=function(t){return null!=this.target?this.adapter(this.key).publish(this.target,this.key.path,t):void 0},e.prototype.value=function(){return null!=this.target?this.read(this.key,this.target):void 0},e.prototype.realize=function(){var t,e,n,r,i,o,s,a;for(t=this.model,i=null,a=this.tokens,e=o=0,s=a.length;s>o;e=++o)r=a[e],null!=t?(null!=this.objectPath[e]?t!==(n=this.objectPath[e])&&(this.set(!1,r,n,this.update),this.set(!0,r,t,this.update),this.objectPath[e]=t):(this.set(!0,r,t,this.update),this.objectPath[e]=t),t=this.read(r,t)):(null==i&&(i=e),(n=this.objectPath[e])&&this.set(!1,r,n,this.update));
return null!=i&&this.objectPath.splice(i),t},e.prototype.unobserve=function(){var t,e,n,r,i,o;for(o=this.tokens,t=r=0,i=o.length;i>r;t=++r)n=o[t],(e=this.objectPath[t])&&this.set(!1,n,e,this.update);return null!=this.target?this.set(!1,this.key,this.target,this.callback):void 0},e}(),t.binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t.binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t.binders.show=function(t,e){return t.style.display=e?"":"none"
},t.binders.hide=function(t,e){return t.style.display=e?"none":""},t.binders.enabled=function(t,e){return t.disabled=!e},t.binders.disabled=function(t,e){return t.disabled=!!e},t.binders.checked={publishes:!0,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var n;return t.checked="radio"===t.type?(null!=(n=t.value)?n.toString():void 0)===(null!=e?e.toString():void 0):!!e}},t.binders.unchecked={publishes:!0,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)
},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var n;return t.checked="radio"===t.type?(null!=(n=t.value)?n.toString():void 0)!==(null!=e?e.toString():void 0):!e}},t.binders.value={publishes:!0,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var n,r,i,s,a,u,l;if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(s=t.val())?s.toString():void 0))return t.val(null!=e?e:"")
}else if("select-multiple"===t.type){if(null!=e){for(l=[],r=0,i=t.length;i>r;r++)n=t[r],l.push(n.selected=(a=n.value,o.call(e,a)>=0));return l}}else if((null!=e?e.toString():void 0)!==(null!=(u=t.value)?u.toString():void 0))return t.value=null!=e?e:""}},t.binders["if"]={block:!0,bind:function(t){var e,n;return null==this.marker?(e=[this.view.config.prefix,this.type].join("-").replace("--","-"),n=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+n+" "),t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0
},unbind:function(){var t;return null!=(t=this.nested)?t.unbind():void 0},routine:function(e,n){var r,i,o,s,a;if(!!n==(null==this.nested)){if(n){o={},a=this.view.models;for(r in a)i=a[r],o[r]=i;return s={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:this.view.options.config},(this.nested=new t.View(e,o,s)).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling)}return e.parentNode.removeChild(e),this.nested.unbind(),delete this.nested
}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t.binders.unless={block:!0,bind:function(e){return t.binders["if"].bind.call(this,e)},unbind:function(){return t.binders["if"].unbind.call(this)},routine:function(e,n){return t.binders["if"].routine.call(this,e,!n)},update:function(e){return t.binders["if"].update.call(this,e)}},t.binders["on-*"]={"function":!0,unbind:function(e){return this.handler?t.Util.unbindEvent(e,this.args[0],this.handler):void 0},routine:function(e,n){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(n))
}},t.binders["each-*"]={block:!0,bind:function(t){var e;return null==this.marker?(e=[this.view.config.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0},unbind:function(){var t,e,n,r,i;if(null!=this.iterated){for(r=this.iterated,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.unbind());return i}},routine:function(e,n){var r,i,o,s,a,u,l,c,f,p,h,d,v,y,g,_,m,w,b,x,V,E,M,T;
if(c=this.args[0],n=n||[],this.iterated.length>n.length)for(x=Array(this.iterated.length-n.length),y=0,m=x.length;m>y;y++)o=x[y],v=this.iterated.pop(),v.unbind(),this.marker.parentNode.removeChild(v.els[0]);for(s=g=0,w=n.length;w>g;s=++g)if(l=n[s],i={index:s},i[c]=l,null==this.iterated[s]){V=this.view.models;for(u in V)l=V[u],null==i[u]&&(i[u]=l);p=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,f={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:{}},E=this.view.options.config;
for(a in E)d=E[a],f.config[a]=d;f.config.preloadData=!0,h=e.cloneNode(!0),v=new t.View(h,i,f),v.bind(),this.iterated.push(v),this.marker.parentNode.insertBefore(h,p.nextSibling)}else this.iterated[s].models[c]!==l&&this.iterated[s].update(i);if("OPTION"===e.nodeName){for(M=this.view.bindings,T=[],_=0,b=M.length;b>_;_++)r=M[_],T.push(r.el===this.marker.parentNode&&"value"===r.type?r.sync():void 0);return T}},update:function(t){var e,n,r,i,o,s,a,u;e={};for(n in t)r=t[n],n!==this.args[0]&&(e[n]=r);for(a=this.iterated,u=[],o=0,s=a.length;s>o;o++)i=a[o],u.push(i.update(e));
return u}},t.binders["class-*"]=function(t,e){var n;return n=" "+t.className+" ",!e==(-1!==n.indexOf(" "+this.args[0]+" "))?t.className=e?""+t.className+" "+this.args[0]:n.replace(" "+this.args[0]+" "," ").trim():void 0},t.binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e;return null==t[this.id]&&(e=this.counter++,this.weakmap[e]={callbacks:{}},Object.defineProperty(t,this.id,{value:e})),this.weakmap[t[this.id]]
},stubFunction:function(t,e){var n,r,i;return r=t[e],n=this.weakReference(t),i=this.weakmap,t[e]=function(){var e,o,s,a,u,l,c,f,p,h;a=r.apply(t,arguments),c=n.pointers;for(s in c)for(o=c[s],h=null!=(f=null!=(p=i[s])?p.callbacks[o]:void 0)?f:[],u=0,l=h.length;l>u;u++)(e=h[u])();return a}},observeMutations:function(t,e,n){var r,i,s,a,u,l;if(Array.isArray(t)){if(s=this.weakReference(t),null==s.pointers)for(s.pointers={},i=["push","pop","shift","unshift","sort","reverse","splice"],u=0,l=i.length;l>u;u++)r=i[u],this.stubFunction(t,r);
if(null==(a=s.pointers)[e]&&(a[e]=[]),o.call(s.pointers[e],n)<0)return s.pointers[e].push(n)}},unobserveMutations:function(t,e,n){var r,i;return Array.isArray(t&&null!=t[this.id])&&(r=null!=(i=this.weakReference(t).pointers)?i[e]:void 0)?r.splice(r.indexOf(n),1):void 0},subscribe:function(t,e,n){var r,i,s=this;return r=this.weakReference(t).callbacks,null==r[e]&&(r[e]=[],i=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return i},set:function(o){var a,u,l;if(o!==i){for(i=o,l=r[e],a=0,u=l.length;u>a;a++)(n=l[a])();
return s.observeMutations(o,t[s.id],e)}}})),o.call(r[e],n)<0&&r[e].push(n),this.observeMutations(t[e],t[this.id],e)},unsubscribe:function(t,e,n){var r;return r=this.weakmap[t[this.id]].callbacks[e],r.splice(r.indexOf(n),1),this.unobserveMutations(t[e],t[this.id],e)},read:function(t,e){return t[e]},publish:function(t,e,n){return t[e]=n}},t.factory=function(e){return e._=t,e.binders=t.binders,e.components=t.components,e.formatters=t.formatters,e.adapters=t.adapters,e.config=t.config,e.configure=function(e){var n,r;
null==e&&(e={});for(n in e)r=e[n],t.config[n]=r},e.bind=function(e,n,r){var i;return null==n&&(n={}),null==r&&(r={}),i=new t.View(e,n,r),i.bind(),i}},"object"==typeof exports?t.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(e){return t.factory(this.rivets=e),e}):t.factory(this.rivets={})}.call(this),function(t,e){"function"==typeof define&&define.amd?define(["noscript","rivets"],e):"object"==typeof exports?module.exports=e(require("noscript"),require("rivets")):ns.ViewRivets=e(t.ns,t.rivets)
}(this,function(t,e){var n=t.View,r=function(e){return e instanceof t.Model},i=function(e){return e instanceof t.ModelCollection};e.configure({handler:function(t,e,n){this.call(n.model,e,n)}}),e.adapters[":"]={subscribe:function(t,e,n){r(t)&&t.on("ns-model-changed."+e,n)},unsubscribe:function(t,e,n){r(t)&&t.off("ns-model-changed."+e,n)},read:function(t,e){return r(t)?t.get("."+e):void 0},publish:function(t,e,n){r(t)&&t.set("."+e,n)}},e.adapters["*"]={subscribe:function(t,e,n){i(t)&&(t.on("ns-model-insert",n),t.on("ns-model-remove",n))
},unsubscribe:function(t,e,n){i(t)&&(t.off("ns-model-insert",n),t.off("ns-model-remove",n))},read:function(t){return i(t)?t.models:void 0}};var o=function(){};return no.inherit(o,n,{_init:function(){n.prototype._init.apply(this,arguments),this.on("ns-view-htmlinit",this._bindRivetsView),this.on("ns-view-htmldestroy",this._unbindRivetsView)},_bindRivetsView:function(){this._rivetsView=e.bind(this.node,{view:this,models:this.models})},_unbindRivetsView:function(){this._rivetsView.unbind()}})}),no.True=no["true"],no.False=no["false"],ns.action.getParams=function(t){var e=t.getAttribute("data-params")||t.getAttribute("params"),n=t.getAttribute("href");
if(e){if(!e||"{"!==e.charAt(0))return ns.parseQuery(e||"");try{return JSON.parse(e)}catch(r){}}else if(n)return(ns.router(n)||{}).params;return{}},ns.action.__process=ns.action._process,ns.action._process=function(t){return t.isPropagationStopped()?!1:ns.action.__process(t)},ns.action.__run=ns.action.run,ns.action.run=function(t,e,n,r){if(e=e||{},e.counter){var i=e.counter.split(":");i&&i.length&&Jane.c(i[0],i[1])}e.mcounter&&(Jane.c(e.mcounter.split(":")),e.mcounter=null);var o=["archive","delete","forward","ignore","infolder","label","mark","move","sendon","stop-waitforreply","reply","reply-all","reply-tmpl","unlabel","unmark","unsubscribe"];
return o.indexOf(t)>-1&&!e.doNotCloseDropdown&&$(document).trigger("b-mail-dropdown-closeall"),ns.action.__run(t,e,n,r)},ns.action.__init=ns.action.init,ns.action.init=function(){var t=$("body");t.on("submit",".daria-form",function(t){var e=t.currentTarget,n=!0,r=$(e),i=e.getAttribute("data-click-action");return i&&!r.prop("disabled")&&(n=ns.action.run(i,ns.action.getParams(e),e,t)),void 0===n?!1:n}),t.on("click",".daria-action",function(t){var e=t.currentTarget,n=!0,r=$(e),i=e.getAttribute("data-action")||e.getAttribute("action");
return i&&!r.prop("disabled")&&(n=ns.action.run(i,ns.action.getParams(e),e,t)),void 0===n?!1:n}),ns.action.__init()},ns._ns_html2node=ns.html2node,ns.html2node=function(t){if(!t)return null;for(var e=ns._ns_html2node(t),n=e.getElementsByTagName("x-a"),r=n.length-1;r>=0;r--){var i=n[r],o=ns.renameNode(i,"a");i.parentNode.replaceChild(o,i)}return e},ns.renameNode=function(t,e){var n,r,i=document.createElement(e),o=t.attributes;for(n=0,r=o.length;r>n;n++){var s=o[n];i.setAttribute(s.name,s.value)}for(;t.firstChild;)i.appendChild(t.firstChild);
return i},ns.http=function(t,e,n){n=no.extend({},ns.H.DEFAULTS,n),n.url=t,n.data=e;var r=new Vow.Promise;return $.ajax(n).done(function(t){r.fulfill(t)}).fail(function(t,n,i){Jane.ErrorLog.send({errorType:"handlersjsx.httperror",status:t.status,headers:t.getAllResponseHeaders()},JSON.stringify(e));var o=i||n||"unknown error";r.reject({error:o,xhr:t})}),r},Function.prototype.bind&&window.console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(t){console[t]=this.bind(console[t],console)
},Function.prototype.call),ns.log.debug=function(){Daria.DEBUG&&console.log.apply(console,arguments)},ns.log.info=function(t,e,n){var r=n;if("ns.Update.restart"===t||"ns.Update.error-content"===t||"ns.View.error-content"===t){var i=n||[],o=!1;if(o&&0===i.length)return;n=JSON.stringify(ns.Model.collectErrorData(n||[]))}else if(n&&"string"!=typeof n)try{n=JSON.stringify(n)}catch(s){n="JSON.stringify.error"}Daria.DEBUG&&window.console&&window.console.group&&(console.group("[qu.log.info]"),console.log(t),console.log(e),console.log(r),console.groupEnd("[qu.log.info]")),e=e||{},e.event=t,Jane.ErrorLog.send(e,n)
},ns.log.exception=function(t,e,n){Jane.ErrorLog.sendException(t,e,n)},ns.Model.destroyAll=function(t){Array.isArray(t)||(t=[t]),t.forEach(function(t){ns.Model.isDefined(t)&&ns.Model.traverse(t,ns.Model.destroy)})},ns.Model.invalidateAll=function(t){Array.isArray(t)||(t=[t]),t.forEach(function(t){ns.Model.isDefined(t)&&ns.Model.invalidate(t)})},ns.Model.isDefined=function(t){var e=!1;try{ns.Model.infoLite(t)&&(e=!0)}catch(n){}return e},ns.Model.collectErrorData=function(t){var e={};return t.forEach(function(t,n){e["model."+n]=t.id,e["key."+n]=t.key,e["error."+n]=t.getError(),e["status."+n]=t.status
}),e},ns.Model.prototype.setIfChanged=function(t,e,n){n=n||{};var r=this.get(t),i=!1;return(!_.isEqual(r,e)||n.force)&&(this.set.apply(this,arguments),i=!0),i},ns.Model.prototype.inNotInitedState=function(){return this.status===this.STATUS.NONE},ns.Model.prototype.set=function(t,e,n){var r=this.data;if(this.isValid()&&r){var i=_.clone(this.get(t));no.jpath.set(t,r,e),n=n||{},n.jpath=t,this.touch(n),n.silent||this.triggerChangedEvent(t,n.data,i)}},ns.Model.prototype.triggerChangedEvent=function(t,e,n){e=e||{};
for(var r=t.split("."),i=r.length;i>1;){var o=r.slice(0,i).join(".");this.trigger("ns-model-changed"+o,o,t,e,n),i--}},ns.Model.prototype.isErrorCanBeFixed=function(t){return"account-information"!==this.id&&"ckey"===t},ns.Model.prototype.fixError=function(){return ns.forcedRequest(["account-information"])},ns.Model.prototype._lz_setError=ns.Model.prototype.setError,ns.Model.prototype.setError=function(t){if(this._lz_setError(t),this.status===this.STATUS.ERROR){var e={errorType:"HandlerError",name:this.id,key:this.key};
Jane.ErrorLog.send(e,JSON.stringify(t))}},ns.ModelArmour=function(){},no.inherit(ns.ModelArmour,ns.Model),ns.ModelArmour.prototype._extractData=ns.Model.prototype.extractData,ns.ModelArmour.prototype.extractData=function(t){return this._extractData(t)||{}},ns.ModelStatic=function(){},no.inherit(ns.ModelStatic,ns.Model),ns.ModelStatic.prototype.canRequest=no.False,ns.ModelStatic.prototype.destroy=function(){ns.Model.prototype.destroy.apply(this),this._reinit()},ns.ModelStatic.prototype.invalidate=function(){this.destroy()
};var e=/^#\s([^#]+)$/,n=/^([^\s>*!]+) > ([^\s>*!]+)$/,r="* > *";ns.ModelFsm=function(){},no.inherit(ns.ModelFsm,ns.Model),ns.ModelFsm.prototype._init=function(){this._transitionEvents={},this._inTransition=!1,this._isSwitchOn=!0,ns.Model.prototype._init.apply(this,arguments)},ns.ModelFsm.prototype.log=function(){var t=_.toArray(arguments);t=["[ns.ModelFsm] id:",this.id].concat(t),ns.log.debug.apply(ns.log,t)},ns.ModelFsm.prototype.request=function(){var t=this.start;return ns.assert(!_.isUndefined(t),"ns.ModelFsm.onInit","'start' state is required param of FSM"),_.isFunction(t)&&(t=this.start()),this.setInitialState(t),vow.Promise.resolve()
},ns.ModelFsm.prototype.setInitialState=function(t){this.setData({state:t})},ns.ModelFsm.prototype.setState=function(t,e){var n=this.get(".state"),r=this._checkTransitionToState(t),i={from:n,to:t,data:e};return r.then(function(){this.log("Transition from",n,"to",t,"is started"),this.trigger(n+" > "+t,i)}.bind(this),function(){this.log("Can't do transition from",n,"to",t),this.log("Current state is",n),Jane.ErrorLog.send({errorType:"fsm_transition_failed",fsmModel:this.id,fromState:n,toState:t,inTransition:this._inTransition,isSwitchOn:this._isSwitchOn})
}.bind(this)),r},ns.ModelFsm.prototype._checkTransitionToState=function(t){var e=this.get(".state"),n=this.transitions["*"],r=this.transitions[e];return this._inTransition||!this._isSwitchOn?vow.Promise.reject():t===e?vow.Promise.reject():n&&_.contains(n,t)?vow.Promise.resolve():_.contains(r,t)||_.contains(r,"*")?vow.Promise.resolve():vow.Promise.reject()},ns.ModelFsm.prototype.getState=function(){return this.get(".state")},ns.ModelFsm.prototype.isCurrentState=function(t){return t=$.makeArray(t),_.contains(t,this.get(".state"))
},ns.ModelFsm.prototype._applyState=function(t,e){this.log("Apply state:",t," EventData:",e),this.set(".state",t),this.trigger("# "+t,e),this.trigger("# *",e)},ns.ModelFsm.prototype.transitionEventHandler=function(t,e){var n=this._transitionEvents[t],i=n.handlers;if(t!==r){var o=this._transitionEvents[r];o&&(i=i.concat(o.handlers))}var s=[];this._inTransition=!0,_.each(i,function(n){s.push(n(t,e))}),this._transitionDeferred=new vow.Deferred,this._transitionDeferred.promise().then(this._transitionSuccess.bind(this,e),this._transitionError.bind(this,e)),vow.all(s).then(this._transitionDeferred.resolve.bind(this._transitionDeferred),this._transitionDeferred.reject.bind(this._transitionDeferred))
},ns.ModelFsm.prototype._transitionSuccess=function(t){this._inTransition=!1,this.log("Transition from",t.from,"to",t.to,"is success"),this._applyState(t.to,t)},ns.ModelFsm.prototype._transitionError=function(t,e){this._inTransition=!1,t.error=e,this.log("Transition from",t.from,"to",t.to,"failed. Error:",e),this.log("Current state is",t.from),this.trigger(t.from+" !> "+t.to,t),this.trigger("* !> *",t)},ns.ModelFsm.prototype.on=function(t,e){var n=this.getEventData(t);if("transition"===n.type){var r=this._transitionEvents[t];
r||(r=this._transitionEvents[t]={name:t,handlers:[],callback:this.transitionEventHandler.bind(this)},ns.Model.prototype.on.call(this,t,r.callback)),r.handlers.push(e)}else ns.Model.prototype.on.call(this,t,e);return this},ns.ModelFsm.prototype.off=function(t,e){var n=this.getEventData(t);if("transition"===n.type){var r=this._transitionEvents[t];r&&(r.handlers=_.reject(r.handlers,function(t){return t===e}),r.handlers.length||(delete this._transitionEvents[t],ns.Model.prototype.off.call(this,t,r.callback)))
}else ns.Model.prototype.off.call(this,t,e);return this},ns.ModelFsm.prototype.trigger=function(t,e){return this._isSwitchOn?n.test(t)&&!this._transitionEvents[t]?void this.trigger(r,e):t!==r||this._transitionEvents[t]?void ns.Model.prototype.trigger.apply(this,arguments):(this.log("Transition from",e.from,"to",e.to,"is success"),void this._applyState(e.to,e)):void 0},ns.ModelFsm.prototype.getEventData=function(t){var i={type:t,from:"",to:""},o=[t];if(e.test(t)&&(o=t.match(e),i.type="current",i.to=o[1]),t===r&&(i.type="transition",i.from="*",i.to="*"),n.test(t)){o=t.match(n);
var s=o[1],a=o[2];i.type=s&&a?"transition":t,i.from=s,i.to=a}return i},ns.ModelFsm.prototype.inTransition=function(){return this._inTransition},ns.ModelFsm.prototype.abortTransition=function(){this._inTransition&&this._transitionDeferred.reject()},ns.ModelFsm.prototype.switchOff=function(){this.log("Model is switchOff"),this.abortTransition(),this._isSwitchOn=!1},ns.ModelFsm.prototype.switchOn=function(){this.log("Model is switchOn"),this._isSwitchOn=!0},ns.ModelFsm.prototype.destroy=function(){this.switchOn(),this.abortTransition(),ns.Model.prototype.destroy.apply(this),this._reinit()
},ns.ModelFsm.prototype.invalidate=ns.ModelFsm.prototype.destroy,ns.ModelCollectionStatic=function(){},no.inherit(ns.ModelCollectionStatic,ns.ModelCollection),ns.ModelCollectionStatic.prototype.canRequest=no.False,ns.ModelCollectionStatic.prototype.destroy=function(){ns.Model.prototype.destroy.apply(this),this._reinit()},ns.ModelCollectionStatic.prototype.invalidate=ns.ModelCollectionStatic.prototype.destroy,ns.page.current={page:null,params:{}},ns.page.HOME_HASH="#inbox",ns.page.home=function(t){return ns.page.go(ns.page.HOME_HASH,t?"replace":"push")
},ns.page.refresh=function(){return ns.page.go(ns.page.currentUrl),new vow.Promise(function(t){ns.events.once("ns-page-after-load",t)})},ns.page.followRoute=function(){var t=new Vow.Promise;if(Jane.Services.hasNewVersion()&&Daria.Page.loadingHash!==ns.page.currentUrl&&!/^#compose/.test(ns.page.currentUrl)&&!/^#done/.test(Daria.Page.loadingHash))return ns.page.forceReload(Daria.Page.loadingHash),t;var e=Daria.modulesForPage(Daria.Page.loadingHash);return Jane.Services.runModules(e,function(){t.fulfill()
}),t},ns.page.getCurrentUrl=function(){var t=window.location.href,e=t.indexOf("#");return-1!==e?t.substr(e):ns.page.HOME_HASH},ns.page.getDefaultUrl=function(){return ns.router.url(ns.page.HOME_HASH)},ns.page.replacePage=function(t,e){var n=ns.router.generateUrl(t,e);ns.page.hashReplace(n),ns.page._setCurrent({page:t,params:e},n)},ns.page.title=no.nop,ns.events.on("ns-page-before-load",function(t,e,n){var r=ns.page.currentUrl;r&&n!=r&&ns.events.trigger("ns-page-before-changed",r,n),Daria.Page.loadingHash=n,Daria.Page.referer=ns.page.current.page
}),ns.page._go=ns.page.go,ns.page.go=function(t,e){if(ns.log.debug("[ns.page.go]",t,e),t&&"#"!==t.charAt(0))return e===!0||"replace"===e?window.location.replace(t):window.location=t,new Vow.Promise;var n=["done","search"],r=ns.page.current.page;return _.contains(n,r)?ns.page._go(t,!0):ns.page._go(t,e)},ns.page.block.clearByCondition=function(t){return ns.page.block._checkers=ns.page.block._checkers.filter(function(e){return!Boolean(t(e))}),this},ns.page.history.getPreviousPageUrl=function(t){t=t||{};
var e,n,r=-1,i=$.makeArray(t.match),o=$.makeArray(t.mismatch),s=function(){var t=_.isEmpty(i)?function(){return!0}:function(t){return _.contains(i,t)},e=function(t){return!_.contains(o,t)};return function(n){return t(n)&&e(n)}},a=s();do e=ns.page.history.getPrevious(++r),e&&(n=ns.router(e).page);while(e&&!a(n));return e},ns.page.history.getFirstValidPrevious=function(t){for(var e,n=ns.page.history._history,r=n.length;r--;)if(e=n[r],t(e))return e;return null},ns.request.addRequestParams=function(t){t._uid=Daria.uid,t._ckey=Daria.Page.ckey,t._connection_id=Daria.Config.connection_id,t._locale=Daria.Config.locale,t._product=Daria.Config.product,t._timestamp=Date.now(),t._exp=Daria.Config["exp-boxes"],t._eexp=Daria.Config["eexp-boxes"],t._messages_per_page=ns.Model.get("settings").getSetting("messages_per_page")||30,Jane.ADBLOCK&&this._shouldRequestAds()&&(t=this._addRequestAdsParams(t))
},ns.request._shouldRequestAds=function(){var t=1e4,e=ns.Model.get("ads"),n=Date.now(),r=e._lastRequest||0;return n-r>=t?(e._lastRequest=n,!0):!1},ns.request._addRequestAdsParams=function(t){return t._ad=JSON.stringify({"target-ref":String(window.location),"page-ref":String(document.referrer)}),t},ns.request.canProcessResponse=function(t){var e=t.versions,n=t.timestamp;return Daria.Config.dev||e&&e.u2709&&Jane.Services.setActualVersion(e.u2709),n&&(Daria._timestampDelta=Date.now()-n||0),Daria.parseLoginInfo(t)
},Daria.parseLoginInfo=function(t){var e=jpath(t,'.models.error[.code == "AUTH_NO_AUTH"]')[0]||jpath(t,'.error[.code == "AUTH_NO_AUTH"]')[0];if(e)return Jane.doLogin("parseLoginInfo",e),ns.request._reset(),!1;if(Array.isArray(t.models)){var n=t.models[t.models.length-1];if("ads"===n.name){var r=t.models.pop(),i=ns.Model.get("ads");i.setData(r.data)}}var o=t.uid;return o&&o!=Daria.uid?(Jane.locate("/"),!1):(t.cookieRenew&&!Jane.cookieRenewFrameTimer&&(document.cookie="Cookie_check=1; domain=."+Jane.Config["yandex-domain"]+"; path=/",$('<iframe id="jane-cookie-renew" src="//'+Jane.Config["passport-host"]+'/auth/update/" class="g-invisible"/>').appendTo("body"),Jane.cookieRenewFrameTimer=window.setTimeout(function(){delete Jane.cookieRenewFrameTimer,$("#jane-cookie-renew").remove()
},6e4)),Daria.AuthDialog.close&&Daria.AuthDialog.close(),!0)},ns.router._ns_generateUrl=ns.router.generateUrl,ns.router.generateUrl=function(t,e){return e=e||{},delete e.threaded,delete e["_actions-dropdown-type"],(e.attachments||e.unread)&&(delete e.extra_cond,delete e["goto"]),ns.router._ns_generateUrl(t,e)},ns.router.buildFoldersUrls=function(){var t=ns.Model.get("folders"),e=t.symbols();for(var n in e)ns.router.routes.rewriteUrl["#"+n]="#folder/"+e[n]},ns.Update.calcPerformanceTimings=function(t){var e={allTime:0,allSumTime:0,requestTime:0,selfTime:0};
for(var n in t)if("_"!==n.charAt(0)){var r=t[n];r.toString().length>10&&(r=Date.now()-r),"full"===n?e.allTime=r:0===n.indexOf("requestModels")?e.requestTime+=r:e.allSumTime+=r,e[n]=r}return e.selfTime=e.allTime-e.requestTime,e},ns.Update.handleError=function(t,e){if(_.method("outputError",t,e)(e.view))return!0;if(t.expired)return!1;var n,r=!1,i=[];return t.invalidModels&&(n=ns.Model.collectErrorData(t.invalidModels),t.invalidModels.forEach(function(t){"message"!==t.id&&"message-body"!==t.id||t.exists()||(r=!0,i.push(_.get(t,"params.ids")))
})),r?(Jane.ErrorLog.send({errorType:"no_such_message",pageReferref:ns.page.history.getPrevious()}),e._reject({error:"NO_MESSAGE"}),e.promise.then(null,function(){function t(n){if(ns.page.block.remove(t),clearTimeout(e),!n||n===ns.page.currentUrl)return ns.page.go("#no-message"),!1;if(n){var r=ns.router(n),o=_.get(r,"params.ids")||_.get(r,"params.thread_id");if(o&&_.contains(i,o))return ns.page.go("#no-message"),!1}return!0}var e=setTimeout(function(){ns.page.refresh()},2e3);ns.page.block.add(t)})):(Jane.ErrorLog.send({errorType:"RunFailed",type:t.error},JSON.stringify(n)),e.EXEC_FLAG===ns.U.EXEC.GLOBAL&&(e.promise.then(null,function(){ns.page.hashReplace(ns.page.history.getPrevious())
}),alert("Ошибка. Не удалось загрузить данные, повторите через некоторое время."))),!1},ns.Update.prototype.applyTemplate=function(t){return ns.renderString(t,null,"common")},ns.Update.prototype.perf=function(t){try{this._logPerfTimings(t)}catch(e){Jane.ErrorLog.sendException("LongRunError",e)}},ns.Update.prototype._logPerfTimings=function(t){var e=ns.Update.calcPerformanceTimings(t);ns.DEBUG&&this.log("perf",t,e),e.selfTime>1e3&&this._sendLongRun("LongRun",e,t),e.allTime>2e3&&this._sendLongRun("LongRun2",e,t)
},ns.Update.prototype._sendLongRun=function(t,e,n){var r={event:t,block:this.view.id,theme:Daria.themeId,allTime:e.allTime,requestTime:e.requestTime,selfTime:e.selfTime};for(var i in n)r["perf."+i]=n[i];Jane.ErrorLog.send(r)},ns.View.prototype.logTimings=function(t){var e=ns.Update.calcPerformanceTimings(t),n={allTime:0,requestTime:0,selfTime:0};t.__parent&&(n=ns.Update.calcPerformanceTimings(t.__parent));var r={blockname:this.id,request:e.requestTime+n.requestTime,event:"BlockTimings",visibilityState:document.visibilityState,show:e.allTime+n.allTime,browser:Jane.UA.BrowserName};
r=_.extend(e,r),Jane.ErrorLog.send(r)},ns.View.prototype.updateByLayout=function(t,e,n){var r=ns.layout.page(t,e);if(n=n||{},n.execFlag=n.execFlag||ns.U.EXEC.ASYNC,this.layout){var i=this.layout[this.id].views;for(var o in i)delete i[o];no.extend(i,r[this.id].views)}else this.layout=r;return new ns.Update(this,this.layout,e,n).render()},ns.View.prototype.getBlockByName=function(t){return this.views[t]},ns.View.prototype.forceUpdate=function(){this.info&&!this.info.isCollection&&this.invalidate(),this.lazyUpdate()
},ns.View.prototype.lazyUpdate=function(){this.isVisible()&&ns.page.lazyRefresh()},ns.View.isDefined=function(t){var e=!1;try{ns.View.infoLite(t)&&(e=!0)}catch(n){}return e},ns.ViewCollection.prototype.forEachValidItem=function(t){this.forEachItem(function(e){e.isValid()&&t(e)})},ns.initMainView=function(){var t=ns.View.create("app");t._setNode(document.getElementById("block-app")),t.invalidate(),ns.MAIN_VIEW=t},ns.tmpl=function(e,n,r){try{var i=t.run(r||"main",e,n);i||console.info("no result",e,n,r);
var o=ns.html2node(i);return o?o.firstChild:null}catch(s){return Jane.ErrorLog.sendException("yate.run",s,{"yate-mode":n,"yate-module":r}),window.DariaAfterLoad||""!==n||Jane.onFatalError("yate.run"),ns.html2node("")}},ns.request.URL=Daria.modelsApiURl,ns.V.DOM_EVENTS.push("onSave"),ns.V.DOM_EVENTS.push("b-mail-dropdown-open"),ns.V.DOM_EVENTS.push("message"),ns.V.DOM_EVENTS.push("dragndrop.drop"),ns.V.DOM_EVENTS.push("result"),ns.V.DOM_EVENTS.push("wheel"),ns.V.DOM_EVENTS.push("DOMNodeRemoved"),ns.V.DOM_EVENTS.push("DOMNodeInserted"),ns.V.DOM_EVENTS.push("DOMNodeInsertedIntoDocument"),ns.V.DOM_EVENTS.push("DOMNodeRemovedFromDocument"),ns.DEBUG=Daria.DEBUG,window.jpath=function(t,e){return no.jpath.raw(e,t).toArray()
},ns.getViewMethods=function(t){if(!ns.View.isDefined(t))return void console.error("Вид `"+t+"` не определен");var e=ns.View.infoLite(t).methods;return _.isArray(e)&&(e=_.extend.apply(null,[{}].concat(e))),e},ns.getViewMethod=function(t,e){var n=ns.getViewMethods(t);if(n)return n[e]?n[e]:void console.error("В виде `"+t+"` не определен метод `"+e+"`")}});